@page "/patientmanage/{id:decimal}"
@using Blazored.SessionStorage
@using Microsoft.AspNetCore.Components.WebAssembly.Hosting
@using Newtonsoft.Json

@using Syncfusion.Blazor.Navigations

@using BlazorApp.Shared
@using BlazorApp.Client.Models

@inject NavigationManager Navigation
@inject ISessionStorageService sessionStorage

@inject HttpClient Http

@inject PatientService PatientService
@inject PatientMngService PatientMngService

@inject ListVisitsService ListVisitsService
@inject VisitService VisitService

@inject ListVisusService ListVisusService
@inject VisusService VisusService

@inject ListControlliService ListControlliService
@inject ControlliService ControlliService

@inject ListOrtoctisService ListOrtoctisService
@inject OrtoctisService OrtoctisService

@inject ListDrugsService ListDrugsService

@inject PrescrizioniService PrescrizioniService

@inject RelazioniService RelazioniService

@using Syncfusion.Pdf
@using Syncfusion.Pdf.Grid;
@using Syncfusion.Drawing;
@using Syncfusion.Pdf.Graphics;
@inject Microsoft.JSInterop.IJSRuntime JS
@using System.IO;

@inject IWebAssemblyHostEnvironment Env

<h5>
    @TitlePage

    <span style="display: @fShowLessBtn;">
        <SfButton IconCss="e-icons e-chevron-up" CssClass="e-flat btn-white" Content="" OnClick='() => SwapView("less")'></SfButton>
    </span>
    <span style="display: @fShowMoreBtn;">
        <SfButton IconCss="e-icons e-chevron-down" CssClass="e-flat btn-white" Content="" OnClick='() => SwapView("more")'></SfButton>
    </span>
    @*<span>PazienteValido: @PazienteValido</span>*@

    <span style="float: right;">
        <SfButton IconCss="e-icons e-save icon-navy" CssClass="e-flat btn-light" Content="@SaveText" OnClick="() => SavePatient()"></SfButton>
        &nbsp;&nbsp;&nbsp;
        <SfButton IconCss="e-icons e-chevron-left icon-green" CssClass="e-flat btn-light" Content="Elenco Pazienti" OnClick="() => GoToPatientList(0)"></SfButton>
    </span>
</h5>

<!-- Sezione paziente -->
<div class="container-fluid bg-light" style="padding: 0 10px 10px 10px;">
    <div class="row">
        <div class="col-sm-1">
            <SfTextBox ID="cod" @bind-Value="@Cod" Placeholder="Cod" FloatLabelType="@FloatLabelType.Always" CssClass="sftext"></SfTextBox>
        </div>

        <div class="col-sm-4">
            <SfTextBox ID="lname" @bind-Value="@LName" Placeholder="Cognome" FloatLabelType="@FloatLabelType.Always" CssClass="sftext"></SfTextBox>
        </div>

        <div class="col-sm-3">
            <SfTextBox ID="fname" @bind-Value="@FName" Placeholder="Nome" FloatLabelType="@FloatLabelType.Always" CssClass="sftext"></SfTextBox>
        </div>

        <div class="col-sm-1">
            <SfMaskedTextBox ID="datanascita" @bind-Value="@BirthDate" Mask="00/00/0000" Placeholder="Data di nascita" FloatLabelType="@FloatLabelType.Always" CssClass="sftext"></SfMaskedTextBox>
        </div>

        <div class="col-sm-2">
            <SfTextBox ID="codfisc" @bind-Value="@CodFisc" Placeholder="Cod Fiscale" FloatLabelType="@FloatLabelType.Always"> CssClass="sftext"</SfTextBox>
        </div>
    </div>

    @if (ShowMore)
    {
        <div class="row" style="margin-top: 10px;">
            <div class="col-sm-4">
                <SfTextBox ID="address" @bind-Value="@Address" Placeholder="Indirizzo" FloatLabelType="@FloatLabelType.Always"></SfTextBox>
            </div>

            <div class="col-sm-3">
                <SfTextBox ID="city" @bind-Value="@City" Placeholder="Città" FloatLabelType="@FloatLabelType.Always"></SfTextBox>
            </div>

            <div class="col-sm-1">
                <SfTextBox ID="zipcode" @bind-Value="@ZipCode" Placeholder="CAP" FloatLabelType="@FloatLabelType.Always"></SfTextBox>
            </div>

            <div class="col-sm-3">
                <SfTextBox ID="state" @bind-Value="@State" Placeholder="Stato" FloatLabelType="@FloatLabelType.Always"></SfTextBox>
            </div>
        </div>

        <div class="row" style="margin-top: 10px;">
            <div class="col-sm-2">
                <SfTextBox ID="phone" @bind-Value="@Phone" Placeholder="Telefono" FloatLabelType="@FloatLabelType.Always"></SfTextBox>
            </div>

            <div class="col-sm-2">
                <SfTextBox ID="mobile" @bind-Value="@Mobile" Placeholder="Mobile" FloatLabelType="@FloatLabelType.Always"></SfTextBox>
            </div>

            <div class="col-sm-7">
                <SfTextBox ID="email" @bind-Value="@Email" Placeholder="Email" FloatLabelType="@FloatLabelType.Always"></SfTextBox>
            </div>
        </div>

        <div class="row" style="margin-top: 10px;">
            <div class="col-sm-8">
                <SfTextBox ID="note" @bind-Value="@Note" Placeholder="Note" FloatLabelType="@FloatLabelType.Always" Multiline="true"></SfTextBox>
            </div>
            <div class="col-sm-4">
                <span style="color: rgba(0, 0, 0, 0.54); font-size: 13px;line-height: 1.4; display:block; margin-bottom:2px;">Privacy</span>
                <div class="col-sm-4">
                    <label style="font-size: 11pt; padding: 0 8px 8px 0; vertical-align: super;">@switchPrivacy</label>
                    <SfSwitch @bind-Checked="@fPrivacy" ValueChange="ManagePrivacy" TChecked="bool"></SfSwitch>
                </div>
            </div>
        </div>

        <div class="row" style="margin-top: 10px; display: none;">
            <div class="col-sm-2">
                <SfTextBox ID="studio" @bind-Value="@Studio" Placeholder="Studio" FloatLabelType="@FloatLabelType.Always" Multiline="false"></SfTextBox>
            </div>
        </div>
    }
</div>

<!-- Sezione visite, prescrizione occhiali, controlli, ortottica,   -->
@if (ShowVisits)
{
    <div class="container-fluid" style="padding: 10px 10px; margin-top: 30px;">
        <div class="row">
            @*             <div class="col-sm-2">
                <span style="font-weight:600;">Data:&nbsp;</span><span style="font-size: 14px; color:midnightblue;">@DataVisita</span>
            </div>
 *@            
                <div class="col-sm-1" style="width: 118px;">
                <SfMaskedTextBox ID="datavisita" @bind-Value="@DataVisita" Mask="00/00/0000" Placeholder="Data" FloatLabelType="@FloatLabelType.Always" CssClass="sftext" style="color: #000;"></SfMaskedTextBox>
            </div>

            <div class="col-sm-2" style="padding-top: 28px;">
                <div class="btn-toolbar mb-3" role="toolbar" aria-label="Toolbar with button groups">
                    <div class="btn-group me-2" role="group" aria-label="First group">
                        <SfButton IconCss="e-icons icon-small e-first-page" CssClass="e-small e-flat btn-light" Content="" OnClick="() => GoToVisit(0)" Disabled="@FirstVisitDisabled" title="Ultima visita"></SfButton>
                        <SfButton IconCss="e-icons icon-small e-chevron-left" CssClass="e-small e-flat btn-light" Content="" OnClick="() => GoToVisit(1)" Disabled="@PrevVisitDisabled" title="Visita precedente"></SfButton>

                        <span class="vstepper">@IndexVisita</span>

                        <SfButton IconCss="e-icons icon-small e-chevron-right" CssClass="e-small e-flat btn-light" Content="" OnClick="() => GoToVisit(2)" Disabled="@NextVisitDisabled" title="Visita successiva"></SfButton>
                        <SfButton IconCss="e-icons icon-small e-last-page" CssClass="e-small e-flat btn-light" Content="" OnClick="() => GoToVisit(3)" Disabled="@LastVisitDisabled" title="Prima visita"></SfButton>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
                <SfTab>
                    <TabItems>
                        <!-- Sezione Visite -->
                        <TabItem>
                            <ChildContent>
                                <TabHeader Text="Visite"></TabHeader>
                            </ChildContent>
                            <ContentTemplate>
                                <div class="row" style="margin-top: 10px;">
                                    <div class="col-sm-2">
                                        <SfButton IconCss="e-icons e-circle-add icon-navy" CssClass="e-flat btn-light" Content=" Nuova Visita" OnClick="() => NewVisit()" Disabled="@AddVisitDisabled"></SfButton>
                                    </div>
                                    <div class="col-sm-10">
                                        <span style="float: right;">
                                            <SfButton IconCss="e-icons icon-navy e-save" CssClass="e-flat btn-light" Content=" Salva Visita" OnClick="() => SaveVisit()"></SfButton>
                                            @* Disabled="@SaveVisitDisabled"*@
                                        </span>
                                        <span style="float: right;">
                                            <SfButton IconCss="e-icons icon-navy e-print" CssClass="e-flat btn-light" Content=" Stampa Visita" OnClick="() => PrintVisit()" Disabled="@PrintVisitDisabled"></SfButton>
                                        </span>
                                        @* <span style="float: right;">
                                            <SfButton IconCss="e-icons icon-navy e-print" CssClass="e-flat btn-light" Content=" Stampa test" OnClick="() => PrintRel()" Disabled="@PrintVisitDisabled"></SfButton>
                                        </span> *@
                                    </div>
                                </div>

                                <!-- Dati di verifica -->
                                @* 
                                <div class="row" style="margin-top: 10px;">
                                    <div class="col-sm-12">
                                        <table class="table table-bordered" style="border:1px solid #f90;">
                                            <thead>
                                                <tr>
                                                    <th>VisitaCorrente</th>
                                                    <th>Visita.IdVisit</th>
                                                    <th>Visita.ptIdUser</th>
                                                    <th>Visita.InsertDate</th>
                                                    <th>Visita.ptIdPatient</th>
                                                    <th>Visita.ptIdAppointment</th>
                                                    <th>Visita.DataVisita</th>
                                                    <th>Visita.DiagnosiOD</th>
                                                    <th>Visita.DiagnosiOS</th>
                                                    <th>Visita.Anamnesi</th>
                                                    <th>Visita.TipoVisita</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>@VisitaCorrente</td>
                                                    <td>@Visita.IdVisit</td>
                                                    <td>@Visita.ptIdUser</td>
                                                    <td>@Visita.InsertDate</td>
                                                    <td>@Visita.ptIdPatient</td>
                                                    <td>@Visita.ptIdAppointment</td>
                                                    <td>@Visita.DataVisita</td>
                                                    <td>@Visita.DiagnosiOD</td>
                                                    <td>@Visita.DiagnosiOS</td>
                                                    <td>@Visita.Anamnesi</td>
                                                    <td>@Visita.TipoVisita</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                *@

                                <!-- Operatore -->
                                <div class="row" style="margin-top: 10px;">
                                    <div class="col-sm-2">
                                        <SfTextBox ID="operatore" @bind-Value="@Visita.Operatore" Placeholder="Operatore" FloatLabelType="@FloatLabelType.Always" CssClass="sftext" style="font-weight: 500;"></SfTextBox>
                                    </div>
                                </div>

                                <!-- Dati visita -->
                                <div class="row" style="margin-top: 10px;">
                                    <div class="col-sm-5">
                                        <!-- Diagnosi OD -->
                                        <div class="row" style="margin-top: 10px;">
                                            <div class="col">
                                                <SfTextBox ID="diagnosiod" @bind-Value="@Visita.DiagnosiOD" Placeholder="Diagnosi OD" FloatLabelType="@FloatLabelType.Always" title="@Visita.DiagnosiOD" Multiline="true" CssClass="sftext" style="height: 30px;"></SfTextBox>
                                            </div>
                                        </div>
                                        <!-- Diagnosi OS -->
                                        <div class="row" style="margin-top: 10px;">
                                            <div class="col">
                                                <SfTextBox ID="diagnosios" @bind-Value="@Visita.DiagnosiOS" Placeholder="Diagnosi OS" FloatLabelType="@FloatLabelType.Always" title="@Visita.DiagnosiOS" Multiline="true" CssClass="sftext" style="height: 30px;"></SfTextBox>
                                            </div>
                                        </div>
                                        <!-- Anamnesi -->
                                        <div class="row" style="margin-top: 10px;">
                                            <div class="col">
                                                <SfTextBox ID="anamnesi" @bind-Value="@Visita.Anamnesi" Placeholder="Anamnesi" FloatLabelType="@FloatLabelType.Always" Multiline="true" CssClass="sftext" style="height: 30px;"></SfTextBox>
                                            </div>
                                        </div>
                                        <!-- Annessi OD -->
                                        <div class="row" style="margin-top: 10px;">
                                            <div class="col">
                                                <SfTextBox ID="annessiod" @bind-Value="@Visita.Annessi_Od" Placeholder="Annessi OD" FloatLabelType="@FloatLabelType.Always" Multiline="true" CssClass="sftext" style="height: 30px;"></SfTextBox>
                                            </div>
                                        </div>
                                        <!-- Annessi OS -->
                                        <div class="row" style="margin-top: 10px;">
                                            <div class="col">
                                                <SfTextBox ID="annessios" @bind-Value="@Visita.Annessi_Os" Placeholder="Annessi OS" FloatLabelType="@FloatLabelType.Always" Multiline="true" CssClass="sftext" style="height: 30px;"></SfTextBox>
                                            </div>
                                        </div>
                                        <!-- Seg.Ant. OD -->
                                        <div class="row" style="margin-top: 10px;">
                                            <div class="col">
                                                <SfTextBox ID="segantod" @bind-Value="@Visita.Seg_Ant_Od" Placeholder="Seg.Ant. OD" FloatLabelType="@FloatLabelType.Always" Multiline="true" CssClass="sftext" style="height: 30px;"></SfTextBox>
                                            </div>
                                        </div>
                                        <!-- Seg.Ant. OS -->
                                        <div class="row" style="margin-top: 10px;">
                                            <div class="col">
                                                <SfTextBox ID="segantos" @bind-Value="@Visita.Seg_Ant_Os" Placeholder="Seg.Ant. OS" FloatLabelType="@FloatLabelType.Always" Multiline="true" CssClass="sftext" style="height: 30px;"></SfTextBox>
                                            </div>
                                        </div>
                                        <!-- Fundus OD -->
                                        <div class="row" style="margin-top: 10px;">
                                            <div class="col">
                                                <SfTextBox ID="fundusod" @bind-Value="@Visita.Fundus_Od" Placeholder="Fundus OD" FloatLabelType="@FloatLabelType.Always" Multiline="true" CssClass="sftext" style="height: 30px;"></SfTextBox>
                                            </div>
                                        </div>
                                        <!-- Fundus OS -->
                                        <div class="row" style="margin-top: 10px;">
                                            <div class="col">
                                                <SfTextBox ID="fundusos" @bind-Value="@Visita.Fundus_Os" Placeholder="Fundus OS" FloatLabelType="@FloatLabelType.Always" Multiline="true" CssClass="sftext" style="height: 30px"></SfTextBox>
                                            </div>
                                        </div>
                                        <!-- Visus OD -->
                                        <div class="row" style="margin-top: 10px;">
                                            <div class="col">
                                                <SfTextBox ID="visusod" @bind-Value="@Visita.Visus_Od" Placeholder="Visus OD" FloatLabelType="@FloatLabelType.Always" Multiline="true" CssClass="sftext" style="height: 30px;"></SfTextBox>
                                            </div>
                                        </div>
                                        <!-- Visus OS -->
                                        <div class="row" style="margin-top: 10px;">
                                            <div class="col">
                                                <SfTextBox ID="visusos" @bind-Value="@Visita.Visus_Os" Placeholder="Visus OS" FloatLabelType="@FloatLabelType.Always" Multiline="true" CssClass="sftext" style="height: 30px;"></SfTextBox>
                                            </div>
                                        </div>
                                        <!-- Terapia -->
                                        <div class="row" style="margin-top: 10px;">
                                            <div class="col">
                                                <SfTextBox ID="terapia" @bind-Value="@Visita.Terapia" Placeholder="Terapia" FloatLabelType="@FloatLabelType.Always" Multiline="true" CssClass="sftext" style="height: 30px;"></SfTextBox>
                                            </div>
                                        </div>
                                        <!-- OD: SUE LENTI -->
                                        <div class="row" style="margin-top: 10px;">
                                            <!-- OD: SUE LENTI PL -->
                                            <div class="col-sm-4">
                                                <SfTextBox ID="odpl" @bind-Value="@Visita.ODPL" Placeholder="OD: SUE LENTI PL" FloatLabelType="@FloatLabelType.Always" Multiline="true" CssClass="sftext" style="height: 30px;"></SfTextBox>
                                            </div>
                                            <!-- OD: SUE LENTI PV -->
                                            <div class="col-sm-4">
                                                <SfTextBox ID="odpv" @bind-Value="@Visita.ODPV" Placeholder="OD: SUE LENTI PV" FloatLabelType="@FloatLabelType.Always" Multiline="true" CssClass="sftext" style="height: 30px;"></SfTextBox>
                                            </div>
                                            <!-- OD: SUE LENTI MEDIA DIST. -->
                                            <div class="col-sm-4">
                                                <SfTextBox ID="odmd" @bind-Value="@Visita.ODMD" Placeholder="OD: SUE LENTI MEDIA DIST." FloatLabelType="@FloatLabelType.Always" Multiline="true" CssClass="sftext" style="height: 30px;"></SfTextBox>
                                            </div>
                                        </div>
                                        <!-- OS: SUE LENTI -->
                                        <div class="row" style="margin-top: 10px;">
                                            <!-- OS: SUE LENTI PL -->
                                            <div class="col-sm-4">
                                                <SfTextBox ID="ospl" @bind-Value="@Visita.OSPL" Placeholder="OS: SUE LENTI PL" FloatLabelType="@FloatLabelType.Always" Multiline="true" CssClass="sftext" style="height: 30px;"></SfTextBox>
                                            </div>
                                            <!-- OS: SUE LENTI PV -->
                                            <div class="col-sm-4">
                                                <SfTextBox ID="ospv" @bind-Value="@Visita.OSPV" Placeholder="OS: SUE LENTI PV" FloatLabelType="@FloatLabelType.Always" Multiline="true" CssClass="sftext" style="height: 30px;"></SfTextBox>
                                            </div>
                                            <!-- OS: SUE LENTI MEDIA DIST. -->
                                            <div class="col-sm-4">
                                                <SfTextBox ID="osmd" @bind-Value="@Visita.OSMD" Placeholder="OS: SUE LENTI MEDIA DIST." FloatLabelType="@FloatLabelType.Always" Multiline="true" CssClass="sftext" style="height: 30px;"></SfTextBox>
                                            </div>
                                        </div>
                                        <!-- Motivo Visita -->
                                        <div class="row" style="margin-top: 10px;">
                                            <div class="col">
                                                <SfTextBox ID="motivovisita" @bind-Value="@Visita.MotivoVisita" Placeholder="Motivo Visita" FloatLabelType="@FloatLabelType.Always" Multiline="true" style="height: 30px;"></SfTextBox>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-7">
                                        <!-- Interventi -->
                                        <div class="row" style="margin-top: 10px;">
                                            <div class="col">
                                                <SfTextBox ID="interventi" @bind-Value="@Visita.Interventi" Placeholder="Interventi" FloatLabelType="@FloatLabelType.Always" Multiline="true" CssClass="sftext" style="height: 30px;"></SfTextBox>
                                            </div>
                                        </div>
                                        <!-- Curva Tonometrica OD e Argon -->
                                        <div class="row" style="margin-top: 10px;">
                                            <div class="col-sm-7">
                                                <SfTextBox ID="curvatonood" @bind-Value="@Visita.CurvaTono_Od" Placeholder="Curva Tonometrica OD" FloatLabelType="@FloatLabelType.Always" Multiline="true" CssClass="sftext" style="height: 30px;"></SfTextBox>
                                            </div>
                                            <div class="col-sm-5">
                                                <SfTextBox ID="argon" @bind-Value="@Visita.CurvaArgon" Placeholder="Argon" FloatLabelType="@FloatLabelType.Always" Multiline="true" CssClass="sftext" style="height: 30px;"></SfTextBox>
                                            </div>
                                        </div>
                                        <!-- Curva Tonometrica OS -->
                                        <div class="row" style="margin-top: 10px;">
                                            <div class="col-sm-7">
                                                <SfTextBox ID="curvatonoos" @bind-Value="@Visita.CurvaTono_Os" Placeholder="Curva Tonometrica OS" FloatLabelType="@FloatLabelType.Always" Multiline="true" CssClass="sftext" style="height: 30px;"></SfTextBox>
                                            </div>
                                        </div>
                                        <!-- Visus corretto OD -->
                                        <div class="row" style="margin-top: 10px; display: none;">
                                            <div class="col">
                                                <SfTextBox ID="vortotticaod" @bind-Value="@Visita.VOrtotticaOD" Placeholder="Visus corretto OD" FloatLabelType="@FloatLabelType.Always" Multiline="true" CssClass="sftext" style="height: 30px;"></SfTextBox>
                                            </div>
                                        </div>
                                        <!-- Visus corretto OS -->
                                        <div class="row" style="margin-top: 10px; display: none;">
                                            <div class="col">
                                                <SfTextBox ID="vortotticaos" @bind-Value="@Visita.VOrtotticaOS" Placeholder="Visus corretto OS" FloatLabelType="@FloatLabelType.Always" Multiline="true" CssClass="sftext" style="height: 30px;"></SfTextBox>
                                            </div>
                                        </div>
                                        <!-- SHIRMER OD e Tono oculare OD -->
                                        <div class="row" style="margin-top: 10px;">
                                            <div class="col-sm-7">
                                                <SfTextBox ID="shirmerod" @bind-Value="@Visita.SHIRMER_Od" Placeholder="SHIRMER OD" FloatLabelType="@FloatLabelType.Always" Multiline="true" style="height: 30px;"></SfTextBox>
                                            </div>
                                            <div class="col-sm-5">
                                                <SfTextBox ID="tonood" @bind-Value="@Visita.TONO_Od" Placeholder="Tono oculare OD" FloatLabelType="@FloatLabelType.Always" Multiline="true" CssClass="sftext" style="height: 30px;"></SfTextBox>
                                            </div>
                                        </div>
                                        <!-- SHIRMER OS e Tono oculare OS -->
                                        <div class="row" style="margin-top: 10px;">
                                            <div class="col-sm-7">
                                                <SfTextBox ID="shirmeros" @bind-Value="@Visita.SHIRMER_Os" Placeholder="SHIRMER OS" FloatLabelType="@FloatLabelType.Always" Multiline="true" style="height: 30px;"></SfTextBox>
                                            </div>
                                            <div class="col-sm-5">
                                                <SfTextBox ID="tonoos" @bind-Value="@Visita.TONO_Os" Placeholder="Tono oculare OS" FloatLabelType="@FloatLabelType.Always" Multiline="true" CssClass="sftext" style="height: 30px;"></SfTextBox>
                                            </div>
                                        </div>
                                        <!-- Vie lacrimali OD e Topografia OD -->
                                        <div class="row" style="margin-top: 10px;">
                                            <div class="col-sm-7">
                                                <SfTextBox ID="lavaggiood" @bind-Value="@Visita.Lavaggio_Od" Placeholder="Vie lacrimali OD" FloatLabelType="@FloatLabelType.Always" Multiline="true" style="height: 30px;"></SfTextBox>
                                            </div>
                                            <div class="col-sm-5">
                                                <SfTextBox ID="topografiaod" @bind-Value="@Visita.Topografia_Od" Placeholder="Topografia OD" FloatLabelType="@FloatLabelType.Always" Multiline="true" CssClass="sftext" style="height: 30px;"></SfTextBox>
                                            </div>
                                        </div>
                                        <!-- Vie lacrimali OS e Topografia OS -->
                                        <div class="row" style="margin-top: 10px;">
                                            <div class="col-sm-7">
                                                <SfTextBox ID="lavaggioos" @bind-Value="@Visita.Lavaggio_Os" Placeholder="Vie lacrimali OS" FloatLabelType="@FloatLabelType.Always" Multiline="true" CssClass="sftext" style="height: 30px;"></SfTextBox>
                                            </div>
                                            <div class="col-sm-5">
                                                <SfTextBox ID="topografiaos" @bind-Value="@Visita.Topografia_Os" Placeholder="Topografia OS" FloatLabelType="@FloatLabelType.Always" Multiline="true" CssClass="sftext" style="height: 30px;"></SfTextBox>
                                            </div>
                                        </div>
                                        <!-- Fag OD e Fag OS -->
                                        <div class="row" style="margin-top: 10px;">
                                            <div class="col-sm-6">
                                                <SfTextBox ID="fagod" @bind-Value="@Visita.FAG_Od" Placeholder="Fag OD" FloatLabelType="@FloatLabelType.Always" Multiline="true" CssClass="sftext" style="height: 30px;"></SfTextBox>
                                            </div>
                                            <div class="col-sm-6">
                                                <SfTextBox ID="fagos" @bind-Value="@Visita.FAG_Os" Placeholder="Fag OS" FloatLabelType="@FloatLabelType.Always" Multiline="true" CssClass="sftext" style="height: 30px;"></SfTextBox>
                                            </div>
                                        </div>
                                        <!-- Biometria e IV -->
                                        <div class="row" style="margin-top: 10px;">
                                            <div class="col-sm-7">
                                                <SfTextBox ID="biometria" @bind-Value="@Visita.Biometria" Placeholder="Biometria" FloatLabelType="@FloatLabelType.Always" Multiline="true" CssClass="sftext" style="height: 30px;"></SfTextBox>
                                            </div>
                                            <div class="col-sm-5">
                                                <SfTextBox ID="iv" @bind-Value="@Visita.IV" Placeholder="IV" FloatLabelType="@FloatLabelType.Always" Multiline="true" CssClass="sftext" style="height: 30px;"></SfTextBox>
                                            </div>
                                        </div>
                                        <!-- Oct OD e Oct OS -->
                                        <div class="row" style="margin-top: 10px;">
                                            <div class="col-sm-6">
                                                <SfTextBox ID="octod" @bind-Value="@Visita.OCT_Od" Placeholder="Oct OD" FloatLabelType="@FloatLabelType.Always" Multiline="true" CssClass="sftext" style="height: 30px;"></SfTextBox>
                                            </div>
                                            <div class="col-sm-6">
                                                <SfTextBox ID="octos" @bind-Value="@Visita.OCT_Os" Placeholder="Oct OS" FloatLabelType="@FloatLabelType.Always" Multiline="true" CssClass="sftext" style="height: 30px;"></SfTextBox>
                                            </div>
                                        </div>
                                        <!-- RNFL OD e RNFL OS -->
                                        <div class="row" style="margin-top: 10px;">
                                            <div class="col-sm-6">
                                                <SfTextBox ID="rnflod" @bind-Value="@Visita.RNFL_Od" Placeholder="RNFL OD" FloatLabelType="@FloatLabelType.Always" Multiline="true" CssClass="sftext" style="height: 30px;"></SfTextBox>
                                            </div>
                                            <div class="col-sm-6">
                                                <SfTextBox ID="rnflos" @bind-Value="@Visita.RNFL_Os" Placeholder="RNFL OS" FloatLabelType="@FloatLabelType.Always" Multiline="true" CssClass="sftext" style="height: 30px;"></SfTextBox>
                                            </div>
                                        </div>
                                        <!-- CV OD e CV OS -->
                                        <div class="row" style="margin-top: 10px;">
                                            <div class="col-sm-6">
                                                <SfTextBox ID="cvod" @bind-Value="@Visita.CV_Od" Placeholder="CV OD" FloatLabelType="@FloatLabelType.Always" Multiline="true" CssClass="sftext" style="height: 30px;"></SfTextBox>
                                            </div>
                                            <div class="col-sm-6">
                                                <SfTextBox ID="cvos" @bind-Value="@Visita.CV_Os" Placeholder="CV OS" FloatLabelType="@FloatLabelType.Always" Multiline="true" CssClass="sftext" style="height: 30px;"></SfTextBox>
                                            </div>
                                        </div>
                                        <!-- Pachimetria OD, Pachimetria OS, C/D OD e C/D OS -->
                                        <div class="row" style="margin-top: 10px;">
                                            <div class="col-sm-3">
                                                <SfTextBox ID="pachimetriaod" @bind-Value="@Visita.PACH_Od" Placeholder="Pachimetria OD" FloatLabelType="@FloatLabelType.Always" Multiline="true" CssClass="sftext" style="height: 30px;"></SfTextBox>
                                            </div>
                                            <div class="col-sm-3">
                                                <SfTextBox ID="pachimetriaos" @bind-Value="@Visita.PACH_Os" Placeholder="Pachimetria OS" FloatLabelType="@FloatLabelType.Always" Multiline="true" CssClass="sftext" style="height: 30px;"></SfTextBox>
                                            </div>
                                            <div class="col-sm-3">
                                                <SfTextBox ID="cdod" @bind-Value="@Visita.CD_Od" Placeholder="C/D OD" FloatLabelType="@FloatLabelType.Always" Multiline="true" CssClass="sftext" style="height: 30px;"></SfTextBox>
                                            </div>
                                            <div class="col-sm-3">
                                                <SfTextBox ID="cdos" @bind-Value="@Visita.CD_Os" Placeholder="C/D OS" FloatLabelType="@FloatLabelType.Always" Multiline="true" CssClass="sftext" style="height: 30px;"></SfTextBox>
                                            </div>
                                        </div>
                                        <!-- AUTOREFRATTOMETRIA -->
                                        <div class="row" style="margin-top: 10px;">
                                            <div class="col">
                                                <SfTextBox ID="auto" @bind-Value="@Visita.Auto" Placeholder="AUTOREFRATTOMETRIA" FloatLabelType="@FloatLabelType.Always" Multiline="true" CssClass="sftext" style="height: 30px;"></SfTextBox>
                                            </div>
                                        </div>
                                        <!-- Conclusioni -->
                                        <div class="row" style="margin-top: 10px;">
                                            <div class="col">
                                                <SfTextBox ID="conclusioni" @bind-Value="@Visita.Conclusioni" Placeholder="Conclusioni" FloatLabelType="@FloatLabelType.Always" Multiline="true" CssClass="sftext" style="height: 30px;"></SfTextBox>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Note visita -->
                                <div class="row" style="margin-top: 10px;">
                                    <div class="col">
                                        <SfTextBox ID="notevisita" @bind-Value="@Visita.Note" Placeholder="NOTE" FloatLabelType="@FloatLabelType.Always" Multiline="true" CssClass="sftext" style="height: 30px;"></SfTextBox>
                                    </div>
                                </div>
                            </ContentTemplate>
                        </TabItem>

                        <!-- Sezione Prescrizione Occhiali -->
                        <TabItem Disabled=@POcchialiDisabled>
                            <ChildContent>
                                <TabHeader Text="Prescrizione Occhiali"></TabHeader>
                            </ChildContent>
                            <ContentTemplate>
                                <div class="row" style="margin-top: 10px;">
                                    <div class="col-sm-12">
                                        <span style="float: left; display: inline-block; margin-left: 10px;  margin-right: 10px; padding-top: 6px; font-weight:bold;">
                                            Data di Stampa
                                        </span>
                                        <span style="float: left; width: 94px; display: inline-block;">
                                            <SfMaskedTextBox ID="data_occhiali" @bind-Value="@pDataOcchiali" Mask="00/00/0000" CssClass="sftext"></SfMaskedTextBox>
                                        </span>

                                        <span style="float: right;">
                                            <SfButton IconCss="e-icons icon-navy e-save" CssClass="e-flat btn-light" Content=" Salva Prescrizione" OnClick="() => SaveVisus()" Disabled="@SaveVisusDisabled"></SfButton>
                                        </span>

                                        <span style="float: right;">
                                            <SfButton IconCss="e-icons icon-navy e-print" CssClass="e-flat btn-light" Content=" Stampa Prescrizione Occhiali" OnClick="() => PrintOcchiali(DropDownTemplate)" Disabled="@PrintVisusDisabled"></SfButton>
                                        </span>

                                        <span style="float: right; width: 110px; margin-right: 10px;">
                                            <SfDropDownList TItem="PrintTemplates" TValue="string" PopupHeight="230px" Placeholder="es. Template 1" @bind-Value="@DropDownTemplate" DataSource="@ListTemplates">
                                                <DropDownListEvents TItem="PrintTemplates" TValue="string" ValueChange="OnLensChange" />
                                                <DropDownListFieldSettings Text="Text" Value="Id" />
                                            </SfDropDownList>
                                        </span>
                                    </div>
                                </div>

                                <!-- Occhi Destro - Sinistro -->
                                <div class="row" style="margin-top: 10px;">
                                    <!-- Occhio Destro -->
                                    <div class="col-sm-6">
                                        <div class="row" style="margin-top: 10px;">
                                            <div class="col-sm-3">&nbsp;</div>
                                            <!-- style="border:1px solid #f90;"-->
                                            <div class="col" style="text-align: center; font-size: larger;">
                                                <!-- border:1px solid #09f;-->
                                                Occhio Destro
                                            </div>
                                        </div>
                                        <div class="row" style="margin-top: 10px;">
                                            <div class="col-sm-3">&nbsp;</div>
                                            <div class="col-sm-3" style="text-align: center; font-weight:bolder;">
                                                Sfera
                                            </div>
                                            <div class="col-sm-3" style="text-align: center; font-weight:bolder;">
                                                Cilindro
                                            </div>
                                            <div class="col-sm-3" style="text-align: center; font-weight:bolder;">
                                                Asse
                                            </div>
                                        </div>
                                        <div class="row" style="margin-top: 10px;">
                                            <div class="col-sm-3" style="text-align: right; padding-top: 5px;">
                                                <span>PER DISTANZA</span>
                                            </div>
                                            <div class="col-sm-3">
                                                <SfTextBox ID="ODD_Sf" @bind-Value="@Visus.ODD_Sf" CssClass="sftext"></SfTextBox>
                                            </div>
                                            <div class="col-sm-3">
                                                <SfTextBox ID="ODD_Cil" @bind-Value="@Visus.ODD_Cil" CssClass="sftext"></SfTextBox>
                                            </div>
                                            <div class="col-sm-3">
                                                <SfTextBox ID="ODD_Asse" @bind-Value="@Visus.ODD_Asse" CssClass="sftext"></SfTextBox>
                                            </div>
                                        </div>
                                        <div class="row" style="margin-top: 10px;">
                                            <div class="col-sm-3" style="text-align: right; padding-top: 5px;">
                                                <span>A PERMANENZA</span>
                                            </div>
                                            <div class="col-sm-3">
                                                <SfTextBox ID="ODP_Sf" @bind-Value="@Visus.ODP_Sf" CssClass="sftext"></SfTextBox>
                                            </div>
                                            <div class="col-sm-3">
                                                <SfTextBox ID="ODP_Cil" @bind-Value="@Visus.ODP_Cil" CssClass="sftext"></SfTextBox>
                                            </div>
                                            <div class="col-sm-3">
                                                <SfTextBox ID="ODP_Asse" @bind-Value="@Visus.ODP_Asse" CssClass="sftext"></SfTextBox>
                                            </div>
                                        </div>
                                        <div class="row" style="margin-top: 10px;">
                                            <div class="col-sm-3" style="text-align: right; padding-top: 5px;">
                                                <span>PER LETTURA</span>
                                            </div>
                                            <div class="col-sm-3">
                                                <SfTextBox ID="ODL_Sf" @bind-Value="@Visus.ODL_Sf" CssClass="sftext"></SfTextBox>
                                            </div>
                                            <div class="col-sm-3">
                                                <SfTextBox ID="ODL_Cil" @bind-Value="@Visus.ODL_Cil" CssClass="sftext"></SfTextBox>
                                            </div>
                                            <div class="col-sm-3">
                                                <SfTextBox ID="ODL_Asse" @bind-Value="@Visus.ODL_Asse" CssClass="sftext"></SfTextBox>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Occhio Sinistro -->
                                    <div class="col-sm-6">
                                        <div class="row" style="margin-top: 10px;">
                                            <div class="col" style="text-align: center; font-size: larger;">
                                                <!--  border:1px solid #09f; -->
                                                Occhio Sinistro
                                            </div>
                                            <div class="col-sm-3">&nbsp;</div>
                                            <!-- style="border:1px solid #f90;"-->
                                        </div>
                                        <div class="row" style="margin-top: 10px;">
                                            <div class="col-sm-3" style="text-align: center; font-weight:bolder;">
                                                Sfera
                                            </div>
                                            <div class="col-sm-3" style="text-align: center; font-weight:bolder;">
                                                Cilindro
                                            </div>
                                            <div class="col-sm-3" style="text-align: center; font-weight:bolder;">
                                                Asse
                                            </div>
                                            <div class="col-sm-3">&nbsp;</div>
                                        </div>
                                        <div class="row" style="margin-top: 10px;">
                                            <div class="col-sm-3">
                                                <SfTextBox ID="OSD_Sf" @bind-Value="@Visus.OSD_Sf" CssClass="sftext"></SfTextBox>
                                            </div>
                                            <div class="col-sm-3">
                                                <SfTextBox ID="OSD_Cil" @bind-Value="@Visus.OSD_Cil" CssClass="sftext"></SfTextBox>
                                            </div>
                                            <div class="col-sm-3">
                                                <SfTextBox ID="OSD_Asse" @bind-Value="@Visus.OSD_Asse" CssClass="sftext"></SfTextBox>
                                            </div>
                                            <div class="col-sm-3">&nbsp;</div>
                                        </div>
                                        <div class="row" style="margin-top: 10px;">
                                            <div class="col-sm-3">
                                                <SfTextBox ID="OSP_Sf" @bind-Value="@Visus.OSP_Sf" CssClass="sftext"></SfTextBox>
                                            </div>
                                            <div class="col-sm-3">
                                                <SfTextBox ID="OSP_Cil" @bind-Value="@Visus.OSP_Cil" CssClass="sftext"></SfTextBox>
                                            </div>
                                            <div class="col-sm-3">
                                                <SfTextBox ID="OSP_Asse" @bind-Value="@Visus.OSP_Asse" CssClass="sftext"></SfTextBox>
                                            </div>
                                            <div class="col-sm-3">&nbsp;</div>
                                        </div>
                                        <div class="row" style="margin-top: 10px;">
                                            <div class="col-sm-3">
                                                <SfTextBox ID="OSL_Sf" @bind-Value="@Visus.OSL_Sf" CssClass="sftext"></SfTextBox>
                                            </div>
                                            <div class="col-sm-3">
                                                <SfTextBox ID="OSL_Cil" @bind-Value="@Visus.OSL_Cil" CssClass="sftext"></SfTextBox>
                                            </div>
                                            <div class="col-sm-3">
                                                <SfTextBox ID="OSL_Asse" @bind-Value="@Visus.OSL_Asse" CssClass="sftext"></SfTextBox>
                                            </div>
                                            <div class="col-sm-3">&nbsp;</div>
                                        </div>
                                    </div>

                                    <div class="col-sm-1">&nbsp;</div>
                                </div>

                                <!-- TABO - Internazionale -->
                                <div class="row" style="margin-top: 10px;">
                                    <div class="col-sm-4">
                                        <label style="font-size: 12pt; padding: 0 8px 8px 0; vertical-align: super;">@switchTabo</label>
                                        <SfSwitch @bind-Checked="@fTabo" ValueChange="ManageTabo" TChecked="bool"></SfSwitch>
                                    </div>

                                    @* 
                                    <div class="col-sm-6" style="text-align:right;">
                                        <label style="font-size: 12pt; padding: 0 8px 8px 0;">@switchInter</label>
                                        <SfSwitch @bind-Checked="@fInter" ValueChange="ManageInter" TChecked="bool"></SfSwitch>
                                    </div> 
                                    *@
                                </div>

                                <!-- Distanza interpupillare -->
                                <div class="row" style="margin-top: 10px;">
                                    <div class="col-sm-2">
                                        <SfTextBox ID="Distanza" @bind-Value="@Visus.DI" Placeholder="Distanza interpupillare (mm)" FloatLabelType="@FloatLabelType.Always" CssClass="sftext"></SfTextBox>
                                    </div>
                                </div>

                                <!-- Note visus -->
                                <div class="row" style="margin-top: 20px;">
                                    <div class="col">
                                        <SfTextBox ID="NoteVisus" @bind-Value="@Visus.Note" Placeholder="NOTE" FloatLabelType="@FloatLabelType.Always" Multiline="true" CssClass="sftext"></SfTextBox>
                                    </div>
                                </div>
                            </ContentTemplate>
                        </TabItem>

                        <!-- Sezione Controlli -->
                        <TabItem Disabled=@ControlliDisabled>
                            <ChildContent>
                                <TabHeader Text="Controlli"></TabHeader>
                            </ChildContent>
                            <ContentTemplate>
                                <div class="row" style="margin-top: 10px;">
                                    @* <div class="col-sm-1"><b>&nbsp;Controllo</b> <i>@(CntrCorrente + 1)</i> <b>di</b> <i>@ListaCntrs.Count</i></div> *@

                                    <div class="col-sm-2">
                                        <div class="btn-toolbar mb-3" role="toolbar" aria-label="Toolbar controlli button groups">
                                            <div class="btn-group me-2" role="group" aria-label="First group">
                                                <SfButton IconCss="e-icons icon-small e-first-page" CssClass="e-small e-flat btn-light" Content="" OnClick="() => GoToControl(0)" Disabled="@FirstCntrDisabled" title="Ultimo Controllo"></SfButton>
                                                <SfButton IconCss="e-icons icon-small e-chevron-left" CssClass="e-small e-flat btn-light" Content="" OnClick="() => GoToControl(1)" Disabled="@PrevCntrDisabled" title="Controllo precedente"></SfButton>

                                                <span class="vstepper">@IndexControlli</span>

                                                <SfButton IconCss="e-icons icon-small e-chevron-right" CssClass="e-small e-flat btn-light" Content="" OnClick="() => GoToControl(2)" Disabled="@NextCntrDisabled" title="Controllo successivo"></SfButton>
                                                <SfButton IconCss="e-icons icon-small e-last-page" CssClass="e-small e-flat btn-light" Content="" OnClick="() => GoToControl(3)" Disabled="@LastCntrDisabled" title="Primo Controllo"></SfButton>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-1">&nbsp;</div>

                                    <div class="col-sm-2">
                                        <SfButton IconCss="e-icons e-circle-add icon-navy" CssClass="e-flat btn-light" Content=" Nuovo Controllo" OnClick="() => NewControl()" Disabled="@AddCntrDisabled"></SfButton>
                                    </div>
                                    <div class="col-sm-7">
                                        <span style="float: right;">
                                            <SfButton IconCss="e-icons icon-navy e-save" CssClass="e-flat btn-light" Content=" Salva Controllo" OnClick="() => SaveControl()" Disabled="@SaveCntrDisabled"></SfButton>
                                        </span>

                                        <span style="float: right;">
                                            <SfButton IconCss="e-icons icon-navy e-print" CssClass="e-flat btn-light" Content=" Stampa Controlli" OnClick="() => PrintControlli(DropDownTemplate)" Disabled="@PrintCntrDisabled"></SfButton>
                                        </span>

                                        <span style="float: right; width: 110px; margin-right: 10px;">
                                            <SfDropDownList TItem="PrintTemplates" TValue="string" PopupHeight="230px" Placeholder="es. Template 1" @bind-Value="@DropDownTemplate" DataSource="@ListTemplates">
                                                <DropDownListEvents TItem="PrintTemplates" TValue="string" ValueChange="OnContrChange" />
                                                <DropDownListFieldSettings Text="Text" Value="Id" />
                                            </SfDropDownList>
                                        </span>
                                    </div>
                                </div>

                                <!-- Dati di verifica -->
                                @*
                                <div class="row" style="margin-top: 10px;">
                                    <div class="col-sm-12">
                                        <table class="table table-bordered" style="border:1px solid #f90;">
                                            <thead>
                                                <tr>
                                                    <th>VisitaCorrente</th>
                                                    <th>Visita.IdVisit</th>
                                                    <th>Visita.DataVisita</th>
                                                    <th>Controllo.IdControllo</th>
                                                    <th>Controllo.ptIdUser</th>
                                                    <th>Controllo.InsertDate</th>
                                                    <th>Controllo.ptIdVisit</th>
                                                    <th>Controllo.DataControllo</th>
                                                    <th>Controllo.Valutazione</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>@VisitaCorrente</td>
                                                    <td>@Visita.IdVisit</td>
                                                    <td>@Visita.DataVisita</td>
                                                    <td>@Controllo.IdControllo</td>
                                                    <td>@Controllo.ptIdUser</td>
                                                    <td>@Controllo.InsertDate</td>
                                                    <td>@Controllo.ptIdVisit</td>
                                                    <td>@Controllo.DataControllo</td>
                                                    <td>@Controllo.Valutazione</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
 *@

                                <!-- Dati controllo -->
                                <div class="row" style="margin-top: 10px;">
                                    <div class="col-sm-1">
                                        <SfMaskedTextBox ID="datacontrollo" @bind-Value="@DataControllo" Mask="00/00/0000" Placeholder="Data controllo" FloatLabelType="@FloatLabelType.Always" CssClass="sftext"></SfMaskedTextBox>
                                    </div>
                                    <div class="col-sm-4">
                                        <label id="label_valutazione" for="valutazione" style="color: #343a40; font-weight: 500; margin: 3px 0;">Valutazione</label>
                                        <SfTextBox ID="valutazione" @bind-Value="@Controllo.Valutazione" Multiline=true CssClass="sftext"></SfTextBox>
                                    </div>
                                </div>
                            </ContentTemplate>
                        </TabItem>

                        <!-- Sezione Ortottica -->
                        <TabItem Disabled=@OrtotticaDisabled>
                            <ChildContent>
                                <TabHeader Text="Ortottica"></TabHeader>
                            </ChildContent>
                            <ContentTemplate>
                                <div class="row" style="margin-top: 10px;">
                                    <div class="col-sm-12">
                                        <span style="float: left; display: inline-block; margin-left: 10px;  margin-right: 10px; padding-top: 6px; font-weight:bold;">
                                            Data di Stampa
                                        </span>

                                        <span style="float: left; width: 94px; display: inline-block;">
                                            <SfMaskedTextBox ID="data_ortottica" @bind-Value="@pDataOrtottica" Mask="00/00/0000" CssClass="sftext"></SfMaskedTextBox>
                                        </span>

                                        <span style="float: right;">
                                            <SfButton IconCss="e-icons icon-navy e-save" CssClass="e-flat btn-light" Content=" Salva Ortottica" OnClick="() => SaveOrtoctis()" Disabled="@SaveOrtoctisDisabled"></SfButton>
                                        </span>

                                        <span style="float: right;">
                                            <SfButton IconCss="e-icons icon-navy e-print" CssClass="e-flat btn-light" Content=" Stampa Ortottica" OnClick="() => PrintOrtottica(DropDownTemplate)" Disabled="@PrintVisitDisabled"></SfButton>
                                        </span>

                                        <span style="float: right; width: 110px; margin-right: 10px;">
                                            <SfDropDownList TItem="PrintTemplates" TValue="string" PopupHeight="230px" Placeholder="es. Template 1" @bind-Value="@DropDownTemplate" DataSource="@ListTemplates">
                                                <DropDownListEvents TItem="PrintTemplates" TValue="string" ValueChange="OnOrthChange" />
                                                <DropDownListFieldSettings Text="Text" Value="Id" />
                                            </SfDropDownList>
                                        </span>
                                    </div>
                                </div>

                                <!-- Posizione Primaria -->
                                <div class="row" style="margin-top: 12px;">
                                    <div class="col-sm-8">
                                        <SfTextBox ID="oPosizione" @bind-Value="@Ortoctis.Posizione" Placeholder="Posizione Primaria" FloatLabelType="@FloatLabelType.Always" Multiline="true" CssClass="sftext"></SfTextBox>
                                    </div>
                                </div>

                                <!-- Motilità Attiva -->
                                <div class="row" style="margin-top: 12px;">
                                    <div class="col-sm-8">
                                        <SfTextBox ID="oMotilita" @bind-Value="@Ortoctis.Motilita" Placeholder="Motilità Attiva" FloatLabelType="@FloatLabelType.Always" Multiline="true" CssClass="sftext"></SfTextBox>
                                    </div>
                                </div>

                                <!-- Convergenza -->
                                <div class="row" style="margin-top: 12px;">
                                    <div class="col-sm-8">
                                        <SfTextBox ID="oConvergenza" @bind-Value="@Ortoctis.Convergenza" Placeholder="Convergenza" FloatLabelType="@FloatLabelType.Always" Multiline="true" CssClass="sftext"></SfTextBox>
                                    </div>
                                </div>

                                <!-- Cover Test -->
                                <div class="row" style="margin-top: 12px;">
                                    <div class="col-sm-8">
                                        <SfTextBox ID="oCover" @bind-Value="@Ortoctis.Cover" Placeholder="Cover Test" FloatLabelType="@FloatLabelType.Always" Multiline="true" CssClass="sftext"></SfTextBox>
                                    </div>
                                </div>

                                <!-- Prisma Cover Test -->
                                <div class="row" style="margin-top: 12px;">
                                    <div class="col-sm-8">
                                        <SfTextBox ID="oPrismaCover" @bind-Value="@Ortoctis.PrismaCover" Placeholder="Prisma Cover Test" FloatLabelType="@FloatLabelType.Always" Multiline="true" CssClass="sftext"></SfTextBox>
                                    </div>
                                </div>

                                <!-- Ampiezza Fusiva -->
                                <div class="row" style="margin-top: 12px;">
                                    <div class="col-sm-8">
                                        <SfTextBox ID="oAmpiezza" @bind-Value="@Ortoctis.Ampiezza" Placeholder="Ampiezza Fusiva" FloatLabelType="@FloatLabelType.Always" Multiline="true" CssClass="sftext"></SfTextBox>
                                    </div>
                                </div>

                                <!-- Vetro Rosso -->
                                <div class="row" style="margin-top: 12px;">
                                    <div class="col-sm-8">
                                        <SfTextBox ID="oVetro" @bind-Value="@Ortoctis.Vetro" Placeholder="Vetro Rosso" FloatLabelType="@FloatLabelType.Always" Multiline="true" CssClass="sftext"></SfTextBox>
                                    </div>
                                </div>

                                <!-- Lang Test -->
                                <div class="row" style="margin-top: 12px;">
                                    <div class="col-sm-8">
                                        <SfTextBox ID="oLang" @bind-Value="@Ortoctis.Lang" Placeholder="Lang Test" FloatLabelType="@FloatLabelType.Always" Multiline="true" CssClass="sftext"></SfTextBox>
                                    </div>
                                </div>

                                <!-- Titmus Test -->
                                <div class="row" style="margin-top: 12px;">
                                    <div class="col-sm-8">
                                        <SfTextBox ID="oTitmus" @bind-Value="@Ortoctis.Titmus" Placeholder="Titmus Test" FloatLabelType="@FloatLabelType.Always" Multiline="true" CssClass="sftext"></SfTextBox>
                                    </div>
                                </div>

                                <!-- Altri test per la visione binoculare -->
                                <div class="row" style="margin-top: 12px;">
                                    <div class="col-sm-8">
                                        <SfTextBox ID="oAltriTest" @bind-Value="@Ortoctis.AltriTest" Placeholder="Altri test per la visione binoculare" FloatLabelType="@FloatLabelType.Always" Multiline="true" CssClass="sftext"></SfTextBox>
                                    </div>
                                </div>

                                <!-- Conclusioni -->
                                <div class="row" style="margin-top: 12px;">
                                    <div class="col-sm-8">
                                        <label class="e-label-top" style="color: #343a40; font-weight: 500; font-size: 12px; padding-bottom:3px;" id="label_Conclusioni" for="oConclusioni">Conclusioni</label>
                                        <SfTextBox ID="oConclusioni" @bind-Value="@Ortoctis.Conclusioni" Multiline="true" CssClass="sftext"></SfTextBox>
                                    </div>
                                </div>

                                <!-- Diagnosi -->
                                <div class="row" style="margin-top: 12px;">
                                    <div class="col-sm-8">
                                        <label class="e-label-top" style="color: #343a40; font-weight: 500; font-size: 12px; padding-bottom:3px;" id="label_Diagnosi" for="oDiagnosi">Diagnosi</label>
                                        <SfTextBox ID="oDiagnosi" @bind-Value="@Ortoctis.Diagnosi" Multiline="true" CssClass="sftext"></SfTextBox>
                                    </div>
                                </div>

                                <!-- Terapia -->
                                <div class="row" style="margin-top: 12px;">
                                    <div class="col-sm-8">
                                        <label class="e-label-top" style="color: #343a40; font-weight: 500; font-size: 12px; padding-bottom:3px;" id="label_Terapia" for="oTerapia">Terapia</label>
                                        <SfTextBox ID="oTerapia" @bind-Value="@Ortoctis.Terapia" Multiline="true" CssClass="sftext"></SfTextBox>
                                    </div>
                                </div>
                            </ContentTemplate>
                        </TabItem>

                        <!-- Sezione Prescrizioni -->
                        <TabItem Disabled=@PrescrizioniDisabled>
                            <ChildContent>
                                <TabHeader Text="Prescrizioni"></TabHeader>
                            </ChildContent>
                            <ContentTemplate>
                                <SfTab>
                                    <TabItems>
                                        <TabItem Visible=@ShowPresc>
                                            <ChildContent>
                                                <TabHeader Text="Prescrizione"></TabHeader>
                                            </ChildContent>
                                            <ContentTemplate>
                                                <div class="row" style="margin: 10px 2px 25px 2px; padding-bottom:10px; border-bottom: 1px solid #ddd;">
                                                    <div class="col-sm-1">&nbsp;</div>
                                                    <div class="col-sm-2" style="font-size: 16px; font-weight: 500; margin: 3px 0;">Farmaco</div>
                                                    <div class="col-sm-4" style="font-size: 16px; font-weight: 500; margin: 3px 0;">Somministrazione</div>
                                                    @* <div class="col-sm-1">&nbsp;@ider</div> *@

                                                    <div class="col-sm-3">
                                                        <span style="float: left;">
                                                            <SfButton IconCss="e-icons e-search icon-slategrey" CssClass="e-flat btn-light" Content="Scelta Farmaco" OnClick="() => ShowFar()"></SfButton>
                                                        </span>

                                                        <span style="float: right; width: 94px; display: inline-block;">
                                                            <SfMaskedTextBox ID="data_prescrizione" @bind-Value="@pDataPrescrizione" Mask="00/00/0000" CssClass="sftext"></SfMaskedTextBox>
                                                        </span>

                                                        <span style="float: right; display: inline-block; margin-left: 10px;  margin-right: 10px; padding-top: 6px; font-weight:bold;">
                                                            Data di Stampa
                                                        </span>
                                                    </div>

                                                    <div class="col-sm-2" style="padding: 0;">
                                                        <span style="float: right; width: 110px;">
                                                            <SfButton IconCss="e-icons icon-navy e-print" CssClass="e-flat btn-light" Content=" Prescrizione" OnClick="() => StampaPrescrizione()" Disabled="@PrintPrescrDisabled"></SfButton>
                                                        </span>

                                                        <span style="float: right; width: 110px; margin-right: 10px;">
                                                            <SfDropDownList TItem="PrintTemplates" TValue="string" PopupHeight="230px" Placeholder="es. Template 1" @bind-Value="@DropDownTemplate" DataSource="@ListTemplates">
                                                                <DropDownListEvents TItem="PrintTemplates" TValue="string" ValueChange="OnPrescChange" />
                                                                <DropDownListFieldSettings Text="Text" Value="Id" />
                                                            </SfDropDownList>
                                                        </span>
                                                    </div>
                                                </div>

                                                @if (@Prescriptions.Count > 0)
                                                {
                                                    @for (var ip = 0; ip < @Prescriptions.Count; ip++)
                                                    {
                                                        decimal questo = @Prescriptions[ip].IdPrescrizione;
                                                        int myId = ip;

                                                        <div class="row" style="margin-top: 10px;">
                                                            <div class="col-sm-1" style="text-align:right; padding-right:6px;">@(ip + 1)</div>
                                                            <div class="col-sm-2">
                                                                <SfTextBox @bind-Value="@Prescriptions[ip].Farmaco" Readonly="true" CssClass="sftext" style="border:0px;"></SfTextBox>
                                                            </div>
                                                            <div class="col-sm-4">
                                                                @* <SfTextBox ID="valutazione" @bind-Value="@Prescriptions[ip].Uso" Multiline=true style="height: 72px;" ></SfTextBox> *@
                                                                <SfTextBox Value="@Prescriptions[ip].Uso" ValueChanged="@(value => UpdateUso(myId, value))" Multiline=true CssClass="sftext" style="height: 72px;"></SfTextBox>
                                                            </div>

                                                            @if (ip < @Prescriptions.Count - 1)
                                                            {
                                                                <div class="col-sm-1">
                                                                    <SfButton IconCss="e-icons e-erase icon-red" CssClass="e-flat btn-light" Content="Rimuovi" OnClick="() => DeleteFar(questo)"></SfButton>
                                                                </div>
                                                            }
                                                        </div>

                                                        <br />
                                                    }
                                                }

                                                <div class="row" style="margin-top: 14px;">
                                                    <div class="col-sm-1" style="text-align:right; padding-right:6px;">Nota:</div>
                                                    <div class="col-sm-6">
                                                        <SfTextBox @bind-Value="@NotaPrescrizione" Multiline="true" CssClass="sftext" style="height: 96px;"></SfTextBox>
                                                    </div>
                                                </div>
                                            </ContentTemplate>
                                        </TabItem>

                                        <TabItem Visible=@ShowDrugs>
                                            <ChildContent>
                                                <TabHeader Text="Lista Farmaci"></TabHeader>
                                            </ChildContent>
                                            <ContentTemplate>
                                                <div class="container-fluid form-farmfilter" style="padding: 4px 10px 14px 10px;">
                                                    <div class="row">
                                                        <div class="col-sm-1">
                                                            <SfButton IconCss="e-icons e-chevron-left icon-green" CssClass="e-flat btn-light" style="margin-top:24px;" Content="Prescrizione" OnClick="() => BackPresc()"></SfButton>
                                                        </div>

                                                        <div class="col-sm-7">
                                                            <span style="display:inline-block; width:300px;">
                                                                <SfTextBox ID="fFar" @bind-Value="@fFar" Placeholder="Farmaco" FloatLabelType="@FloatLabelType.Auto" CssClass="sftext"></SfTextBox>
                                                            </span>
                                                            <span style="display:inline-block; width:50px;">&nbsp;</span>
                                                            <SfButton IconCss="e-icons e-search icon-slategrey" CssClass="e-flat btn-light" style="margin-top:24px;" Content="Cerca" OnClick="() => SearchFar()"></SfButton>
                                                            <span style="display:inline-block; width:25px;">&nbsp;</span>
                                                            <SfButton IconCss="e-icons e-repeat icon-green" CssClass="e-flat btn-light" style="margin-top:24px;" Content="Ripristina" OnClick="() => ResetFar()"></SfButton>
                                                        </div>
                                                    </div>

                                                    <br />

                                                    <div class="row">
                                                        <div class="col-sm-12">
                                                            <SfGrid ID="DrugsGrid" @ref="RefDrugsGrid" DataSource="@drugs" AllowPaging="true" Width="auto">@* RowHeight="20"  *@
                                                                <GridPageSettings PageCount="PAGE_COUNT" PageSize="DEFAULT_PAGE_SIZE" PageSizes="PageSizes"></GridPageSettings>
                                                                <GridColumns>
                                                                    <GridColumn HeaderText="" Width="60">
                                                                        <Template>
                                                                            @{
                                                                                var drugInfo = (context as DrugSearch);
                                                                                var idF = drugInfo.IdFarmaco;
                                                                                var idU = drugInfo.IdFarmacoUso;

                                                                                var far = drugInfo.Farmaco;
                                                                                var use = drugInfo.Uso;

                                                                                <SfButton IconCss="e-icons e-plus icon-green" CssClass="e-small e-flat btn-white" Content="" OnClick="() => AssignDrug(idF, idU, far, use)" title="Assegna a Prescrizione"></SfButton>
                                                                            }
                                                                        </Template>
                                                                    </GridColumn>
                                                                    <GridColumn Field=@nameof(DrugSearch.Farmaco) HeaderText="Farmaco" Width="20%"></GridColumn>
                                                                    <GridColumn Field=@nameof(DrugSearch.Uso) HeaderText="Somministrazione" Width="80%"></GridColumn>
                                                                </GridColumns>
                                                            </SfGrid>
                                                        </div>

                                                        @* <div class="col-sm-1">&nbsp;</div> *@
                                                    </div>
                                                </div>
                                            </ContentTemplate>
                                        </TabItem>
                                    </TabItems>
                                </SfTab>
                            </ContentTemplate>
                        </TabItem>

                        <!-- Sezione Relazioni -->
                        <TabItem Disabled=@RelazioniDisabled>
                            <ChildContent>
                                <TabHeader Text="Relazioni"></TabHeader>
                            </ChildContent>
                            <ContentTemplate>
                                <div class="row" style="margin-top: 10px;">
                                    <div class="col-sm-12">
                                        <span style="float: left; display: inline-block; margin-left: 10px;  margin-right: 10px; padding-top: 6px; font-weight:bold;">
                                            Data di Stampa
                                        </span>

                                        <span style="float: left; width: 94px; display: inline-block;">
                                            <SfMaskedTextBox ID="data_relazione" @bind-Value="@pDataRelazione" Mask="00/00/0000" CssClass="sftext"></SfMaskedTextBox>
                                        </span>

                                        <span style="float: right;">
                                            <SfButton IconCss="e-icons icon-navy e-print" CssClass="e-flat btn-light" Content=" Stampa Relazione" OnClick="() => StampaRelazione(DropDownTemplate)" Disabled="@PrintVisitDisabled"></SfButton>
                                        </span>

                                        <span style="float: right; width: 110px; margin-right: 10px;">
                                            <SfDropDownList TItem="PrintTemplates" TValue="string" PopupHeight="230px" Placeholder="es. Template 1" @bind-Value="@DropDownTemplate" DataSource="@ListTemplates">
                                                <DropDownListEvents TItem="PrintTemplates" TValue="string" ValueChange="OnRelChange" />
                                                <DropDownListFieldSettings Text="Text" Value="Id" />
                                            </SfDropDownList>
                                        </span>
                                    </div>
                                </div>

                                <!-- Diagnosi -->
                                <div class="row" style="margin-top: 12px;">
                                    <div class="col-sm-6">
                                        <SfTextBox ID="rdiagnosiod" @bind-Value="@Relazione.DiagnosiOD" Placeholder="Diagnosi OD" FloatLabelType="@FloatLabelType.Always" title="@Relazione.DiagnosiOD" Multiline="true" CssClass="sftext" style="height: 48px;"></SfTextBox>
                                    </div>
                                    <div class="col-sm-6">
                                        <SfTextBox ID="rdiagnosios" @bind-Value="@Relazione.DiagnosiOS" Placeholder="Diagnosi OS" FloatLabelType="@FloatLabelType.Always" title="@Relazione.DiagnosiOS" Multiline="true" CssClass="sftext" style="height: 48px;"></SfTextBox>
                                    </div>
                                </div>

                                <!-- SHIRMER -->
                                <div class="row" style="margin-top: 12px;">
                                    <div class="col-sm-6">
                                        <SfTextBox ID="shirmerod" @bind-Value="@Relazione.SHIRMER_Od" Placeholder="SHIRMER OD" FloatLabelType="@FloatLabelType.Always" title="@Relazione.SHIRMER_Od" Multiline="true" CssClass="sftext" style="height: 48px;"></SfTextBox>
                                    </div>
                                    <div class="col-sm-6">
                                        <SfTextBox ID="shirmeros" @bind-Value="@Relazione.SHIRMER_Os" Placeholder="SHIRMER OS" FloatLabelType="@FloatLabelType.Always" title="@Relazione.SHIRMER_Os" Multiline="true" CssClass="sftext" style="height: 48px;"></SfTextBox>
                                    </div>
                                </div>

                                <!-- Seg.Ant. -->
                                <div class="row" style="margin-top: 12px;">
                                    <div class="col-sm-6">
                                        <SfTextBox ID="segantod" @bind-Value="@Relazione.Seg_Ant_Od" Placeholder="Seg.Ant. OD" FloatLabelType="@FloatLabelType.Always" title="@Relazione.Seg_Ant_Od" Multiline="true" CssClass="sftext" style="height: 48px;"></SfTextBox>
                                    </div>
                                    <div class="col-sm-6">
                                        <SfTextBox ID="segantos" @bind-Value="@Relazione.Seg_Ant_Os" Placeholder="Seg.Ant. OS" FloatLabelType="@FloatLabelType.Always" title="@Relazione.Seg_Ant_Os" Multiline="true" CssClass="sftext" style="height: 48px;"></SfTextBox>
                                    </div>
                                </div>

                                <!-- Visus -->
                                <div class="row" style="margin-top: 12px;">
                                    <div class="col-sm-6">
                                        <SfTextBox ID="visusod" @bind-Value="@Relazione.Visus_Od" Placeholder="Visus OD" FloatLabelType="@FloatLabelType.Always" title="@Relazione.Visus_Od" Multiline="true" CssClass="sftext" style="height: 48px;"></SfTextBox>
                                    </div>
                                    <div class="col-sm-6">
                                        <SfTextBox ID="visusos" @bind-Value="@Relazione.Visus_Os" Placeholder="Visus OS" FloatLabelType="@FloatLabelType.Always" title="@Relazione.Visus_Os" Multiline="true" CssClass="sftext" style="height: 48px;"></SfTextBox>
                                    </div>
                                </div>

                                <!-- Tono Oculare -->
                                <div class="row" style="margin-top: 12px;">
                                    <div class="col-sm-6">
                                        <SfTextBox ID="tonood" @bind-Value="@Relazione.TONO_Od" Placeholder="Tono Oculare OD" FloatLabelType="@FloatLabelType.Always" title="@Relazione.TONO_Od" Multiline="true" style="height: 48px;"></SfTextBox>
                                    </div>
                                    <div class="col-sm-6">
                                        <SfTextBox ID="tonoos" @bind-Value="@Relazione.TONO_Os" Placeholder="Tono Oculare OS" FloatLabelType="@FloatLabelType.Always" title="@Relazione.TONO_Os" Multiline="true" style="height: 48px;"></SfTextBox>
                                    </div>
                                </div>

                                <!-- Fundus -->
                                <div class="row" style="margin-top: 12px;">
                                    <div class="col-sm-6">
                                        <SfTextBox ID="fundusod" @bind-Value="@Relazione.Fundus_Od" Placeholder="Fundus OD" FloatLabelType="@FloatLabelType.Always" title="@Relazione.Fundus_Od" Multiline="true" CssClass="sftext" style="height: 48px;"></SfTextBox>
                                    </div>
                                    <div class="col-sm-6">
                                        <SfTextBox ID="fundusod" @bind-Value="@Relazione.Fundus_Os" Placeholder="Fundus OS" FloatLabelType="@FloatLabelType.Always" title="@Relazione.Fundus_Os" Multiline="true" CssClass="sftext" style="height: 48px;"></SfTextBox>
                                    </div>
                                </div>
                            </ContentTemplate>
                        </TabItem>
                    </TabItems>
                </SfTab>
            </div>
        </div>
    </div>
}

<br />
<br />

<SfDialog Width="400px" Target="#target" ShowCloseIcon="true" @bind-Visible="DialogVisible">
    <DialogTemplates>
        <Header> @DialogHeader </Header>
        <Content>
            <div class='msg-wrapper col-lg-12'>
                <span class='@DialogIcon'></span>
                <span class='error-msg col-lg-10'>@DialogText</span>
            </div>
            <div class='error-detail col-lg-8'>
                <span>@DialogDetail</span>
            </div>
        </Content>
    </DialogTemplates>
    <DialogButtons>
        <DialogButton Content="OK" IsPrimary="true" OnClick="@CloseDialog" />
    </DialogButtons>
</SfDialog>

<style>
    .vstepper {
        display: inline-block;
        margin: 0 10px 0 8px;
        border: 1px solid #ccc;
        width: 80px;
        text-align: center;
        font-size: 13px;
        padding-top: 3px;
    }

    .default-tab {
        border: 1px solid #d7d7d7;
    }

        .default-tab .e-content .e-item {
            padding: 10px;
            text-align: justify;
        }

    .default-tab-control-section {
        margin: 20px 20% 20px 20%;
    }

    @@media screen and (max-width: 480px) {
        .default-tab-control-section {
            margin: 20px 0 20px 0;
        }
    }

    .bootstrap5 .default-tab,
    .bootstrap .default-tab,
    .bootstrap4 .default-tab {
        border: none;
    }

        .bootstrap5 .default-tab .e-content > .e-item.e-active,
        .bootstrap4 .default-tab .e-content > .e-item.e-active,
        .bootstrap .default-tab .e-content > .e-item.e-active {
            background: #FAF9F8;
        }

    .e-tab .e-tab-header .e-toolbar-items .e-active .e-tab-wrap {
        border-bottom: 4px solid #0d6efd;
    }

        .e-tab .e-tab-header .e-toolbar-items .e-active .e-tab-wrap:hover {
            border-bottom: 4px solid #0d6efd;
        }

    .e-tab .e-tab-header .e-toolbar-item:not(.e-active) {
        border-bottom: 0px;
    }

    @*/*
        .e-tab .e-toolbar .e-toolbar-items .e-toolbar-item .e-text-wrap {
        height: 50px;
    }

    .e-tab-wrap:hover, .e-tab-wrap:active {
        border-bottom: 4px solid #0d6efd !important;
    }*/
    *@

    .e-btn.e-flat.e-primary, .e-btn.e-flat.e-primary:focus {
        background-color: #317ab9;
        border-color: #265f91;
        color: #fff;
    }

    .e-btn.e-flat.e-primary:hover, .e-btn.e-flat.e-primary:active {
        background-color: #21527d;
        border-color: #163854;
        color: #fff;
    }

    .e-circle-close {
        width: 24px;
        height: 24px;
        position: relative;
        display: inline-block;
    }

    .e-circle-info {
        width: 24px;
        height: 24px;
        position: relative;
        display: inline-block;
    }

    .error-msg {
        color: #66afe9;
        display: inline-block;
        position: relative;
        top: -20px;
        left: 10px;
    }

    .error-detail {
        position: relative;
        left: 36px;
        margin: 0 0 21px;
    }

    @*/*
    .e-icons.close-icon.col-lg-2:before {
        content: '\e7e9';
        font-size: 26px;
        color: #d9534f;
        position: relative;
        left: 1px;
        bottom: 18px; e-circle-info
    }*/
    *@

    .e-icons.e-circle-close.col-lg-2:before {
        font-size: 20px;
        color: #d9534f;
        position: relative;
        left: 4px;
        bottom: 18px;
    }

    .e-icons.e-circle-info.col-lg-2:before {
        font-size: 20px;
        color: #228e1f;
        position: relative;
        left: 4px;
        bottom: 18px;
    }

    .e-dialog .e-footer-content {
        background-color: #f8f8f8;
    }

    .e-dialog.e-control.e-popup, .e-dialog.e-control.e-popup .e-dlg-header-content {
        background-color: #d9edf7;
    }

    .e-dialog.e-control.e-popup {
        padding: 3px;
    }

    .e-dialog.e-control .e-dlg-header-content {
        padding: 10px;
    }

    .e-dialog.e-control .e-footer-content {
        padding: 8px 12px;
    }

    .e-dialog.e-control .e-dlg-content {
        padding: 15px 0 0;
    }

    .msg-wrapper.col-lg-12 {
        margin-top: 20px;
    }

    .customtooltip.e-tooltip-wrap.e-popup {
        background-color: #ededed;
        border: 1px solid #d9d9d9;
    }

    .e-tooltip-wrap .e-tip-content {
        color: #3d3d3d;
    }

    .customtooltip.e-tooltip-wrap .e-arrow-tip-outer {
        border-bottom: 12px solid transparent;
        border-left: 12px solid transparent;
        border-top: 12px solid transparent;
        border-right: 12px solid transparent;
    }

    .customtooltip.e-tooltip-wrap .e-arrow-tip-inner {
        color: #ededed;
        font-size: 25.9px;
    }
</style>


@code {
    [Parameter]
    public decimal id { get; set; }

    string TitlePage = "";

    public const int PAGE_COUNT = 10;
    public const int DEFAULT_PAGE_SIZE = 10;
    public string[] PageSizes = new string[] { "Tutti", "5", "10", "20", "50" };

    private List<TabData> TabStyles { get; set; } = new List<TabData>() {
        new TabData { StyleMode = "Default Tab", StyleClass = "" },
        new TabData { StyleMode = "Fill Tab Header", StyleClass = "e-fill" },
        new TabData { StyleMode = "Background Tab Header", StyleClass = "e-background" }
    };
    public class TabData
    {
        public string StyleMode { get; set; }
        public string StyleClass { get; set; }
    }

    Boolean ShowMore = true;
    string fShowLessBtn = "inline-block";
    string fShowMoreBtn = "none";

    private string SaveText = "";

    bool FirstPage;

    Boolean ShowVisits = false;

    #region dialog
    private bool DialogVisible { get; set; } = false;

    private string DialogHeader { get; set; } = "";
    private string DialogIcon { get; set; } = "";
    private string DialogText { get; set; } = "";
    private string DialogDetail { get; set; } = "";

    private void CloseDialog()
    {
        DialogVisible = false;
    }
    #endregion

    #region logging
    string? LoggedUser;
    string[]? arUser;

    private string? gIdUser;
    private string? gFName;
    private string? gLName;
    private string? gSuperUser;

    private string? SessionID;

    //private string[] gRoleUser;

    private string sessionLoggedUser { get; set; }
    #endregion

    #region binding paziente
    private List<Patient> Pazienti = new List<Patient> { };
    private Patient Paziente = new Patient();

    public Boolean PazienteValido = false;

    public string LName = "";
    public string FName = "";

    public string Cod = "";
    public string CodFisc = "";

    public string BirthDate = "";
    public string BirthCity = "";
    public string Gender = "";

    public string Address = "";
    public string City = "";
    public string ZipCode = "";
    public string State = "";

    public string Phone = "";
    public string Mobile = "";
    public string Email = "";
    public string Note = "";

    public string Privacy = "";

    public string Studio = "";

    private string switchPrivacy = "Da firmare";
    private bool fPrivacy = false;
    #endregion

    #region binding visita
    public string DataVisita = "";

    public Boolean FirstVisitDisabled = false;
    public Boolean PrevVisitDisabled = false;
    public Boolean NextVisitDisabled = false;
    public Boolean LastVisitDisabled = false;

    public Boolean AddVisitDisabled = false;
    public Boolean SaveVisitDisabled = true;
    public Boolean PrintVisitDisabled = true;

    public Boolean IsNewVisit = false;

    private Visit Visita = new Visit();

    // private List<Coppia> ListaVisite;
    private List<CoppiaDecDat> ListaVisite = new List<CoppiaDecDat>();
    private int VisitaCorrente = -1;

    string IndexVisita = "";
    #endregion

    #region binding prescrizione occhiali
    public string DataMisura = "";
    public string pDataOcchiali = "";

    public Boolean POcchialiDisabled = true;
    public Boolean SaveVisusDisabled = false;
    public Boolean PrintVisusDisabled = true;

    public Boolean IsNewVisus = false;

    private Misure Visus = new Misure();

    private List<CoppiaDecDat> ListaVisus;
    private int VisusCorrente = -1;

    private string switchTabo = "TABO: Si";
    private bool fTabo = true;

    private string switchInter = "INTERNAZIONALE: No";
    private bool fInter = false;
    #endregion

    #region binding controllo
    public string DataControllo = "";

    public Boolean ControlliDisabled = true;

    public Boolean FirstCntrDisabled = false;
    public Boolean PrevCntrDisabled = false;
    public Boolean NextCntrDisabled = false;
    public Boolean LastCntrDisabled = false;

    public Boolean AddCntrDisabled = false;
    public Boolean SaveCntrDisabled = false;
    public Boolean PrintCntrDisabled = true;

    public Boolean IsNewCntr = false;

    private Controlli Controllo = new Controlli();

    private List<TriplaDecDatStr> ListaCntrs = new List<TriplaDecDatStr>();

    private int CntrCorrente = -1;

    string IndexControlli = "";
    #endregion

    #region binding visita ortottica
    public string DataOrtottica = "";
    public string pDataOrtottica = "";

    public Boolean OrtotticaDisabled = true;
    public Boolean PrintOrtotDisabled = true;

    public Boolean SaveOrtoctisDisabled = false;
    public Boolean IsNewOrtoctis = false;

    private Ortottica Ortoctis = new Ortottica();

    private List<CoppiaDecDat> ListaOrtoctis;
    private int OrtoctisCorrente = -1;
    #endregion

    #region binding prescrizioni
    public string pDataPrescrizione = "";

    public Boolean PrescrizioniDisabled = true;
    public Boolean PrintPrescrDisabled = true;

    public Boolean ShowPresc = true;
    public Boolean ShowDrugs = false;

    public string fFar = "";

    private List<DrugSearch>? drugs;

    private SfGrid<DrugSearch> RefDrugsGrid;

    private List<Prescrizioni>? Prescriptions;

    private int LastPrescr = 0;

    private string? NotaPrescrizione;

    decimal ider;
    #endregion

    #region binding relazioni
    public Boolean RelazioniDisabled = true;
    public string pDataRelazione = "";
    private Relazioni Relazione = new Relazioni();
    #endregion

    #region template di stampa
    public class PrintTemplates
    {
        public string Id { get; set; }
        public string Text { get; set; }
    }

    private List<PrintTemplates> ListTemplates = new List<PrintTemplates>()
    {
        new PrintTemplates(){ Id= "1", Text= "Template 1" },
        new PrintTemplates(){ Id= "2", Text= "Template 2" },
     };

    public string DropDownTemplate = "1";       // unico per tutte le drop down così scelto per una vale per tutte le altre

    // Occhiali
    public string LensChangeValue { get; set; } = "Template 1";

    public void OnLensChange(Syncfusion.Blazor.DropDowns.ChangeEventArgs<string, PrintTemplates> args)
    {
        this.LensChangeValue = args.ItemData.Text;
    }

    // Controlli
    public string ContrChangeValue { get; set; } = "Template 1";

    public void OnContrChange(Syncfusion.Blazor.DropDowns.ChangeEventArgs<string, PrintTemplates> args)
    {
        this.ContrChangeValue = args.ItemData.Text;
    }

    // Ortottica
    public string OrthChangeValue { get; set; } = "Template 1";

    public void OnOrthChange(Syncfusion.Blazor.DropDowns.ChangeEventArgs<string, PrintTemplates> args)
    {
        this.OrthChangeValue = args.ItemData.Text;
    }

    // Prescrizioni
    public string PrescChangeValue { get; set; } = "Template 1";

    public void OnPrescChange(Syncfusion.Blazor.DropDowns.ChangeEventArgs<string, PrintTemplates> args)
    {
        this.PrescChangeValue = args.ItemData.Text;
    }

    // Relazione
    public string RelChangeValue { get; set; } = "Template 1";

    public void OnRelChange(Syncfusion.Blazor.DropDowns.ChangeEventArgs<string, PrintTemplates> args)
    {
        this.RelChangeValue = args.ItemData.Text;
    }
    #endregion

    #region Funzioni di supporto
    private void ManagePrivacy(Syncfusion.Blazor.Buttons.ChangeEventArgs<bool> obj)
    {
        if (fPrivacy)
        {
            switchPrivacy = "Firmata";
        }
        else
        {
            switchPrivacy = "Da firmare";
        }
    }

    private void SwapView(string view)
    {
        if (view == "less")
        {
            ShowMore = false;

            fShowLessBtn = "none";
            fShowMoreBtn = "inline-block";
        }
        else
        {
            ShowMore = true;

            fShowLessBtn = "inline-block";
            fShowMoreBtn = "none";
        }
    }

    private string SetObjNullToStr(object obj)
    {
        string result = "";

        if ((obj == null) || (obj.Equals(System.DBNull.Value)))
        {
            result = "";
        }
        else
        {
            result = obj.ToString();
        }

        return result;
    }

    public static int GetDaysInMonth(int year, int month)
    {
        // Verifica che il mese sia compreso tra 1 e 12
        if (month < 1 || month > 12)
        {
            throw new ArgumentOutOfRangeException(nameof(month), "Il mese deve essere compreso tra 1 e 12.");
        }

        // Anni bisestili: divisibili per 4, ma non per 100, a meno che siano divisibili per 400
        bool isLeapYear = year % 4 == 0 && (year % 100 != 0 || year % 400 == 0);

        // Numero di giorni per ogni mese
        int[] daysInMonth = { 31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31 };

        // Aggiungi un giorno a febbraio se è un anno bisestile
        if (isLeapYear && month == 2)
        {
            return daysInMonth[month - 1] + 1;
        }

        return daysInMonth[month - 1];
    }

    private Boolean CheckDate(string myDate)
    {
        Boolean result = false;
        string myYear, myMonth, myDay;
        int GiorniMese;

        if (myDate.Length == 8)
        {
            myYear = myDate.Substring(4, 4);
            myMonth = myDate.Substring(2, 2);
            myDay = myDate.Substring(0, 2);

            if (int.Parse(myYear) > 1900)
            {
                if ((int.Parse(myMonth) >= 1) && (int.Parse(myMonth) <= 12))
                {
                    GiorniMese = (GetDaysInMonth(int.Parse(myYear), int.Parse(myMonth)));

                    if ((int.Parse(myDay) >= 1) && (int.Parse(myDay) <= GiorniMese))
                    {
                        result = true;
                    }
                    else
                    {
                        // giorno non compreso tra 1 e numero giorni previsto per il mese esci con false
                        DialogHeader = " Attenzione ";
                        DialogIcon = "e-icons e-circle-close col-lg-2";
                        DialogText = "Giorno data di nascita non valido";
                        DialogDetail = "";
                        DialogVisible = true;
                    }
                }
                else
                {
                    // mese non compreso tra 1 e 12 esci con false
                    DialogHeader = " Attenzione ";
                    DialogIcon = "e-icons e-circle-close col-lg-2";
                    DialogText = "Mese data di nascita non valido";
                    DialogDetail = "";
                    DialogVisible = true;
                }
            }
            else
            {
                // anno inferiore al 190 esci con false
                DialogHeader = " Attenzione ";
                DialogIcon = "e-icons e-circle-close col-lg-2";
                DialogText = "Anno data di nascita non valido";
                DialogDetail = "";
                DialogVisible = true;
            }
        }
        else
        {
            // anno inferiore al 190 esci con false
            DialogHeader = " Attenzione ";
            DialogIcon = "e-icons e-circle-close col-lg-2";
            DialogText = "Data di nascita non valida";
            DialogDetail = "";
            DialogVisible = true;
        }

        return result;
    }

    private void ManageTabo(Syncfusion.Blazor.Buttons.ChangeEventArgs<bool> obj)
    {
        if (fTabo)
        {
            switchTabo = "TABO: Si";
        }
        else
        {
            switchTabo = "TABO: No";
        }
    }

    private void ManageInter(Syncfusion.Blazor.Buttons.ChangeEventArgs<bool> obj)
    {
        if (fInter)
        {
            switchInter = "INTERNAZIONALE: Si";
        }
        else
        {
            switchInter = "INTERNAZIONALE: No";
        }
    }

    public async void GoToPatientList(decimal id)
    {
        await Task.Delay(10);
        Navigation.NavigateTo("/patientlist/" + id.ToString());
    }
    #endregion

    protected override async Task OnInitializedAsync()
    {
        sessionLoggedUser = await sessionStorage.GetItemAsStringAsync("sessionLoggedUser");

        if (string.IsNullOrEmpty(sessionLoggedUser))
        {
            Navigation.NavigateTo("/auth/login");
        }
        else
        {
            LoggedUser = sessionLoggedUser.Substring(1, sessionLoggedUser.Length - 2);

            arUser = LoggedUser.Split(",");

            gIdUser = arUser[0];
            gFName = arUser[1];
            gLName = arUser[2];
            gSuperUser = arUser[3];

            SessionID = arUser[4];

            fFar = "";

            // gRoleUser = arUser[n].Split(",");

            if (id == 0)
            {
                TitlePage = "Inserimento Nuovo Paziente";

                ShowMore = true;

                fShowLessBtn = "inline-block";
                fShowMoreBtn = "none";

                fPrivacy = false;
                switchPrivacy = "Da firmare";

                SaveText = "Inserisci dati Paziente";

                ShowVisits = false;
            }
            else
            {
                TitlePage = "Dati Paziente";

                ShowMore = false;

                fShowLessBtn = "none";
                fShowMoreBtn = "inline-block";

                SaveText = "Aggiorna dati Paziente";

                ShowVisits = true;

                // load dati paziente
                LoadPatient();

                // load date e id storico visite e dati ultima visita
                ListaVisite = await ListVisitsService.ListPatientsVisits(id);

                // load date e id storico visus e dati ultimo visus
                ListaVisus = await ListVisusService.ListPatientsVisus(id);

                // load date e id storico visite ortottiche
                ListaOrtoctis = await ListOrtoctisService.ListPatientsOrtottica(id);

                if (ListaVisite.Count > 0)
                {
                    SaveVisitDisabled = true;
                    PrintVisitDisabled = false;

                    if (ListaVisite.Count == 1)
                    {
                        FirstVisitDisabled = true;
                        PrevVisitDisabled = true;
                        NextVisitDisabled = true;
                        LastVisitDisabled = true;
                    }
                    else
                    {
                        FirstVisitDisabled = true;
                        PrevVisitDisabled = true;
                        NextVisitDisabled = false;
                        LastVisitDisabled = false;
                    }

                    POcchialiDisabled = false;
                    ControlliDisabled = false;
                    OrtotticaDisabled = false;
                    PrescrizioniDisabled = false;
                    RelazioniDisabled = false;

                    VisitaCorrente = 0;

                    IndexVisita = (VisitaCorrente + 1).ToString() + " di " + ListaVisite.Count.ToString();

                    DataVisita = ListaVisite[VisitaCorrente].Val.ToString("dd/MM/yyyy");

                    LoadVisit(ListaVisite[VisitaCorrente].ID);

                    LoadVisus(ListaVisite[VisitaCorrente].ID);

                    // load date e id storico controlli e dati ultimo controllo

                    ListaCntrs = await ListControlliService.ListControlliByVisit(ListaVisite[VisitaCorrente].ID);

                    if (ListaCntrs.Count > 0)
                    {
                        if (ListaCntrs.Count == 1)
                        {
                            FirstCntrDisabled = true;
                            PrevCntrDisabled = true;
                            NextCntrDisabled = true;
                            LastCntrDisabled = true;
                        }
                        else
                        {
                            FirstCntrDisabled = true;
                            PrevCntrDisabled = true;
                            NextCntrDisabled = false;
                            LastCntrDisabled = false;
                        }

                        CntrCorrente = 0;

                        IndexControlli = (CntrCorrente + 1).ToString() + " di " + ListaCntrs.Count.ToString();

                        DataControllo = ListaCntrs[CntrCorrente].ValDat.ToString();

                        LoadControl(ListaCntrs[CntrCorrente].ID);

                        PrintCntrDisabled = false;
                    }
                    else
                    {
                        FirstCntrDisabled = true;
                        PrevCntrDisabled = true;
                        NextCntrDisabled = true;
                        LastCntrDisabled = true;

                        IndexControlli = " - ";

                        PrintCntrDisabled = true;
                    }

                    AddCntrDisabled = false;

                    LoadOrtoctis(ListaVisite[VisitaCorrente].ID);

                    LoadPrescrizioni(ListaVisite[VisitaCorrente].ID);

                    LoadRelazione(ListaVisite[VisitaCorrente].ID);
                }
                else
                {
                    FirstVisitDisabled = true;
                    PrevVisitDisabled = true;
                    NextVisitDisabled = true;
                    LastVisitDisabled = true;

                    SaveVisitDisabled = true;

                    POcchialiDisabled = true;
                    ControlliDisabled = true;
                    OrtotticaDisabled = true;
                    PrescrizioniDisabled = true;
                    RelazioniDisabled = true;

                    IndexVisita = " - ";
                }

                StateHasChanged();
            }
        }
    }

    #region Pazienti
    public async void LoadPatient()
    {
        Paziente = await PatientMngService.GetPatient(id);

        FName = Paziente.FName;
        LName = Paziente.LName;

        Cod = SetObjNullToStr(Paziente.Cod);

        CodFisc = SetObjNullToStr(Paziente.CodFisc);
        BirthDate = SetObjNullToStr(Paziente.BirthDate);
        BirthCity = SetObjNullToStr(Paziente.BirthCity);
        Gender = SetObjNullToStr(Paziente.Gender);

        Address = SetObjNullToStr(Paziente.Address);
        City = SetObjNullToStr(Paziente.City);
        ZipCode = SetObjNullToStr(Paziente.ZipCode);
        State = SetObjNullToStr(Paziente.State);

        Phone = SetObjNullToStr(Paziente.Phone);
        Mobile = SetObjNullToStr(Paziente.Mobile);
        Email = SetObjNullToStr(Paziente.Email);

        Note = SetObjNullToStr(Paziente.Note);

        fPrivacy = Paziente.fPrivacy;

        Studio = SetObjNullToStr(Paziente.Studio);

        if (fPrivacy)
        {
            switchPrivacy = "Firmata";
        }
    }

    // async
    public void CheckPatient()
    {
        Boolean result = true;

        PazienteValido = true;

        DialogHeader = "";
        DialogIcon = "";
        DialogText = "";
        DialogDetail = "";

        // controllo nome e cognome ed esistenza stesso nominativo in archivio
        if (String.IsNullOrEmpty(FName) || String.IsNullOrEmpty(LName))
        {
            if (String.IsNullOrEmpty(FName) && String.IsNullOrEmpty(LName))
            {
                result &= false;
                PazienteValido &= false;

                DialogHeader = " Attenzione ";
                DialogIcon = "e-icons e-circle-close col-lg-2";
                DialogText = "Nome e Cognome sono obbligatori";
                DialogDetail = "Inserire Nome e Cognome.";
            }
            else
            {
                if (String.IsNullOrEmpty(LName))
                {
                    result &= false;
                    PazienteValido &= false;

                    DialogHeader = " Attenzione ";
                    DialogIcon = "e-icons e-circle-close col-lg-2";
                    DialogText = "Il Cognome è obbligatorio";
                    DialogDetail = "Inserire il Cognome.";
                }

                if (String.IsNullOrEmpty(FName))
                {
                    result &= false;
                    PazienteValido &= false;

                    DialogHeader = " Attenzione ";
                    DialogIcon = "e-icons e-circle-close col-lg-2";
                    DialogText = "Il Nome è obbligatorio";
                    DialogDetail += "Inserire il Nome.";
                }
            }
        }
        else
        {
            if (Pazienti.Count > 0)     //  sono presenti casi di omonimia
            {
                if (id == 0)
                {
                    if (String.IsNullOrEmpty(CodFisc))
                    {
                        result &= false;
                        PazienteValido &= false;

                        DialogHeader = " Attenzione ";
                        DialogIcon = "e-icons e-circle-close col-lg-2";
                        DialogText += "Sono presenti in archivio altri pazienti con lo stesso Nome e Cognome.";
                        DialogDetail = "Inserire il Codice Fiscale";
                    }
                    else
                    {
                        for (var pp = 0; pp < Pazienti.Count; pp++)
                        {
                            if ((Pazienti[pp].CodFisc == CodFisc) && (Pazienti[pp].IdPatient != id))
                            {
                                result &= false;
                            }
                        }

                        if (!result)
                        {
                            PazienteValido &= false;

                            DialogHeader = " Attenzione ";
                            DialogIcon = "e-icons e-circle-close col-lg-2";
                            DialogText += "Sono presenti in archivio altri pazienti con lo stesso Nome, Cognome e Codice Fiscale.";
                            DialogDetail = "Modificare il Nome o il Cognome o il Codice Fiscale";
                        }
                    }
                }
                else
                {
                    for (var pp = 0; pp < Pazienti.Count; pp++)
                    {
                        if ((Pazienti[pp].CodFisc == CodFisc) && (Pazienti[pp].IdPatient != id))
                        {
                            result &= false;
                        }
                    }

                    if (!result)
                    {
                        PazienteValido &= false;

                        DialogHeader = " Attenzione ";
                        DialogIcon = "e-icons e-circle-close col-lg-2";
                        DialogText += "Sono presenti in archivio altri pazienti con lo stesso Nome, Cognome e Codice Fiscale.";
                        DialogDetail = "Modificare il Nome o il Cognome o il Codice Fiscale";
                    }
                }
            }
        }

        if (result)
        {
            if (String.IsNullOrEmpty(Phone) && String.IsNullOrEmpty(Mobile))
            {
                PazienteValido &= false;

                DialogHeader = " Attenzione ";
                DialogIcon = "e-icons e-circle-close col-lg-2";
                DialogText = "Inserire recapito telefonico mancante";
                DialogDetail = "Inserire almeno un recapito telefonico tra numero di telefono e mobile.";
            }
        }

        Console.WriteLine($"------------------------------------------------");
        Console.WriteLine($"-          Controllo dati paziente             -");
        Console.WriteLine($"------------------------------------------------");
        Console.WriteLine($"📌 FName: {FName}, String.IsNullOrEmpty(FName): {String.IsNullOrEmpty(FName)}");
        Console.WriteLine($"LName: {LName}, String.IsNullOrEmpty(LName): {String.IsNullOrEmpty(LName)}");
        Console.WriteLine($"CodFisc: {CodFisc}, String.IsNullOrEmpty(CodFisc): {String.IsNullOrEmpty(CodFisc)}");
        Console.WriteLine($" ");
        Console.WriteLine($"Pazienti.Count: {Pazienti.Count}");
        Console.WriteLine($" ");
        Console.WriteLine($"Phone: {Phone}, String.IsNullOrEmpty(Phone): {String.IsNullOrEmpty(Phone)}");
        Console.WriteLine($"Mobile: {Mobile}, String.IsNullOrEmpty(Mobile): {String.IsNullOrEmpty(Mobile)}");
        Console.WriteLine($"------------------------------------------------");

        Console.WriteLine($" ");

        Console.WriteLine($"------------------------------------------------");
        Console.WriteLine($"result: {result}");
        Console.WriteLine($"PazienteValido: {PazienteValido}");
        Console.WriteLine($"DialogHeader: {DialogHeader}");
        Console.WriteLine($"DialogIcon: {DialogIcon}");
        Console.WriteLine($"DialogDetail: {DialogDetail}");
        Console.WriteLine($"------------------------------------------------");

        Console.WriteLine($" ");

        StateHasChanged();
    }

    public async void SavePatient()
    {
        string TmpDate;
        Boolean ContinueIns = true;

        if (!String.IsNullOrEmpty(FName) && !String.IsNullOrEmpty(LName))
        {
            Pazienti = await PatientService.PatList(FName + "|" + LName + "|||");

            Console.WriteLine($"------------------------------------------------");
            Console.WriteLine($"Pazienti.Count: {Pazienti.Count}");
            Console.WriteLine($"------------------------------------------------");
            Console.WriteLine($" ");
        }

        CheckPatient();

        if (!PazienteValido)
        {
            DialogVisible = true;
        }
        else
        {
            Paziente.Cod = Cod;

            Paziente.FName = FName.Trim();
            Paziente.LName = LName.Trim();

            Paziente.CodFisc = CodFisc;

            if (BirthDate != "")
            {
                if (CheckDate(BirthDate))
                {
                    TmpDate = BirthDate.Substring(4, 4) + "-" + BirthDate.Substring(2, 2) + "-" + BirthDate.Substring(0, 2) + " 00:00:00,000";

                    Paziente.BirthDate = DateTime.ParseExact(TmpDate, "yyyy-MM-dd HH:mm:ss,fff", System.Globalization.CultureInfo.InvariantCulture);
                }
                else
                {
                    ContinueIns = false;
                }
            }

            if (ContinueIns)
            {
                Paziente.BirthCity = BirthCity;
                Paziente.Gender = Gender;

                Paziente.Address = Address;
                Paziente.City = City;
                Paziente.ZipCode = ZipCode;
                Paziente.State = State;

                Paziente.Phone = Phone;
                Paziente.Mobile = Mobile;
                Paziente.Email = Email;

                Paziente.Note = Note;

                Paziente.fPrivacy = fPrivacy;

                Paziente.Studio = Studio;

                if (id == 0)
                {
                    Paziente.ptIdUser = Decimal.Parse(gIdUser);

                    Paziente.InsertDate = DateTime.Now;

                    await PatientMngService.AddPatient(Paziente);
                }
                else
                {
                    await PatientMngService.UpdPatient(id, Paziente);
                }

                Navigation.NavigateTo("/patientlist/" + id.ToString());
            }
        }

        StateHasChanged();
    }
    #endregion

    #region Visite
    public async void LoadVisit(decimal idv)
    {
        Visita = await VisitService.GetVisit(idv);

        Visita.Operatore = SetObjNullToStr(Visita.Operatore);

        Visita.DiagnosiOD = SetObjNullToStr(Visita.DiagnosiOD);
        Visita.DiagnosiOS = SetObjNullToStr(Visita.DiagnosiOS);

        Visita.Anamnesi = SetObjNullToStr(Visita.Anamnesi);

        Visita.Annessi_Od = SetObjNullToStr(Visita.Annessi_Od);
        Visita.Annessi_Os = SetObjNullToStr(Visita.Annessi_Os);

        Visita.Seg_Ant_Od = SetObjNullToStr(Visita.Seg_Ant_Od);
        Visita.Seg_Ant_Os = SetObjNullToStr(Visita.Seg_Ant_Os);

        Visita.Fundus_Od = SetObjNullToStr(Visita.Fundus_Od);
        Visita.Fundus_Os = SetObjNullToStr(Visita.Fundus_Os);

        Visita.Visus_Od = SetObjNullToStr(Visita.Visus_Od);
        Visita.Visus_Os = SetObjNullToStr(Visita.Visus_Os);

        Visita.Terapia = SetObjNullToStr(Visita.Terapia);

        Visita.ODPL = SetObjNullToStr(Visita.ODPL);
        Visita.ODPV = SetObjNullToStr(Visita.ODPV);
        Visita.ODMD = SetObjNullToStr(Visita.ODMD);

        Visita.OSPL = SetObjNullToStr(Visita.OSPL);
        Visita.OSPV = SetObjNullToStr(Visita.OSPV);
        Visita.OSMD = SetObjNullToStr(Visita.OSMD);

        Visita.Interventi = SetObjNullToStr(Visita.Interventi);

        Visita.CurvaTono_Od = SetObjNullToStr(Visita.CurvaTono_Od);
        Visita.CurvaTono_Os = SetObjNullToStr(Visita.CurvaTono_Os);

        Visita.CurvaArgon = SetObjNullToStr(Visita.CurvaArgon);

        Visita.VOrtotticaOD = SetObjNullToStr(Visita.VOrtotticaOD);
        Visita.VOrtotticaOS = SetObjNullToStr(Visita.VOrtotticaOS);

        Visita.SHIRMER_Od = SetObjNullToStr(Visita.SHIRMER_Od);
        Visita.SHIRMER_Os = SetObjNullToStr(Visita.SHIRMER_Os);

        Visita.TONO_Od = SetObjNullToStr(Visita.TONO_Od);
        Visita.TONO_Os = SetObjNullToStr(Visita.TONO_Os);

        Visita.Lavaggio_Od = SetObjNullToStr(Visita.Lavaggio_Od);
        Visita.Lavaggio_Os = SetObjNullToStr(Visita.Lavaggio_Os);

        Visita.Biometria = SetObjNullToStr(Visita.Biometria);

        Visita.FAG_Od = SetObjNullToStr(Visita.FAG_Od);
        Visita.FAG_Os = SetObjNullToStr(Visita.FAG_Os);

        Visita.Topografia_Od = SetObjNullToStr(Visita.Topografia_Od);
        Visita.Topografia_Os = SetObjNullToStr(Visita.Topografia_Os);

        Visita.IV = SetObjNullToStr(Visita.IV);

        Visita.OCT_Od = SetObjNullToStr(Visita.OCT_Od);
        Visita.OCT_Os = SetObjNullToStr(Visita.OCT_Os);

        Visita.RNFL_Od = SetObjNullToStr(Visita.RNFL_Od);
        Visita.RNFL_Os = SetObjNullToStr(Visita.RNFL_Os);

        Visita.CV_Od = SetObjNullToStr(Visita.CV_Od);
        Visita.CV_Os = SetObjNullToStr(Visita.CV_Os);

        Visita.PACH_Od = SetObjNullToStr(Visita.PACH_Od);
        Visita.PACH_Os = SetObjNullToStr(Visita.PACH_Os);

        Visita.CD_Od = SetObjNullToStr(Visita.CD_Od);
        Visita.CD_Os = SetObjNullToStr(Visita.CD_Os);

        Visita.Auto = SetObjNullToStr(Visita.Auto);

        Visita.MotivoVisita = SetObjNullToStr(Visita.MotivoVisita);

        Visita.Conclusioni = SetObjNullToStr(Visita.Conclusioni);

        Visita.Note = SetObjNullToStr(Visita.Note);

        StateHasChanged();
    }

    public async void CloneVisit(decimal idv)
    {
        Visit TmpVisita = new Visit();

        TmpVisita = await VisitService.GetVisit(idv);

        Visita.Operatore = "";

        Visita.DiagnosiOD = SetObjNullToStr(TmpVisita.DiagnosiOD);
        Visita.DiagnosiOS = SetObjNullToStr(TmpVisita.DiagnosiOS);

        Visita.Anamnesi = SetObjNullToStr(TmpVisita.Anamnesi);

        Visita.Annessi_Od = SetObjNullToStr(TmpVisita.Annessi_Od);
        Visita.Annessi_Os = SetObjNullToStr(TmpVisita.Annessi_Os);

        Visita.Seg_Ant_Od = SetObjNullToStr(TmpVisita.Seg_Ant_Od);
        Visita.Seg_Ant_Os = SetObjNullToStr(TmpVisita.Seg_Ant_Os);

        Visita.Fundus_Od = SetObjNullToStr(TmpVisita.Fundus_Od);
        Visita.Fundus_Os = SetObjNullToStr(TmpVisita.Fundus_Os);

        Visita.Visus_Od = SetObjNullToStr(TmpVisita.Visus_Od);
        Visita.Visus_Os = SetObjNullToStr(TmpVisita.Visus_Os);

        Visita.Terapia = SetObjNullToStr(TmpVisita.Terapia);

        Visita.ODPL = SetObjNullToStr(TmpVisita.ODPL);
        Visita.ODPV = SetObjNullToStr(TmpVisita.ODPV);
        Visita.ODMD = SetObjNullToStr(TmpVisita.ODMD);

        Visita.OSPL = SetObjNullToStr(TmpVisita.OSPL);
        Visita.OSPV = SetObjNullToStr(TmpVisita.OSPV);
        Visita.OSMD = SetObjNullToStr(TmpVisita.OSMD);

        Visita.Interventi = SetObjNullToStr(TmpVisita.Interventi);

        Visita.CurvaTono_Od = SetObjNullToStr(TmpVisita.CurvaTono_Od);
        Visita.CurvaTono_Os = SetObjNullToStr(TmpVisita.CurvaTono_Os);

        Visita.CurvaArgon = SetObjNullToStr(TmpVisita.CurvaArgon);

        Visita.VOrtotticaOD = SetObjNullToStr(TmpVisita.VOrtotticaOD);
        Visita.VOrtotticaOS = SetObjNullToStr(TmpVisita.VOrtotticaOS);

        Visita.SHIRMER_Od = SetObjNullToStr(TmpVisita.SHIRMER_Od);
        Visita.SHIRMER_Os = SetObjNullToStr(TmpVisita.SHIRMER_Os);

        Visita.TONO_Od = SetObjNullToStr(TmpVisita.TONO_Od);
        Visita.TONO_Os = SetObjNullToStr(TmpVisita.TONO_Os);

        Visita.Lavaggio_Od = SetObjNullToStr(TmpVisita.Lavaggio_Od);
        Visita.Lavaggio_Os = SetObjNullToStr(TmpVisita.Lavaggio_Os);

        Visita.Biometria = SetObjNullToStr(TmpVisita.Biometria);

        Visita.FAG_Od = SetObjNullToStr(TmpVisita.FAG_Od);
        Visita.FAG_Os = SetObjNullToStr(TmpVisita.FAG_Os);

        Visita.Topografia_Od = SetObjNullToStr(TmpVisita.Topografia_Od);
        Visita.Topografia_Os = SetObjNullToStr(TmpVisita.Topografia_Os);

        Visita.IV = SetObjNullToStr(TmpVisita.IV);

        Visita.OCT_Od = SetObjNullToStr(TmpVisita.OCT_Od);
        Visita.OCT_Os = SetObjNullToStr(TmpVisita.OCT_Os);

        Visita.RNFL_Od = SetObjNullToStr(TmpVisita.RNFL_Od);
        Visita.RNFL_Os = SetObjNullToStr(TmpVisita.RNFL_Os);

        Visita.CV_Od = SetObjNullToStr(TmpVisita.CV_Od);
        Visita.CV_Os = SetObjNullToStr(TmpVisita.CV_Os);

        Visita.PACH_Od = SetObjNullToStr(TmpVisita.PACH_Od);
        Visita.PACH_Os = SetObjNullToStr(TmpVisita.PACH_Os);

        Visita.CD_Od = SetObjNullToStr(TmpVisita.CD_Od);
        Visita.CD_Os = SetObjNullToStr(TmpVisita.CD_Os);

        Visita.Auto = SetObjNullToStr(TmpVisita.Auto);

        Visita.MotivoVisita = SetObjNullToStr(TmpVisita.MotivoVisita);

        Visita.Conclusioni = SetObjNullToStr(TmpVisita.Conclusioni);

        Visita.Note = SetObjNullToStr(TmpVisita.Note);

        StateHasChanged();
    }

    public async void GoToVisit(int p)
    {
        await Task.Delay(10);

        switch (p)
        {
            case 0:
                VisitaCorrente = 0;

                IndexVisita = (VisitaCorrente + 1).ToString() + " di " + ListaVisite.Count.ToString();

                FirstVisitDisabled = true;
                PrevVisitDisabled = true;

                NextVisitDisabled = false;
                LastVisitDisabled = false;
                break;

            case 1:
                if (VisitaCorrente > 0)
                {
                    VisitaCorrente -= 1;

                    NextVisitDisabled = false;
                    LastVisitDisabled = false;

                    if (VisitaCorrente == 0)
                    {
                        FirstVisitDisabled = true;
                        PrevVisitDisabled = true;
                    }

                    IndexVisita = (VisitaCorrente + 1).ToString() + " di " + ListaVisite.Count.ToString();
                }
                break;

            case 2:
                if (VisitaCorrente < ListaVisite.Count - 1)
                {
                    VisitaCorrente += 1;

                    FirstVisitDisabled = false;
                    PrevVisitDisabled = false;

                    if (VisitaCorrente == ListaVisite.Count - 1)
                    {
                        NextVisitDisabled = true;
                        LastVisitDisabled = true;
                    }

                    IndexVisita = (VisitaCorrente + 1).ToString() + " di " + ListaVisite.Count.ToString();
                }
                break;

            case 3:
                VisitaCorrente = ListaVisite.Count - 1;

                IndexVisita = (VisitaCorrente + 1).ToString() + " di " + ListaVisite.Count.ToString();

                FirstVisitDisabled = false;
                PrevVisitDisabled = false;

                NextVisitDisabled = true;
                LastVisitDisabled = true;
                break;
        }

        DataVisita = ListaVisite[VisitaCorrente].Val.ToString("dd/MM/yyyy");

        LoadVisit(ListaVisite[VisitaCorrente].ID);

        AddVisitDisabled = false;

        LoadVisus(ListaVisite[VisitaCorrente].ID);

        LoadOrtoctis(ListaVisite[VisitaCorrente].ID);

        LoadPrescrizioni(ListaVisite[VisitaCorrente].ID);

        LoadRelazione(ListaVisite[VisitaCorrente].ID);

        // load date e id storico controlli e dati ultimo controllo
        DataControllo = "";
        Controllo = new Controlli();
        CntrCorrente = -1;

        ListaCntrs.Clear();

        ListaCntrs = await ListControlliService.ListControlliByVisit(ListaVisite[VisitaCorrente].ID);

        if (ListaCntrs.Count > 0)
        {
            if (ListaCntrs.Count == 1)
            {
                FirstCntrDisabled = true;
                PrevCntrDisabled = true;
                NextCntrDisabled = true;
                LastCntrDisabled = true;
            }
            else
            {
                FirstCntrDisabled = true;
                PrevCntrDisabled = true;
                NextCntrDisabled = false;
                LastCntrDisabled = false;
            }

            CntrCorrente = 0;

            IndexControlli = (CntrCorrente + 1).ToString() + " di " + ListaCntrs.Count.ToString();

            DataControllo = ListaCntrs[CntrCorrente].ValDat.ToString();

            LoadControl(ListaCntrs[CntrCorrente].ID);

            SaveCntrDisabled = false;

            PrintCntrDisabled = false;
        }
        else
        {
            FirstCntrDisabled = true;
            PrevCntrDisabled = true;
            NextCntrDisabled = true;
            LastCntrDisabled = true;

            IndexControlli = " - ";

            SaveCntrDisabled = true;

            PrintCntrDisabled = true;
        }

        AddCntrDisabled = false;

        StateHasChanged();
    }

    public async void NewVisit()
    {
        await Task.Run(() =>
        {
            // parte visite
            IsNewVisit = true;

            Visita = new Visit();

            if (VisitaCorrente != -1)   // clona l'ultima visita
            {
                CloneVisit(ListaVisite[0].ID);
            }

            Visita.ptIdPatient = id;
            Visita.ptIdUser = Decimal.Parse(gIdUser);
            Visita.InsertDate = DateTime.Now;
            Visita.DataVisita = DateTime.Now;

            DataVisita = Visita.DataVisita.ToString("dd/MM/yyyy");

            AddVisitDisabled = true;
            SaveVisitDisabled = false;

            POcchialiDisabled = true;
            ControlliDisabled = true;
            OrtotticaDisabled = true;
            PrescrizioniDisabled = true;
            RelazioniDisabled = true;

            // // parte visus
            // NewVisus();
            // Visus.DataMisura = Visita.DataVisita;

            // parte controlli
            Controllo = new Controlli();

            IsNewCntr = false;
            DataControllo = "";

            AddCntrDisabled = false;
            SaveCntrDisabled = true;

            // // parte ortottica
            // NewOrtoctis();
            // Ortoctis.DataOrtottica = Visita.DataVisita;

            StateHasChanged();
        });
    }

    public async void SaveVisit()
    {
        String TmpDate = "";
        bool ContinueOp = true;
        String FailReason = "";

        if (IsNewVisit)
        {
            if (CheckDate(DataVisita))
            {
                TmpDate = DataVisita.Substring(4, 4) + "-" + DataVisita.Substring(2, 2) + "-" + DataVisita.Substring(0, 2) + " 00:00:00,000";

                Visita.DataVisita = DateTime.ParseExact(TmpDate, "yyyy-MM-dd HH:mm:ss,fff", System.Globalization.CultureInfo.InvariantCulture);

                if ((Visita.Operatore == "") || (Visita.Operatore == null))
                {
                    FailReason = "operatore";
                    Console.WriteLine($"Inserimento Visita");
                    Console.WriteLine($"Errore controllo operatore mancante");

                    ContinueOp = false;
                }
            }
            else
            {
                FailReason = "data visita";
                Console.WriteLine($"Inserimento Visita");
                Console.WriteLine($"Errore controllo data visita");

                ContinueOp = false;
            }

            if (ContinueOp)
            {
                await VisitService.AddVisit(Visita);

                Console.WriteLine($"Inserimento Visita");

                // visit entry completed
                IsNewVisit = false;
            }
        }
        else
        {
            if (CheckDate(DataVisita))
            {
                TmpDate = DataVisita.Substring(4, 4) + "-" + DataVisita.Substring(2, 2) + "-" + DataVisita.Substring(0, 2) + " 00:00:00,000";

                Visita.DataVisita = DateTime.ParseExact(TmpDate, "yyyy-MM-dd HH:mm:ss,fff", System.Globalization.CultureInfo.InvariantCulture);

                if ((Visita.Operatore == "") || (Visita.Operatore == null))
                {
                    FailReason = "operatore";
                    Console.WriteLine($"Inserimento Visita");
                    Console.WriteLine($"Errore controllo operatore mancante");

                    ContinueOp = false;
                }
            }
            else
            {
                FailReason = "data visita";
                Console.WriteLine($"Aggiornamento Visita");
                Console.WriteLine($"Errore controllo data visita");

                ContinueOp = false;
            }

            if (ContinueOp)
            {
                Console.WriteLine($"Aggiornamento Visita");

                await VisitService.UpdVisit(Visita.IdVisit, Visita);
            }
        }

        // load date e id storico visite e dati ultima visita
        ListaVisite.Clear();

        ListaVisite = await ListVisitsService.ListPatientsVisits(id);

        if (ListaVisite.Count > 0)
        {
            PrintVisitDisabled = false;

            if (ListaVisite.Count == 1)
            {
                FirstVisitDisabled = true;
                PrevVisitDisabled = true;
                NextVisitDisabled = true;
                LastVisitDisabled = true;
            }
            else
            {
                FirstVisitDisabled = true;
                PrevVisitDisabled = true;
                NextVisitDisabled = false;
                LastVisitDisabled = false;
            }

            POcchialiDisabled = false;
            ControlliDisabled = false;
            OrtotticaDisabled = false;
            PrescrizioniDisabled = false;
            RelazioniDisabled = false;

            VisitaCorrente = 0;

            IndexVisita = (VisitaCorrente + 1).ToString() + " di " + ListaVisite.Count.ToString();

            DataVisita = ListaVisite[0].Val.ToString("dd/MM/yyyy");

            LoadVisit(ListaVisite[VisitaCorrente].ID);

            LoadVisus(ListaVisite[VisitaCorrente].ID);

            LoadOrtoctis(ListaVisite[VisitaCorrente].ID);

            LoadPrescrizioni(ListaVisite[VisitaCorrente].ID);

            LoadRelazione(ListaVisite[VisitaCorrente].ID);
        }

        AddVisitDisabled = false;
        // SaveVisitDisabled = true;

        await Task.Run(() =>
        {
            if (ContinueOp)
            {
                DialogHeader = " Informazioni ";
                DialogIcon = "e-icons e-circle-info col-lg-2";
                DialogText = "Dati Visita salvati";
                DialogDetail = "";
            }
            else
            {
                if (FailReason == "operatore")
                {
                    DialogHeader = " Attenzione ";
                    DialogIcon = "e-icons e-circle-close icon-red col-lg-2";
                    DialogText = "Dati Visita NON salvati";
                    DialogDetail = "Operatore mancante";
                }
                else
                {
                    DialogHeader = " Attenzione ";
                    DialogIcon = "e-icons e-circle-close icon-red col-lg-2";
                    DialogText = "Dati Visita NON salvati";
                    DialogDetail = "Data errata";
                }
            }

            DialogVisible = true;
        });

        StateHasChanged();
    }
    #endregion

    #region Prescrizione Occhiali
    public async void LoadVisus(decimal idv)
    {
        Console.WriteLine($"VisitaCorrente: {VisitaCorrente}");
        Console.WriteLine($"ListaVisite[VisitaCorrente].ID: {ListaVisite[VisitaCorrente].ID}");
        Console.WriteLine($"idv: {idv}");

        pDataOcchiali = DateTime.Now.ToString("dd/MM/yyyy");

        Visus = new Misure();

        Visus = await VisusService.GetVisus(idv);

        if (Visus.IdMisura != 0)
        {
            Visus.ODD_Sf = SetObjNullToStr(Visus.ODD_Sf);       // Occhio Destro Distanza

            Visus.ODD_Cil = SetObjNullToStr(Visus.ODD_Cil);

            Visus.ODD_Asse = SetObjNullToStr(Visus.ODD_Asse);

            Visus.OSD_Sf = SetObjNullToStr(Visus.OSD_Sf);       // Occhio Sinistro Distanza

            Visus.OSD_Cil = SetObjNullToStr(Visus.OSD_Cil);

            Visus.OSD_Asse = SetObjNullToStr(Visus.OSD_Asse);


            Visus.ODP_Sf = SetObjNullToStr(Visus.ODP_Sf);       // Occhio Destro Permanenza

            Visus.ODP_Cil = SetObjNullToStr(Visus.ODP_Cil);

            Visus.ODP_Asse = SetObjNullToStr(Visus.ODP_Asse);

            Visus.OSP_Sf = SetObjNullToStr(Visus.OSP_Sf);       // Occhio Sinistro Permanenza

            Visus.OSP_Cil = SetObjNullToStr(Visus.OSP_Cil);

            Visus.OSP_Asse = SetObjNullToStr(Visus.OSP_Asse);


            Visus.ODL_Sf = SetObjNullToStr(Visus.ODL_Sf);       // Occhio Destro Lettura

            Visus.ODL_Cil = SetObjNullToStr(Visus.ODL_Cil);

            Visus.ODL_Asse = SetObjNullToStr(Visus.ODL_Asse);

            Visus.OSL_Sf = SetObjNullToStr(Visus.OSL_Sf);       // Occhio Sinistro Lettura

            Visus.OSL_Cil = SetObjNullToStr(Visus.OSL_Cil);

            Visus.OSL_Asse = SetObjNullToStr(Visus.OSL_Asse);


            fTabo = Visus.Tabo;

            if (fTabo)
            {
                switchTabo = "TABO: Si";
            }

            fInter = Visus.Inter;

            if (fInter)
            {
                switchInter = "INTERNAZIONALE: Si";
            }

            Visus.DI = SetObjNullToStr(Visus.DI);

            Visus.Note = SetObjNullToStr(Visus.Note);

            IsNewVisus = false;

            pDataOcchiali = Visus.PrintDate.ToShortDateString();

            PrintVisusDisabled = false;

            Console.WriteLine($"Load Visus");
            Console.WriteLine($"ListaVisite[VisitaCorrente].ID: {ListaVisite[VisitaCorrente].ID}");
            Console.WriteLine($"Visus.IdMisura: {Visus.IdMisura}");
            Console.WriteLine($"Visus.ptIdVisit: {Visus.ptIdVisit}");
            Console.WriteLine($"Visus.DataMisura: {Visus.DataMisura}");
            Console.WriteLine($"Visus.PrintDate: {Visus.PrintDate}");
        }
        else
        {
            IsNewVisus = true;

            DataMisura = DataVisita;

            SaveVisusDisabled = false;

            PrintVisusDisabled = true;

            Console.WriteLine($"Carica Visus");
            Console.WriteLine($"ListaVisite[VisitaCorrente].ID: {ListaVisite[VisitaCorrente].ID}");
            Console.WriteLine($"Visus.IdMisura: {Visus.IdMisura}");
            Console.WriteLine($"Visus.ptIdVisit: {Visus.ptIdVisit}");
            Console.WriteLine($"Visus.DataMisura: {Visus.DataMisura}");
            Console.WriteLine($"Visus.PrintDate: {Visus.PrintDate}");
        }

        StateHasChanged();
    }

    // public async void NewVisus()
    // {
    //     await Task.Run(() =>
    //     {
    //         IsNewVisus = true;

    //         Visus = new Misure();

    //         Visus.ptIdUser = Decimal.Parse(gIdUser);
    //         Visus.ptIdPatient = id;
    //         Visus.InsertDate = DateTime.Now;
    //         Visus.DataMisura = DateTime.Now;

    //         DataMisura = DateTime.Now.ToString("dd/MM/yyyy");

    //         pDataOcchiali = DateTime.Now.ToString("dd/MM/yyyy");

    //         SaveVisusDisabled = false;

    //         StateHasChanged();
    //     });
    // }

    public async void SaveVisus()
    {
        string TmpDate;
        bool ContinueOp = true;

        Visus.Tabo = fTabo;
        Visus.Inter = fInter;

        if (IsNewVisus)
        {
            Visus.ptIdUser = Decimal.Parse(gIdUser);
            Visus.ptIdPatient = id;
            Visus.ptIdVisit = ListaVisite[VisitaCorrente].ID;
            Visus.InsertDate = DateTime.Now;
            Visus.DataMisura = Visita.DataVisita;

            if (CheckDate(pDataOcchiali))
            {
                TmpDate = pDataOcchiali.Substring(4, 4) + "-" + pDataOcchiali.Substring(2, 2) + "-" + pDataOcchiali.Substring(0, 2) + " 00:00:00,000";

                Visus.PrintDate = DateTime.ParseExact(TmpDate, "yyyy-MM-dd HH:mm:ss,fff", System.Globalization.CultureInfo.InvariantCulture);
            }
            else
            {
                Console.WriteLine($"Inserimento Visus");
                Console.WriteLine($"Errore controllo data di stampa per occhiali");

                ContinueOp = false;
            }

            if (ContinueOp)
            {
                Console.WriteLine($"Inserimento Visus");
                Console.WriteLine($"ListaVisite[VisitaCorrente].ID: {ListaVisite[VisitaCorrente].ID}, Visita.DataVisita: {Visita.DataVisita}");

                await VisusService.AddVisus(Visus);

                // visit entry completed
                IsNewVisus = false;

                PrintVisusDisabled = false;
            }
        }
        else
        {
            if (CheckDate(pDataOcchiali))
            {
                TmpDate = pDataOcchiali.Substring(4, 4) + "-" + pDataOcchiali.Substring(2, 2) + "-" + pDataOcchiali.Substring(0, 2) + " 00:00:00,000";

                Visus.PrintDate = DateTime.ParseExact(TmpDate, "yyyy-MM-dd HH:mm:ss,fff", System.Globalization.CultureInfo.InvariantCulture);
            }
            else
            {
                Console.WriteLine($"Aggiornamento Visus");
                Console.WriteLine($"Errore controllo data di stampa per occhiali");

                ContinueOp = false;
            }

            if (ContinueOp)
            {
                Console.WriteLine($"Aggiornamento Visus");
                Console.WriteLine($"Visus.IdMisura: {Visus.IdMisura}");

                await VisusService.UpdVisus(Visus.IdMisura, Visus);
            }
        }

        await Task.Run(() =>
        {
            DialogHeader = " Informazioni ";
            DialogIcon = "e-icons e-circle-info col-lg-2";
            DialogText = "Dati Prescrizione occhiali salvati";
            DialogDetail = "";
            DialogVisible = true;
        });

        StateHasChanged();
    }
    #endregion

    #region Controlli
    public async void LoadControl(decimal idc)
    {
        Controllo = await ControlliService.GetControllo(idc);

        Controllo.Valutazione = SetObjNullToStr(Controllo.Valutazione);

        StateHasChanged();
    }

    public async void GoToControl(int p)
    {
        await Task.Delay(10);

        switch (p)
        {
            case 0:                         // primo controllo
                CntrCorrente = 0;

                FirstCntrDisabled = true;
                PrevCntrDisabled = true;

                NextCntrDisabled = false;
                LastCntrDisabled = false;
                break;

            case 1:                         // controllo precedente
                if (CntrCorrente > 0)
                {
                    CntrCorrente -= 1;

                    NextCntrDisabled = false;
                    LastCntrDisabled = false;

                    if (CntrCorrente == 0)
                    {
                        FirstCntrDisabled = true;
                        PrevCntrDisabled = true;
                    }
                }
                break;

            case 2:                         // controllo successivo
                if (CntrCorrente < ListaCntrs.Count - 1)
                {
                    CntrCorrente += 1;

                    FirstCntrDisabled = false;
                    PrevCntrDisabled = false;

                    if (CntrCorrente == ListaCntrs.Count - 1)
                    {
                        NextCntrDisabled = true;
                        LastCntrDisabled = true;
                    }
                }
                break;

            case 3:                         // ultimo controllo
                CntrCorrente = ListaCntrs.Count - 1;

                FirstCntrDisabled = false;
                PrevCntrDisabled = false;

                NextCntrDisabled = true;
                LastCntrDisabled = true;
                break;
        }

        DataControllo = ListaCntrs[CntrCorrente].ValDat.ToString("dd/MM/yyyy");

        LoadControl(ListaCntrs[CntrCorrente].ID);

        StateHasChanged();
    }

    public async void NewControl()
    {
        await Task.Run(() =>
        {
            // parte controlli
            IsNewCntr = true;

            Controllo = new Controlli();

            Controllo.ptIdUser = Decimal.Parse(gIdUser);
            Controllo.InsertDate = DateTime.Now;
            Controllo.ptIdVisit = ListaVisite[VisitaCorrente].ID;
            Controllo.DataControllo = DateTime.Now;

            DataControllo = Controllo.DataControllo.ToString("dd/MM/yyyy");

            AddCntrDisabled = true;
            SaveCntrDisabled = false;

            StateHasChanged();
        });
    }

    public async void SaveControl()
    {
        if (IsNewCntr)
        {
            await ControlliService.AddControllo(Controllo);

            // control entry completed
            IsNewCntr = false;
        }
        else
        {
            await ControlliService.UpdControllo(Controllo.IdControllo, Controllo);
        }

        // load date e id storico controlli e dati ultimo controllo
        ListaCntrs.Clear();

        ListaCntrs = await ListControlliService.ListControlliByVisit(Visita.IdVisit);

        if (ListaCntrs.Count > 0)
        {
            if (ListaCntrs.Count == 1)
            {
                FirstCntrDisabled = true;
                PrevCntrDisabled = true;
                NextCntrDisabled = true;
                LastCntrDisabled = true;
            }
            else
            {
                FirstCntrDisabled = true;
                PrevCntrDisabled = true;
                NextCntrDisabled = false;
                LastCntrDisabled = false;
            }

            CntrCorrente = 0;

            IndexControlli = (CntrCorrente + 1).ToString() + " di " + ListaCntrs.Count.ToString();

            DataControllo = ListaCntrs[0].ValDat.ToString("dd/MM/yyyy");

            LoadControl(ListaCntrs[CntrCorrente].ID);

            PrintCntrDisabled = false;
        }
        else
        {
            FirstCntrDisabled = true;
            PrevCntrDisabled = true;
            NextCntrDisabled = true;
            LastCntrDisabled = true;

            IndexControlli = " - ";

            PrintCntrDisabled = true;
        }

        AddCntrDisabled = false;
        // SaveCntrDisabled = true;

        await Task.Run(() =>
        {
            DialogHeader = " Informazioni ";
            DialogIcon = "e-icons e-circle-info col-lg-2";
            DialogText = "Dati Controllo salvati";
            DialogDetail = "";
            DialogVisible = true;
        });

        StateHasChanged();
    }
    #endregion

    #region Visita Ortottica
    public async void LoadOrtoctis(decimal idv)
    {
        Console.WriteLine($"VisitaCorrente: {VisitaCorrente}");
        Console.WriteLine($"ListaVisite[VisitaCorrente].ID: {ListaVisite[VisitaCorrente].ID}");
        Console.WriteLine($"idv: {idv}");

        pDataOrtottica = DateTime.Now.ToString("dd/MM/yyyy");

        Ortoctis = new Ortottica();

        Ortoctis = await OrtoctisService.GetOrtottica(idv);

        if (Ortoctis.IdOrtottica != 0)
        {
            Ortoctis.Posizione = SetObjNullToStr(Ortoctis.Posizione);

            Ortoctis.Motilita = SetObjNullToStr(Ortoctis.Motilita);

            Ortoctis.Convergenza = SetObjNullToStr(Ortoctis.Convergenza);

            Ortoctis.Cover = SetObjNullToStr(Ortoctis.Cover);

            Ortoctis.PrismaCover = SetObjNullToStr(Ortoctis.PrismaCover);

            Ortoctis.Ampiezza = SetObjNullToStr(Ortoctis.Ampiezza);

            Ortoctis.Vetro = SetObjNullToStr(Ortoctis.Vetro);

            Ortoctis.Lang = SetObjNullToStr(Ortoctis.Lang);

            Ortoctis.Titmus = SetObjNullToStr(Ortoctis.Titmus);

            Ortoctis.AltriTest = SetObjNullToStr(Ortoctis.AltriTest);


            Ortoctis.Conclusioni = SetObjNullToStr(Ortoctis.Conclusioni);

            Ortoctis.Diagnosi = SetObjNullToStr(Ortoctis.Diagnosi);

            Ortoctis.Terapia = SetObjNullToStr(Ortoctis.Terapia);


            IsNewOrtoctis = false;

            pDataOrtottica = Ortoctis.PrintDate.ToShortDateString();

            PrintOrtotDisabled = false;

            Console.WriteLine($"Load Ortottica");
            Console.WriteLine($"ListaVisite[VisitaCorrente].ID: {ListaVisite[VisitaCorrente].ID}");
            Console.WriteLine($"Ortoctis.IdOrtottica: {Ortoctis.IdOrtottica}");
            Console.WriteLine($"Ortoctis.ptIdVisit: {Ortoctis.ptIdVisit}");
            Console.WriteLine($"Ortoctis.DataMisura: {Ortoctis.DataOrtottica}");
            Console.WriteLine($"Ortoctis.PrintDate: {Ortoctis.PrintDate}");
        }
        else
        {
            IsNewOrtoctis = true;

            DataOrtottica = DataVisita;

            SaveOrtoctisDisabled = false;

            PrintOrtotDisabled = true;

            Ortoctis.DataOrtottica = ListaVisite[VisitaCorrente].Val;

            Console.WriteLine($"Carica Ortottica");
            Console.WriteLine($"ListaVisite[VisitaCorrente].ID: {ListaVisite[VisitaCorrente].ID}");
            Console.WriteLine($"Ortoctis.IdOrtottica: {Ortoctis.IdOrtottica}");
            Console.WriteLine($"Ortoctis.ptIdVisit: {Ortoctis.ptIdVisit}");
            Console.WriteLine($"Ortoctis.DataMisura: {Ortoctis.DataOrtottica}");
            Console.WriteLine($"Ortoctis.PrintDate: {Ortoctis.PrintDate}");
        }

        StateHasChanged();
    }

    // public async void NewOrtoctis()
    // {
    //     await Task.Run(() =>
    //     {
    //         IsNewOrtoctis = true;

    //         Ortoctis = new Ortottica();

    //         Ortoctis.ptIdUser = Decimal.Parse(gIdUser);
    //         Ortoctis.ptIdPatient = id;
    //         Ortoctis.InsertDate = DateTime.Now;
    //         Ortoctis.DataOrtottica = DateTime.Now;

    //         DataOrtottica = DateTime.Now.ToString("dd/MM/yyyy");

    //         pDataOrtottica = DateTime.Now.ToString("dd/MM/yyyy");

    //         SaveOrtoctisDisabled = false;

    //         StateHasChanged();
    //     });
    // }

    public async void SaveOrtoctis()
    {
        string TmpDate;
        bool ContinueOp = true;

        if (IsNewOrtoctis)
        {
            Ortoctis.ptIdUser = Decimal.Parse(gIdUser);
            Ortoctis.ptIdPatient = id;
            Ortoctis.ptIdVisit = ListaVisite[VisitaCorrente].ID;
            Ortoctis.InsertDate = DateTime.Now;
            Ortoctis.DataOrtottica = Visita.DataVisita;

            if (CheckDate(pDataOrtottica))
            {
                TmpDate = pDataOrtottica.Substring(4, 4) + "-" + pDataOrtottica.Substring(2, 2) + "-" + pDataOrtottica.Substring(0, 2) + " 00:00:00,000";

                Ortoctis.PrintDate = DateTime.ParseExact(TmpDate, "yyyy-MM-dd HH:mm:ss,fff", System.Globalization.CultureInfo.InvariantCulture);
            }
            else
            {
                Console.WriteLine($"Inserimento Ortottica");
                Console.WriteLine($"Errore controllo data di stampa per ortottica");

                ContinueOp = false;
            }

            if (ContinueOp)
            {
                Console.WriteLine($"Inserimento Ortottica");
                Console.WriteLine($"ListaVisite[VisitaCorrente].ID: {ListaVisite[VisitaCorrente].ID}, Visita.DataVisita: {Visita.DataVisita}");

                await OrtoctisService.AddOrtottica(Ortoctis);

                // visit entry completed
                IsNewOrtoctis = false;

                PrintOrtotDisabled = false;
            }
        }
        else
        {
            if (CheckDate(pDataOrtottica))
            {
                TmpDate = pDataOrtottica.Substring(4, 4) + "-" + pDataOrtottica.Substring(2, 2) + "-" + pDataOrtottica.Substring(0, 2) + " 00:00:00,000";

                Ortoctis.PrintDate = DateTime.ParseExact(TmpDate, "yyyy-MM-dd HH:mm:ss,fff", System.Globalization.CultureInfo.InvariantCulture);
            }
            else
            {
                Console.WriteLine($"Aggiornamento Ortottica");
                Console.WriteLine($"Errore controllo data di stampa per ortottica");

                ContinueOp = false;
            }

            if (ContinueOp)
            {
                Console.WriteLine($"Aggiornamento Ortottica");
                Console.WriteLine($"Ortoctis.IdOrtottica: {Ortoctis.IdOrtottica}");

                await OrtoctisService.UpdOrtottica(Ortoctis.IdOrtottica, Ortoctis);
            }
        }

        await Task.Run(() =>
        {
            DialogHeader = " Informazioni ";
            DialogIcon = "e-icons e-circle-info col-lg-2";
            DialogText = "Dati Visita ortottica salvati";
            DialogDetail = "";
            DialogVisible = true;
        });

        StateHasChanged();
    }
    #endregion

    #region Prescrizioni
    private async void ShowFar()
    {
        ShowPresc = !ShowPresc;
        ShowDrugs = !ShowDrugs;

        StateHasChanged();
    }

    private async void BackPresc()
    {
        ShowPresc = !ShowPresc;
        ShowDrugs = !ShowDrugs;

        StateHasChanged();
    }

    private async void SearchFar()
    {
        bool AllowSearch = false;//ShowPresc

        AllowSearch = (!string.IsNullOrEmpty(fFar)) ? true : false;

        if (AllowSearch)
        {
            try
            {
                drugs = await ListDrugsService.ListDrugsAndUse(fFar);

                StateHasChanged();
            }
            catch (Exception ex)
            {
                Console.WriteLine(ex.Message);
            }
        }
    }

    public async void ResetFar()
    {
        fFar = "";

        // drugs.Clear();

        // drugs = await PatientService.PatList(p);

        StateHasChanged();
    }

    public async void AssignDrug(decimal idF, decimal idU, string far, string use)
    {
        string TmpDate;
        DateTime printDate = DateTime.Now;

        bool ContinueOp = true;

        if (CheckDate(pDataPrescrizione))
        {
            TmpDate = pDataPrescrizione.Substring(4, 4) + "-" + pDataPrescrizione.Substring(2, 2) + "-" + pDataPrescrizione.Substring(0, 2) + " 00:00:00,000";

            printDate = DateTime.ParseExact(TmpDate, "yyyy-MM-dd HH:mm:ss,fff", System.Globalization.CultureInfo.InvariantCulture);
        }
        else
        {
            Console.WriteLine($"Inserimento Prescrizione");
            Console.WriteLine($"Errore controllo data di stampa per prescrizione");

            ContinueOp = false;
        }

        if (ContinueOp)
        {
            Prescrizione NewPrescSec = new Prescrizione
                {
                    ptIdUser = Decimal.Parse(gIdUser),
                    InsertDate = DateTime.Now,
                    ptIdVisit = Visita.IdVisit,
                    DataPrescrizione = DateTime.Now,
                    PrintDate = printDate,
                    ptIdFarmaco = idF,
                    ptIdFarmacoUso = idU
                };

            Console.WriteLine($"Inserimento Prescrizione");
            Console.WriteLine($"ptIdVisit: {Visita.IdVisit}");
            Console.WriteLine($"DataPrescrizione: {DateTime.Now}");
            Console.WriteLine($"PrintDate: {printDate}");
            Console.WriteLine($"ptIdFarmaco: {idF}");
            Console.WriteLine($"ptIdFarmacoUso: {idU}");
            Console.WriteLine($" ");

            // Ottieni la prescrizione restituita con l'ID generato
            var createdPresc = await PrescrizioniService.PostPrescrizione(NewPrescSec);

            // Usa l'ID generato se necessario
            var idPrescrizione = createdPresc.IdPrescrizione;

            Console.WriteLine($"idPrescrizione: {idPrescrizione}");
            Console.WriteLine($"-----------------------");

            ider = idPrescrizione;

            // Logica successiva
            ShowPresc = !ShowPresc;
            ShowDrugs = !ShowDrugs;

            LoadPrescrizioni(Visita.IdVisit);
        }
    }

    private void UpdateUso(int index, string value)
    {
        // Console.WriteLine($"Index: {index}, New Value: {value}");
        Prescriptions[index].Uso = value;
    }

    public async void DeleteFar(decimal id)
    {
        string TmpDate;
        DateTime printDate = DateTime.Now;

        bool ContinueOp = true;

        if (CheckDate(pDataPrescrizione))
        {
            TmpDate = pDataPrescrizione.Substring(4, 4) + "-" + pDataPrescrizione.Substring(2, 2) + "-" + pDataPrescrizione.Substring(0, 2) + " 00:00:00,000";

            printDate = DateTime.ParseExact(TmpDate, "yyyy-MM-dd HH:mm:ss,fff", System.Globalization.CultureInfo.InvariantCulture);
        }
        else
        {
            Console.WriteLine($"Aggiornamento Prescrizione");
            Console.WriteLine($"Errore controllo data di stampa per prescrizione");

            ContinueOp = false;
        }

        if (ContinueOp)
        {
            for (var np = 0; np < Prescriptions.Count; np++)
            {
                if (Prescriptions[np].IdPrescrizione == id && np == 0 && Prescriptions.Count > 1)
                {
                    NotaPrescrizione = Prescriptions[np].NotePrescr;

                    Prescrizione FirstPresc = new Prescrizione
                        {
                            IdPrescrizione = Prescriptions[np + 1].IdPrescrizione,
                            ptIdUser = Prescriptions[np + 1].ptIdUser,
                            InsertDate = Prescriptions[np + 1].InsertDate,
                            ptIdVisit = Prescriptions[np + 1].ptIdVisit,
                            DataPrescrizione = Prescriptions[np + 1].DataPrescrizione,
                            PrintDate = Prescriptions[np + 1].PrintDate,
                            ptIdFarmaco = Prescriptions[np + 1].ptIdFarmaco,
                            ptIdFarmacoUso = Prescriptions[np + 1].ptIdFarmacoUso,
                            NotePrescr = NotaPrescrizione
                        };

                    await PrescrizioniService.PutPrescrizione(Prescriptions[np + 1].IdPrescrizione, FirstPresc);

                    Console.WriteLine($"Aggiornamento Prescrizione");
                    Console.WriteLine($"IdPrescrizione: {Prescriptions[np + 1].IdPrescrizione}");
                    Console.WriteLine($"ptIdVisit: {Prescriptions[np + 1].ptIdVisit}");
                    Console.WriteLine($"DataPrescrizione: {Prescriptions[np + 1].DataPrescrizione}");
                    Console.WriteLine($"PrintDate: {Prescriptions[np + 1].PrintDate}");
                    Console.WriteLine($"ptIdFarmaco: {Prescriptions[np + 1].ptIdFarmaco}");
                    Console.WriteLine($"ptIdFarmacoUso: {Prescriptions[np + 1].ptIdFarmacoUso}");
                    Console.WriteLine($" ");

                    np = Prescriptions.Count;
                }
            }

            Console.WriteLine($"-----------------------");
            Console.WriteLine($" ");

            Console.WriteLine($"Cancellazione Prescrizione");
            Console.WriteLine($"id: {id}");
            Console.WriteLine($" ");

            await PrescrizioniService.DeletePrescrizione(id);

            LoadPrescrizioni(Visita.IdVisit);
        }
    }

    public async void LoadPrescrizioni(decimal idv)
    {
        pDataPrescrizione = DateTime.Now.ToString("dd/MM/yyyy");

        Prescriptions = await PrescrizioniService.GetPrescrByVisit(idv);

        if (Prescriptions.Count > 0)
        {
            PrintPrescrDisabled = false;

            NotaPrescrizione = Prescriptions[0].NotePrescr;
        }
        else
        {
            PrintPrescrDisabled = true;

            NotaPrescrizione = "";
        }

        Prescrizioni LastPresc = new();

        Prescriptions.Add(LastPresc);

        StateHasChanged();
    }

    public async void StampaPrescrizione()
    {
        string TmpDate;
        DateTime printDate = DateTime.Now;

        bool ContinueOp = true;

        if (CheckDate(pDataPrescrizione))
        {
            TmpDate = pDataPrescrizione.Substring(4, 4) + "-" + pDataPrescrizione.Substring(2, 2) + "-" + pDataPrescrizione.Substring(0, 2) + " 00:00:00,000";

            printDate = DateTime.ParseExact(TmpDate, "yyyy-MM-dd HH:mm:ss,fff", System.Globalization.CultureInfo.InvariantCulture);
        }
        else
        {
            Console.WriteLine($"Stampa Prescrizione");
            Console.WriteLine($"Errore controllo data di stampa per prescrizione");

            ContinueOp = false;
        }

        if (ContinueOp)
        {
            Prescrizione FirstPresc = new Prescrizione
                {
                    IdPrescrizione = Prescriptions[0].IdPrescrizione,
                    ptIdUser = Prescriptions[0].ptIdUser,
                    InsertDate = Prescriptions[0].InsertDate,
                    ptIdVisit = Prescriptions[0].ptIdVisit,
                    ptIdFarmaco = Prescriptions[0].ptIdFarmaco,
                    ptIdFarmacoUso = Prescriptions[0].ptIdFarmacoUso,
                    NotePrescr = NotaPrescrizione
                };

            await PrescrizioniService.PutPrescrizione(Prescriptions[0].IdPrescrizione, FirstPresc);

            PrintPrescrizione(DropDownTemplate);
        }
    }
    #endregion

    #region Relazioni
    public async void LoadRelazione(decimal idv)
    {
        Console.WriteLine($"VisitaCorrente: {VisitaCorrente}");
        Console.WriteLine($"ListaVisite[VisitaCorrente].ID: {ListaVisite[VisitaCorrente].ID}");
        Console.WriteLine($"idv: {idv}");

        Relazione = new Relazioni();

        Relazione = await RelazioniService.GetRelazione(idv);

        if (Relazione.IdRelazione != 0)
        {
            Relazione.DiagnosiOD = SetObjNullToStr(Relazione.DiagnosiOD);
            Relazione.DiagnosiOS = SetObjNullToStr(Relazione.DiagnosiOS);

            Relazione.SHIRMER_Od = SetObjNullToStr(Relazione.SHIRMER_Od);
            Relazione.SHIRMER_Os = SetObjNullToStr(Relazione.SHIRMER_Os);

            Relazione.Seg_Ant_Od = SetObjNullToStr(Relazione.Seg_Ant_Od);
            Relazione.Seg_Ant_Os = SetObjNullToStr(Relazione.Seg_Ant_Os);

            Relazione.Visus_Od = SetObjNullToStr(Relazione.Visus_Od);
            Relazione.Visus_Os = SetObjNullToStr(Relazione.Visus_Os);

            Relazione.TONO_Od = SetObjNullToStr(Relazione.TONO_Od);
            Relazione.TONO_Os = SetObjNullToStr(Relazione.TONO_Os);

            Relazione.Fundus_Od = SetObjNullToStr(Relazione.Fundus_Od);
            Relazione.Fundus_Os = SetObjNullToStr(Relazione.Fundus_Os);

            pDataRelazione = Relazione.PrintDate.ToShortDateString();

            Console.WriteLine($"Load Relazione");
            Console.WriteLine($"Relazione.IdRelazione: {Relazione.IdRelazione}");
            Console.WriteLine($"Relazione.ptIdUser: {Relazione.ptIdUser}");
            Console.WriteLine($"Relazione.ptIdVisit: {Relazione.ptIdVisit}");
            Console.WriteLine($"Relazione.DataRelazione: {Relazione.DataRelazione}");
            Console.WriteLine($"Relazione.PrintDate: {Relazione.PrintDate}");
        }
        else
        {
            Relazione.DiagnosiOD = SetObjNullToStr(Visita.DiagnosiOD);
            Relazione.DiagnosiOS = SetObjNullToStr(Visita.DiagnosiOS);

            Relazione.SHIRMER_Od = SetObjNullToStr(Visita.SHIRMER_Od);
            Relazione.SHIRMER_Os = SetObjNullToStr(Visita.SHIRMER_Os);

            Relazione.Seg_Ant_Od = SetObjNullToStr(Visita.Seg_Ant_Od);
            Relazione.Seg_Ant_Os = SetObjNullToStr(Visita.Seg_Ant_Os);

            Relazione.Visus_Od = SetObjNullToStr(Visita.Visus_Od);
            Relazione.Visus_Os = SetObjNullToStr(Visita.Visus_Os);

            Relazione.TONO_Od = SetObjNullToStr(Visita.TONO_Od);
            Relazione.TONO_Os = SetObjNullToStr(Visita.TONO_Os);

            Relazione.Fundus_Od = SetObjNullToStr(Visita.Fundus_Od);
            Relazione.Fundus_Os = SetObjNullToStr(Visita.Fundus_Os);

            Relazione.DataRelazione = DateTime.Now;
            Relazione.PrintDate = DateTime.Now;

            pDataRelazione = DateTime.Now.ToShortDateString();

            Console.WriteLine($"Setting Relazione ...");
            Console.WriteLine($"Relazione.IdRelazione: {Relazione.IdRelazione}");
            Console.WriteLine($"Relazione.ptIdUser: {Relazione.ptIdUser}");
            Console.WriteLine($"Relazione.ptIdVisit: {Relazione.ptIdVisit}");
            Console.WriteLine($"Relazione.DataRelazione: {Relazione.DataRelazione}");
            Console.WriteLine($"Relazione.PrintDate: {Relazione.PrintDate}");
        }

        StateHasChanged();
    }

    public async void StampaRelazione(string who)
    {
        string TmpDate;
        DateTime printDate = DateTime.Now;

        bool ContinueOp = true;

        if (CheckDate(pDataRelazione))
        {
            TmpDate = pDataRelazione.Substring(4, 4) + "-" + pDataRelazione.Substring(2, 2) + "-" + pDataRelazione.Substring(0, 2) + " 00:00:00,000";

            printDate = DateTime.ParseExact(TmpDate, "yyyy-MM-dd HH:mm:ss,fff", System.Globalization.CultureInfo.InvariantCulture);
        }
        else
        {
            Console.WriteLine($"Errore controllo data di stampa per relazione");

            ContinueOp = false;
        }

        Console.WriteLine($"printDate: {printDate}");

        if (Relazione.IdRelazione != 0)
        {
            if (ContinueOp)
            {
                Relazione.PrintDate = printDate;

                Console.WriteLine($"Aggiornamento Relazione ...");

                Console.WriteLine($"Relazione.IdRelazione: {Relazione.IdRelazione}");
                Console.WriteLine($"Relazione.ptIdUser: {Relazione.ptIdUser}");
                Console.WriteLine($"Relazione.ptIdVisit: {Relazione.ptIdVisit}");
                Console.WriteLine($"Relazione.DataRelazione: {Relazione.DataRelazione}");
                Console.WriteLine($"Relazione.PrintDate: {Relazione.PrintDate}");

                await RelazioniService.UpdRelazione(Relazione.IdRelazione, Relazione);
            }
        }
        else
        {
            if (ContinueOp)
            {
                Relazione.ptIdUser = Decimal.Parse(gIdUser);
                Relazione.InsertDate = DateTime.Now;
                Relazione.ptIdVisit = Visita.IdVisit;

                Relazione.DataRelazione = DateTime.Now;
                Relazione.PrintDate = printDate;

                Console.WriteLine($"Inserimento Relazione ...");

                Console.WriteLine($"Relazione.IdRelazione: {Relazione.IdRelazione}");
                Console.WriteLine($"Relazione.ptIdUser: {Relazione.ptIdUser}");
                Console.WriteLine($"Relazione.ptIdVisit: {Relazione.ptIdVisit}");
                Console.WriteLine($"Relazione.DataRelazione: {Relazione.DataRelazione}");
                Console.WriteLine($"Relazione.PrintDate: {Relazione.PrintDate}");

                await RelazioniService.AddRelazione(Relazione);
            }
        }

        LoadRelazione(Visita.IdVisit);
        Console.WriteLine($"pDataRelazione: {pDataRelazione}");

        pDataRelazione = printDate.ToShortDateString();
        Console.WriteLine($"printDate: {printDate}");

        PrintRelazione(who);

        //pDataRelazione = DateTime.Now.ToString("dd/MM/yyyy");
    }
    #endregion

    #region pdf
    void Pages_PageAdded(object sender, PageAddedEventArgs args)
    {
        PdfPage page = args.Page;
        PdfGraphics g = page.Graphics;

        int FirstLay;

        if (FirstPage)
        {
            FirstLay = 0;
            FirstPage = false;
        }
        else
        {
            FirstLay = 1;
        }

        // Setup font for Dati Testata
        PdfStandardFont SideFont = new PdfStandardFont(PdfFontFamily.TimesRoman, 10, PdfFontStyle.Bold | PdfFontStyle.Italic);
        // PdfStandardFont FootFont = new PdfStandardFont(PdfFontFamily.TimesRoman, 9, PdfFontStyle.Bold | PdfFontStyle.Italic);

        PdfPen pen = new PdfPen(Color.Black);
        pen.Width = 0.1F;

        PointF p1 = new PointF();
        PointF p2 = new PointF();

        // linea verticale sinistra
        p1.X = 85;
        p1.Y = 70 - FirstLay * 70;

        p2.X = 85;
        p2.Y = 842 - (2 - FirstLay) * 70;

        g.DrawLine(pen, p1, p2);

        //
        // linea verticale destra
        // p1.X = 545;
        // p1.Y = 0;

        // p2.X = 545;
        // p2.Y = 840;

        // g.DrawLine(pen, p1, p2);

        // 1a linea orizzontale
        // p1.X = 0;
        // p1.Y = 70 - FirstLay * 70;

        // p2.X = 545;
        // p2.Y = 70 - FirstLay * 70;

        // g.DrawLine(pen, p1, p2);

        // 2a linea orizzontale
        // p1.X = 0;
        // p1.Y = 710;

        // p2.X = 545;
        // p2.Y = 710;

        // g.DrawLine(pen, p1, p2);

        // PdfPen penT = new PdfPen(Color.Orange);
        // penT.Width = 0.1F;

        // Microchirurgia Oculare up
        // p1.X = 0;
        // p1.Y = 100;

        // p2.X = 545;
        // p2.Y = 100;

        // g.DrawLine(penT, p1, p2);

        // Microchirurgia Oculare down
        // p1.X = 0;
        // p1.Y = 120;

        // p2.X = 545;
        // p2.Y = 120;

        // g.DrawLine(penT, p1, p2);

        // Chirurgia Oftalmoplastica up
        // p1.X = 0;
        // p1.Y = 153;

        // p2.X = 545;
        // p2.Y = 153;

        // g.DrawLine(penT, p1, p2);

        // Chirurgia Oftalmoplastica down
        // p1.X = 0;
        // p1.Y = 173;

        // p2.X = 545;
        // p2.Y = 173;

        // g.DrawLine(penT, p1, p2);

        // Chirurgia Refrattiva, Miopia, Ipermetropia, Astigmatismo up
        // p1.X = 0;
        // p1.Y = 206;

        // p2.X = 545;
        // p2.Y = 206;

        // g.DrawLine(penT, p1, p2);

        // Chirurgia Refrattiva, Miopia, Ipermetropia, Astigmatismo down
        // p1.X = 0;
        // p1.Y = 262;

        // p2.X = 545;
        // p2.Y = 262;

        // g.DrawLine(penT, p1, p2);

        // Laser Terapia, Chirurgia, Vitreo-Retinica up
        // p1.X = 0;
        // p1.Y = 295;

        // p2.X = 545;
        // p2.Y = 295;

        // g.DrawLine(penT, p1, p2);

        // Laser Terapia, Chirurgia, Vitreo-Retinica down
        // p1.X = 0;
        // p1.Y = 327;

        // p2.X = 545;
        // p2.Y = 327;

        // g.DrawLine(penT, p1, p2);

        // Topografia Corneale up
        // p1.X = 0;
        // p1.Y = 360;

        // p2.X = 545;
        // p2.Y = 360;

        // g.DrawLine(penT, p1, p2);

        // Topografia Corneale down
        // p1.X = 0;
        // p1.Y = 380;

        // p2.X = 545;
        // p2.Y = 380;

        // g.DrawLine(penT, p1, p2);

        // Ecografia up
        // p1.X = 0;
        // p1.Y = 413;

        // p2.X = 545;
        // p2.Y = 413;

        // g.DrawLine(penT, p1, p2);

        // Ecografia down
        // p1.X = 0;
        // p1.Y = 421;

        // p2.X = 545;
        // p2.Y = 421;

        // g.DrawLine(penT, p1, p2);

        // Fluorangiografia, Angiografia con, verde di, indocianina up
        // p1.X = 0;
        // p1.Y = 454;

        // p2.X = 545;
        // p2.Y = 454;

        // g.DrawLine(penT, p1, p2);

        // Fluorangiografia, Angiografia con, verde di, indocianina down
        // p1.X = 0;
        // p1.Y = 498;

        // p2.X = 545;
        // p2.Y = 498;

        // g.DrawLine(penT, p1, p2);

        // Campo Visivo up
        // p1.X = 0;
        // p1.Y = 531;

        // p2.X = 545;
        // p2.Y = 531;

        // g.DrawLine(penT, p1, p2);

        // Campo Visivo down
        // p1.X = 0;
        // p1.Y = 539;

        // p2.X = 545;
        // p2.Y = 539;

        // g.DrawLine(penT, p1, p2);

        // Tomografia Coerenza Ottica (O.C.T.). up
        // p1.X = 0;
        // p1.Y = 572;

        // p2.X = 545;
        // p2.Y = 572;

        // g.DrawLine(penT, p1, p2);

        // Tomografia Coerenza Ottica (O.C.T.) down
        // p1.X = 0;
        // p1.Y = 604;

        // p2.X = 545;
        // p2.Y = 604;

        // g.DrawLine(penT, p1, p2);

        // Angio - O.C.T. up
        // p1.X = 0;
        // p1.Y = 637;

        // p2.X = 545;
        // p2.Y = 637;

        // g.DrawLine(penT, p1, p2);

        // Angio - O.C.T. down
        // p1.X = 0;
        // p1.Y = 645;

        // p2.X = 545;
        // p2.Y = 645;

        // g.DrawLine(penT, p1, p2);

        // R.N.F.L. up
        // p1.X = 0;
        // p1.Y = 678;

        // p2.X = 545;
        // p2.Y = 678;

        // g.DrawLine(penT, p1, p2);

        // R.N.F.L. down
        // p1.X = 0;
        // p1.Y = 686;

        // p2.X = 545;
        // p2.Y = 686;

        // g.DrawLine(penT, p1, p2);
        //

        g.DrawString("Microchirurgia", SideFont, PdfBrushes.Black, 0, 98 - FirstLay * 70);
        g.DrawString("Oculare", SideFont, PdfBrushes.Black, 0, 110 - FirstLay * 70);

        g.DrawString("Chirurgia", SideFont, PdfBrushes.Black, 0, 151 - FirstLay * 70);
        g.DrawString("Oftalmoplastica", SideFont, PdfBrushes.Black, 0, 163 - FirstLay * 70);

        g.DrawString("Chirurgia", SideFont, PdfBrushes.Black, 0, 204 - FirstLay * 70);
        g.DrawString("Refrattiva", SideFont, PdfBrushes.Black, 0, 216 - FirstLay * 70);
        g.DrawString("Miopia", SideFont, PdfBrushes.Black, 0, 228 - FirstLay * 70);
        g.DrawString("Ipermetropia", SideFont, PdfBrushes.Black, 0, 240 - FirstLay * 70);
        g.DrawString("Astigmatismo", SideFont, PdfBrushes.Black, 0, 252 - FirstLay * 70);

        g.DrawString("Laser Terapia", SideFont, PdfBrushes.Black, 0, 293 - FirstLay * 70);
        g.DrawString("Chirurgia", SideFont, PdfBrushes.Black, 0, 305 - FirstLay * 70);
        g.DrawString("Vitreo-Retinica", SideFont, PdfBrushes.Black, 0, 317 - FirstLay * 70);

        g.DrawString("Topografia", SideFont, PdfBrushes.Black, 0, 358 - FirstLay * 70);
        g.DrawString("Corneale", SideFont, PdfBrushes.Black, 0, 370 - FirstLay * 70);

        g.DrawString("Ecografia", SideFont, PdfBrushes.Black, 0, 411 - FirstLay * 70);

        g.DrawString("Fluorangiografia", SideFont, PdfBrushes.Black, 0, 452 - FirstLay * 70);
        g.DrawString("Angiografia con", SideFont, PdfBrushes.Black, 0, 464 - FirstLay * 70);
        g.DrawString("verde di", SideFont, PdfBrushes.Black, 0, 476 - FirstLay * 70);
        g.DrawString("indocianina", SideFont, PdfBrushes.Black, 0, 488 - FirstLay * 70);

        g.DrawString("Campo Visivo", SideFont, PdfBrushes.Black, 0, 529 - FirstLay * 70);

        g.DrawString("Tomografia", SideFont, PdfBrushes.Black, 0, 570 - FirstLay * 70);
        g.DrawString("Coerenza Ottica", SideFont, PdfBrushes.Black, 0, 582 - FirstLay * 70);
        g.DrawString("(O.C.T.)", SideFont, PdfBrushes.Black, 0, 594 - FirstLay * 70);

        g.DrawString("Angio - O.C.T.", SideFont, PdfBrushes.Black, 0, 635 - FirstLay * 70);

        g.DrawString("R.N.F.L.", SideFont, PdfBrushes.Black, 0, 676 - FirstLay * 70);

        // g.DrawString("Viale Raffaello Sanzio, 60 – scala C, 5° piano – (Piazza Michelangelo) - 95128 Catania (CT)", FootFont, PdfBrushes.Red, 141, 719);
        // g.DrawString("Riceve per appuntamento – Tel/Fax: 095371701", FootFont, PdfBrushes.Red, 220, 732);
        // g.DrawString("Sito Web: http://www.studiolabruna.it – email: info@studiolabruna.it", FootFont, PdfBrushes.Red, 180, 745);
        // g.DrawString("Iscriz. Ord. Dei Medici di CT- Pietro La Bruna n° 5133 / Marco La Bruna n° 14037", FootFont, PdfBrushes.Red, 152, 758);

        // FirstLay = 1;
    }

    private string CustomDate(string val)
    {
        string result = "";

        if ((val == null) || (val == "") || (val.Equals(System.DBNull.Value)))
        {
            result = "";
        }
        else
        {
            result = val.Substring(0, 2) + "/" + val.Substring(2, 2) + "/" + val.Substring(4, 4);
        }

        return result;
    }

    public static string Eta(string data1, string data2)
    {
        string result = "";

        // Verifica che le date siano valide
        if (!DateTime.TryParse(data1, out DateTime primaData))
        {
            //throw new ArgumentException("La prima data non è valida.");
            result = "";
        }

        if (!DateTime.TryParse(data2, out DateTime secondaData))
        {
            //throw new ArgumentException("La seconda data non è valida.");
            result = "";
        }

        // Calcolo della differenza in anni
        int anniDifferenza = secondaData.Year - primaData.Year;

        // Aggiusta se il compleanno non è ancora passato nell'anno corrente
        if (secondaData < primaData.AddYears(anniDifferenza))
        {
            anniDifferenza--;
        }

        result = Math.Abs(anniDifferenza).ToString();

        // return Math.Abs(anniDifferenza); // Restituisce sempre un valore positivo

        return result;
    }

    private string FillEmpty(object val)
    {
        string result = "";

        if ((val == null) || (val.ToString() == "") || (val.Equals(System.DBNull.Value)))
        {
            result = " ";
        }
        else
        {
            result = val.ToString();
        }

        return result;
    }

    async void PrintVisit()
    {
        int paragraphAfterSpacing = 8;
        int cellMargin = 8;

        //Create a new PDF document.
        PdfDocument pdfDocument = new PdfDocument();

        #region Definizione documento pdf
        // Set document information
        // ------------------------------------------------------------------------------------------------------------------------
        pdfDocument.DocumentInformation.Author = "Powered by Phoenix";
        pdfDocument.DocumentInformation.CreationDate = DateTime.Now;
        pdfDocument.DocumentInformation.Creator = "Ophthal";
        pdfDocument.DocumentInformation.Keywords = "Dott. La Bruna";
        pdfDocument.DocumentInformation.Subject = "Scheda Visita";
        pdfDocument.DocumentInformation.Title = "Cognome Nome - Visita del: Data Visita  ";

        // Set page size
        // ------------------------------------------------------------------------------------------------------------------------
        pdfDocument.PageSettings.Size = Syncfusion.Pdf.PdfPageSize.A4;

        // Set margin for all the pages
        pdfDocument.PageSettings.Margins.Left = 10;
        pdfDocument.PageSettings.Margins.Right = 10;
        pdfDocument.PageSettings.Margins.Top = 10;
        pdfDocument.PageSettings.Margins.Bottom = 10;

        // Set page orientation
        // ------------------------------------------------------------------------------------------------------------------------
        pdfDocument.PageSettings.Orientation = PdfPageOrientation.Landscape;

        // Set paginate layout
        // ------------------------------------------------------------------------------------------------------------------------
        PdfLayoutFormat format = new PdfLayoutFormat();
        format.Layout = PdfLayoutType.Paginate;

        // Add page to the PDF document
        PdfPage page = pdfDocument.Pages.Add();
        #endregion

        #region Header & Footer
        // Create Header and Footer font
        // ------------------------------------------------------------------------------------------------------------------------
        PdfFont fontHeader = new PdfStandardFont(PdfFontFamily.Helvetica, 14, PdfFontStyle.Regular);
        PdfFont fontFooter = new PdfStandardFont(PdfFontFamily.Helvetica, 7, PdfFontStyle.Regular);

        #region Header
        // Get document's bounds
        // ------------------------------------------------------------------------------------------------------------------------
        RectangleF bounds = new RectangleF(0, 0, pdfDocument.Pages[0].GetClientSize().Width, 50);

        // Create a Page template that can be used as header.
        // ------------------------------------------------------------------------------------------------------------------------
        PdfPageTemplateElement header = new PdfPageTemplateElement(bounds);

        // Load image for header
        // Scarica l'immagine dal server
        var httpClient = new HttpClient();
        string imageUrl = $"{Env.BaseAddress}/img/LB_Logo_25.png";                      // URL dell'immagine
        var imageBytes = await httpClient.GetByteArrayAsync(imageUrl);

        PdfGridCellStyle HeadLogoStyle = new PdfGridCellStyle();
        HeadLogoStyle.Borders.Left.Width = 0;
        HeadLogoStyle.Borders.Right.Width = 0;
        HeadLogoStyle.Borders.Top.Width = 0;
        HeadLogoStyle.Borders.Bottom.Width = 0;
        HeadLogoStyle.CellPadding = new PdfPaddings(0, 0, 0, 0);

        // Setup font for Dati Testata
        PdfStandardFont hNameFont = new PdfStandardFont(PdfFontFamily.Helvetica, 7, PdfFontStyle.Bold);
        PdfStandardFont hValueFont = new PdfStandardFont(PdfFontFamily.Helvetica, 7, PdfFontStyle.Regular);

        // Specify the style for bottom
        PdfGridCellStyle HeadStyle = new PdfGridCellStyle();
        HeadStyle.Borders.Left.Width = 0.1F;
        HeadStyle.Borders.Right.Width = 0.1F;
        HeadStyle.Borders.Top.Width = 0.1F;
        HeadStyle.Borders.Bottom.Width = 0.1F;
        HeadStyle.CellPadding = new PdfPaddings(2, 2, 2, 2);
        HeadStyle.StringFormat = new PdfStringFormat(PdfTextAlignment.Center);

        // Usa un MemoryStream per creare il PdfBitmap
        using (MemoryStream imageStream = new MemoryStream(imageBytes))
        {
            PdfImage image = new PdfBitmap(imageStream);

            HeadLogoStyle.BackgroundImage = new PdfBitmap(imageStream);

            // Draw the image in the header.
            header.Graphics.DrawImage(image, new PointF(0, 0), new SizeF(46, 25));      // (46, 25) = width, height immagine
        }

        // Add the header at the top.
        //pdfDocument.Template.Top = header;
        #endregion

        #region Footer
        // Create a Page template that can be used as footer.
        // ------------------------------------------------------------------------------------------------------------------------
        PdfPageTemplateElement footer = new PdfPageTemplateElement(bounds);

        PdfBrush brush = new PdfSolidBrush(Color.Black);

        // Create page date of printing field.
        PdfTextElement pageDatePrint = new PdfTextElement("Printed on " + DateTime.Now.ToShortDateString(), fontFooter, brush);


        // Create page number field.
        PdfPageNumberField pageNumber = new PdfPageNumberField(fontFooter, brush);

        // Create page count field.
        PdfPageCountField count = new PdfPageCountField(fontFooter, brush);

        // Add the fields in composite fields.
        PdfCompositeField compositeField = new PdfCompositeField(fontFooter, brush, "Page {0} of {1}", pageNumber, count);

        compositeField.Bounds = footer.Bounds;

        // Draw the text element and store its layout information
        pageDatePrint.Draw(footer.Graphics, new PointF(0, 40));

        // Draw the composite field in footer.
        compositeField.Draw(footer.Graphics, new PointF(380, 40));

        // Add the footer template at the bottom.
        pdfDocument.Template.Bottom = footer;
        #endregion
        #endregion

        #region Prima parte: Dati Testata
        #region Definizione stile celle Dati Testata
        // // Setup font for Dati Testata
        // PdfStandardFont hNameFont = new PdfStandardFont(PdfFontFamily.Helvetica, 7, PdfFontStyle.Bold);
        // PdfStandardFont hValueFont = new PdfStandardFont(PdfFontFamily.Helvetica, 7, PdfFontStyle.Regular);

        // // Specify the style for bottom
        // PdfGridCellStyle HeadStyle = new PdfGridCellStyle();
        // HeadStyle.Borders.Left.Width = 0.1F;
        // HeadStyle.Borders.Right.Width = 0.1F;
        // HeadStyle.Borders.Top.Width = 0.1F;
        // HeadStyle.Borders.Bottom.Width = 0.1F;
        // HeadStyle.CellPadding = new PdfPaddings(2, 2, 2, 2);
        // HeadStyle.StringFormat = new PdfStringFormat(PdfTextAlignment.Center);

        // PdfGridCellStyle HeadLogoStyle = new PdfGridCellStyle();
        // HeadLogoStyle.Borders.Left.Width = 0;
        // HeadLogoStyle.Borders.Right.Width = 0;
        // HeadLogoStyle.Borders.Top.Width = 0;
        // HeadLogoStyle.Borders.Bottom.Width = 0;
        // HeadLogoStyle.CellPadding = new PdfPaddings(0, 0, 0, 0);
        #endregion

        #region Imposta griglia Dati Testata
        // Create the head grid
        PdfGrid HeadPdfGrid = new PdfGrid();

        // Add the rows to head grid
        PdfGridRow row1 = HeadPdfGrid.Rows.Add();
        PdfGridRow row2 = HeadPdfGrid.Rows.Add();


        //Adding grid style
        PdfGridStyle gridStyle = new PdfGridStyle();
        //Allow grid to overflow horizontally
        gridStyle.AllowHorizontalOverflow = true;
        //Adding cell spacing between cells
        gridStyle.CellSpacing = 3F;

        HeadPdfGrid.Style = gridStyle;

        // Set rows's height
        // row1.Height = 18;
        // row2.Height = 18;

        // Add the columns to head grid
        HeadPdfGrid.Columns.Add(13);

        // Set columns's width
        HeadPdfGrid.Columns[0].Width = 57;
        HeadPdfGrid.Columns[1].Width = 48;
        HeadPdfGrid.Columns[2].Width = 58;
        HeadPdfGrid.Columns[3].Width = 45;
        HeadPdfGrid.Columns[4].Width = 45;
        HeadPdfGrid.Columns[5].Width = 34;
        HeadPdfGrid.Columns[6].Width = 116;
        HeadPdfGrid.Columns[7].Width = 48;
        HeadPdfGrid.Columns[8].Width = 48;
        HeadPdfGrid.Columns[9].Width = 63;
        HeadPdfGrid.Columns[10].Width = 58;
        HeadPdfGrid.Columns[11].Width = 53;
        HeadPdfGrid.Columns[12].Width = 137;

        // Set columns merged
        HeadPdfGrid.Rows[0].Cells[0].RowSpan = 2;

        HeadPdfGrid.Rows[0].Cells[2].ColumnSpan = 3;
        HeadPdfGrid.Rows[1].Cells[7].ColumnSpan = 2;
        HeadPdfGrid.Rows[1].Cells[9].ColumnSpan = 4;
        #endregion

        #region Inserimento Dati Testata
        // Set the HeadPdfGrid's value
        PdfTextElement val;

        HeadPdfGrid.Rows[0].Cells[0].Style = HeadLogoStyle;
        HeadPdfGrid.Rows[0].Cells[0].ImagePosition = PdfGridImagePosition.Tile;                                         // 0-0

        HeadPdfGrid.Rows[0].Cells[1].Style = HeadStyle;
        HeadPdfGrid.Rows[0].Cells[2].Style = HeadStyle;
        // HeadPdfGrid.Rows[0].Cells[3].Style = HeadStyle;
        // HeadPdfGrid.Rows[0].Cells[4].Style = HeadStyle;
        HeadPdfGrid.Rows[0].Cells[5].Style = HeadStyle;
        HeadPdfGrid.Rows[0].Cells[6].Style = HeadStyle;
        HeadPdfGrid.Rows[0].Cells[7].Style = HeadStyle;
        HeadPdfGrid.Rows[0].Cells[8].Style = HeadStyle;
        HeadPdfGrid.Rows[0].Cells[9].Style = HeadStyle;
        HeadPdfGrid.Rows[0].Cells[10].Style = HeadStyle;
        HeadPdfGrid.Rows[0].Cells[11].Style = HeadStyle;
        HeadPdfGrid.Rows[0].Cells[12].Style = HeadStyle;

        val = new PdfTextElement("Cognome", hNameFont, PdfBrushes.Black);                                               // 0-1
        HeadPdfGrid.Rows[0].Cells[1].Value = val;
        val = new PdfTextElement(LName, hValueFont, PdfBrushes.Black);                                                  // 0-2
        HeadPdfGrid.Rows[0].Cells[2].Value = val;

        val = new PdfTextElement("Nome", hNameFont, PdfBrushes.Black);                                                  // 0-5
        HeadPdfGrid.Rows[0].Cells[5].Value = val;
        val = new PdfTextElement(FName, hValueFont, PdfBrushes.Black);                                                  // 0-6
        HeadPdfGrid.Rows[0].Cells[6].Value = val;

        val = new PdfTextElement("COD", hNameFont, PdfBrushes.Black);                                                   // 0-7
        HeadPdfGrid.Rows[0].Cells[7].Value = val;
        val = new PdfTextElement(Cod, hValueFont, PdfBrushes.Black);                                                    // 0-8
        HeadPdfGrid.Rows[0].Cells[8].Value = val;

        val = new PdfTextElement("Data nascita", hNameFont, PdfBrushes.Black);                                          // 0-9
        HeadPdfGrid.Rows[0].Cells[9].Value = val;
        val = new PdfTextElement(CustomDate(BirthDate), hValueFont, PdfBrushes.Black);                                  // 0-10
        HeadPdfGrid.Rows[0].Cells[10].Value = val;

        val = new PdfTextElement("Telefono", hNameFont, PdfBrushes.Black);                                              // 0-11
        HeadPdfGrid.Rows[0].Cells[11].Value = val;
        val = new PdfTextElement(Phone, hValueFont, PdfBrushes.Black);                                                  // 0-12
        HeadPdfGrid.Rows[0].Cells[12].Value = val;


        HeadPdfGrid.Rows[1].Cells[1].Style = HeadStyle;
        HeadPdfGrid.Rows[1].Cells[2].Style = HeadStyle;
        HeadPdfGrid.Rows[1].Cells[3].Style = HeadStyle;
        HeadPdfGrid.Rows[1].Cells[4].Style = HeadStyle;
        HeadPdfGrid.Rows[1].Cells[5].Style = HeadStyle;
        HeadPdfGrid.Rows[1].Cells[6].Style = HeadStyle;
        HeadPdfGrid.Rows[1].Cells[7].Style = HeadStyle;
        // HeadPdfGrid.Rows[1].Cells[8].Style = HeadStyle;
        HeadPdfGrid.Rows[1].Cells[9].Style = HeadStyle;
        // HeadPdfGrid.Rows[1].Cells[10].Style = HeadStyle;
        // HeadPdfGrid.Rows[1].Cells[11].Style = HeadStyle;
        // HeadPdfGrid.Rows[1].Cells[12].Style = HeadStyle;

        val = new PdfTextElement("Data", hNameFont, PdfBrushes.Black);                                                  // 1-1
        HeadPdfGrid.Rows[1].Cells[1].Value = val;
        val = new PdfTextElement(ListaVisite[VisitaCorrente].Val.ToString("dd/MM/yyyy"), hValueFont, PdfBrushes.Black); // 1-2
        HeadPdfGrid.Rows[1].Cells[2].Value = val;

        val = new PdfTextElement("Anni", hNameFont, PdfBrushes.Black);                                                  // 1-3
        HeadPdfGrid.Rows[1].Cells[3].Value = val;

        if ((BirthDate != "") && (DataVisita != ""))
        {
            val = new PdfTextElement(Eta(CustomDate(BirthDate), DataVisita), hValueFont, PdfBrushes.Black);             // 1-4
            HeadPdfGrid.Rows[1].Cells[4].Value = val;
        }
        else
        {
            val = new PdfTextElement("", hValueFont, PdfBrushes.Black);                                                 // 1-4
            HeadPdfGrid.Rows[1].Cells[4].Value = val;
        }

        val = new PdfTextElement("CF", hNameFont, PdfBrushes.Black);                                                    // 1-5
        HeadPdfGrid.Rows[1].Cells[5].Value = val;
        val = new PdfTextElement(CodFisc, hValueFont, PdfBrushes.Black);                                                // 1-6
        HeadPdfGrid.Rows[1].Cells[6].Value = val;

        val = new PdfTextElement("DATI PERSONALI", hNameFont, PdfBrushes.Black);                                        // 1-7
        HeadPdfGrid.Rows[1].Cells[7].Value = val;
        val = new PdfTextElement(Note, hValueFont, PdfBrushes.Black);                                                   // 1-9
        HeadPdfGrid.Rows[1].Cells[9].Value = val;

        // //Create a text element to draw a text in PDF page.
        // PdfTextElement title = new PdfTextElement("", hNameFont, PdfBrushes.Black);
        // PdfLayoutResult result = title.Draw(page, new PointF(0, 0));

        PdfLayoutResult result = HeadPdfGrid.Draw(page, new Syncfusion.Drawing.PointF(0, 0));

        //Draw PDF grid into the PDF page.
        //HeadPdfGrid.Draw(page, new Syncfusion.Drawing.PointF(0, result.Bounds.Bottom + paragraphAfterSpacing));
        // HeadPdfGrid.Draw(page, new Syncfusion.Drawing.PointF(0, 0));
        #endregion
        #endregion

        #region Seconda parte: Dati Visita
        // Create field's name and field's font
        // ------------------------------------------------------------------------------------------------------------------------
        PdfFont fieldNameFont = new PdfStandardFont(PdfFontFamily.Helvetica, 6, PdfFontStyle.Bold);
        PdfFont fieldFont = new PdfStandardFont(PdfFontFamily.Helvetica, 7, PdfFontStyle.Regular);

        #region Definizione stile celle Visita
        // Specify the style for head's cell
        PdfGridCellStyle posCellStyleH = new PdfGridCellStyle();
        posCellStyleH.Borders.Left.Width = 0;
        posCellStyleH.Borders.Right.Width = 0;
        posCellStyleH.Borders.Top.Width = 0;
        posCellStyleH.Borders.Bottom.Width = 0.2F;
        posCellStyleH.CellPadding = new PdfPaddings(0, 3, 6, 0);

        // Specify the style for value's cell
        PdfGridCellStyle posCellStyleV = new PdfGridCellStyle();
        posCellStyleV.Borders.Left.Width = 0.2F;
        posCellStyleV.Borders.Right.Width = 0.2F;
        posCellStyleV.Borders.Top.Width = 0;
        posCellStyleV.Borders.Bottom.Width = 0.2F;
        posCellStyleV.CellPadding = new PdfPaddings(3, 3, 3, 3);

        // Specify the style for space's cell
        PdfGridCellStyle posCellStyleS = new PdfGridCellStyle();
        posCellStyleS.Borders.Left.Width = 0;
        posCellStyleS.Borders.Right.Width = 0;
        posCellStyleS.Borders.Top.Width = 0;
        posCellStyleS.Borders.Bottom.Width = 0;
        posCellStyleS.CellPadding = new PdfPaddings(0, 0, 0, 0);
        #endregion

        #region Imposta griglia Dati Visita
        // Create Grid
        PdfGrid VisitPdfGrid = new PdfGrid();

        // Add Rows
        PdfGridRow rowV01 = VisitPdfGrid.Rows.Add();
        PdfGridRow rowV02 = VisitPdfGrid.Rows.Add();
        PdfGridRow rowV03 = VisitPdfGrid.Rows.Add();
        PdfGridRow rowV04 = VisitPdfGrid.Rows.Add();
        PdfGridRow rowV05 = VisitPdfGrid.Rows.Add();
        PdfGridRow rowV06 = VisitPdfGrid.Rows.Add();
        PdfGridRow rowV07 = VisitPdfGrid.Rows.Add();
        PdfGridRow rowV08 = VisitPdfGrid.Rows.Add();
        PdfGridRow rowV09 = VisitPdfGrid.Rows.Add();
        PdfGridRow rowV10 = VisitPdfGrid.Rows.Add();
        PdfGridRow rowV11 = VisitPdfGrid.Rows.Add();
        PdfGridRow rowV12 = VisitPdfGrid.Rows.Add();
        PdfGridRow rowV13 = VisitPdfGrid.Rows.Add();
        PdfGridRow rowV14 = VisitPdfGrid.Rows.Add();
        PdfGridRow rowV15 = VisitPdfGrid.Rows.Add();
        PdfGridRow rowV16 = VisitPdfGrid.Rows.Add();
        PdfGridRow rowV17 = VisitPdfGrid.Rows.Add();
        PdfGridRow rowV18 = VisitPdfGrid.Rows.Add();
        PdfGridRow rowV19 = VisitPdfGrid.Rows.Add();
        PdfGridRow rowV20 = VisitPdfGrid.Rows.Add();
        PdfGridRow rowV21 = VisitPdfGrid.Rows.Add();
        PdfGridRow rowV22 = VisitPdfGrid.Rows.Add();
        PdfGridRow rowV23 = VisitPdfGrid.Rows.Add();
        PdfGridRow rowV24 = VisitPdfGrid.Rows.Add();
        PdfGridRow rowV25 = VisitPdfGrid.Rows.Add();
        PdfGridRow rowV26 = VisitPdfGrid.Rows.Add();
        PdfGridRow rowV27 = VisitPdfGrid.Rows.Add();
        PdfGridRow rowV28 = VisitPdfGrid.Rows.Add();
        PdfGridRow rowV29 = VisitPdfGrid.Rows.Add();
        PdfGridRow rowV30 = VisitPdfGrid.Rows.Add();
        PdfGridRow rowV31 = VisitPdfGrid.Rows.Add();
        PdfGridRow rowV32 = VisitPdfGrid.Rows.Add();

        // Set Rows's height
        rowV01.Height = 15;         // Diagnosi OD
        // rowV02.Height = 24;

        rowV03.Height = 15;         // Diagnosi OS
        // rowV04.Height = 24;

        rowV05.Height = 15;         // Anamnesi
        // rowV06.Height = 24;

        rowV07.Height = 15;         // Annessi OD
        // rowV08.Height = 16;

        rowV09.Height = 15;         // Annessi OS
        // rowV10.Height = 16;

        rowV11.Height = 15;         // Seg Ant OD
        // rowV12.Height = 15;

        rowV13.Height = 15;         // Seg Ant OS
        // rowV14.Height = 16;

        rowV15.Height = 15;         // Fundus OD
        // rowV16.Height = 16;

        rowV17.Height = 15;         // Fundus OS
        // rowV18.Height = 16;

        rowV19.Height = 15;         // Visus OD
        // rowV20.Height = 16;

        rowV21.Height = 15;         // Visus OS
        // rowV22.Height = 16;

        rowV23.Height = 15;         // Terapia
        // rowV24.Height = 16;

        rowV25.Height = 15;         // OD Sue lenti PL
        // rowV26.Height = 16;

        rowV27.Height = 15;         // OS Sue lenti PL
        // rowV28.Height = 16;

        rowV29.Height = 15;         // Motico Visita
        // rowV30.Height = 36;

        rowV31.Height = 15;         // Note Visita
        // rowV32.Height = 36;

        // Add Columns
        VisitPdfGrid.Columns.Add(13);

        // Set Columns's width
        VisitPdfGrid.Columns[0].Width = 110;
        VisitPdfGrid.Columns[1].Width = 6;
        VisitPdfGrid.Columns[2].Width = 110;
        VisitPdfGrid.Columns[3].Width = 6;
        VisitPdfGrid.Columns[4].Width = 110;
        VisitPdfGrid.Columns[5].Width = 6;
        VisitPdfGrid.Columns[6].Width = 111;
        VisitPdfGrid.Columns[7].Width = 6;
        VisitPdfGrid.Columns[8].Width = 111;
        VisitPdfGrid.Columns[9].Width = 6;
        VisitPdfGrid.Columns[10].Width = 111;
        VisitPdfGrid.Columns[11].Width = 6;
        VisitPdfGrid.Columns[12].Width = 111;

        // Set Columns merged
        VisitPdfGrid.Rows[0].Cells[0].ColumnSpan = 5;                                           //  0
        VisitPdfGrid.Rows[0].Cells[6].ColumnSpan = 7;
        VisitPdfGrid.Rows[1].Cells[0].ColumnSpan = 5;                                           //  1
        VisitPdfGrid.Rows[1].Cells[6].ColumnSpan = 7;

        VisitPdfGrid.Rows[2].Cells[0].ColumnSpan = 5;                                           //  2
        VisitPdfGrid.Rows[2].Cells[6].ColumnSpan = 3;
        VisitPdfGrid.Rows[2].Cells[10].ColumnSpan = 3;
        VisitPdfGrid.Rows[3].Cells[0].ColumnSpan = 5;                                           //  3
        VisitPdfGrid.Rows[3].Cells[6].ColumnSpan = 3;
        VisitPdfGrid.Rows[3].Cells[10].ColumnSpan = 3;

        VisitPdfGrid.Rows[4].Cells[0].ColumnSpan = 5;                                           //  4
        VisitPdfGrid.Rows[4].Cells[6].ColumnSpan = 3;
        VisitPdfGrid.Rows[4].Cells[10].ColumnSpan = 3;
        VisitPdfGrid.Rows[5].Cells[0].ColumnSpan = 5;                                           //  5
        VisitPdfGrid.Rows[5].Cells[6].ColumnSpan = 3;
        VisitPdfGrid.Rows[5].Cells[10].ColumnSpan = 3;

        VisitPdfGrid.Rows[6].Cells[0].ColumnSpan = 5;                                           //  6
        VisitPdfGrid.Rows[6].Cells[6].ColumnSpan = 3;
        VisitPdfGrid.Rows[6].Cells[10].ColumnSpan = 3;
        VisitPdfGrid.Rows[7].Cells[0].ColumnSpan = 5;                                           //  7
        VisitPdfGrid.Rows[7].Cells[6].ColumnSpan = 3;
        VisitPdfGrid.Rows[7].Cells[10].ColumnSpan = 3;

        VisitPdfGrid.Rows[8].Cells[0].ColumnSpan = 5;                                           //  8
        VisitPdfGrid.Rows[8].Cells[6].ColumnSpan = 3;
        VisitPdfGrid.Rows[8].Cells[10].ColumnSpan = 3;
        VisitPdfGrid.Rows[9].Cells[0].ColumnSpan = 5;                                           //  9
        VisitPdfGrid.Rows[9].Cells[6].ColumnSpan = 3;
        VisitPdfGrid.Rows[9].Cells[10].ColumnSpan = 3;

        VisitPdfGrid.Rows[10].Cells[0].ColumnSpan = 5;                                          // 10
        VisitPdfGrid.Rows[10].Cells[6].ColumnSpan = 3;
        VisitPdfGrid.Rows[10].Cells[10].ColumnSpan = 3;
        VisitPdfGrid.Rows[11].Cells[0].ColumnSpan = 5;                                          // 11
        VisitPdfGrid.Rows[11].Cells[6].ColumnSpan = 3;
        VisitPdfGrid.Rows[11].Cells[10].ColumnSpan = 3;

        VisitPdfGrid.Rows[12].Cells[0].ColumnSpan = 5;                                          // 12
        VisitPdfGrid.Rows[12].Cells[6].ColumnSpan = 3;
        VisitPdfGrid.Rows[12].Cells[10].ColumnSpan = 3;
        VisitPdfGrid.Rows[13].Cells[0].ColumnSpan = 5;                                          // 13
        VisitPdfGrid.Rows[13].Cells[6].ColumnSpan = 3;
        VisitPdfGrid.Rows[13].Cells[10].ColumnSpan = 3;

        VisitPdfGrid.Rows[14].Cells[0].ColumnSpan = 5;                                          // 14
        VisitPdfGrid.Rows[14].Cells[6].ColumnSpan = 3;
        VisitPdfGrid.Rows[14].Cells[10].ColumnSpan = 3;
        VisitPdfGrid.Rows[15].Cells[0].ColumnSpan = 5;                                          // 15
        VisitPdfGrid.Rows[15].Cells[6].ColumnSpan = 3;
        VisitPdfGrid.Rows[15].Cells[10].ColumnSpan = 3;

        VisitPdfGrid.Rows[16].Cells[0].ColumnSpan = 5;                                          // 16
        VisitPdfGrid.Rows[16].Cells[6].ColumnSpan = 3;
        VisitPdfGrid.Rows[16].Cells[10].ColumnSpan = 3;
        VisitPdfGrid.Rows[17].Cells[0].ColumnSpan = 5;                                          // 17
        VisitPdfGrid.Rows[17].Cells[6].ColumnSpan = 3;
        VisitPdfGrid.Rows[17].Cells[10].ColumnSpan = 3;

        VisitPdfGrid.Rows[18].Cells[0].ColumnSpan = 5;                                          // 18
        VisitPdfGrid.Rows[18].Cells[6].ColumnSpan = 3;
        VisitPdfGrid.Rows[18].Cells[10].ColumnSpan = 3;
        VisitPdfGrid.Rows[19].Cells[0].ColumnSpan = 5;                                          // 19
        VisitPdfGrid.Rows[19].Cells[6].ColumnSpan = 3;
        VisitPdfGrid.Rows[19].Cells[10].ColumnSpan = 3;

        VisitPdfGrid.Rows[20].Cells[0].ColumnSpan = 5;                                          // 20
        VisitPdfGrid.Rows[20].Cells[6].ColumnSpan = 3;
        VisitPdfGrid.Rows[20].Cells[10].ColumnSpan = 3;
        VisitPdfGrid.Rows[21].Cells[0].ColumnSpan = 5;                                          // 21
        VisitPdfGrid.Rows[21].Cells[6].ColumnSpan = 3;
        VisitPdfGrid.Rows[21].Cells[10].ColumnSpan = 3;

        VisitPdfGrid.Rows[22].Cells[0].ColumnSpan = 5;                                          // 22
        VisitPdfGrid.Rows[22].Cells[6].ColumnSpan = 3;
        VisitPdfGrid.Rows[22].Cells[10].ColumnSpan = 3;
        VisitPdfGrid.Rows[23].Cells[0].ColumnSpan = 5;                                          // 23
        VisitPdfGrid.Rows[23].Cells[6].ColumnSpan = 3;
        VisitPdfGrid.Rows[23].Cells[10].ColumnSpan = 3;

        VisitPdfGrid.Rows[26].Cells[6].ColumnSpan = 7;                                          // 26
        VisitPdfGrid.Rows[27].Cells[6].ColumnSpan = 7;                                          // 27

        VisitPdfGrid.Rows[28].Cells[0].ColumnSpan = 5;                                          // 28
        VisitPdfGrid.Rows[28].Cells[6].ColumnSpan = 7;
        VisitPdfGrid.Rows[29].Cells[0].ColumnSpan = 5;                                          // 29
        VisitPdfGrid.Rows[29].Cells[6].ColumnSpan = 7;

        VisitPdfGrid.Rows[30].Cells[0].ColumnSpan = 13;                                         // 30
        VisitPdfGrid.Rows[31].Cells[0].ColumnSpan = 13;                                         // 31
        #endregion

        #region Inserimento Dati Visita
        // Set the HeadPdfGrid's value
        PdfTextElement value;

        VisitPdfGrid.Rows[0].Cells[0].Style = posCellStyleH;                                        // Diagnosi OD
        VisitPdfGrid.Rows[0].Cells[5].Style = posCellStyleS;                                        // vuoto
        VisitPdfGrid.Rows[0].Cells[6].Style = posCellStyleH;                                        // INTERVENTI

        VisitPdfGrid.Rows[1].Cells[0].Style = posCellStyleV;
        VisitPdfGrid.Rows[1].Cells[5].Style = posCellStyleS;
        VisitPdfGrid.Rows[1].Cells[6].Style = posCellStyleV;

        value = new PdfTextElement("DIAGNOSI OD", fieldNameFont, PdfBrushes.Black);                 // 0-0
        VisitPdfGrid.Rows[0].Cells[0].Value = value;
        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            // 0-5
        VisitPdfGrid.Rows[0].Cells[5].Value = value;
        value = new PdfTextElement("INTERVENTI", fieldNameFont, PdfBrushes.Black);                  // 0-6
        VisitPdfGrid.Rows[0].Cells[6].Value = value;

        value = new PdfTextElement(FillEmpty(Visita.DiagnosiOD), fieldFont, PdfBrushes.Black);      // 1-0
        VisitPdfGrid.Rows[1].Cells[0].Value = value;
        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            // 1-5
        VisitPdfGrid.Rows[1].Cells[5].Value = value;
        value = new PdfTextElement(FillEmpty(Visita.Interventi), fieldFont, PdfBrushes.Black);      // 1-6
        VisitPdfGrid.Rows[1].Cells[6].Value = value;


        VisitPdfGrid.Rows[2].Cells[0].Style = posCellStyleH;                                        // Diagnosi OS
        VisitPdfGrid.Rows[2].Cells[5].Style = posCellStyleS;                                        // vuoto
        VisitPdfGrid.Rows[2].Cells[6].Style = posCellStyleH;                                        // Curva Tonometrica OD
        VisitPdfGrid.Rows[2].Cells[9].Style = posCellStyleS;                                        // vuoto
        VisitPdfGrid.Rows[2].Cells[10].Style = posCellStyleH;                                       // Argon

        VisitPdfGrid.Rows[3].Cells[0].Style = posCellStyleV;
        VisitPdfGrid.Rows[3].Cells[5].Style = posCellStyleS;
        VisitPdfGrid.Rows[3].Cells[6].Style = posCellStyleV;
        VisitPdfGrid.Rows[3].Cells[9].Style = posCellStyleS;
        VisitPdfGrid.Rows[3].Cells[10].Style = posCellStyleV;

        value = new PdfTextElement("DIAGNOSI OS", fieldNameFont, PdfBrushes.Black);                 // 2-0
        VisitPdfGrid.Rows[2].Cells[0].Value = value;
        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            // 2-5
        VisitPdfGrid.Rows[2].Cells[5].Value = value;
        value = new PdfTextElement("CURVA TONOMETRICA OD", fieldNameFont, PdfBrushes.Black);        // 2-6
        VisitPdfGrid.Rows[2].Cells[6].Value = value;
        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            // 2-9
        VisitPdfGrid.Rows[2].Cells[9].Value = value;
        value = new PdfTextElement("ARGON", fieldNameFont, PdfBrushes.Black);                       // 2-10
        VisitPdfGrid.Rows[2].Cells[10].Value = value;

        value = new PdfTextElement(FillEmpty(Visita.DiagnosiOS), fieldFont, PdfBrushes.Black);      // 3-0
        VisitPdfGrid.Rows[3].Cells[0].Value = value;
        value = new PdfTextElement("", fieldFont, PdfBrushes.Black);                                // 3-5
        VisitPdfGrid.Rows[3].Cells[5].Value = value;
        value = new PdfTextElement(FillEmpty(Visita.CurvaTono_Od), fieldFont, PdfBrushes.Black);    // 3-6
        VisitPdfGrid.Rows[3].Cells[6].Value = value;
        value = new PdfTextElement("", fieldFont, PdfBrushes.Black);                                // 3-9
        VisitPdfGrid.Rows[3].Cells[9].Value = value;
        value = new PdfTextElement(FillEmpty(Visita.CurvaArgon), fieldFont, PdfBrushes.Black);      // 3-10
        VisitPdfGrid.Rows[3].Cells[10].Value = value;


        VisitPdfGrid.Rows[4].Cells[0].Style = posCellStyleH;                                        // Anamnesi
        VisitPdfGrid.Rows[4].Cells[5].Style = posCellStyleS;                                        // vuoto
        VisitPdfGrid.Rows[4].Cells[6].Style = posCellStyleH;                                        // Curva Tonometrica OS
        VisitPdfGrid.Rows[4].Cells[9].Style = posCellStyleS;                                        // vuoto
        VisitPdfGrid.Rows[4].Cells[10].Style = posCellStyleS;                                       // vuoto

        VisitPdfGrid.Rows[5].Cells[0].Style = posCellStyleV;
        VisitPdfGrid.Rows[5].Cells[5].Style = posCellStyleS;
        VisitPdfGrid.Rows[5].Cells[6].Style = posCellStyleV;
        VisitPdfGrid.Rows[5].Cells[9].Style = posCellStyleS;
        VisitPdfGrid.Rows[5].Cells[10].Style = posCellStyleS;

        value = new PdfTextElement("ANAMNESI", fieldNameFont, PdfBrushes.Black);                    // 4-0
        VisitPdfGrid.Rows[4].Cells[0].Value = value;
        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            // 4-5
        VisitPdfGrid.Rows[4].Cells[5].Value = value;
        value = new PdfTextElement("CURVA TONOMETRICA OS", fieldNameFont, PdfBrushes.Black);        // 4-6
        VisitPdfGrid.Rows[4].Cells[6].Value = value;
        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            // 4-9
        VisitPdfGrid.Rows[4].Cells[5].Value = value;
        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            // 4-10
        VisitPdfGrid.Rows[4].Cells[5].Value = value;

        value = new PdfTextElement(FillEmpty(Visita.Anamnesi), fieldFont, PdfBrushes.Black);        // 5-0
        VisitPdfGrid.Rows[5].Cells[0].Value = value;
        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            // 5-5
        VisitPdfGrid.Rows[5].Cells[5].Value = value;
        value = new PdfTextElement(FillEmpty(Visita.CurvaTono_Os), fieldFont, PdfBrushes.Black);    // 5-6
        VisitPdfGrid.Rows[5].Cells[6].Value = value;
        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            // 5-9
        VisitPdfGrid.Rows[5].Cells[9].Value = value;
        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            // 5-10
        VisitPdfGrid.Rows[5].Cells[10].Value = value;


        VisitPdfGrid.Rows[6].Cells[0].Style = posCellStyleH;                                        // Annessi OD
        VisitPdfGrid.Rows[6].Cells[5].Style = posCellStyleS;                                        // vuoto
        VisitPdfGrid.Rows[6].Cells[6].Style = posCellStyleH;                                        // SHIRMER OD
        VisitPdfGrid.Rows[6].Cells[9].Style = posCellStyleS;                                        // vuoto
        VisitPdfGrid.Rows[6].Cells[10].Style = posCellStyleH;                                       // Tono Oculare OD

        VisitPdfGrid.Rows[7].Cells[0].Style = posCellStyleV;
        VisitPdfGrid.Rows[7].Cells[5].Style = posCellStyleS;
        VisitPdfGrid.Rows[7].Cells[6].Style = posCellStyleV;
        VisitPdfGrid.Rows[7].Cells[9].Style = posCellStyleS;
        VisitPdfGrid.Rows[7].Cells[10].Style = posCellStyleV;

        value = new PdfTextElement("ANNESSI OD", fieldNameFont, PdfBrushes.Black);                  // 6-0
        VisitPdfGrid.Rows[6].Cells[0].Value = value;
        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            // 6-5
        VisitPdfGrid.Rows[6].Cells[5].Value = value;
        value = new PdfTextElement("SHIRMER OD", fieldNameFont, PdfBrushes.Black);                  // 6-6
        VisitPdfGrid.Rows[6].Cells[6].Value = value;
        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            // 6-9
        VisitPdfGrid.Rows[6].Cells[5].Value = value;
        value = new PdfTextElement("TONO OCULARE OD", fieldNameFont, PdfBrushes.Black);             // 6-10
        VisitPdfGrid.Rows[6].Cells[10].Value = value;

        value = new PdfTextElement(FillEmpty(Visita.Annessi_Od), fieldFont, PdfBrushes.Black);      // 7-0
        VisitPdfGrid.Rows[7].Cells[0].Value = value;
        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            // 7-5
        VisitPdfGrid.Rows[7].Cells[5].Value = value;
        value = new PdfTextElement(FillEmpty(Visita.SHIRMER_Od), fieldFont, PdfBrushes.Black);      // 7-6
        VisitPdfGrid.Rows[7].Cells[6].Value = value;
        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            // 7-9
        VisitPdfGrid.Rows[7].Cells[9].Value = value;
        value = new PdfTextElement(FillEmpty(Visita.TONO_Od), fieldFont, PdfBrushes.Black);         // 7-10
        VisitPdfGrid.Rows[7].Cells[10].Value = value;


        VisitPdfGrid.Rows[8].Cells[0].Style = posCellStyleH;                                        // Annessi OS
        VisitPdfGrid.Rows[8].Cells[5].Style = posCellStyleS;                                        // vuoto
        VisitPdfGrid.Rows[8].Cells[6].Style = posCellStyleH;                                        // SHIRMER OS
        VisitPdfGrid.Rows[8].Cells[9].Style = posCellStyleS;                                        // vuoto
        VisitPdfGrid.Rows[8].Cells[10].Style = posCellStyleH;                                       // Tono Oculare OS

        VisitPdfGrid.Rows[9].Cells[0].Style = posCellStyleV;
        VisitPdfGrid.Rows[9].Cells[5].Style = posCellStyleS;
        VisitPdfGrid.Rows[9].Cells[6].Style = posCellStyleV;
        VisitPdfGrid.Rows[9].Cells[9].Style = posCellStyleS;
        VisitPdfGrid.Rows[9].Cells[10].Style = posCellStyleV;

        value = new PdfTextElement("ANNESSI OS", fieldNameFont, PdfBrushes.Black);                  // 8-0
        VisitPdfGrid.Rows[8].Cells[0].Value = value;
        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            // 8-5
        VisitPdfGrid.Rows[8].Cells[5].Value = value;
        value = new PdfTextElement("SHIRMER OS", fieldNameFont, PdfBrushes.Black);                  // 8-6
        VisitPdfGrid.Rows[8].Cells[6].Value = value;
        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            // 8-9
        VisitPdfGrid.Rows[8].Cells[9].Value = value;
        value = new PdfTextElement("TONO OCULARE OS", fieldNameFont, PdfBrushes.Black);             // 8-10
        VisitPdfGrid.Rows[8].Cells[10].Value = value;

        value = new PdfTextElement(FillEmpty(Visita.Annessi_Os), fieldFont, PdfBrushes.Black);      // 9-0
        VisitPdfGrid.Rows[9].Cells[0].Value = value;
        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            // 9-5
        VisitPdfGrid.Rows[9].Cells[5].Value = value;
        value = new PdfTextElement(FillEmpty(Visita.SHIRMER_Os), fieldFont, PdfBrushes.Black);      // 9-6
        VisitPdfGrid.Rows[9].Cells[6].Value = value;
        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            // 9-9
        VisitPdfGrid.Rows[9].Cells[9].Value = value;
        value = new PdfTextElement(FillEmpty(Visita.TONO_Os), fieldFont, PdfBrushes.Black);         // 9-10
        VisitPdfGrid.Rows[9].Cells[10].Value = value;


        VisitPdfGrid.Rows[10].Cells[0].Style = posCellStyleH;                                       // Seg. Ant OD
        VisitPdfGrid.Rows[10].Cells[5].Style = posCellStyleS;                                       // vuoto
        VisitPdfGrid.Rows[10].Cells[6].Style = posCellStyleH;                                       // Vie lacrimali OD
        VisitPdfGrid.Rows[10].Cells[9].Style = posCellStyleS;                                       // vuoto
        VisitPdfGrid.Rows[10].Cells[10].Style = posCellStyleH;                                      // Topografia OD

        VisitPdfGrid.Rows[11].Cells[0].Style = posCellStyleV;
        VisitPdfGrid.Rows[11].Cells[5].Style = posCellStyleS;
        VisitPdfGrid.Rows[11].Cells[6].Style = posCellStyleV;
        VisitPdfGrid.Rows[11].Cells[9].Style = posCellStyleS;
        VisitPdfGrid.Rows[11].Cells[10].Style = posCellStyleV;

        value = new PdfTextElement("SEG ANT OD", fieldNameFont, PdfBrushes.Black);                  // 10-0
        VisitPdfGrid.Rows[10].Cells[0].Value = value;
        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            // 10-5
        VisitPdfGrid.Rows[10].Cells[5].Value = value;
        value = new PdfTextElement("VIE LACRIMALI OD", fieldNameFont, PdfBrushes.Black);            // 10-6
        VisitPdfGrid.Rows[10].Cells[6].Value = value;
        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            // 10-9
        VisitPdfGrid.Rows[10].Cells[9].Value = value;
        value = new PdfTextElement("TOPOGRAFIA OD", fieldNameFont, PdfBrushes.Black);               // 10-10
        VisitPdfGrid.Rows[10].Cells[10].Value = value;

        value = new PdfTextElement(FillEmpty(Visita.Seg_Ant_Od), fieldFont, PdfBrushes.Black);      // 11-0
        VisitPdfGrid.Rows[11].Cells[0].Value = value;
        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            // 11-5
        VisitPdfGrid.Rows[11].Cells[5].Value = value;
        value = new PdfTextElement(FillEmpty(Visita.Lavaggio_Od), fieldFont, PdfBrushes.Black);     // 11-6
        VisitPdfGrid.Rows[11].Cells[6].Value = value;
        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            // 11-9
        VisitPdfGrid.Rows[11].Cells[9].Value = value;
        value = new PdfTextElement(FillEmpty(Visita.Topografia_Od), fieldFont, PdfBrushes.Black);   // 11-10
        VisitPdfGrid.Rows[11].Cells[10].Value = value;


        VisitPdfGrid.Rows[12].Cells[0].Style = posCellStyleH;                                       // Seg. Ant OS
        VisitPdfGrid.Rows[12].Cells[5].Style = posCellStyleS;                                       // vuoto
        VisitPdfGrid.Rows[12].Cells[6].Style = posCellStyleH;                                       // Vie lacrimali OS
        VisitPdfGrid.Rows[12].Cells[9].Style = posCellStyleS;                                       // vuoto
        VisitPdfGrid.Rows[12].Cells[10].Style = posCellStyleH;                                      // opografia OS

        VisitPdfGrid.Rows[13].Cells[0].Style = posCellStyleV;
        VisitPdfGrid.Rows[13].Cells[5].Style = posCellStyleS;
        VisitPdfGrid.Rows[13].Cells[6].Style = posCellStyleV;
        VisitPdfGrid.Rows[13].Cells[9].Style = posCellStyleS;
        VisitPdfGrid.Rows[13].Cells[10].Style = posCellStyleV;

        value = new PdfTextElement("SEG ANT OS", fieldNameFont, PdfBrushes.Black);                  // 12-0
        VisitPdfGrid.Rows[12].Cells[0].Value = value;
        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            // 12-5
        VisitPdfGrid.Rows[12].Cells[5].Value = value;
        value = new PdfTextElement("VIE LACRIMALI OS", fieldNameFont, PdfBrushes.Black);            // 12-6
        VisitPdfGrid.Rows[12].Cells[6].Value = value;
        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            // 12-9
        VisitPdfGrid.Rows[12].Cells[9].Value = value;
        value = new PdfTextElement("TOPOGRAFIA OS", fieldNameFont, PdfBrushes.Black);               // 12-10
        VisitPdfGrid.Rows[12].Cells[10].Value = value;

        value = new PdfTextElement(FillEmpty(Visita.Seg_Ant_Os), fieldFont, PdfBrushes.Black);      // 13-0
        VisitPdfGrid.Rows[13].Cells[0].Value = value;
        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            // 13-5
        VisitPdfGrid.Rows[13].Cells[5].Value = value;
        value = new PdfTextElement(FillEmpty(Visita.Lavaggio_Os), fieldFont, PdfBrushes.Black);     // 13-6
        VisitPdfGrid.Rows[13].Cells[6].Value = value;
        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            // 13-9
        VisitPdfGrid.Rows[13].Cells[9].Value = value;
        value = new PdfTextElement(FillEmpty(Visita.Topografia_Os), fieldFont, PdfBrushes.Black);   // 13-10
        VisitPdfGrid.Rows[13].Cells[10].Value = value;


        VisitPdfGrid.Rows[14].Cells[0].Style = posCellStyleH;                                       // Fundus OD
        VisitPdfGrid.Rows[14].Cells[5].Style = posCellStyleS;                                       // vuoto
        VisitPdfGrid.Rows[14].Cells[6].Style = posCellStyleH;                                       // Fag OD
        VisitPdfGrid.Rows[14].Cells[9].Style = posCellStyleS;                                       // vuoto
        VisitPdfGrid.Rows[14].Cells[10].Style = posCellStyleH;                                      // Fag OS

        VisitPdfGrid.Rows[15].Cells[0].Style = posCellStyleV;
        VisitPdfGrid.Rows[15].Cells[5].Style = posCellStyleS;
        VisitPdfGrid.Rows[15].Cells[6].Style = posCellStyleV;
        VisitPdfGrid.Rows[15].Cells[9].Style = posCellStyleS;
        VisitPdfGrid.Rows[15].Cells[10].Style = posCellStyleV;

        value = new PdfTextElement("FUNDUS OD", fieldNameFont, PdfBrushes.Black);                   // 14-0
        VisitPdfGrid.Rows[14].Cells[0].Value = value;
        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            // 14-5
        VisitPdfGrid.Rows[14].Cells[5].Value = value;
        value = new PdfTextElement("FAG OD", fieldNameFont, PdfBrushes.Black);                      // 14-6
        VisitPdfGrid.Rows[14].Cells[6].Value = value;
        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            // 14-9
        VisitPdfGrid.Rows[14].Cells[9].Value = value;
        value = new PdfTextElement("FAG OS", fieldNameFont, PdfBrushes.Black);                      // 14-10
        VisitPdfGrid.Rows[14].Cells[10].Value = value;

        value = new PdfTextElement(FillEmpty(Visita.Fundus_Od), fieldFont, PdfBrushes.Black);       // 15-0
        VisitPdfGrid.Rows[15].Cells[0].Value = value;
        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            // 15-5
        VisitPdfGrid.Rows[15].Cells[5].Value = value;
        value = new PdfTextElement(FillEmpty(Visita.FAG_Od), fieldFont, PdfBrushes.Black);          // 15-6
        VisitPdfGrid.Rows[15].Cells[6].Value = value;
        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            // 15-9
        VisitPdfGrid.Rows[15].Cells[9].Value = value;
        value = new PdfTextElement(FillEmpty(Visita.FAG_Os), fieldFont, PdfBrushes.Black);          // 15-10
        VisitPdfGrid.Rows[15].Cells[10].Value = value;


        VisitPdfGrid.Rows[16].Cells[0].Style = posCellStyleH;                                       // Fundus OS
        VisitPdfGrid.Rows[16].Cells[5].Style = posCellStyleS;                                       // vuoto
        VisitPdfGrid.Rows[16].Cells[6].Style = posCellStyleH;                                       // Biometria
        VisitPdfGrid.Rows[16].Cells[9].Style = posCellStyleS;                                       // vuoto
        VisitPdfGrid.Rows[16].Cells[10].Style = posCellStyleH;                                      // IV

        VisitPdfGrid.Rows[17].Cells[0].Style = posCellStyleV;
        VisitPdfGrid.Rows[17].Cells[5].Style = posCellStyleS;
        VisitPdfGrid.Rows[17].Cells[6].Style = posCellStyleV;
        VisitPdfGrid.Rows[17].Cells[9].Style = posCellStyleS;
        VisitPdfGrid.Rows[17].Cells[10].Style = posCellStyleV;

        value = new PdfTextElement("FUNDUS OS", fieldNameFont, PdfBrushes.Black);                   // 16-0
        VisitPdfGrid.Rows[16].Cells[0].Value = value;
        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            // 16-5
        VisitPdfGrid.Rows[16].Cells[5].Value = value;
        value = new PdfTextElement("BIOMETRIA", fieldNameFont, PdfBrushes.Black);                   // 16-6
        VisitPdfGrid.Rows[16].Cells[6].Value = value;
        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            // 16-9
        VisitPdfGrid.Rows[16].Cells[9].Value = value;
        value = new PdfTextElement("IV", fieldNameFont, PdfBrushes.Black);                          // 16-10
        VisitPdfGrid.Rows[16].Cells[10].Value = value;

        value = new PdfTextElement(FillEmpty(Visita.Fundus_Os), fieldFont, PdfBrushes.Black);       // 17-0
        VisitPdfGrid.Rows[17].Cells[0].Value = value;
        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            // 17-5
        VisitPdfGrid.Rows[17].Cells[5].Value = value;
        value = new PdfTextElement(FillEmpty(Visita.Biometria), fieldFont, PdfBrushes.Black);       // 17-6
        VisitPdfGrid.Rows[17].Cells[6].Value = value;
        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            // 17-9
        VisitPdfGrid.Rows[17].Cells[9].Value = value;
        value = new PdfTextElement(FillEmpty(Visita.IV), fieldFont, PdfBrushes.Black);              // 17-10
        VisitPdfGrid.Rows[17].Cells[0].Value = value;


        VisitPdfGrid.Rows[18].Cells[0].Style = posCellStyleH;                                       // Visus OD
        VisitPdfGrid.Rows[18].Cells[5].Style = posCellStyleS;                                       // vuoto
        VisitPdfGrid.Rows[18].Cells[6].Style = posCellStyleH;                                       // Oct OD
        VisitPdfGrid.Rows[18].Cells[9].Style = posCellStyleS;                                       // vuoto
        VisitPdfGrid.Rows[18].Cells[10].Style = posCellStyleH;                                      // Oct OS

        VisitPdfGrid.Rows[19].Cells[0].Style = posCellStyleV;
        VisitPdfGrid.Rows[19].Cells[5].Style = posCellStyleS;
        VisitPdfGrid.Rows[19].Cells[6].Style = posCellStyleV;
        VisitPdfGrid.Rows[19].Cells[9].Style = posCellStyleS;
        VisitPdfGrid.Rows[19].Cells[10].Style = posCellStyleV;

        value = new PdfTextElement("VISUS OD", fieldNameFont, PdfBrushes.Black);                    // 18-0
        VisitPdfGrid.Rows[18].Cells[0].Value = value;
        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            // 18-5
        VisitPdfGrid.Rows[18].Cells[5].Value = value;
        value = new PdfTextElement("OCT OD", fieldNameFont, PdfBrushes.Black);                      // 18-6
        VisitPdfGrid.Rows[18].Cells[6].Value = value;
        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            // 18-9
        VisitPdfGrid.Rows[18].Cells[9].Value = value;
        value = new PdfTextElement("OCT OS", fieldNameFont, PdfBrushes.Black);                      // 18-10
        VisitPdfGrid.Rows[18].Cells[10].Value = value;

        value = new PdfTextElement(FillEmpty(Visita.Visus_Od), fieldFont, PdfBrushes.Black);        // 19-0
        VisitPdfGrid.Rows[19].Cells[0].Value = value;
        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            // 19-5
        VisitPdfGrid.Rows[19].Cells[5].Value = value;
        value = new PdfTextElement(FillEmpty(Visita.OCT_Od), fieldFont, PdfBrushes.Black);          // 19-6
        VisitPdfGrid.Rows[19].Cells[6].Value = value;
        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            // 19-9
        VisitPdfGrid.Rows[19].Cells[9].Value = value;
        value = new PdfTextElement(FillEmpty(Visita.OCT_Os), fieldFont, PdfBrushes.Black);          // 19-10
        VisitPdfGrid.Rows[19].Cells[10].Value = value;


        VisitPdfGrid.Rows[20].Cells[0].Style = posCellStyleH;                                       // Visus OS
        VisitPdfGrid.Rows[20].Cells[5].Style = posCellStyleS;                                       // vuoto
        VisitPdfGrid.Rows[20].Cells[6].Style = posCellStyleH;                                       // RNFL OD
        VisitPdfGrid.Rows[20].Cells[9].Style = posCellStyleS;                                       // vuoto
        VisitPdfGrid.Rows[20].Cells[10].Style = posCellStyleH;                                      // RNFL OS

        VisitPdfGrid.Rows[21].Cells[0].Style = posCellStyleV;
        VisitPdfGrid.Rows[21].Cells[5].Style = posCellStyleS;
        VisitPdfGrid.Rows[21].Cells[6].Style = posCellStyleV;
        VisitPdfGrid.Rows[21].Cells[9].Style = posCellStyleS;
        VisitPdfGrid.Rows[21].Cells[10].Style = posCellStyleV;

        value = new PdfTextElement("VISUS OS", fieldNameFont, PdfBrushes.Black);                    // 20-0
        VisitPdfGrid.Rows[20].Cells[0].Value = value;
        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            // 20-5
        VisitPdfGrid.Rows[20].Cells[5].Value = value;
        value = new PdfTextElement("RNFL OD", fieldNameFont, PdfBrushes.Black);                     // 20-6
        VisitPdfGrid.Rows[20].Cells[6].Value = value;
        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            // 20-9
        VisitPdfGrid.Rows[20].Cells[9].Value = value;
        value = new PdfTextElement("RNFL OS", fieldNameFont, PdfBrushes.Black);                     // 20-10
        VisitPdfGrid.Rows[20].Cells[10].Value = value;

        value = new PdfTextElement(FillEmpty(Visita.Visus_Os), fieldFont, PdfBrushes.Black);        // 21-0
        VisitPdfGrid.Rows[21].Cells[0].Value = value;
        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            // 21-5
        VisitPdfGrid.Rows[21].Cells[5].Value = value;
        value = new PdfTextElement(FillEmpty(Visita.RNFL_Od), fieldFont, PdfBrushes.Black);         // 21-6
        VisitPdfGrid.Rows[21].Cells[6].Value = value;
        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            // 21-9
        VisitPdfGrid.Rows[21].Cells[9].Value = value;
        value = new PdfTextElement(FillEmpty(Visita.RNFL_Os), fieldFont, PdfBrushes.Black);         // 21-10
        VisitPdfGrid.Rows[21].Cells[10].Value = value;


        VisitPdfGrid.Rows[22].Cells[0].Style = posCellStyleH;                                       // Terapia
        VisitPdfGrid.Rows[22].Cells[5].Style = posCellStyleS;                                       // vuoto
        VisitPdfGrid.Rows[22].Cells[6].Style = posCellStyleH;                                       // CV OD
        VisitPdfGrid.Rows[22].Cells[9].Style = posCellStyleS;                                       // vuoto
        VisitPdfGrid.Rows[22].Cells[10].Style = posCellStyleH;                                      // CV OS

        VisitPdfGrid.Rows[23].Cells[0].Style = posCellStyleV;
        VisitPdfGrid.Rows[23].Cells[5].Style = posCellStyleS;
        VisitPdfGrid.Rows[23].Cells[6].Style = posCellStyleV;
        VisitPdfGrid.Rows[23].Cells[9].Style = posCellStyleS;
        VisitPdfGrid.Rows[23].Cells[10].Style = posCellStyleV;

        value = new PdfTextElement("TERAPIA", fieldNameFont, PdfBrushes.Black);                     // 22-0
        VisitPdfGrid.Rows[22].Cells[0].Value = value;
        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            // 22-5
        VisitPdfGrid.Rows[22].Cells[5].Value = value;
        value = new PdfTextElement("CV OD", fieldNameFont, PdfBrushes.Black);                       // 22-6
        VisitPdfGrid.Rows[22].Cells[6].Value = value;
        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            // 22-9
        VisitPdfGrid.Rows[22].Cells[9].Value = value;
        value = new PdfTextElement("CV OS", fieldNameFont, PdfBrushes.Black);                       // 22-10
        VisitPdfGrid.Rows[22].Cells[10].Value = value;

        value = new PdfTextElement(FillEmpty(Visita.Terapia), fieldFont, PdfBrushes.Black);         // 23-0
        VisitPdfGrid.Rows[23].Cells[0].Value = value;
        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            // 23-5
        VisitPdfGrid.Rows[23].Cells[5].Value = value;
        value = new PdfTextElement(FillEmpty(Visita.CV_Od), fieldFont, PdfBrushes.Black);           // 23-6
        VisitPdfGrid.Rows[23].Cells[6].Value = value;
        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            // 23-9
        VisitPdfGrid.Rows[23].Cells[9].Value = value;
        value = new PdfTextElement(FillEmpty(Visita.CV_Os), fieldFont, PdfBrushes.Black);           // 23-10
        VisitPdfGrid.Rows[23].Cells[10].Value = value;


        VisitPdfGrid.Rows[24].Cells[0].Style = posCellStyleH;                                       // OD SUE LENTI PL
        VisitPdfGrid.Rows[24].Cells[1].Style = posCellStyleS;                                       // vuoto
        VisitPdfGrid.Rows[24].Cells[2].Style = posCellStyleH;                                       // OD SUE LENTI PV
        VisitPdfGrid.Rows[24].Cells[3].Style = posCellStyleS;                                       // vuoto
        VisitPdfGrid.Rows[24].Cells[4].Style = posCellStyleH;                                       // OD SUE LENTI MD
        VisitPdfGrid.Rows[24].Cells[5].Style = posCellStyleS;                                       // vuoto
        VisitPdfGrid.Rows[24].Cells[6].Style = posCellStyleH;                                       // PACHIMETRIA OD
        VisitPdfGrid.Rows[24].Cells[7].Style = posCellStyleS;                                       // vuoto
        VisitPdfGrid.Rows[24].Cells[8].Style = posCellStyleH;                                       // PACHIMETRIA OS
        VisitPdfGrid.Rows[24].Cells[9].Style = posCellStyleS;                                       // vuoto
        VisitPdfGrid.Rows[24].Cells[10].Style = posCellStyleH;                                      // C/D OD
        VisitPdfGrid.Rows[24].Cells[11].Style = posCellStyleS;                                      // vuoto
        VisitPdfGrid.Rows[24].Cells[12].Style = posCellStyleH;                                      // C/D OS

        VisitPdfGrid.Rows[25].Cells[0].Style = posCellStyleV;
        VisitPdfGrid.Rows[25].Cells[1].Style = posCellStyleS;
        VisitPdfGrid.Rows[25].Cells[2].Style = posCellStyleV;
        VisitPdfGrid.Rows[25].Cells[3].Style = posCellStyleS;
        VisitPdfGrid.Rows[25].Cells[4].Style = posCellStyleV;
        VisitPdfGrid.Rows[25].Cells[5].Style = posCellStyleS;
        VisitPdfGrid.Rows[25].Cells[6].Style = posCellStyleV;
        VisitPdfGrid.Rows[25].Cells[7].Style = posCellStyleS;
        VisitPdfGrid.Rows[25].Cells[8].Style = posCellStyleV;
        VisitPdfGrid.Rows[25].Cells[9].Style = posCellStyleS;
        VisitPdfGrid.Rows[25].Cells[10].Style = posCellStyleV;
        VisitPdfGrid.Rows[25].Cells[11].Style = posCellStyleS;
        VisitPdfGrid.Rows[25].Cells[12].Style = posCellStyleV;

        value = new PdfTextElement("OD SUE LENTI PL", fieldNameFont, PdfBrushes.Black);             // 24-0
        VisitPdfGrid.Rows[24].Cells[0].Value = value;
        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            // 24-1
        VisitPdfGrid.Rows[24].Cells[1].Value = value;
        value = new PdfTextElement("OD SUE LENTI PV", fieldNameFont, PdfBrushes.Black);             // 24-2
        VisitPdfGrid.Rows[24].Cells[2].Value = value;
        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            // 24-3
        VisitPdfGrid.Rows[24].Cells[3].Value = value;
        value = new PdfTextElement("OD SUE LENTI MD", fieldNameFont, PdfBrushes.Black);             // 24-4
        VisitPdfGrid.Rows[24].Cells[4].Value = value;
        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            // 24-5
        VisitPdfGrid.Rows[24].Cells[5].Value = value;
        value = new PdfTextElement("PACHIMETRIA OD", fieldNameFont, PdfBrushes.Black);              // 24-6
        VisitPdfGrid.Rows[24].Cells[6].Value = value;
        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            // 24-7
        VisitPdfGrid.Rows[24].Cells[7].Value = value;
        value = new PdfTextElement("PACHIMETRIA OS", fieldNameFont, PdfBrushes.Black);              // 24-8
        VisitPdfGrid.Rows[24].Cells[8].Value = value;
        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            // 24-9
        VisitPdfGrid.Rows[24].Cells[9].Value = value;
        value = new PdfTextElement("C/D OD", fieldNameFont, PdfBrushes.Black);                      // 24-10
        VisitPdfGrid.Rows[24].Cells[10].Value = value;
        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            // 24-11
        VisitPdfGrid.Rows[24].Cells[11].Value = value;
        value = new PdfTextElement("C/D OS", fieldNameFont, PdfBrushes.Black);                      // 24-12
        VisitPdfGrid.Rows[24].Cells[12].Value = value;

        value = new PdfTextElement(FillEmpty(Visita.ODPL), fieldFont, PdfBrushes.Black);            // 25-0
        VisitPdfGrid.Rows[25].Cells[0].Value = value;
        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            // 25-9
        VisitPdfGrid.Rows[25].Cells[1].Value = value;
        value = new PdfTextElement(FillEmpty(Visita.ODPV), fieldFont, PdfBrushes.Black);            // 25-2
        VisitPdfGrid.Rows[25].Cells[2].Value = value;
        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            // 25-9
        VisitPdfGrid.Rows[25].Cells[3].Value = value;
        value = new PdfTextElement(FillEmpty(Visita.ODMD), fieldFont, PdfBrushes.Black);            // 25-4
        VisitPdfGrid.Rows[25].Cells[4].Value = value;
        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            // 25-9
        VisitPdfGrid.Rows[25].Cells[5].Value = value;
        value = new PdfTextElement(FillEmpty(Visita.PACH_Od), fieldFont, PdfBrushes.Black);         // 25-6
        VisitPdfGrid.Rows[25].Cells[6].Value = value;
        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            // 25-9
        VisitPdfGrid.Rows[25].Cells[7].Value = value;
        value = new PdfTextElement(FillEmpty(Visita.PACH_Os), fieldFont, PdfBrushes.Black);         // 25-8
        VisitPdfGrid.Rows[25].Cells[8].Value = value;
        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            // 25-9
        VisitPdfGrid.Rows[25].Cells[9].Value = value;
        value = new PdfTextElement(FillEmpty(Visita.CD_Od), fieldFont, PdfBrushes.Black);           // 25-10
        VisitPdfGrid.Rows[25].Cells[10].Value = value;
        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            // 25-9
        VisitPdfGrid.Rows[25].Cells[11].Value = value;
        value = new PdfTextElement(FillEmpty(Visita.CD_Os), fieldFont, PdfBrushes.Black);           // 25-12
        VisitPdfGrid.Rows[25].Cells[12].Value = value;


        VisitPdfGrid.Rows[26].Cells[0].Style = posCellStyleH;                                       // OS SUE LENTI PL
        VisitPdfGrid.Rows[26].Cells[1].Style = posCellStyleS;                                       // vuoto
        VisitPdfGrid.Rows[26].Cells[2].Style = posCellStyleH;                                       // OS SUE LENTI PV
        VisitPdfGrid.Rows[26].Cells[3].Style = posCellStyleS;                                       // vuoto
        VisitPdfGrid.Rows[26].Cells[4].Style = posCellStyleH;                                       // OS SUE LENTI MD
        VisitPdfGrid.Rows[26].Cells[5].Style = posCellStyleS;                                       // vuoto
        VisitPdfGrid.Rows[26].Cells[6].Style = posCellStyleH;                                       // AUTOREFRATTOMETRIA

        VisitPdfGrid.Rows[27].Cells[0].Style = posCellStyleV;
        VisitPdfGrid.Rows[27].Cells[1].Style = posCellStyleS;
        VisitPdfGrid.Rows[27].Cells[2].Style = posCellStyleV;
        VisitPdfGrid.Rows[27].Cells[3].Style = posCellStyleS;
        VisitPdfGrid.Rows[27].Cells[4].Style = posCellStyleV;
        VisitPdfGrid.Rows[27].Cells[5].Style = posCellStyleS;
        VisitPdfGrid.Rows[27].Cells[6].Style = posCellStyleV;

        value = new PdfTextElement("OS SUE LENTI PL", fieldNameFont, PdfBrushes.Black);             // 26-0
        VisitPdfGrid.Rows[26].Cells[0].Value = value;
        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            // 26-1
        VisitPdfGrid.Rows[26].Cells[1].Value = value;
        value = new PdfTextElement("OS SUE LENTI PV", fieldNameFont, PdfBrushes.Black);             // 26-2
        VisitPdfGrid.Rows[26].Cells[2].Value = value;
        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            // 26-3
        VisitPdfGrid.Rows[26].Cells[3].Value = value;
        value = new PdfTextElement("OS SUE LENTI MD", fieldNameFont, PdfBrushes.Black);             // 26-4
        VisitPdfGrid.Rows[26].Cells[4].Value = value;
        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            // 26-5
        VisitPdfGrid.Rows[26].Cells[5].Value = value;
        value = new PdfTextElement("AUTOREFRATTOMETRIA", fieldNameFont, PdfBrushes.Black);          // 26-6
        VisitPdfGrid.Rows[26].Cells[6].Value = value;

        value = new PdfTextElement(FillEmpty(Visita.OSPL), fieldFont, PdfBrushes.Black);            // 27-0
        VisitPdfGrid.Rows[27].Cells[0].Value = value;
        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            // 27-1
        VisitPdfGrid.Rows[27].Cells[1].Value = value;
        value = new PdfTextElement(FillEmpty(Visita.OSPV), fieldFont, PdfBrushes.Black);            // 27-2
        VisitPdfGrid.Rows[27].Cells[2].Value = value;
        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            // 27-3
        VisitPdfGrid.Rows[27].Cells[3].Value = value;
        value = new PdfTextElement(FillEmpty(Visita.OSMD), fieldFont, PdfBrushes.Black);            // 27-4
        VisitPdfGrid.Rows[27].Cells[4].Value = value;
        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            // 27-5
        VisitPdfGrid.Rows[27].Cells[5].Value = value;
        value = new PdfTextElement(FillEmpty(Visita.Auto), fieldFont, PdfBrushes.Black);            // 27-6
        VisitPdfGrid.Rows[27].Cells[6].Value = value;


        VisitPdfGrid.Rows[28].Cells[0].Style = posCellStyleH;                                       // MOTIVO VISITA
        VisitPdfGrid.Rows[28].Cells[5].Style = posCellStyleS;                                       // vuoto
        VisitPdfGrid.Rows[28].Cells[6].Style = posCellStyleH;                                       // CONCLUSIONI

        VisitPdfGrid.Rows[29].Cells[0].Style = posCellStyleV;
        VisitPdfGrid.Rows[29].Cells[5].Style = posCellStyleS;
        VisitPdfGrid.Rows[29].Cells[6].Style = posCellStyleV;

        value = new PdfTextElement("MOTIVO VISITA", fieldNameFont, PdfBrushes.Black);               // 28-0
        VisitPdfGrid.Rows[28].Cells[0].Value = value;
        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            // 28-5
        VisitPdfGrid.Rows[28].Cells[5].Value = value;
        value = new PdfTextElement("CONCLUSIONI", fieldNameFont, PdfBrushes.Black);                 // 28-6
        VisitPdfGrid.Rows[28].Cells[6].Value = value;

        value = new PdfTextElement(FillEmpty(Visita.MotivoVisita), fieldFont, PdfBrushes.Black);    // 29-6
        VisitPdfGrid.Rows[29].Cells[0].Value = value;
        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            // 29-5
        VisitPdfGrid.Rows[29].Cells[5].Value = value;
        value = new PdfTextElement(FillEmpty(Visita.Conclusioni), fieldFont, PdfBrushes.Black);     // 29-6
        VisitPdfGrid.Rows[29].Cells[6].Value = value;


        VisitPdfGrid.Rows[30].Cells[0].Style = posCellStyleH;                                       // NOTE

        VisitPdfGrid.Rows[31].Cells[0].Style = posCellStyleV;

        value = new PdfTextElement("NOTE", fieldNameFont, PdfBrushes.Black);                        // 15-0
        VisitPdfGrid.Rows[30].Cells[0].Value = value;

        value = new PdfTextElement(FillEmpty(Visita.Note), fieldFont, PdfBrushes.Black);            // 31-0
        VisitPdfGrid.Rows[31].Cells[0].Value = value;
        #endregion

        // Draw PDF grid into the PDF page.
        VisitPdfGrid.Draw(page, new Syncfusion.Drawing.PointF(0, result.Bounds.Bottom + paragraphAfterSpacing));
        #endregion

        //Create memory stream.
        MemoryStream memoryStream = new MemoryStream();
        //Save the PDF document.
        pdfDocument.Save(memoryStream);
        //Download the PDF document
        await JS.SaveAs("Scheda " + LName + " " + FName + "_" + ListaVisite[VisitaCorrente].Val.ToString("dd.MM.yyyy") + ".pdf", memoryStream.ToArray());
    }

    async void PrintOrtottica(string who)
    {
        int paragraphAfterSpacing = 8;
        // int cellMargin = 8;

        string doctor = "";
        string specialization = "";
        string address = "V.le R. Sanzio, 60 Tel 095 371701";
        string city = "CATANIA";
        string codfisc = "";
        string piva = "";
        string ordine = "";

        string iscrOrdine = "";

        if (who == "1")
        {
            doctor = "MARCO LA BRUNA";
            specialization = "Specialista in Oftalmologia";
            codfisc = "Cod. Fisc. LBR MRC 84M31 C351P";
            piva = "Partita IVA 05289740879";
            ordine = "Ordine dei Medici CT n° 14037";

            iscrOrdine = "Iscriz. Ord. Dei Medici di CT - Marco La Bruna n° 14037";
        }
        else
        {
            doctor = "PIETRO LA BRUNA";
            specialization = "Specialista in Oculistica";
            codfisc = "Cod. Fisc. LBR PTR 49T07 H221S";
            piva = "Partita IVA 00635170871";
            // ordine = "Ordine dei Medici CT n° 5133";

            iscrOrdine = "Iscriz. Ord. Dei Medici di CT - Pietro La Bruna n° 5133";
        }

        FirstPage = true;

        //Create a new PDF document.
        PdfDocument pdfDocument = new PdfDocument();

        // Add the event.
        // ------------------------------------------------------------------------------------------------------------------------
        pdfDocument.Pages.PageAdded += Pages_PageAdded;
        // ------------------------------------------------------------------------------------------------------------------------

        #region Definizione documento pdf
        // Set document information
        // ------------------------------------------------------------------------------------------------------------------------
        pdfDocument.DocumentInformation.Author = "Powered by Phoenix";
        pdfDocument.DocumentInformation.CreationDate = DateTime.Now;
        pdfDocument.DocumentInformation.Creator = "Ophthal";
        pdfDocument.DocumentInformation.Keywords = "Dott. La Bruna";
        pdfDocument.DocumentInformation.Subject = "Scheda Ortottica";
        pdfDocument.DocumentInformation.Title = "Scheda Ortottica " + LName + " " + FName + "_" + pDataOrtottica.Substring(0, 2) + "." + pDataOrtottica.Substring(2, 2) + "." + pDataOrtottica.Substring(4, 4);

        // Set page size
        // ------------------------------------------------------------------------------------------------------------------------
        pdfDocument.PageSettings.Size = Syncfusion.Pdf.PdfPageSize.A4;

        // Set margin for all the pages
        pdfDocument.PageSettings.Margins.Left = 20F;
        pdfDocument.PageSettings.Margins.Right = 30F;
        pdfDocument.PageSettings.Margins.Top = 20F;
        pdfDocument.PageSettings.Margins.Bottom = 50F;

        // pdfDocument.PageSettings.Margins.All = 40F;

        // Set page orientation
        // ------------------------------------------------------------------------------------------------------------------------
        pdfDocument.PageSettings.Orientation = PdfPageOrientation.Portrait;

        // Set paginate layout
        // ------------------------------------------------------------------------------------------------------------------------
        PdfLayoutFormat format = new PdfLayoutFormat();
        format.Layout = PdfLayoutType.Paginate;

        // Add page to the PDF document
        PdfPage page = pdfDocument.Pages.Add();

        // Obtain PdfGraphics object.
        PdfGraphics g = page.Graphics;
        #endregion

        #region Header & Footer
        // Create Header and Footer font
        // ------------------------------------------------------------------------------------------------------------------------
        PdfFont fontHeader = new PdfStandardFont(PdfFontFamily.Helvetica, 14, PdfFontStyle.Regular);
        PdfFont fontFooter = new PdfStandardFont(PdfFontFamily.Helvetica, 7, PdfFontStyle.Regular);

        #region Header
        // Get document's bounds
        // ------------------------------------------------------------------------------------------------------------------------
        RectangleF bounds = new RectangleF(0, 0, pdfDocument.Pages[0].GetClientSize().Width, 70);

        // Create a Page template that can be used as header.
        // ------------------------------------------------------------------------------------------------------------------------
        PdfPageTemplateElement header = new PdfPageTemplateElement(bounds);

        // Load image for header
        // Scarica l'immagine dal server
        var httpClient = new HttpClient();
        string imageUrl = $"{Env.BaseAddress}/img/LB_99_53.png";                      // URL dell'immagine
        var imageBytes = await httpClient.GetByteArrayAsync(imageUrl);

        PdfGridCellStyle HeadLogoStyle = new PdfGridCellStyle();
        HeadLogoStyle.Borders.Left.Width = 0F;
        HeadLogoStyle.Borders.Right.Width = 0F;
        HeadLogoStyle.Borders.Top.Width = 0F;
        HeadLogoStyle.Borders.Bottom.Width = 0F;
        HeadLogoStyle.CellPadding = new PdfPaddings(0, 0, 0, 0);

        // Setup font for Dati Testata
        PdfStandardFont SideFont = new PdfStandardFont(PdfFontFamily.TimesRoman, 10, PdfFontStyle.Bold | PdfFontStyle.Italic);
        PdfStandardFont hHeadFont = new PdfStandardFont(PdfFontFamily.TimesRoman, 16, PdfFontStyle.Bold | PdfFontStyle.Italic);

        PdfStandardFont PdPFont = new PdfStandardFont(PdfFontFamily.TimesRoman, 8, PdfFontStyle.Bold);
        PdfStandardFont FootFont = new PdfStandardFont(PdfFontFamily.TimesRoman, 9, PdfFontStyle.Bold | PdfFontStyle.Italic);

        // Specify the style for bottom
        PdfGridCellStyle HeadStyle = new PdfGridCellStyle();
        HeadStyle.Borders.Left.Width = 0F;
        HeadStyle.Borders.Right.Width = 0F;
        HeadStyle.Borders.Top.Width = 0F;
        HeadStyle.Borders.Bottom.Width = 0F;
        HeadStyle.CellPadding = new PdfPaddings(15, 10, 0, 0);
        HeadStyle.StringFormat = new PdfStringFormat(PdfTextAlignment.Center);

        // Usa un MemoryStream per creare il PdfBitmap
        using (MemoryStream imageStream = new MemoryStream(imageBytes))
        {
            PdfBitmap image = new PdfBitmap(imageStream);

            // Draw the image in the header.
            header.Graphics.DrawImage(image, 5, 15);
        }

        header.Graphics.DrawString("DOTT. " + doctor, hHeadFont, PdfBrushes.Black, 100, 14);
        header.Graphics.DrawString(specialization, hHeadFont, PdfBrushes.Black, 100, 36);

        PdfPen hPen = new PdfPen(Color.Black);
        hPen.Width = 0.1F;

        PointF hP1 = new PointF();
        PointF hP2 = new PointF();

        // linea verticale
        hP1.X = 85;
        hP1.Y = 0;

        hP2.X = 85;
        hP2.Y = 70;

        header.Graphics.DrawLine(hPen, hP1, hP2);

        // top linea orizzontale
        hP1.X = 0;
        hP1.Y = 70;

        hP2.X = 545;
        hP2.Y = 70;

        header.Graphics.DrawLine(hPen, hP1, hP2);

        // Add the header at the top.
        pdfDocument.Template.Top = header;
        #endregion

        #region Footer
        // Set document's bounds
        // ------------------------------------------------------------------------------------------------------------------------
        RectangleF fBounds = new RectangleF(0, 0, pdfDocument.Pages[0].GetClientSize().Width, 70);

        // Create a Page template that can be used as footer.
        // ------------------------------------------------------------------------------------------------------------------------
        PdfPageTemplateElement footer = new PdfPageTemplateElement(fBounds);

        PdfBrush brush = new PdfSolidBrush(Color.Black);

        // Create page number field.
        PdfPageNumberField pageNumber = new PdfPageNumberField(fontFooter, brush);

        // Create page count field.
        PdfPageCountField count = new PdfPageCountField(fontFooter, brush);

        // Add the fields in composite fields.
        PdfCompositeField compositeField = new PdfCompositeField(fontFooter, brush, "Pag. {0} di {1}", pageNumber, count);

        compositeField.Bounds = footer.Bounds;

        Console.WriteLine($"pageNumber: {pageNumber}, count: {count}");

        // Draw the composite field in footer.
        compositeField.Draw(footer.Graphics, new PointF(20, 28));

        footer.Graphics.DrawString("Viale Raffaello Sanzio, 60 – scala C, 5° piano – (Piazza Michelangelo) - 95128 Catania (CT)", FootFont, PdfBrushes.Black, 151, 8);
        footer.Graphics.DrawString("Riceve per appuntamento – Tel/Fax: 095371701", FootFont, PdfBrushes.Black, 230, 22);
        footer.Graphics.DrawString("Sito Web: http://www.studiolabruna.it – email: info@studiolabruna.it", FootFont, PdfBrushes.Black, 190, 36);
        footer.Graphics.DrawString(iscrOrdine, FootFont, PdfBrushes.Black, 212, 50);

        PdfPen fPen = new PdfPen(Color.Black);
        fPen.Width = 0.1F;

        PointF fP1 = new PointF();
        PointF fP2 = new PointF();

        // linea verticale
        fP1.X = 85;
        fP1.Y = 0;

        fP2.X = 85;
        fP2.Y = 70;

        footer.Graphics.DrawLine(fPen, fP1, fP2);

        // bottom linea orizzontale
        fP1.X = 0;
        fP1.Y = 0;

        fP2.X = 545;
        fP2.Y = 0;

        footer.Graphics.DrawLine(fPen, fP1, fP2);

        // Add the footer template at the bottom.
        pdfDocument.Template.Bottom = footer;
        #endregion
        #endregion

        #region Prima parte: Dati Testata
        PdfFont fieldPaziente = new PdfStandardFont(PdfFontFamily.Helvetica, 14, PdfFontStyle.Bold | PdfFontStyle.Italic);
        PdfFont fieldHelvBold = new PdfStandardFont(PdfFontFamily.Helvetica, 12, PdfFontStyle.Bold | PdfFontStyle.Italic);
        PdfFont FieldRegFont = new PdfStandardFont(PdfFontFamily.Helvetica, 10, PdfFontStyle.Regular);
        PdfFont FieldItaBldFont = new PdfStandardFont(PdfFontFamily.Helvetica, 10, PdfFontStyle.Bold | PdfFontStyle.Italic);

        #region Imposta griglia Dati Testata
        // Create the head grid
        PdfGrid HeadPdfGrid = new PdfGrid();

        PdfGridCellStyle HeadFieldStyle = new PdfGridCellStyle();
        HeadFieldStyle.Borders.Left.Width = 0F;
        HeadFieldStyle.Borders.Right.Width = 0F;
        HeadFieldStyle.Borders.Top.Width = 0F;
        HeadFieldStyle.Borders.Bottom.Width = 0F;
        HeadFieldStyle.CellPadding = new PdfPaddings(0, 0, 4, 0);

        PdfGridCellStyle posCellStyleP0 = new PdfGridCellStyle();
        posCellStyleP0.Borders.Left.Width = 0;
        posCellStyleP0.Borders.Right.Width = 0;
        posCellStyleP0.Borders.Top.Width = 0;
        posCellStyleP0.Borders.Bottom.Width = 0;
        posCellStyleP0.CellPadding = new PdfPaddings(0, 3, 6, 0);

        PdfGridCellStyle posCellStyleP1 = new PdfGridCellStyle();
        posCellStyleP1.Borders.Left.Width = 0;
        posCellStyleP1.Borders.Right.Width = 0;
        posCellStyleP1.Borders.Top.Width = 0;
        posCellStyleP1.Borders.Bottom.Width = 0;
        posCellStyleP1.CellPadding = new PdfPaddings(0, 3, 12, 0);


        // Add the rows to head grid
        PdfGridRow row0 = HeadPdfGrid.Rows.Add();
        PdfGridRow row1 = HeadPdfGrid.Rows.Add();
        PdfGridRow row2 = HeadPdfGrid.Rows.Add();

        // Set rows's height
        row0.Height = 18;

        //Adding grid style
        PdfGridStyle gridStyle = new PdfGridStyle();

        //Allow grid to overflow horizontally
        gridStyle.AllowHorizontalOverflow = true;

        //Adding cell spacing between cells
        gridStyle.CellSpacing = 0F;

        HeadPdfGrid.Style = gridStyle;

        // Add the columns to head grid
        HeadPdfGrid.Columns.Add(3);

        // Set columns's width
        HeadPdfGrid.Columns[0].Width = 300;
        HeadPdfGrid.Columns[1].Width = 36;
        HeadPdfGrid.Columns[2].Width = 94;

        // Set columns merged
        HeadPdfGrid.Rows[1].Cells[0].ColumnSpan = 3;
        HeadPdfGrid.Rows[2].Cells[0].ColumnSpan = 3;
        #endregion

        #region Inserimento Dati Testata
        // Set the HeadPdfGrid's value
        PdfTextElement val;

        HeadPdfGrid.Rows[0].Cells[0].Style = HeadFieldStyle;
        HeadPdfGrid.Rows[0].Cells[1].Style = HeadFieldStyle;
        HeadPdfGrid.Rows[0].Cells[2].Style = HeadFieldStyle;

        val = new PdfTextElement(" ", fieldPaziente, PdfBrushes.Black);                     // 0 - 0
        HeadPdfGrid.Rows[0].Cells[0].Value = val;

        val = new PdfTextElement("Data.", FieldItaBldFont, PdfBrushes.Black);               // 0 - 1
        HeadPdfGrid.Rows[0].Cells[1].Value = val;

        var TmpDate = pDataOrtottica.Substring(0, 2) + "/" + pDataOrtottica.Substring(2, 2) + "/" + pDataOrtottica.Substring(4, 4);
        val = new PdfTextElement(TmpDate, FieldRegFont, PdfBrushes.Black);                  // 0 - 2
        HeadPdfGrid.Rows[0].Cells[2].Value = val;

        HeadPdfGrid.Rows[1].Cells[0].Style = posCellStyleP0;

        val = new PdfTextElement(LName + " " + FName, fieldPaziente, PdfBrushes.Black);     // 1 - 0
        HeadPdfGrid.Rows[1].Cells[0].Value = val;

        HeadPdfGrid.Rows[2].Cells[0].Style = posCellStyleP1;

        val = new PdfTextElement("Visita Ortottica", fieldHelvBold, PdfBrushes.Black);      // 2 - 0
        HeadPdfGrid.Rows[2].Cells[0].Value = val;

        PdfLayoutResult result = HeadPdfGrid.Draw(page, new Syncfusion.Drawing.PointF(100, 80));
        Console.WriteLine($"📌 Ortottica - Testata ");
        Console.WriteLine($"🔷\t pDataOrtottica: {pDataOrtottica}\t TmpDate: {TmpDate}");
        Console.WriteLine($"🔷\t X: {100}\t Y: {80}");
        Console.WriteLine($"🔷\t result.Bounds.X: {result.Bounds.X}\t result.Bounds.Bottom: {result.Bounds.Bottom}");
        Console.WriteLine($"🔷\t result.Bounds.X: {result.Bounds.X}\t result.Bounds.Y: {result.Bounds.Y}");
        Console.WriteLine($" ");
        #endregion
        #endregion

        #region Seconda parte: Dati Visita Ortottica
        // Create field's name and field's font
        // ------------------------------------------------------------------------------------------------------------------------
        PdfFont fieldNameFont = new PdfStandardFont(PdfFontFamily.TimesRoman, 11, PdfFontStyle.Bold);
        PdfFont fieldFont = new PdfStandardFont(PdfFontFamily.Helvetica, 10, PdfFontStyle.Regular);

        PdfFont fieldDateFont = new PdfStandardFont(PdfFontFamily.Helvetica, 11, PdfFontStyle.Bold);
        PdfFont fieldValueFont = new PdfStandardFont(PdfFontFamily.Helvetica, 11, PdfFontStyle.Regular);

        PdfFont italicdFont = new PdfStandardFont(PdfFontFamily.Helvetica, 10, PdfFontStyle.Italic);

        #region Definizione stile celle Visita
        // Specify the style for head's cell
        PdfGridCellStyle posCellStyleEH = new PdfGridCellStyle();
        posCellStyleEH.Borders.Left.Width = 0F;
        posCellStyleEH.Borders.Right.Width = 0F;
        posCellStyleEH.Borders.Top.Width = 0F;
        posCellStyleEH.Borders.Bottom.Width = 0F;
        posCellStyleEH.CellPadding = new PdfPaddings(0, 0, 0, 0);

        // Specify the style for head's cell
        PdfGridCellStyle posCellStyleH = new PdfGridCellStyle();
        posCellStyleH.Borders.Left.Width = 0F;
        posCellStyleH.Borders.Right.Width = 0F;
        posCellStyleH.Borders.Top.Width = 0F;
        posCellStyleH.Borders.Bottom.Width = 0F;
        posCellStyleH.CellPadding = new PdfPaddings(0, 3, 6, 6);

        // Specify the style for value's cell
        PdfGridCellStyle posCellStyleV = new PdfGridCellStyle();
        posCellStyleV.Borders.Left.Width = 0F;
        posCellStyleV.Borders.Right.Width = 0F;
        posCellStyleV.Borders.Top.Width = 0F;
        posCellStyleV.Borders.Bottom.Width = 0F;
        posCellStyleV.CellPadding = new PdfPaddings(3, 3, 6, 6);
        #endregion

        #region Imposta griglia Dati Visita
        // Create Grid
        PdfGrid VisitPdfGrid = new PdfGrid();

        // Add Rows
        PdfGridRow rowV01 = VisitPdfGrid.Rows.Add();
        PdfGridRow rowV02 = VisitPdfGrid.Rows.Add();
        PdfGridRow rowV03 = VisitPdfGrid.Rows.Add();
        PdfGridRow rowV04 = VisitPdfGrid.Rows.Add();
        PdfGridRow rowV05 = VisitPdfGrid.Rows.Add();
        PdfGridRow rowV06 = VisitPdfGrid.Rows.Add();
        PdfGridRow rowV07 = VisitPdfGrid.Rows.Add();
        PdfGridRow rowV08 = VisitPdfGrid.Rows.Add();
        PdfGridRow rowV09 = VisitPdfGrid.Rows.Add();
        PdfGridRow rowV10 = VisitPdfGrid.Rows.Add();
        PdfGridRow rowV11 = VisitPdfGrid.Rows.Add();
        PdfGridRow rowV12 = VisitPdfGrid.Rows.Add();
        PdfGridRow rowV13 = VisitPdfGrid.Rows.Add();

        // Add Columns
        VisitPdfGrid.Columns.Add(3);

        // Set Columns's width
        VisitPdfGrid.Columns[0].Width = 100;
        VisitPdfGrid.Columns[1].Width = 110;
        VisitPdfGrid.Columns[2].Width = 320;
        #endregion

        #region Inserimento Dati Visita Ortottica
        // Set the HeadPdfGrid's value
        PdfTextElement value;

        VisitPdfGrid.Rows[0].Cells[0].Style = posCellStyleEH;                                       // Cella vuota
        VisitPdfGrid.Rows[0].Cells[1].Style = posCellStyleH;                                        // Posizione Primaria
        VisitPdfGrid.Rows[0].Cells[2].Style = posCellStyleV;

        VisitPdfGrid.Rows[1].Cells[0].Style = posCellStyleEH;                                       // Cella vuota
        VisitPdfGrid.Rows[1].Cells[1].Style = posCellStyleH;                                        // Motilità Attiva
        VisitPdfGrid.Rows[1].Cells[2].Style = posCellStyleV;

        VisitPdfGrid.Rows[2].Cells[0].Style = posCellStyleEH;                                       // Cella vuota
        VisitPdfGrid.Rows[2].Cells[1].Style = posCellStyleH;                                        // Convergenza
        VisitPdfGrid.Rows[2].Cells[2].Style = posCellStyleV;

        VisitPdfGrid.Rows[3].Cells[0].Style = posCellStyleEH;                                       // Cella vuota
        VisitPdfGrid.Rows[3].Cells[1].Style = posCellStyleH;                                        // Cover Test
        VisitPdfGrid.Rows[3].Cells[2].Style = posCellStyleV;

        VisitPdfGrid.Rows[4].Cells[0].Style = posCellStyleEH;                                       // Cella vuota
        VisitPdfGrid.Rows[4].Cells[1].Style = posCellStyleH;                                        // Prisma Cover Test
        VisitPdfGrid.Rows[4].Cells[2].Style = posCellStyleV;

        VisitPdfGrid.Rows[5].Cells[0].Style = posCellStyleEH;                                       // Cella vuota
        VisitPdfGrid.Rows[5].Cells[1].Style = posCellStyleH;                                        // Ampiezza Fusiva
        VisitPdfGrid.Rows[5].Cells[2].Style = posCellStyleV;

        VisitPdfGrid.Rows[6].Cells[0].Style = posCellStyleEH;                                       // Cella vuota
        VisitPdfGrid.Rows[6].Cells[1].Style = posCellStyleH;                                        // Vetro Rosso
        VisitPdfGrid.Rows[6].Cells[2].Style = posCellStyleV;

        VisitPdfGrid.Rows[7].Cells[0].Style = posCellStyleEH;                                       // Cella vuota
        VisitPdfGrid.Rows[7].Cells[1].Style = posCellStyleH;                                        // Lang Test
        VisitPdfGrid.Rows[7].Cells[2].Style = posCellStyleV;

        VisitPdfGrid.Rows[8].Cells[0].Style = posCellStyleEH;                                       // Cella vuota
        VisitPdfGrid.Rows[8].Cells[1].Style = posCellStyleH;                                        // Titmus Test
        VisitPdfGrid.Rows[8].Cells[2].Style = posCellStyleV;

        VisitPdfGrid.Rows[9].Cells[0].Style = posCellStyleEH;                                       // Cella vuota
        VisitPdfGrid.Rows[9].Cells[1].Style = posCellStyleH;                                        // Altri test per la visione binoculare
        VisitPdfGrid.Rows[9].Cells[2].Style = posCellStyleV;

        VisitPdfGrid.Rows[10].Cells[0].Style = posCellStyleEH;                                      // Cella vuota
        VisitPdfGrid.Rows[10].Cells[1].Style = posCellStyleH;                                       // Conclusioni
        VisitPdfGrid.Rows[10].Cells[2].Style = posCellStyleV;

        VisitPdfGrid.Rows[11].Cells[0].Style = posCellStyleEH;                                      // Cella vuota
        VisitPdfGrid.Rows[11].Cells[1].Style = posCellStyleH;                                       // Diagnosi
        VisitPdfGrid.Rows[11].Cells[2].Style = posCellStyleV;

        VisitPdfGrid.Rows[12].Cells[0].Style = posCellStyleEH;                                      // Cella vuota
        VisitPdfGrid.Rows[12].Cells[1].Style = posCellStyleH;                                       // Terapia
        VisitPdfGrid.Rows[12].Cells[2].Style = posCellStyleV;

        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            //  0 - 0
        VisitPdfGrid.Rows[0].Cells[0].Value = value;
        value = new PdfTextElement("Posizione Primaria:", fieldNameFont, PdfBrushes.Black);         //  0 - 1
        VisitPdfGrid.Rows[0].Cells[1].Value = value;
        value = new PdfTextElement(FillEmpty(Ortoctis.Posizione), fieldFont, PdfBrushes.Black);     //  0 - 2
        VisitPdfGrid.Rows[0].Cells[2].Value = value;

        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            //  1 - 0
        VisitPdfGrid.Rows[1].Cells[0].Value = value;
        value = new PdfTextElement("Motilità Attiva:", fieldNameFont, PdfBrushes.Black);            //  1 - 1
        VisitPdfGrid.Rows[1].Cells[1].Value = value;
        value = new PdfTextElement(FillEmpty(Ortoctis.Motilita), fieldFont, PdfBrushes.Black);      //  1 - 2
        VisitPdfGrid.Rows[1].Cells[2].Value = value;

        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            //  2 - 0
        VisitPdfGrid.Rows[2].Cells[0].Value = value;
        value = new PdfTextElement("Convergenza:", fieldNameFont, PdfBrushes.Black);                //  2 - 1
        VisitPdfGrid.Rows[2].Cells[1].Value = value;
        value = new PdfTextElement(FillEmpty(Ortoctis.Convergenza), fieldFont, PdfBrushes.Black);   //  2 - 2
        VisitPdfGrid.Rows[2].Cells[2].Value = value;

        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            //  3 - 0
        VisitPdfGrid.Rows[3].Cells[0].Value = value;
        value = new PdfTextElement("Cover Test:", fieldNameFont, PdfBrushes.Black);                 //  3 - 1
        VisitPdfGrid.Rows[3].Cells[1].Value = value;
        value = new PdfTextElement(FillEmpty(Ortoctis.Cover), fieldFont, PdfBrushes.Black);         //  3 - 2
        VisitPdfGrid.Rows[3].Cells[2].Value = value;

        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            //  4 - 0
        VisitPdfGrid.Rows[4].Cells[0].Value = value;
        value = new PdfTextElement("Prisma Cover Test:", fieldNameFont, PdfBrushes.Black);          //  4 - 1
        VisitPdfGrid.Rows[4].Cells[1].Value = value;
        value = new PdfTextElement(FillEmpty(Ortoctis.PrismaCover), fieldFont, PdfBrushes.Black);   //  4 - 2
        VisitPdfGrid.Rows[4].Cells[2].Value = value;

        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            //  5 - 0
        VisitPdfGrid.Rows[5].Cells[0].Value = value;
        value = new PdfTextElement("Ampiezza Fusiva:", fieldNameFont, PdfBrushes.Black);            //  5 - 1
        VisitPdfGrid.Rows[5].Cells[1].Value = value;
        value = new PdfTextElement(FillEmpty(Ortoctis.Ampiezza), fieldFont, PdfBrushes.Black);      //  5 - 2
        VisitPdfGrid.Rows[5].Cells[2].Value = value;

        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            //  6 - 0
        VisitPdfGrid.Rows[6].Cells[0].Value = value;
        value = new PdfTextElement("Vetro Rosso:", fieldNameFont, PdfBrushes.Black);                //  6 - 1
        VisitPdfGrid.Rows[6].Cells[1].Value = value;
        value = new PdfTextElement(FillEmpty(Ortoctis.Vetro), fieldFont, PdfBrushes.Black);         //  6 - 2
        VisitPdfGrid.Rows[6].Cells[2].Value = value;

        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            //  7 - 0
        VisitPdfGrid.Rows[7].Cells[0].Value = value;
        value = new PdfTextElement("Lang Test:", fieldNameFont, PdfBrushes.Black);                  //  7 - 1
        VisitPdfGrid.Rows[7].Cells[1].Value = value;
        value = new PdfTextElement(FillEmpty(Ortoctis.Lang), fieldFont, PdfBrushes.Black);          //  7 - 2
        VisitPdfGrid.Rows[7].Cells[2].Value = value;

        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            //  8 - 0
        VisitPdfGrid.Rows[8].Cells[0].Value = value;
        value = new PdfTextElement("Titmus Test:", fieldNameFont, PdfBrushes.Black);                //  8 - 1
        VisitPdfGrid.Rows[8].Cells[1].Value = value;
        value = new PdfTextElement(FillEmpty(Ortoctis.Titmus), fieldFont, PdfBrushes.Black);        //  8 - 2
        VisitPdfGrid.Rows[8].Cells[2].Value = value;

        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            //  9 - 0
        VisitPdfGrid.Rows[9].Cells[0].Value = value;
        value = new PdfTextElement("Altri test per la visione binoculare:", fieldNameFont, PdfBrushes.Black);                // 9-1
        VisitPdfGrid.Rows[9].Cells[1].Value = value;
        value = new PdfTextElement(FillEmpty(Ortoctis.AltriTest), fieldFont, PdfBrushes.Black);     //  9 - 2
        VisitPdfGrid.Rows[9].Cells[2].Value = value;

        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            // 10 - 0
        VisitPdfGrid.Rows[10].Cells[0].Value = value;
        value = new PdfTextElement("Conclusioni:", fieldNameFont, PdfBrushes.Black);                // 10 - 1
        VisitPdfGrid.Rows[10].Cells[1].Value = value;
        value = new PdfTextElement(FillEmpty(Ortoctis.Conclusioni), fieldFont, PdfBrushes.Black);   // 10 - 2
        VisitPdfGrid.Rows[10].Cells[2].Value = value;

        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            // 11 - 0
        VisitPdfGrid.Rows[11].Cells[0].Value = value;
        value = new PdfTextElement("Diagnosi:", fieldNameFont, PdfBrushes.Black);                   // 11 - 1
        VisitPdfGrid.Rows[11].Cells[1].Value = value;
        value = new PdfTextElement(FillEmpty(Ortoctis.Diagnosi), fieldFont, PdfBrushes.Black);      // 11 - 2
        VisitPdfGrid.Rows[11].Cells[2].Value = value;

        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                            // 12 - 0
        VisitPdfGrid.Rows[12].Cells[0].Value = value;
        value = new PdfTextElement("Terapia:", fieldNameFont, PdfBrushes.Black);                    // 12 - 1
        VisitPdfGrid.Rows[12].Cells[1].Value = value;
        value = new PdfTextElement(FillEmpty(Ortoctis.Terapia), fieldFont, PdfBrushes.Black);       // 12 - 2
        VisitPdfGrid.Rows[12].Cells[2].Value = value;
        #endregion

        // Draw PDF grid into the PDF page.
        PdfLayoutResult result2 = VisitPdfGrid.Draw(page, new Syncfusion.Drawing.PointF(0, result.Bounds.Bottom + paragraphAfterSpacing));
        Console.WriteLine($"📌 Ortottica - Dati Visita ");
        Console.WriteLine($"🔷\t X: {0}\t Y: {result.Bounds.Y + paragraphAfterSpacing}");
        Console.WriteLine($"🔷\t X: {0}\t Bottom: {result.Bounds.Bottom + paragraphAfterSpacing}");
        Console.WriteLine($"🔷\t result2.Bounds.X: {result2.Bounds.X}\t result2.Bounds.Y: {result2.Bounds.Y}");
        Console.WriteLine($" ");
        #endregion

        #region Timbro
        PdfStandardFont TimbroFont = new PdfStandardFont(PdfFontFamily.TimesRoman, 8, PdfFontStyle.Bold);

        PdfGrid TimbroPdfGrid = new PdfGrid();

        TimbroPdfGrid.AllowRowBreakAcrossPages = false;

        PdfGridCellStyle tCellStyle0 = new PdfGridCellStyle();
        PdfGridCellStyle tCellStyle1 = new PdfGridCellStyle();
        PdfGridCellStyle tCellStyle2 = new PdfGridCellStyle();
        PdfGridCellStyle tCellStyle3 = new PdfGridCellStyle();
        PdfGridCellStyle tCellStyle4 = new PdfGridCellStyle();
        PdfGridCellStyle tCellStyle5 = new PdfGridCellStyle();
        PdfGridCellStyle tCellStyle6 = new PdfGridCellStyle();

        tCellStyle2.Borders.Left.Width = 0F;
        tCellStyle2.Borders.Right.Width = 0F;
        tCellStyle2.Borders.Top.Width = 0F;
        tCellStyle2.Borders.Bottom.Width = 0F;
        tCellStyle2.CellPadding = new PdfPaddings(16F, 0, 1F, 0);

        tCellStyle3.Borders.Left.Width = 0F;
        tCellStyle3.Borders.Right.Width = 0F;
        tCellStyle3.Borders.Top.Width = 0F;
        tCellStyle3.Borders.Bottom.Width = 0F;
        tCellStyle3.CellPadding = new PdfPaddings(53.2F, 0, 1F, 0);

        if (who == "1")     // Marco
        {
            tCellStyle0.Borders.Left.Width = 0F;
            tCellStyle0.Borders.Right.Width = 0F;
            tCellStyle0.Borders.Top.Width = 0F;
            tCellStyle0.Borders.Bottom.Width = 0F;
            tCellStyle0.CellPadding = new PdfPaddings(25.3F, 0, 0, 0);

            tCellStyle1.Borders.Left.Width = 0F;
            tCellStyle1.Borders.Right.Width = 0F;
            tCellStyle1.Borders.Top.Width = 0F;
            tCellStyle1.Borders.Bottom.Width = 0F;
            tCellStyle1.CellPadding = new PdfPaddings(26F, 0, 1F, 0);

            tCellStyle4.Borders.Left.Width = 0F;
            tCellStyle4.Borders.Right.Width = 0F;
            tCellStyle4.Borders.Top.Width = 0F;
            tCellStyle4.Borders.Bottom.Width = 0F;
            tCellStyle4.CellPadding = new PdfPaddings(10.3F, 0, 1F, 0);

            tCellStyle5.Borders.Left.Width = 0F;
            tCellStyle5.Borders.Right.Width = 0F;
            tCellStyle5.Borders.Top.Width = 0F;
            tCellStyle5.Borders.Bottom.Width = 0F;
            tCellStyle5.CellPadding = new PdfPaddings(28.9F, 0, 1F, 0);

            tCellStyle6.Borders.Left.Width = 0F;
            tCellStyle6.Borders.Right.Width = 0F;
            tCellStyle6.Borders.Top.Width = 0F;
            tCellStyle6.Borders.Bottom.Width = 0F;
            tCellStyle6.CellPadding = new PdfPaddings(18.9F, 0, 1F, 0);
        }
        else                // Pietro
        {
            tCellStyle0.Borders.Left.Width = 0F;
            tCellStyle0.Borders.Right.Width = 0F;
            tCellStyle0.Borders.Top.Width = 0F;
            tCellStyle0.Borders.Bottom.Width = 0F;
            tCellStyle0.CellPadding = new PdfPaddings(25.3F, 0, 0, 0);

            tCellStyle1.Borders.Left.Width = 0F;
            tCellStyle1.Borders.Right.Width = 0F;
            tCellStyle1.Borders.Top.Width = 0F;
            tCellStyle1.Borders.Bottom.Width = 0F;
            tCellStyle1.CellPadding = new PdfPaddings(31.8F, 0, 1F, 0);

            tCellStyle4.Borders.Left.Width = 0F;
            tCellStyle4.Borders.Right.Width = 0F;
            tCellStyle4.Borders.Top.Width = 0F;
            tCellStyle4.Borders.Bottom.Width = 0F;
            tCellStyle4.CellPadding = new PdfPaddings(12.5F, 0, 1F, 0);

            tCellStyle5.Borders.Left.Width = 0F;
            tCellStyle5.Borders.Right.Width = 0F;
            tCellStyle5.Borders.Top.Width = 0F;
            tCellStyle5.Borders.Bottom.Width = 0F;
            tCellStyle5.CellPadding = new PdfPaddings(28.9F, 0, 1F, 0);

            tCellStyle6.Borders.Left.Width = 0F;
            tCellStyle6.Borders.Right.Width = 0F;
            tCellStyle6.Borders.Top.Width = 0F;
            tCellStyle6.Borders.Bottom.Width = 0F;
            tCellStyle6.CellPadding = new PdfPaddings(20.3F, 0, 1F, 0);
        }

        // Add rows to the DataTable.
        PdfGridRow trow0 = TimbroPdfGrid.Rows.Add();
        PdfGridRow trow1 = TimbroPdfGrid.Rows.Add();
        PdfGridRow trow2 = TimbroPdfGrid.Rows.Add();
        PdfGridRow trow3 = TimbroPdfGrid.Rows.Add();
        PdfGridRow trow4 = TimbroPdfGrid.Rows.Add();
        PdfGridRow trow5 = TimbroPdfGrid.Rows.Add();
        PdfGridRow trow6 = TimbroPdfGrid.Rows.Add();

        // Add the columns to head grid
        TimbroPdfGrid.Columns.Add(1);

        // Adding grid cell style
        PdfGridCellStyle cellStyle = new PdfGridCellStyle();
        cellStyle.Borders.Left.Width = 0.1F;
        cellStyle.Borders.Right.Width = 0.1F;
        cellStyle.Borders.Top.Width = 0.1F;
        cellStyle.Borders.Bottom.Width = 0.1F;

        //Set cell paddings.
        cellStyle.CellPadding = new PdfPaddings(10, 0, 0, 0);

        // Set columns's width
        TimbroPdfGrid.Columns[0].Width = 150;

        //Applying style to grid
        TimbroPdfGrid.Rows[0].Cells[0].Style = tCellStyle0;
        TimbroPdfGrid.Rows[1].Cells[0].Style = tCellStyle1;
        TimbroPdfGrid.Rows[2].Cells[0].Style = tCellStyle2;
        TimbroPdfGrid.Rows[3].Cells[0].Style = tCellStyle3;
        TimbroPdfGrid.Rows[4].Cells[0].Style = tCellStyle4;
        TimbroPdfGrid.Rows[5].Cells[0].Style = tCellStyle5;
        TimbroPdfGrid.Rows[6].Cells[0].Style = tCellStyle6;

        // Set rows values
        val = new PdfTextElement("Dott. " + doctor, TimbroFont, PdfBrushes.Black);       // 0 - 0
        TimbroPdfGrid.Rows[0].Cells[0].Value = val;

        val = new PdfTextElement(specialization, TimbroFont, PdfBrushes.Black);          // 1 - 0
        TimbroPdfGrid.Rows[1].Cells[0].Value = val;

        val = new PdfTextElement(address, TimbroFont, PdfBrushes.Black);                 // 2 - 0
        TimbroPdfGrid.Rows[2].Cells[0].Value = val;

        val = new PdfTextElement(city, TimbroFont, PdfBrushes.Black);                    // 3 - 0
        TimbroPdfGrid.Rows[3].Cells[0].Value = val;

        val = new PdfTextElement(codfisc, TimbroFont, PdfBrushes.Black);                 // 4 - 0
        TimbroPdfGrid.Rows[4].Cells[0].Value = val;

        val = new PdfTextElement(piva, TimbroFont, PdfBrushes.Black);                    // 5 - 0
        TimbroPdfGrid.Rows[5].Cells[0].Value = val;

        val = new PdfTextElement(ordine, TimbroFont, PdfBrushes.Black);                  // 6 - 0
        TimbroPdfGrid.Rows[6].Cells[0].Value = val;

        // Draw PDF grid into the PDF page.
        TimbroPdfGrid.Draw(page, new Syncfusion.Drawing.PointF(350, result2.Bounds.Bottom + 20));
        Console.WriteLine($"📌 Ortottica - Timbro ");
        Console.WriteLine($"🔷\t X: {350}\t Y: {result2.Bounds.Bottom + 20}");
        Console.WriteLine($" ");
        #endregion

        //Create memory stream.
        MemoryStream memoryStream = new MemoryStream();

        //Save the PDF document.
        pdfDocument.Save(memoryStream);

        //Download the PDF document
        await JS.SaveAs("Scheda Ortottica " + LName + " " + FName + "_" + ListaVisite[VisitaCorrente].Val.ToString("dd.MM.yyyy") + ".pdf", memoryStream.ToArray());
    }

    async void PrintControlli(string who)
    {
        int paragraphAfterSpacing = 8;
        // int cellMargin = 8;

        string doctor = "";
        string specialization = "";
        string address = "V.le R. Sanzio, 60 Tel 095 371701";
        string city = "CATANIA";
        string codfisc = "";
        string piva = "";
        string ordine = "";

        string iscrOrdine = "";

        if (who == "1")
        {
            doctor = "MARCO LA BRUNA";
            specialization = "Specialista in Oftalmologia";
            codfisc = "Cod. Fisc. LBR MRC 84M31 C351P";
            piva = "Partita IVA 05289740879";
            ordine = "Ordine dei Medici CT n° 14037";

            iscrOrdine = "Iscriz. Ord. Dei Medici di CT - Marco La Bruna n° 14037";
        }
        else
        {
            doctor = "PIETRO LA BRUNA";
            specialization = "Specialista in Oculistica";
            codfisc = "Cod. Fisc. LBR PTR 49T07 H221S";
            piva = "Partita IVA 00635170871";
            // ordine = "Ordine dei Medici CT n° 5133";

            iscrOrdine = "Iscriz. Ord. Dei Medici di CT - Pietro La Bruna n° 5133";
        }

        FirstPage = true;

        //Create a new PDF document.
        PdfDocument pdfDocument = new PdfDocument();

        // Add the event.
        // ------------------------------------------------------------------------------------------------------------------------
        pdfDocument.Pages.PageAdded += Pages_PageAdded;
        // ------------------------------------------------------------------------------------------------------------------------

        #region Definizione documento pdf
        // Set document information
        // ------------------------------------------------------------------------------------------------------------------------
        pdfDocument.DocumentInformation.Author = "Powered by Phoenix";
        pdfDocument.DocumentInformation.CreationDate = DateTime.Now;
        pdfDocument.DocumentInformation.Creator = "Ophthal";
        pdfDocument.DocumentInformation.Keywords = "Dott. La Bruna";
        pdfDocument.DocumentInformation.Subject = "Scheda Controlli";
        pdfDocument.DocumentInformation.Title = "Scheda Controlli" + LName + " " + FName + "_" + ListaVisite[VisitaCorrente].Val.ToString("dd.MM.yyyy");

        // Set page size
        // ------------------------------------------------------------------------------------------------------------------------
        pdfDocument.PageSettings.Size = Syncfusion.Pdf.PdfPageSize.A4;

        // Set margin for all the pages
        pdfDocument.PageSettings.Margins.Left = 20F;
        pdfDocument.PageSettings.Margins.Right = 30F;
        pdfDocument.PageSettings.Margins.Top = 20F;
        pdfDocument.PageSettings.Margins.Bottom = 50F;

        // pdfDocument.PageSettings.Margins.All = 40F;

        // Set page orientation
        // ------------------------------------------------------------------------------------------------------------------------
        pdfDocument.PageSettings.Orientation = PdfPageOrientation.Portrait;

        // Set paginate layout
        // ------------------------------------------------------------------------------------------------------------------------
        PdfLayoutFormat format = new PdfLayoutFormat();
        format.Layout = PdfLayoutType.Paginate;

        // Add page to the PDF document
        PdfPage page = pdfDocument.Pages.Add();

        // Obtain PdfGraphics object.
        PdfGraphics g = page.Graphics;
        #endregion

        #region Header & Footer
        // Create Header and Footer font
        // ------------------------------------------------------------------------------------------------------------------------
        PdfFont fontHeader = new PdfStandardFont(PdfFontFamily.Helvetica, 14, PdfFontStyle.Regular);
        PdfFont fontFooter = new PdfStandardFont(PdfFontFamily.Helvetica, 7, PdfFontStyle.Regular);

        #region Header
        // Get document's bounds
        // ------------------------------------------------------------------------------------------------------------------------
        RectangleF bounds = new RectangleF(0, 0, pdfDocument.Pages[0].GetClientSize().Width, 70);

        // Create a Page template that can be used as header.
        // ------------------------------------------------------------------------------------------------------------------------
        PdfPageTemplateElement header = new PdfPageTemplateElement(bounds);

        // Load image for header
        // Scarica l'immagine dal server
        var httpClient = new HttpClient();
        string imageUrl = $"{Env.BaseAddress}/img/LB_99_53.png";                      // URL dell'immagine
        var imageBytes = await httpClient.GetByteArrayAsync(imageUrl);

        PdfGridCellStyle HeadLogoStyle = new PdfGridCellStyle();
        HeadLogoStyle.Borders.Left.Width = 0F;
        HeadLogoStyle.Borders.Right.Width = 0F;
        HeadLogoStyle.Borders.Top.Width = 0F;
        HeadLogoStyle.Borders.Bottom.Width = 0F;
        HeadLogoStyle.CellPadding = new PdfPaddings(0, 0, 0, 0);

        // Setup font for Dati Testata
        PdfStandardFont SideFont = new PdfStandardFont(PdfFontFamily.TimesRoman, 10, PdfFontStyle.Bold | PdfFontStyle.Italic);
        PdfStandardFont hHeadFont = new PdfStandardFont(PdfFontFamily.TimesRoman, 16, PdfFontStyle.Bold | PdfFontStyle.Italic);

        PdfStandardFont PdPFont = new PdfStandardFont(PdfFontFamily.TimesRoman, 8, PdfFontStyle.Bold);
        PdfStandardFont FootFont = new PdfStandardFont(PdfFontFamily.TimesRoman, 9, PdfFontStyle.Bold | PdfFontStyle.Italic);

        PdfStandardFont hNameFont = new PdfStandardFont(PdfFontFamily.Helvetica, 7, PdfFontStyle.Bold);
        PdfStandardFont hValueFont = new PdfStandardFont(PdfFontFamily.Helvetica, 7, PdfFontStyle.Regular);

        // Specify the style for bottom
        PdfGridCellStyle HeadStyle = new PdfGridCellStyle();
        HeadStyle.Borders.Left.Width = 0F;
        HeadStyle.Borders.Right.Width = 0F;
        HeadStyle.Borders.Top.Width = 0F;
        HeadStyle.Borders.Bottom.Width = 0F;
        HeadStyle.CellPadding = new PdfPaddings(15, 10, 0, 0);
        HeadStyle.StringFormat = new PdfStringFormat(PdfTextAlignment.Center);

        // Usa un MemoryStream per creare il PdfBitmap
        using (MemoryStream imageStream = new MemoryStream(imageBytes))
        {
            PdfBitmap image = new PdfBitmap(imageStream);

            // Draw the image in the header.
            header.Graphics.DrawImage(image, 5, 15);
        }

        header.Graphics.DrawString("DOTT. " + doctor, hHeadFont, PdfBrushes.Black, 100, 14);
        header.Graphics.DrawString(specialization, hHeadFont, PdfBrushes.Black, 100, 36);

        PdfPen hPen = new PdfPen(Color.Black);
        hPen.Width = 0.1F;

        PointF hP1 = new PointF();
        PointF hP2 = new PointF();

        // linea verticale
        hP1.X = 85;
        hP1.Y = 0;

        hP2.X = 85;
        hP2.Y = 70;

        header.Graphics.DrawLine(hPen, hP1, hP2);

        // top linea orizzontale
        hP1.X = 0;
        hP1.Y = 70;

        hP2.X = 545;
        hP2.Y = 70;

        header.Graphics.DrawLine(hPen, hP1, hP2);

        // Add the header at the top.
        pdfDocument.Template.Top = header;
        #endregion

        #region Footer
        // Set document's bounds
        // ------------------------------------------------------------------------------------------------------------------------
        RectangleF fBounds = new RectangleF(0, 0, pdfDocument.Pages[0].GetClientSize().Width, 70);

        // Create a Page template that can be used as footer.
        // ------------------------------------------------------------------------------------------------------------------------
        PdfPageTemplateElement footer = new PdfPageTemplateElement(fBounds);

        PdfBrush brush = new PdfSolidBrush(Color.Black);

        // Create page number field.
        PdfPageNumberField pageNumber = new PdfPageNumberField(fontFooter, brush);

        // Create page count field.
        PdfPageCountField count = new PdfPageCountField(fontFooter, brush);

        // Add the fields in composite fields.
        PdfCompositeField compositeField = new PdfCompositeField(fontFooter, brush, "Pag. {0} di {1}", pageNumber, count);

        compositeField.Bounds = footer.Bounds;

        Console.WriteLine($"pageNumber: {pageNumber}, count: {count}");

        // Draw the composite field in footer.
        compositeField.Draw(footer.Graphics, new PointF(20, 28));

        footer.Graphics.DrawString("Viale Raffaello Sanzio, 60 – scala C, 5° piano – (Piazza Michelangelo) - 95128 Catania (CT)", FootFont, PdfBrushes.Black, 151, 8);
        footer.Graphics.DrawString("Riceve per appuntamento – Tel/Fax: 095371701", FootFont, PdfBrushes.Black, 230, 22);
        footer.Graphics.DrawString("Sito Web: http://www.studiolabruna.it – email: info@studiolabruna.it", FootFont, PdfBrushes.Black, 190, 36);
        footer.Graphics.DrawString(iscrOrdine, FootFont, PdfBrushes.Black, 212, 50);

        PdfPen fPen = new PdfPen(Color.Black);
        fPen.Width = 0.1F;

        PointF fP1 = new PointF();
        PointF fP2 = new PointF();

        // linea verticale
        fP1.X = 85;
        fP1.Y = 0;

        fP2.X = 85;
        fP2.Y = 70;

        footer.Graphics.DrawLine(fPen, fP1, fP2);

        // bottom linea orizzontale
        fP1.X = 0;
        fP1.Y = 0;

        fP2.X = 545;
        fP2.Y = 0;

        footer.Graphics.DrawLine(fPen, fP1, fP2);

        // Add the footer template at the bottom.
        pdfDocument.Template.Bottom = footer;
        #endregion
        #endregion

        #region Prima parte: Dati Testata
        PdfFont fieldPaziente = new PdfStandardFont(PdfFontFamily.Helvetica, 14, PdfFontStyle.Bold | PdfFontStyle.Italic);
        PdfFont fieldHelvBold = new PdfStandardFont(PdfFontFamily.Helvetica, 12, PdfFontStyle.Bold | PdfFontStyle.Italic);

        #region Imposta griglia Dati Testata
        // Create the head grid
        PdfGrid HeadPdfGrid = new PdfGrid();

        PdfGridCellStyle posCellStyleP0 = new PdfGridCellStyle();
        posCellStyleP0.Borders.Left.Width = 0;
        posCellStyleP0.Borders.Right.Width = 0;
        posCellStyleP0.Borders.Top.Width = 0;
        posCellStyleP0.Borders.Bottom.Width = 0;
        posCellStyleP0.CellPadding = new PdfPaddings(0, 3, 6, 0);

        PdfGridCellStyle posCellStyleP1 = new PdfGridCellStyle();
        posCellStyleP1.Borders.Left.Width = 0;
        posCellStyleP1.Borders.Right.Width = 0;
        posCellStyleP1.Borders.Top.Width = 0;
        posCellStyleP1.Borders.Bottom.Width = 0;
        posCellStyleP1.CellPadding = new PdfPaddings(0, 3, 12, 0);

        // Add the rows to head grid
        PdfGridRow row0 = HeadPdfGrid.Rows.Add();
        PdfGridRow row1 = HeadPdfGrid.Rows.Add();

        //Adding grid style
        PdfGridStyle gridStyle = new PdfGridStyle();

        //Allow grid to overflow horizontally
        gridStyle.AllowHorizontalOverflow = true;

        //Adding cell spacing between cells
        gridStyle.CellSpacing = 0F;

        HeadPdfGrid.Style = gridStyle;

        // Add the columns to head grid
        HeadPdfGrid.Columns.Add(2);

        // Set columns's width
        HeadPdfGrid.Columns[0].Width = 100;
        HeadPdfGrid.Columns[1].Width = 430;

        // Set columns merged
        // HeadPdfGrid.Rows[0].Cells[0].RowSpan = 2;
        #endregion

        #region Inserimento Dati Testata
        // Set the HeadPdfGrid's value
        PdfTextElement val;

        HeadPdfGrid.Rows[0].Cells[0].Style = posCellStyleP0;
        HeadPdfGrid.Rows[0].Cells[1].Style = posCellStyleP0;

        val = new PdfTextElement(" ", fieldPaziente, PdfBrushes.Black);                     // 0-0
        HeadPdfGrid.Rows[0].Cells[0].Value = val;

        val = new PdfTextElement(LName + " " + FName, fieldPaziente, PdfBrushes.Black);     // 0-1
        HeadPdfGrid.Rows[0].Cells[1].Value = val;

        HeadPdfGrid.Rows[1].Cells[0].Style = posCellStyleP1;
        HeadPdfGrid.Rows[1].Cells[1].Style = posCellStyleP1;

        val = new PdfTextElement(" ", fieldPaziente, PdfBrushes.Black);                     // 1-0
        HeadPdfGrid.Rows[1].Cells[0].Value = val;

        val = new PdfTextElement("Lista Controlli", fieldHelvBold, PdfBrushes.Black);          // 1-1
        HeadPdfGrid.Rows[1].Cells[1].Value = val;

        PdfLayoutResult result = HeadPdfGrid.Draw(page, new Syncfusion.Drawing.PointF(0, 80));
        #endregion
        #endregion

        #region Seconda parte: Dati Lista Controlli
        // Create field's name and field's font
        // ------------------------------------------------------------------------------------------------------------------------
        PdfFont fieldNameFont = new PdfStandardFont(PdfFontFamily.TimesRoman, 11, PdfFontStyle.Bold);
        PdfFont fieldFont = new PdfStandardFont(PdfFontFamily.Helvetica, 11, PdfFontStyle.Regular);

        PdfFont fieldDateFont = new PdfStandardFont(PdfFontFamily.Helvetica, 11, PdfFontStyle.Bold);
        PdfFont fieldValueFont = new PdfStandardFont(PdfFontFamily.Helvetica, 11, PdfFontStyle.Regular);

        PdfFont italicdFont = new PdfStandardFont(PdfFontFamily.Helvetica, 10, PdfFontStyle.Italic);

        #region Definizione stile celle Visita
        // Specify the style for head's cell
        PdfGridCellStyle posCellStyleEH = new PdfGridCellStyle();
        posCellStyleEH.Borders.Left.Width = 0F;
        posCellStyleEH.Borders.Right.Width = 0F;
        posCellStyleEH.Borders.Top.Width = 0F;
        posCellStyleEH.Borders.Bottom.Width = 0F;
        posCellStyleEH.CellPadding = new PdfPaddings(0, 3, 6, 6);
        posCellStyleEH.StringFormat = new PdfStringFormat(PdfTextAlignment.Right);

        // Specify the style for head's cell
        PdfGridCellStyle posCellStyleH = new PdfGridCellStyle();
        posCellStyleH.Borders.Left.Width = 0F;
        posCellStyleH.Borders.Right.Width = 0F;
        posCellStyleH.Borders.Top.Width = 0F;
        posCellStyleH.Borders.Bottom.Width = 0.1F;
        posCellStyleH.CellPadding = new PdfPaddings(0, 3, 12, 6);
        posCellStyleH.StringFormat = new PdfStringFormat(PdfTextAlignment.Right);

        // Specify the style for value's cell
        PdfGridCellStyle posCellStyleV = new PdfGridCellStyle();
        posCellStyleV.Borders.Left.Width = 0F;
        posCellStyleV.Borders.Right.Width = 0F;
        posCellStyleV.Borders.Top.Width = 0F;
        posCellStyleV.Borders.Bottom.Width = 0.1F;
        posCellStyleV.CellPadding = new PdfPaddings(3, 3, 12, 6);
        #endregion

        #region Imposta griglia Controlli Visita
        // Create Grid
        PdfGrid VisitPdfGrid = new PdfGrid();

        // Add Columns
        VisitPdfGrid.Columns.Add(3);

        // Add Rows
        PdfGridRow rowHead = VisitPdfGrid.Rows.Add();

        // Set Rows's height
        // rowHead.Height = 35;

        // Set Columns's width
        VisitPdfGrid.Columns[0].Width = 100;
        VisitPdfGrid.Columns[1].Width = 90;
        VisitPdfGrid.Columns[2].Width = 340;
        #endregion

        #region Inserimento Dati Lista Controlli
        // Set the HeadPdfGrid's value
        PdfTextElement value;

        VisitPdfGrid.Rows[0].Cells[0].Style = posCellStyleEH;                                           // colonna vuota
        VisitPdfGrid.Rows[0].Cells[1].Style = posCellStyleH;                                            // Intestazione tabella controlli Data Controllo
        VisitPdfGrid.Rows[0].Cells[2].Style = posCellStyleV;

        value = new PdfTextElement("", fieldNameFont, PdfBrushes.Black);                                //  0 - 0
        VisitPdfGrid.Rows[0].Cells[0].Value = value;

        value = new PdfTextElement("Data Controllo:", fieldNameFont, PdfBrushes.Black);                 //  0 - 1
        VisitPdfGrid.Rows[0].Cells[1].Value = value;

        value = new PdfTextElement("Valutazione", fieldFont, PdfBrushes.Black);                         //  0 - 2
        VisitPdfGrid.Rows[0].Cells[2].Value = value;

        for (int rp = 0; rp < ListaCntrs.Count; rp++)
        {
            PdfGridRow cRow = VisitPdfGrid.Rows.Add();

            cRow.Cells[0].Style = posCellStyleEH;
            cRow.Cells[1].Style = posCellStyleH;
            cRow.Cells[2].Style = posCellStyleV;

            val = new PdfTextElement("", fieldFont, PdfBrushes.Black);
            cRow.Cells[0].Value = val;

            val = new PdfTextElement(ListaCntrs[rp].ValDat.ToString("dd/MM/yyyy"), fieldFont, PdfBrushes.Black);
            cRow.Cells[1].Value = val;

            val = new PdfTextElement(ListaCntrs[rp].ValStr, fieldFont, PdfBrushes.Black);
            cRow.Cells[2].Value = val;
        }
        #endregion

        // Draw PDF grid into the PDF page.
        PdfLayoutResult result2 = VisitPdfGrid.Draw(page, new Syncfusion.Drawing.PointF(0, result.Bounds.Bottom + paragraphAfterSpacing));
        #endregion

        #region Timbro
        PdfStandardFont TimbroFont = new PdfStandardFont(PdfFontFamily.TimesRoman, 8, PdfFontStyle.Bold);

        PdfGrid TimbroPdfGrid = new PdfGrid();

        TimbroPdfGrid.AllowRowBreakAcrossPages = false;

        PdfGridCellStyle tCellStyle0 = new PdfGridCellStyle();
        PdfGridCellStyle tCellStyle1 = new PdfGridCellStyle();
        PdfGridCellStyle tCellStyle2 = new PdfGridCellStyle();
        PdfGridCellStyle tCellStyle3 = new PdfGridCellStyle();
        PdfGridCellStyle tCellStyle4 = new PdfGridCellStyle();
        PdfGridCellStyle tCellStyle5 = new PdfGridCellStyle();
        PdfGridCellStyle tCellStyle6 = new PdfGridCellStyle();

        tCellStyle2.Borders.Left.Width = 0F;
        tCellStyle2.Borders.Right.Width = 0F;
        tCellStyle2.Borders.Top.Width = 0F;
        tCellStyle2.Borders.Bottom.Width = 0F;
        tCellStyle2.CellPadding = new PdfPaddings(16F, 0, 1F, 0);

        tCellStyle3.Borders.Left.Width = 0F;
        tCellStyle3.Borders.Right.Width = 0F;
        tCellStyle3.Borders.Top.Width = 0F;
        tCellStyle3.Borders.Bottom.Width = 0F;
        tCellStyle3.CellPadding = new PdfPaddings(53.2F, 0, 1F, 0);

        if (who == "1")     // Marco
        {
            tCellStyle0.Borders.Left.Width = 0F;
            tCellStyle0.Borders.Right.Width = 0F;
            tCellStyle0.Borders.Top.Width = 0F;
            tCellStyle0.Borders.Bottom.Width = 0F;
            tCellStyle0.CellPadding = new PdfPaddings(25.3F, 0, 0, 0);

            tCellStyle1.Borders.Left.Width = 0F;
            tCellStyle1.Borders.Right.Width = 0F;
            tCellStyle1.Borders.Top.Width = 0F;
            tCellStyle1.Borders.Bottom.Width = 0F;
            tCellStyle1.CellPadding = new PdfPaddings(26F, 0, 1F, 0);

            tCellStyle4.Borders.Left.Width = 0F;
            tCellStyle4.Borders.Right.Width = 0F;
            tCellStyle4.Borders.Top.Width = 0F;
            tCellStyle4.Borders.Bottom.Width = 0F;
            tCellStyle4.CellPadding = new PdfPaddings(10.3F, 0, 1F, 0);

            tCellStyle5.Borders.Left.Width = 0F;
            tCellStyle5.Borders.Right.Width = 0F;
            tCellStyle5.Borders.Top.Width = 0F;
            tCellStyle5.Borders.Bottom.Width = 0F;
            tCellStyle5.CellPadding = new PdfPaddings(28.9F, 0, 1F, 0);

            tCellStyle6.Borders.Left.Width = 0F;
            tCellStyle6.Borders.Right.Width = 0F;
            tCellStyle6.Borders.Top.Width = 0F;
            tCellStyle6.Borders.Bottom.Width = 0F;
            tCellStyle6.CellPadding = new PdfPaddings(18.9F, 0, 1F, 0);
        }
        else                // Pietro
        {
            tCellStyle0.Borders.Left.Width = 0F;
            tCellStyle0.Borders.Right.Width = 0F;
            tCellStyle0.Borders.Top.Width = 0F;
            tCellStyle0.Borders.Bottom.Width = 0F;
            tCellStyle0.CellPadding = new PdfPaddings(25.3F, 0, 0, 0);

            tCellStyle1.Borders.Left.Width = 0F;
            tCellStyle1.Borders.Right.Width = 0F;
            tCellStyle1.Borders.Top.Width = 0F;
            tCellStyle1.Borders.Bottom.Width = 0F;
            tCellStyle1.CellPadding = new PdfPaddings(31.8F, 0, 1F, 0);

            tCellStyle4.Borders.Left.Width = 0F;
            tCellStyle4.Borders.Right.Width = 0F;
            tCellStyle4.Borders.Top.Width = 0F;
            tCellStyle4.Borders.Bottom.Width = 0F;
            tCellStyle4.CellPadding = new PdfPaddings(12.5F, 0, 1F, 0);

            tCellStyle5.Borders.Left.Width = 0F;
            tCellStyle5.Borders.Right.Width = 0F;
            tCellStyle5.Borders.Top.Width = 0F;
            tCellStyle5.Borders.Bottom.Width = 0F;
            tCellStyle5.CellPadding = new PdfPaddings(28.9F, 0, 1F, 0);

            tCellStyle6.Borders.Left.Width = 0F;
            tCellStyle6.Borders.Right.Width = 0F;
            tCellStyle6.Borders.Top.Width = 0F;
            tCellStyle6.Borders.Bottom.Width = 0F;
            tCellStyle6.CellPadding = new PdfPaddings(20.3F, 0, 1F, 0);
        }

        // Add rows to the DataTable.
        PdfGridRow trow0 = TimbroPdfGrid.Rows.Add();
        PdfGridRow trow1 = TimbroPdfGrid.Rows.Add();
        PdfGridRow trow2 = TimbroPdfGrid.Rows.Add();
        PdfGridRow trow3 = TimbroPdfGrid.Rows.Add();
        PdfGridRow trow4 = TimbroPdfGrid.Rows.Add();
        PdfGridRow trow5 = TimbroPdfGrid.Rows.Add();
        PdfGridRow trow6 = TimbroPdfGrid.Rows.Add();

        // Add the columns to head grid
        TimbroPdfGrid.Columns.Add(1);

        // Adding grid cell style
        PdfGridCellStyle cellStyle = new PdfGridCellStyle();
        cellStyle.Borders.Left.Width = 0.1F;
        cellStyle.Borders.Right.Width = 0.1F;
        cellStyle.Borders.Top.Width = 0.1F;
        cellStyle.Borders.Bottom.Width = 0.1F;

        //Set cell paddings.
        cellStyle.CellPadding = new PdfPaddings(10, 0, 0, 0);

        // Set columns's width
        TimbroPdfGrid.Columns[0].Width = 150;

        //Applying style to grid
        TimbroPdfGrid.Rows[0].Cells[0].Style = tCellStyle0;
        TimbroPdfGrid.Rows[1].Cells[0].Style = tCellStyle1;
        TimbroPdfGrid.Rows[2].Cells[0].Style = tCellStyle2;
        TimbroPdfGrid.Rows[3].Cells[0].Style = tCellStyle3;
        TimbroPdfGrid.Rows[4].Cells[0].Style = tCellStyle4;
        TimbroPdfGrid.Rows[5].Cells[0].Style = tCellStyle5;
        TimbroPdfGrid.Rows[6].Cells[0].Style = tCellStyle6;

        // Set rows values
        val = new PdfTextElement("Dott. " + doctor, TimbroFont, PdfBrushes.Black);       // 0 - 0
        TimbroPdfGrid.Rows[0].Cells[0].Value = val;

        val = new PdfTextElement(specialization, TimbroFont, PdfBrushes.Black);          // 1 - 0
        TimbroPdfGrid.Rows[1].Cells[0].Value = val;

        val = new PdfTextElement(address, TimbroFont, PdfBrushes.Black);                 // 2 - 0
        TimbroPdfGrid.Rows[2].Cells[0].Value = val;

        val = new PdfTextElement(city, TimbroFont, PdfBrushes.Black);                    // 3 - 0
        TimbroPdfGrid.Rows[3].Cells[0].Value = val;

        val = new PdfTextElement(codfisc, TimbroFont, PdfBrushes.Black);                 // 4 - 0
        TimbroPdfGrid.Rows[4].Cells[0].Value = val;

        val = new PdfTextElement(piva, TimbroFont, PdfBrushes.Black);                    // 5 - 0
        TimbroPdfGrid.Rows[5].Cells[0].Value = val;

        val = new PdfTextElement(ordine, TimbroFont, PdfBrushes.Black);                  // 6 - 0
        TimbroPdfGrid.Rows[6].Cells[0].Value = val;

        // Draw PDF grid into the PDF page.
        TimbroPdfGrid.Draw(page, new Syncfusion.Drawing.PointF(350, result2.Bounds.Bottom + 20));
        #endregion

        //Create memory stream.
        MemoryStream memoryStream = new MemoryStream();

        //Save the PDF document.
        pdfDocument.Save(memoryStream);

        //Download the PDF document
        await JS.SaveAs("Scheda Controlli " + LName + " " + FName + "_" + ListaVisite[VisitaCorrente].Val.ToString("dd.MM.yyyy") + ".pdf", memoryStream.ToArray());
    }

    async void PrintOcchiali(string who)
    {
        int paragraphAfterSpacing = 16;
        // int cellMargin = 8;

        string doctor = "";
        string specialization = "";
        string address = "V.le R. Sanzio, 60 Tel 095 371701";
        string city = "CATANIA";
        string codfisc = "";
        string piva = "";
        string ordine = "";

        string iscrOrdine = "";

        if (who == "1")
        {
            doctor = "MARCO LA BRUNA";
            specialization = "Specialista in Oftalmologia";
            codfisc = "Cod. Fisc. LBR MRC 84M31 C351P";
            piva = "Partita IVA 05289740879";
            ordine = "Ordine dei Medici CT n° 14037";

            iscrOrdine = "Iscriz. Ord. Dei Medici di CT - Marco La Bruna n° 14037";
        }
        else
        {
            doctor = "PIETRO LA BRUNA";
            specialization = "Specialista in Oculistica";
            codfisc = "Cod. Fisc. LBR PTR 49T07 H221S";
            piva = "Partita IVA 00635170871";
            // ordine = "Ordine dei Medici CT n° 5133";

            iscrOrdine = "Iscriz. Ord. Dei Medici di CT - Pietro La Bruna n° 5133";
        }

        FirstPage = true;

        //Create a new PDF document.
        PdfDocument pdfDocument = new PdfDocument();

        // Add the event.
        // ------------------------------------------------------------------------------------------------------------------------
        pdfDocument.Pages.PageAdded += Pages_PageAdded;
        // ------------------------------------------------------------------------------------------------------------------------

        #region Definizione documento pdf
        // Set document information
        // ------------------------------------------------------------------------------------------------------------------------
        pdfDocument.DocumentInformation.Author = "Powered by Phoenix";
        pdfDocument.DocumentInformation.CreationDate = DateTime.Now;
        pdfDocument.DocumentInformation.Creator = "Ophthal";
        pdfDocument.DocumentInformation.Keywords = "Dott. La Bruna";
        pdfDocument.DocumentInformation.Subject = "Prescrizione Lenti";
        pdfDocument.DocumentInformation.Title = "Prescrizione Lenti" + LName + " " + FName + "_" + pDataOcchiali.Substring(0, 2) + "." + pDataOcchiali.Substring(2, 2) + "." + pDataOcchiali.Substring(4, 4);

        // Set page size
        // ------------------------------------------------------------------------------------------------------------------------
        pdfDocument.PageSettings.Size = Syncfusion.Pdf.PdfPageSize.A4;

        // Set margin for all the pages
        pdfDocument.PageSettings.Margins.Left = 20F;
        pdfDocument.PageSettings.Margins.Right = 30F;
        pdfDocument.PageSettings.Margins.Top = 20F;
        pdfDocument.PageSettings.Margins.Bottom = 50F;

        // pdfDocument.PageSettings.Margins.All = 40F;

        // Set page orientation
        // ------------------------------------------------------------------------------------------------------------------------
        pdfDocument.PageSettings.Orientation = PdfPageOrientation.Portrait;

        // Set paginate layout
        // ------------------------------------------------------------------------------------------------------------------------
        PdfLayoutFormat format = new PdfLayoutFormat();
        format.Layout = PdfLayoutType.Paginate;

        // Add page to the PDF document
        PdfPage page = pdfDocument.Pages.Add();

        // Obtain PdfGraphics object.
        PdfGraphics g = page.Graphics;
        #endregion

        #region Header & Footer
        // Create Header and Footer font
        // ------------------------------------------------------------------------------------------------------------------------
        PdfFont fontHeader = new PdfStandardFont(PdfFontFamily.Helvetica, 14, PdfFontStyle.Regular);
        PdfFont fontFooter = new PdfStandardFont(PdfFontFamily.Helvetica, 7, PdfFontStyle.Regular);

        #region Header
        // Get document's bounds
        // ------------------------------------------------------------------------------------------------------------------------
        RectangleF bounds = new RectangleF(0, 0, pdfDocument.Pages[0].GetClientSize().Width, 70);

        // Create a Page template that can be used as header.
        // ------------------------------------------------------------------------------------------------------------------------
        PdfPageTemplateElement header = new PdfPageTemplateElement(bounds);

        // Load image for header
        // Scarica l'immagine dal server
        var httpClient = new HttpClient();
        string imageUrl = $"{Env.BaseAddress}/img/LB_99_53.png";                      // URL dell'immagine
        var imageBytes = await httpClient.GetByteArrayAsync(imageUrl);

        PdfGridCellStyle HeadLogoStyle = new PdfGridCellStyle();
        HeadLogoStyle.Borders.Left.Width = 0F;
        HeadLogoStyle.Borders.Right.Width = 0F;
        HeadLogoStyle.Borders.Top.Width = 0F;
        HeadLogoStyle.Borders.Bottom.Width = 0F;
        HeadLogoStyle.CellPadding = new PdfPaddings(0, 0, 0, 0);

        // Setup font for Dati Testata
        PdfStandardFont SideFont = new PdfStandardFont(PdfFontFamily.TimesRoman, 10, PdfFontStyle.Bold | PdfFontStyle.Italic);
        PdfStandardFont hHeadFont = new PdfStandardFont(PdfFontFamily.TimesRoman, 16, PdfFontStyle.Bold | PdfFontStyle.Italic);

        PdfStandardFont PdPFont = new PdfStandardFont(PdfFontFamily.TimesRoman, 8, PdfFontStyle.Bold);
        PdfStandardFont FootFont = new PdfStandardFont(PdfFontFamily.TimesRoman, 9, PdfFontStyle.Bold | PdfFontStyle.Italic);

        PdfStandardFont hNameFont = new PdfStandardFont(PdfFontFamily.Helvetica, 7, PdfFontStyle.Bold);
        PdfStandardFont hValueFont = new PdfStandardFont(PdfFontFamily.Helvetica, 7, PdfFontStyle.Regular);

        // Specify the style for bottom
        PdfGridCellStyle HeadStyle = new PdfGridCellStyle();
        HeadStyle.Borders.Left.Width = 0F;
        HeadStyle.Borders.Right.Width = 0F;
        HeadStyle.Borders.Top.Width = 0F;
        HeadStyle.Borders.Bottom.Width = 0F;
        HeadStyle.CellPadding = new PdfPaddings(15, 10, 0, 0);
        HeadStyle.StringFormat = new PdfStringFormat(PdfTextAlignment.Center);

        // Usa un MemoryStream per creare il PdfBitmap
        using (MemoryStream imageStream = new MemoryStream(imageBytes))
        {
            PdfBitmap image = new PdfBitmap(imageStream);

            // g.DrawImage(image, 0, 0);
            //g.DrawImage(image, 5, 0);

            // Draw the image in the header.
            header.Graphics.DrawImage(image, 5, 15);
        }

        header.Graphics.DrawString("DOTT. " + doctor, hHeadFont, PdfBrushes.Black, 100, 14);
        header.Graphics.DrawString(specialization, hHeadFont, PdfBrushes.Black, 100, 36);

        PdfPen hPen = new PdfPen(Color.Black);
        hPen.Width = 0.1F;

        PointF hP1 = new PointF();
        PointF hP2 = new PointF();

        // linea verticale
        hP1.X = 85;
        hP1.Y = 0;

        hP2.X = 85;
        hP2.Y = 70;

        header.Graphics.DrawLine(hPen, hP1, hP2);

        // top linea orizzontale
        hP1.X = 0;
        hP1.Y = 70;

        hP2.X = 545;
        hP2.Y = 70;

        header.Graphics.DrawLine(hPen, hP1, hP2);

        // Add the header at the top.
        pdfDocument.Template.Top = header;
        #endregion

        #region Footer
        // Set document's bounds
        // ------------------------------------------------------------------------------------------------------------------------
        RectangleF fBounds = new RectangleF(0, 0, pdfDocument.Pages[0].GetClientSize().Width, 70);

        // Create a Page template that can be used as footer.
        // ------------------------------------------------------------------------------------------------------------------------
        PdfPageTemplateElement footer = new PdfPageTemplateElement(fBounds);

        PdfBrush brush = new PdfSolidBrush(Color.Black);

        // Create page number field.
        PdfPageNumberField pageNumber = new PdfPageNumberField(fontFooter, brush);

        // Create page count field.
        PdfPageCountField count = new PdfPageCountField(fontFooter, brush);

        // Add the fields in composite fields.
        PdfCompositeField compositeField = new PdfCompositeField(fontFooter, brush, "Pag. {0} di {1}", pageNumber, count);

        compositeField.Bounds = footer.Bounds;

        Console.WriteLine($"pageNumber: {pageNumber}, count: {count}");

        // Draw the composite field in footer.
        compositeField.Draw(footer.Graphics, new PointF(20, 28));

        footer.Graphics.DrawString("Viale Raffaello Sanzio, 60 – scala C, 5° piano – (Piazza Michelangelo) - 95128 Catania (CT)", FootFont, PdfBrushes.Black, 151, 8);
        footer.Graphics.DrawString("Riceve per appuntamento – Tel/Fax: 095371701", FootFont, PdfBrushes.Black, 230, 22);
        footer.Graphics.DrawString("Sito Web: http://www.studiolabruna.it – email: info@studiolabruna.it", FootFont, PdfBrushes.Black, 190, 36);
        footer.Graphics.DrawString(iscrOrdine, FootFont, PdfBrushes.Black, 212, 50);

        PdfPen fPen = new PdfPen(Color.Black);
        fPen.Width = 0.1F;

        PointF fP1 = new PointF();
        PointF fP2 = new PointF();

        // linea verticale
        fP1.X = 85;
        fP1.Y = 0;

        fP2.X = 85;
        fP2.Y = 70;

        footer.Graphics.DrawLine(fPen, fP1, fP2);

        // bottom linea orizzontale
        fP1.X = 0;
        fP1.Y = 0;

        fP2.X = 545;
        fP2.Y = 0;

        footer.Graphics.DrawLine(fPen, fP1, fP2);

        // Add the footer template at the bottom.
        pdfDocument.Template.Bottom = footer;
        #endregion
        #endregion

        #region Grafico misura
        PdfFont font = new PdfStandardFont(PdfFontFamily.Helvetica, 8, PdfFontStyle.Bold);
        PdfPen pen = new PdfPen(Color.Black);

        PointF p1 = new PointF();
        PointF p2 = new PointF();

        // g.DrawString("Arcs", font, PdfBrushes.DarkBlue, new PointF(330, 0));

        pen = new PdfPen(Color.Black);
        pen.Width = 0.5F;
        pen.LineCap = PdfLineCap.Round;
        pen.LineCap = PdfLineCap.Flat;

        // Occhio Destro
        // RectangleF rect1 = new RectangleF(45, 190, 200, 200);
        RectangleF rect1 = new RectangleF(110, 190, 200, 200);

        pen.Color = Color.Black;

        // pen.Color = Color.Red;
        // // bottom linea orizzontale
        // fP1.X = 110;
        // fP1.Y = 190;

        // fP2.X = 310;
        // fP2.Y = 190;

        // g.DrawLine(pen, fP1, fP2);

        // fP1.X = 330;
        // fP1.Y = 190;

        // fP2.X = 530;
        // fP2.Y = 190;

        // g.DrawLine(pen, fP1, fP2);

        // pen.Color = Color.Black;

        // archi
        g.DrawArc(pen, rect1, 180, 180);                    // 1° arco

        rect1.X += 15;
        rect1.Y += 15;
        rect1.Width -= 30;
        rect1.Height -= 30;
        g.DrawArc(pen, rect1, 180, 180);                    // 2° arco

        rect1.X += 15;
        rect1.Y += 15;
        rect1.Width -= 30;
        rect1.Height -= 30;
        g.DrawArc(pen, rect1, 180, 180);                    // 3° arco

        // segmenti
        for (var a = 0; a <= 180; a += 10)
        {
            // p1.X = (float)(Math.Cos(Math.PI * a / 180) * 70 + 145);
            p1.X = (float)(Math.Cos(Math.PI * a / 180) * 70 + 210);
            p1.Y = (float)(290 - Math.Sin(Math.PI * a / 180) * 70);

            // p2.X = (float)(Math.Cos(Math.PI * a / 180) * 100 + 145);
            p2.X = (float)(Math.Cos(Math.PI * a / 180) * 100 + 210);
            p2.Y = (float)(290 - Math.Sin(Math.PI * a / 180) * 100);

            g.DrawLine(pen, p1, p2);
        }

        for (var a = 5; a <= 175; a += 10)
        {
            // p1.X = (float)(Math.Cos(Math.PI * a / 180) * 70 + 145);
            p1.X = (float)(Math.Cos(Math.PI * a / 180) * 70 + 210);
            p1.Y = (float)(290 - Math.Sin(Math.PI * a / 180) * 70);

            // p2.X = (float)(Math.Cos(Math.PI * a / 180) * 85 + 145);
            p2.X = (float)(Math.Cos(Math.PI * a / 180) * 85 + 210);
            p2.Y = (float)(290 - Math.Sin(Math.PI * a / 180) * 85);

            g.DrawLine(pen, p1, p2);
        }

        // gradi
        g.Save();
        g.TranslateTransform(320, 288);
        // g.TranslateTransform(255, 288);
        g.RotateTransform(90);
        g.DrawString("0", font, PdfBrushes.Black, 0, 0);
        g.Restore();

        g.Save();
        g.TranslateTransform(312, 248);
        // g.TranslateTransform(247, 248);
        g.RotateTransform(70);
        g.DrawString("20", font, PdfBrushes.Black, 0, 0);
        g.Restore();

        g.Save();
        g.TranslateTransform(291, 216);
        // g.TranslateTransform(226, 216);
        g.RotateTransform(50);
        g.DrawString("40", font, PdfBrushes.Black, 0, 0);
        g.Restore();

        g.Save();
        g.TranslateTransform(261, 193);
        // g.TranslateTransform(196, 193);
        g.RotateTransform(30);
        g.DrawString("60", font, PdfBrushes.Black, 0, 0);
        g.Restore();

        g.Save();
        g.TranslateTransform(225, 181);
        // g.TranslateTransform(160, 181);
        g.RotateTransform(10);
        g.DrawString("80", font, PdfBrushes.Black, 0, 0);
        g.Restore();

        g.Save();
        g.TranslateTransform(184, 183);
        // g.TranslateTransform(119, 183);
        g.RotateTransform(-10);
        g.DrawString("100", font, PdfBrushes.Black, 0, 0);
        g.Restore();

        g.Save();
        g.TranslateTransform(149, 198);
        // g.TranslateTransform(84, 198);
        g.RotateTransform(-30);
        g.DrawString("120", font, PdfBrushes.Black, 0, 0);
        g.Restore();

        g.Save();
        g.TranslateTransform(121, 225);
        // g.TranslateTransform(56, 225);
        g.RotateTransform(-50);
        g.DrawString("140", font, PdfBrushes.Black, 0, 0);
        g.Restore();

        g.Save();
        g.TranslateTransform(104, 259);
        // g.TranslateTransform(39, 259);
        g.RotateTransform(-70);
        g.DrawString("160", font, PdfBrushes.Black, 0, 0);
        g.Restore();

        g.Save();
        g.TranslateTransform(100, 296);
        // g.TranslateTransform(35, 296);
        g.RotateTransform(-90);
        g.DrawString("180", font, PdfBrushes.Black, 0, 0);
        g.Restore();

        // linea inferiore
        p1.X = 110;
        // p1.X = 45;
        p1.Y = 290;

        p2.X = 205;
        // p2.X = 140;
        p2.Y = 290;

        g.DrawLine(pen, p1, p2);

        p1.X = 207;
        // p1.X = 142;
        p1.Y = 290;

        p2.X = 213;
        // p2.X = 148;
        p2.Y = 290;

        g.DrawLine(pen, p1, p2);

        p1.X = 215;
        // p1.X = 150;
        p1.Y = 290;

        p2.X = 310;
        // p2.X = 245;
        p2.Y = 290;

        g.DrawLine(pen, p1, p2);

        p1.X = 210;
        // p1.X = 145;
        p1.Y = 287;

        p2.X = 210;
        // p2.X = 145;
        p2.Y = 293;

        g.DrawLine(pen, p1, p2);

        // Occhio Sinistro
        // RectangleF rect2 = new RectangleF(265, 190, 200, 200);
        RectangleF rect2 = new RectangleF(330, 190, 200, 200);

        pen.Color = Color.Black;

        // archi
        g.DrawArc(pen, rect2, 180, 180);                    // 1° arco

        rect2.X += 15;
        rect2.Y += 15;
        rect2.Width -= 30;
        rect2.Height -= 30;
        g.DrawArc(pen, rect2, 180, 180);                    // 2° arco

        rect2.X += 15;
        rect2.Y += 15;
        rect2.Width -= 30;
        rect2.Height -= 30;
        g.DrawArc(pen, rect2, 180, 180);                    // 3° arco

        // segmenti
        for (var a = 0; a <= 180; a += 10)
        {
            // p1.X = (float)(Math.Cos(Math.PI * a / 180) * 70 + 365);
            p1.X = (float)(Math.Cos(Math.PI * a / 180) * 70 + 430);
            p1.Y = (float)(290 - Math.Sin(Math.PI * a / 180) * 70);

            // p2.X = (float)(Math.Cos(Math.PI * a / 180) * 100 + 365);
            p2.X = (float)(Math.Cos(Math.PI * a / 180) * 100 + 430);
            p2.Y = (float)(290 - Math.Sin(Math.PI * a / 180) * 100);

            g.DrawLine(pen, p1, p2);
        }

        for (var a = 5; a <= 175; a += 10)
        {
            // p1.X = (float)(Math.Cos(Math.PI * a / 180) * 70 + 365);
            p1.X = (float)(Math.Cos(Math.PI * a / 180) * 70 + 430);
            p1.Y = (float)(290 - Math.Sin(Math.PI * a / 180) * 70);

            // p2.X = (float)(Math.Cos(Math.PI * a / 180) * 85 + 365);
            p2.X = (float)(Math.Cos(Math.PI * a / 180) * 85 + 430);
            p2.Y = (float)(290 - Math.Sin(Math.PI * a / 180) * 85);

            g.DrawLine(pen, p1, p2);
        }

        // gradi
        g.Save();
        // g.TranslateTransform(475, 288);
        g.TranslateTransform(540, 288);
        g.RotateTransform(90);
        g.DrawString("0", font, PdfBrushes.Black, 0, 0);
        g.Restore();

        g.Save();
        // g.TranslateTransform(467, 248);
        g.TranslateTransform(532, 248);
        g.RotateTransform(70);
        g.DrawString("20", font, PdfBrushes.Black, 0, 0);
        g.Restore();

        g.Save();
        // g.TranslateTransform(446, 216);
        g.TranslateTransform(511, 216);
        g.RotateTransform(50);
        g.DrawString("40", font, PdfBrushes.Black, 0, 0);
        g.Restore();

        g.Save();
        // g.TranslateTransform(416, 193);
        g.TranslateTransform(481, 193);
        g.RotateTransform(30);
        g.DrawString("60", font, PdfBrushes.Black, 0, 0);
        g.Restore();

        g.Save();
        // g.TranslateTransform(380, 181);
        g.TranslateTransform(445, 181);
        g.RotateTransform(10);
        g.DrawString("80", font, PdfBrushes.Black, 0, 0);
        g.Restore();

        g.Save();
        // g.TranslateTransform(339, 183);
        g.TranslateTransform(404, 183);
        g.RotateTransform(-10);
        g.DrawString("100", font, PdfBrushes.Black, 0, 0);
        g.Restore();

        g.Save();
        // g.TranslateTransform(304, 198);
        g.TranslateTransform(369, 198);
        g.RotateTransform(-30);
        g.DrawString("120", font, PdfBrushes.Black, 0, 0);
        g.Restore();

        g.Save();
        // g.TranslateTransform(276, 225);
        g.TranslateTransform(341, 225);
        g.RotateTransform(-50);
        g.DrawString("140", font, PdfBrushes.Black, 0, 0);
        g.Restore();

        g.Save();
        // g.TranslateTransform(259, 259);
        g.TranslateTransform(324, 259);
        g.RotateTransform(-70);
        g.DrawString("160", font, PdfBrushes.Black, 0, 0);
        g.Restore();

        g.Save();
        // g.TranslateTransform(255, 296);
        g.TranslateTransform(320, 296);
        g.RotateTransform(-90);
        g.DrawString("180", font, PdfBrushes.Black, 0, 0);
        g.Restore();

        // linea inferiore
        // p1.X = 265;
        p1.X = 330;
        p1.Y = 290;

        // p2.X = 360;
        p2.X = 425;
        p2.Y = 290;

        g.DrawLine(pen, p1, p2);

        // p1.X = 362;
        p1.X = 427;
        p1.Y = 290;

        // p2.X = 368;
        p2.X = 433;
        p2.Y = 290;

        g.DrawLine(pen, p1, p2);

        // p1.X = 370;
        p1.X = 435;
        p1.Y = 290;

        // p2.X = 465;
        p2.X = 530;
        p2.Y = 290;

        g.DrawLine(pen, p1, p2);

        // p1.X = 365;
        p1.X = 430;
        p1.Y = 287;

        // p2.X = 365;
        p2.X = 430;
        p2.Y = 293;

        g.DrawLine(pen, p1, p2);

        // Assi
        PointF pb = new PointF();
        PointF pc = new PointF();

        pen.Width = 1.5F;
        pen.LineCap = PdfLineCap.Square;

        // occhio destro
        if (SetObjNullToStr(Visus.ODD_Asse) != "")
        {
            pen.Color = Color.DarkBlue;

            double aa = Convert.ToDouble(SetObjNullToStr(Visus.ODD_Asse));
            double ab = aa + 170;
            double ac = aa + 190;

            // p1.X = (float)(Math.Cos(Math.PI * aa / 180) + 145);
            // p1.X = (float)(Math.Cos(Math.PI * aa / 180) + 210);
            // p1.Y = (float)(290 - Math.Sin(Math.PI * aa / 180));
            p1.X = (float)(210);
            p1.Y = (float)(290);

            // p2.X = (float)(Math.Cos(Math.PI * aa / 180) * 115 + 145);
            p2.X = (float)(Math.Cos(Math.PI * aa / 180) * 110 + 210);
            p2.Y = (float)(290 - Math.Sin(Math.PI * aa / 180) * 110);

            g.DrawLine(pen, p1, p2);

            // Console.WriteLine($"Distanza OD");
            // Console.WriteLine($"aa: {aa}");
            // Console.WriteLine($"p1.X: {p1.X}, p1.Y: {p1.Y}");
            // Console.WriteLine($"p2.X: {p2.X}, p2.Y: {p2.Y}");
            // Console.WriteLine($" ");

            pb.X = (float)(Math.Cos(Math.PI * ab / 180) * 10 + p2.X);
            pb.Y = (float)(p2.Y - Math.Sin(Math.PI * ab / 180) * 10);

            g.DrawLine(pen, p2, pb);

            pc.X = (float)(Math.Cos(Math.PI * ac / 180) * 10 + p2.X);
            pc.Y = (float)(p2.Y - Math.Sin(Math.PI * ac / 180) * 10);

            g.DrawLine(pen, p2, pc);

            // g.DrawLine(pen, pb, pc);
        }

        if (SetObjNullToStr(Visus.ODP_Asse) != "")
        {
            pen.Color = Color.DarkRed;

            double aa = Convert.ToDouble(SetObjNullToStr(Visus.ODP_Asse));
            double ab = aa + 170;
            double ac = aa + 190;

            // p1.X = (float)(Math.Cos(Math.PI * aa / 180) + 145);
            p1.X = (float)(210);
            p1.Y = (float)(290);

            // p2.X = (float)(Math.Cos(Math.PI * aa / 180) * 115 + 145);
            p2.X = (float)(Math.Cos(Math.PI * aa / 180) * 110 + 210);
            p2.Y = (float)(290 - Math.Sin(Math.PI * aa / 180) * 110);

            g.DrawLine(pen, p1, p2);

            pb.X = (float)(Math.Cos(Math.PI * ab / 180) * 10 + p2.X);
            pb.Y = (float)(p2.Y - Math.Sin(Math.PI * ab / 180) * 10);

            g.DrawLine(pen, p2, pb);

            pc.X = (float)(Math.Cos(Math.PI * ac / 180) * 10 + p2.X);
            pc.Y = (float)(p2.Y - Math.Sin(Math.PI * ac / 180) * 10);

            g.DrawLine(pen, p2, pc);
        }

        if (SetObjNullToStr(Visus.ODL_Asse) != "")
        {
            pen.Color = Color.DarkGreen;

            double aa = Convert.ToDouble(SetObjNullToStr(Visus.ODL_Asse));
            double ab = aa + 170;
            double ac = aa + 190;

            // p1.X = (float)(Math.Cos(Math.PI * aa / 180) + 145);
            p1.X = (float)(210);
            p1.Y = (float)(290);

            // p2.X = (float)(Math.Cos(Math.PI * aa / 180) * 115 + 145);
            p2.X = (float)(Math.Cos(Math.PI * aa / 180) * 110 + 210);
            p2.Y = (float)(290 - Math.Sin(Math.PI * aa / 180) * 110);

            g.DrawLine(pen, p1, p2);

            pb.X = (float)(Math.Cos(Math.PI * ab / 180) * 10 + p2.X);
            pb.Y = (float)(p2.Y - Math.Sin(Math.PI * ab / 180) * 10);

            g.DrawLine(pen, p2, pb);

            pc.X = (float)(Math.Cos(Math.PI * ac / 180) * 10 + p2.X);
            pc.Y = (float)(p2.Y - Math.Sin(Math.PI * ac / 180) * 10);

            g.DrawLine(pen, p2, pc);
        }

        // occhio sinistro
        if (SetObjNullToStr(Visus.OSD_Asse) != "")
        {
            pen.Color = Color.DarkBlue;

            double aa = Convert.ToDouble(SetObjNullToStr(Visus.OSD_Asse));
            double ab = aa + 170;
            double ac = aa + 190;

            // p1.X = (float)(Math.Cos(Math.PI * aa / 180) + 365);
            // p1.Y = (float)(290 - Math.Sin(Math.PI * aa / 180));
            p1.X = (float)(430);
            p1.Y = (float)(290);

            // p2.X = (float)(Math.Cos(Math.PI * aa / 180) * 115 + 365);
            p2.X = (float)(Math.Cos(Math.PI * aa / 180) * 110 + 430);
            p2.Y = (float)(290 - Math.Sin(Math.PI * aa / 180) * 110);

            g.DrawLine(pen, p1, p2);

            pb.X = (float)(Math.Cos(Math.PI * ab / 180) * 10 + p2.X);
            pb.Y = (float)(p2.Y - Math.Sin(Math.PI * ab / 180) * 10);

            g.DrawLine(pen, p2, pb);

            pc.X = (float)(Math.Cos(Math.PI * ac / 180) * 10 + p2.X);
            pc.Y = (float)(p2.Y - Math.Sin(Math.PI * ac / 180) * 10);

            g.DrawLine(pen, p2, pc);
        }

        if (SetObjNullToStr(Visus.OSP_Asse) != "")
        {
            pen.Color = Color.DarkRed;

            double aa = Convert.ToDouble(SetObjNullToStr(Visus.OSP_Asse));
            double ab = aa + 170;
            double ac = aa + 190;

            // p1.X = (float)(Math.Cos(Math.PI * aa / 180) + 365);
            // p1.Y = (float)(290 - Math.Sin(Math.PI * aa / 180));
            p1.X = (float)(430);
            p1.Y = (float)(290);

            // p2.X = (float)(Math.Cos(Math.PI * aa / 180) * 115 + 365);
            p2.X = (float)(Math.Cos(Math.PI * aa / 180) * 110 + 430);
            p2.Y = (float)(290 - Math.Sin(Math.PI * aa / 180) * 110);

            g.DrawLine(pen, p1, p2);

            pb.X = (float)(Math.Cos(Math.PI * ab / 180) * 10 + p2.X);
            pb.Y = (float)(p2.Y - Math.Sin(Math.PI * ab / 180) * 10);

            g.DrawLine(pen, p2, pb);

            pc.X = (float)(Math.Cos(Math.PI * ac / 180) * 10 + p2.X);
            pc.Y = (float)(p2.Y - Math.Sin(Math.PI * ac / 180) * 10);

            g.DrawLine(pen, p2, pc);
        }

        if (SetObjNullToStr(Visus.OSL_Asse) != "")
        {
            pen.Color = Color.DarkGreen;

            double aa = Convert.ToDouble(SetObjNullToStr(Visus.OSL_Asse));
            double ab = aa + 170;
            double ac = aa + 190;

            // p1.X = (float)(Math.Cos(Math.PI * aa / 180) + 365);
            // p1.Y = (float)(290 - Math.Sin(Math.PI * aa / 180));
            p1.X = (float)(430);
            p1.Y = (float)(290);

            // p2.X = (float)(Math.Cos(Math.PI * aa / 180) * 115 + 365);
            p2.X = (float)(Math.Cos(Math.PI * aa / 180) * 110 + 430);
            p2.Y = (float)(290 - Math.Sin(Math.PI * aa / 180) * 110);

            g.DrawLine(pen, p1, p2);

            pb.X = (float)(Math.Cos(Math.PI * ab / 180) * 10 + p2.X);
            pb.Y = (float)(p2.Y - Math.Sin(Math.PI * ab / 180) * 10);

            g.DrawLine(pen, p2, pb);

            pc.X = (float)(Math.Cos(Math.PI * ac / 180) * 10 + p2.X);
            pc.Y = (float)(p2.Y - Math.Sin(Math.PI * ac / 180) * 10);

            g.DrawLine(pen, p2, pc);
        }

        pen.Width = 0.5F;
        #endregion

        #region Prima parte: Dati Testata
        #region Definizione stili celle Dati Testata
        // Setup font for Dati Testata
        PdfStandardFont DocFont = new PdfStandardFont(PdfFontFamily.Helvetica, 12, PdfFontStyle.Bold);
        PdfStandardFont SubTitleBoldFont = new PdfStandardFont(PdfFontFamily.Helvetica, 11, PdfFontStyle.Bold);
        PdfStandardFont SubTitleRegFont = new PdfStandardFont(PdfFontFamily.Helvetica, 11, PdfFontStyle.Regular);
        PdfStandardFont FieldBldFont = new PdfStandardFont(PdfFontFamily.Helvetica, 10, PdfFontStyle.Bold);
        PdfStandardFont FieldRegFont = new PdfStandardFont(PdfFontFamily.Helvetica, 10, PdfFontStyle.Regular);
        PdfStandardFont FieldItaBldFont = new PdfStandardFont(PdfFontFamily.Helvetica, 10, PdfFontStyle.Bold | PdfFontStyle.Italic);
        PdfStandardFont TitleFont = new PdfStandardFont(PdfFontFamily.Helvetica, 13, PdfFontStyle.Bold);

        PdfGridCellStyle HeadFieldStyle = new PdfGridCellStyle();
        HeadFieldStyle.Borders.Left.Width = 0F;
        HeadFieldStyle.Borders.Right.Width = 0F;
        HeadFieldStyle.Borders.Top.Width = 0F;
        HeadFieldStyle.Borders.Bottom.Width = 0F;
        HeadFieldStyle.CellPadding = new PdfPaddings(0, 0, 4, 0);

        PdfGridCellStyle HeadFieldStyle2 = new PdfGridCellStyle();
        HeadFieldStyle2.Borders.Left.Width = 0F;
        HeadFieldStyle2.Borders.Right.Width = 0F;
        HeadFieldStyle2.Borders.Top.Width = 0F;
        HeadFieldStyle2.Borders.Bottom.Width = 0F;
        HeadFieldStyle2.CellPadding = new PdfPaddings(0, 0, 3, 1);

        PdfGridCellStyle HeadTitleStyle = new PdfGridCellStyle();
        HeadTitleStyle.Borders.Left.Width = 0F;
        HeadTitleStyle.Borders.Right.Width = 0F;
        HeadTitleStyle.Borders.Top.Width = 0F;
        HeadTitleStyle.Borders.Bottom.Width = 0F;
        HeadTitleStyle.CellPadding = new PdfPaddings(150, 0, 15, 0);

        PdfGridCellStyle HeadEmptyStyle = new PdfGridCellStyle();
        HeadEmptyStyle.Borders.Left.Width = 0F;
        HeadEmptyStyle.Borders.Right.Width = 0F;
        HeadEmptyStyle.Borders.Top.Width = 0F;
        HeadEmptyStyle.Borders.Bottom.Width = 0F;
        HeadEmptyStyle.CellPadding = new PdfPaddings(0, 0, 4, 0);
        #endregion

        #region Imposta griglia Dati Testata
        // Create the head grid
        PdfGrid HeadPdfGrid = new PdfGrid();

        //Adding grid style
        PdfGridStyle gridStyle = new PdfGridStyle();

        //Allow grid to overflow horizontally
        gridStyle.AllowHorizontalOverflow = true;

        //Adding cell spacing between cells
        gridStyle.CellSpacing = 0F;

        HeadPdfGrid.Style = gridStyle;

        // Add the rows to head grid
        PdfGridRow rowL0 = HeadPdfGrid.Rows.Add();
        PdfGridRow rowL1 = HeadPdfGrid.Rows.Add();
        PdfGridRow rowL2 = HeadPdfGrid.Rows.Add();

        // Set rows's height
        rowL0.Height = 18;
        rowL1.Height = 46;
        rowL2.Height = 20;

        // Add the columns to head grid
        HeadPdfGrid.Columns.Add(5);

        // Set columns's width
        HeadPdfGrid.Columns[0].Width = 100;
        HeadPdfGrid.Columns[1].Width = 21;
        HeadPdfGrid.Columns[2].Width = 279;
        HeadPdfGrid.Columns[3].Width = 36;
        HeadPdfGrid.Columns[4].Width = 94;

        // Set columns merged (ColumnSpan & RowSpan)
        HeadPdfGrid.Rows[0].Cells[1].ColumnSpan = 2;
        HeadPdfGrid.Rows[1].Cells[1].ColumnSpan = 4;
        HeadPdfGrid.Rows[2].Cells[2].ColumnSpan = 3;
        #endregion

        #region Inserimento Dati Testata
        // Set the HeadPdfGrid's value
        PdfTextElement val;

        // 0
        val = new PdfTextElement("", FieldBldFont, PdfBrushes.Black);                                           // 0-0
        HeadPdfGrid.Rows[0].Cells[0].Value = val;
        HeadPdfGrid.Rows[0].Cells[0].Style = HeadEmptyStyle;

        val = new PdfTextElement("", FieldBldFont, PdfBrushes.Black);                                           // 0-1
        HeadPdfGrid.Rows[0].Cells[1].Value = val;
        HeadPdfGrid.Rows[0].Cells[1].Style = HeadEmptyStyle;

        val = new PdfTextElement("Data.", FieldItaBldFont, PdfBrushes.Black);                                   // 0-3
        HeadPdfGrid.Rows[0].Cells[3].Value = val;
        HeadPdfGrid.Rows[0].Cells[3].Style = HeadFieldStyle;

        var TmpDate = pDataOcchiali.Substring(0, 2) + "/" + pDataOcchiali.Substring(2, 2) + "/" + pDataOcchiali.Substring(4, 4);
        val = new PdfTextElement(TmpDate, FieldRegFont, PdfBrushes.Black);                                      // 0-4
        HeadPdfGrid.Rows[0].Cells[4].Value = val;
        HeadPdfGrid.Rows[0].Cells[4].Style = HeadFieldStyle;

        // 1
        val = new PdfTextElement("", SubTitleBoldFont, PdfBrushes.Black);                                           // 1-0
        HeadPdfGrid.Rows[1].Cells[0].Value = val;
        HeadPdfGrid.Rows[1].Cells[0].Style = HeadEmptyStyle;

        val = new PdfTextElement("PRESCRIZIONE LENTI", TitleFont, PdfBrushes.Black);                                // 1-1
        HeadPdfGrid.Rows[1].Cells[1].Value = val;
        HeadPdfGrid.Rows[1].Cells[1].Style = HeadTitleStyle;

        // 2
        val = new PdfTextElement("", SubTitleBoldFont, PdfBrushes.Black);                                           // 2-0
        HeadPdfGrid.Rows[2].Cells[0].Value = val;
        HeadPdfGrid.Rows[2].Cells[0].Style = HeadEmptyStyle;

        val = new PdfTextElement("Sig. ", SubTitleBoldFont, PdfBrushes.Black);                                       // 2-1
        HeadPdfGrid.Rows[2].Cells[1].Value = val;
        HeadPdfGrid.Rows[2].Cells[1].Style = HeadFieldStyle2;

        val = new PdfTextElement(" " + @LName + " " + @FName, SubTitleRegFont, PdfBrushes.Black);                        // 2-2
        HeadPdfGrid.Rows[2].Cells[2].Value = val;
        HeadPdfGrid.Rows[2].Cells[2].Style = HeadFieldStyle;

        PdfLayoutResult result = HeadPdfGrid.Draw(page, new Syncfusion.Drawing.PointF(0, 80));
        #endregion
        #endregion

        #region Seconda parte: Dati PRESCRIZIONE LENTI
        #region Definizione stili celle PRESCRIZIONE LENTI
        // Create field's name and field's font
        // ------------------------------------------------------------------------------------------------------------------------
        PdfStandardFont MisEyeFont = new PdfStandardFont(PdfFontFamily.Helvetica, 11, PdfFontStyle.Bold);
        PdfStandardFont MisBldFont = new PdfStandardFont(PdfFontFamily.Helvetica, 10, PdfFontStyle.Bold);
        PdfStandardFont MisRegFont = new PdfStandardFont(PdfFontFamily.Helvetica, 10, PdfFontStyle.Regular);

        // Specify the style for head's cell
        PdfGridCellStyle CellStyleE = new PdfGridCellStyle();
        CellStyleE.Borders.Left.Width = 0F;
        CellStyleE.Borders.Right.Width = 0F;
        CellStyleE.Borders.Top.Width = 0F;
        CellStyleE.Borders.Bottom.Width = 0F;
        CellStyleE.CellPadding = new PdfPaddings(0, 0, 0, 0);

        PdfGridCellStyle CellStyleGr = new PdfGridCellStyle();
        CellStyleGr.Borders.Left.Width = 0F;
        CellStyleGr.Borders.Right.Width = 0F;
        CellStyleGr.Borders.Top.Width = 0F;
        CellStyleGr.Borders.Bottom.Width = 0F;
        CellStyleGr.CellPadding = new PdfPaddings(0, 0, 0, 0);

        PdfGridCellStyle CellStyleGrH = new PdfGridCellStyle();
        CellStyleGrH.Borders.Left.Width = 0F;
        CellStyleGrH.Borders.Right.Width = 0F;
        CellStyleGrH.Borders.Top.Width = 0F;
        CellStyleGrH.Borders.Bottom.Width = 0F;
        CellStyleGrH.CellPadding = new PdfPaddings(65, 0, 6, 0);
        CellStyleGrH.StringFormat = new PdfStringFormat(PdfTextAlignment.Center);

        // Specify the style for head's cell
        PdfGridCellStyle CellStyleHSf = new PdfGridCellStyle();
        CellStyleHSf.Borders.Left.Width = 0.1F;
        CellStyleHSf.Borders.Right.Width = 0.1F;
        CellStyleHSf.Borders.Top.Width = 0.1F;
        CellStyleHSf.Borders.Bottom.Width = 0.1F;
        CellStyleHSf.CellPadding = new PdfPaddings(24, 0, 4, 0);
        CellStyleHSf.StringFormat = new PdfStringFormat(PdfTextAlignment.Center);

        PdfGridCellStyle CellStyleHCl = new PdfGridCellStyle();
        CellStyleHCl.Borders.Left.Width = 0.1F;
        CellStyleHCl.Borders.Right.Width = 0.1F;
        CellStyleHCl.Borders.Top.Width = 0.1F;
        CellStyleHCl.Borders.Bottom.Width = 0.1F;
        CellStyleHCl.CellPadding = new PdfPaddings(18, 0, 4, 0);
        CellStyleHCl.StringFormat = new PdfStringFormat(PdfTextAlignment.Center);

        PdfGridCellStyle CellStyleHAs = new PdfGridCellStyle();
        CellStyleHAs.Borders.Left.Width = 0.1F;
        CellStyleHAs.Borders.Right.Width = 0.1F;
        CellStyleHAs.Borders.Top.Width = 0.1F;
        CellStyleHAs.Borders.Bottom.Width = 0.1F;
        CellStyleHAs.CellPadding = new PdfPaddings(25, 0, 4, 0);
        CellStyleHAs.StringFormat = new PdfStringFormat(PdfTextAlignment.Center);

        PdfGridCellStyle CellStyleHbD = new PdfGridCellStyle();
        CellStyleHbD.Borders.Left.Width = 0.1F;
        CellStyleHbD.Borders.Right.Width = 0.1F;
        CellStyleHbD.Borders.Top.Width = 0.1F;
        CellStyleHbD.Borders.Bottom.Width = 0F;
        CellStyleHbD.CellPadding = new PdfPaddings(186, 0, 1, 0);
        CellStyleHbD.StringFormat = new PdfStringFormat(PdfTextAlignment.Center);

        PdfGridCellStyle CellStyleHbP = new PdfGridCellStyle();
        CellStyleHbP.Borders.Left.Width = 0.1F;
        CellStyleHbP.Borders.Right.Width = 0.1F;
        CellStyleHbP.Borders.Top.Width = 0.1F;
        CellStyleHbP.Borders.Bottom.Width = 0F;
        CellStyleHbP.CellPadding = new PdfPaddings(182, 0, 1, 0);
        CellStyleHbP.StringFormat = new PdfStringFormat(PdfTextAlignment.Center);

        PdfGridCellStyle CellStyleHbV = new PdfGridCellStyle();
        CellStyleHbV.Borders.Left.Width = 0.1F;
        CellStyleHbV.Borders.Right.Width = 0.1F;
        CellStyleHbV.Borders.Top.Width = 0.1F;
        CellStyleHbV.Borders.Bottom.Width = 0F;
        CellStyleHbV.CellPadding = new PdfPaddings(187, 0, 1, 0);
        CellStyleHbV.StringFormat = new PdfStringFormat(PdfTextAlignment.Center);

        // Specify the style for value's cell
        PdfGridCellStyle CellStyleVal = new PdfGridCellStyle();
        CellStyleVal.Borders.Left.Width = 0.1F;
        CellStyleVal.Borders.Right.Width = 0.1F;
        CellStyleVal.Borders.Top.Width = 0F;
        CellStyleVal.Borders.Bottom.Width = 0.1F;
        CellStyleVal.CellPadding = new PdfPaddings(27, 0, 8, 0);
        CellStyleVal.StringFormat = new PdfStringFormat(PdfTextAlignment.Right);
        #endregion

        #region Imposta griglia PRESCRIZIONE LENTI
        // Create Grid
        PdfGrid LentiPdfGrid = new PdfGrid();

        //Adding grid style
        LentiPdfGrid.Style = gridStyle;

        // Add Rows
        PdfGridRow rowCL0 = LentiPdfGrid.Rows.Add();
        PdfGridRow rowCL1 = LentiPdfGrid.Rows.Add();
        PdfGridRow rowCL2 = LentiPdfGrid.Rows.Add();
        PdfGridRow rowCL3 = LentiPdfGrid.Rows.Add();
        PdfGridRow rowCL4 = LentiPdfGrid.Rows.Add();
        PdfGridRow rowCL5 = LentiPdfGrid.Rows.Add();
        PdfGridRow rowCL6 = LentiPdfGrid.Rows.Add();
        PdfGridRow rowCL7 = LentiPdfGrid.Rows.Add();
        PdfGridRow rowCL8 = LentiPdfGrid.Rows.Add();

        // Add Columns
        LentiPdfGrid.Columns.Add(7);

        // Set Rows's height
        rowCL0.Height = 125;
        rowCL1.Height = 24;
        rowCL2.Height = 20;
        rowCL3.Height = 14;
        rowCL4.Height = 28;
        rowCL5.Height = 14;
        rowCL6.Height = 28;
        rowCL7.Height = 14;
        rowCL8.Height = 28;

        // Set Columns's width
        LentiPdfGrid.Columns[0].Width = 95F;
        LentiPdfGrid.Columns[1].Width = 74F;
        LentiPdfGrid.Columns[2].Width = 74F;
        LentiPdfGrid.Columns[3].Width = 74F;
        LentiPdfGrid.Columns[4].Width = 74F;
        LentiPdfGrid.Columns[5].Width = 74F;
        LentiPdfGrid.Columns[6].Width = 74F;

        // Set columns merged (ColumnSpan & RowSpan)
        LentiPdfGrid.Rows[0].Cells[1].ColumnSpan = 3;
        LentiPdfGrid.Rows[0].Cells[4].ColumnSpan = 3;
        LentiPdfGrid.Rows[1].Cells[1].ColumnSpan = 3;
        LentiPdfGrid.Rows[1].Cells[4].ColumnSpan = 3;
        LentiPdfGrid.Rows[3].Cells[1].ColumnSpan = 6;
        LentiPdfGrid.Rows[5].Cells[1].ColumnSpan = 6;
        LentiPdfGrid.Rows[7].Cells[1].ColumnSpan = 6;
        #endregion

        #region Inserimento Dati PRESCRIZIONE LENTI
        // Set the HeadPdfGrid's value
        PdfTextElement value;

        LentiPdfGrid.Rows[0].Cells[0].Style = CellStyleE;
        LentiPdfGrid.Rows[0].Cells[1].Style = CellStyleGr;
        LentiPdfGrid.Rows[0].Cells[4].Style = CellStyleGr;

        value = new PdfTextElement("", MisRegFont, PdfBrushes.Black);                                   //  0 - 0
        LentiPdfGrid.Rows[0].Cells[0].Value = value;
        value = new PdfTextElement("", MisRegFont, PdfBrushes.Black);                                   //  0 - 1
        LentiPdfGrid.Rows[0].Cells[1].Value = value;
        value = new PdfTextElement("", MisRegFont, PdfBrushes.Black);                                   //  0 - 4
        LentiPdfGrid.Rows[0].Cells[4].Value = value;

        LentiPdfGrid.Rows[1].Cells[0].Style = CellStyleE;
        LentiPdfGrid.Rows[1].Cells[1].Style = CellStyleGrH;
        LentiPdfGrid.Rows[1].Cells[4].Style = CellStyleGrH;

        value = new PdfTextElement("", MisRegFont, PdfBrushes.Black);                                   //  1 - 0
        LentiPdfGrid.Rows[1].Cells[0].Value = value;
        value = new PdfTextElement("OCCHIO DESTRO", MisEyeFont, PdfBrushes.Black);                      //  1 - 1
        LentiPdfGrid.Rows[1].Cells[1].Value = value;
        value = new PdfTextElement("OCCHIO SINISTRO", MisEyeFont, PdfBrushes.Black);                    //  1 - 4
        LentiPdfGrid.Rows[1].Cells[4].Value = value;

        LentiPdfGrid.Rows[2].Cells[0].Style = CellStyleE;
        LentiPdfGrid.Rows[2].Cells[1].Style = CellStyleHSf;
        LentiPdfGrid.Rows[2].Cells[2].Style = CellStyleHCl;
        LentiPdfGrid.Rows[2].Cells[3].Style = CellStyleHAs;
        LentiPdfGrid.Rows[2].Cells[4].Style = CellStyleHSf;
        LentiPdfGrid.Rows[2].Cells[5].Style = CellStyleHCl;
        LentiPdfGrid.Rows[2].Cells[6].Style = CellStyleHAs;

        value = new PdfTextElement("", MisRegFont, PdfBrushes.Black);                                   //  2 - 0
        LentiPdfGrid.Rows[2].Cells[0].Value = value;
        value = new PdfTextElement("Sfera", MisBldFont, PdfBrushes.Black);                              //  2 - 1
        LentiPdfGrid.Rows[2].Cells[1].Value = value;
        value = new PdfTextElement("Cilindro", MisBldFont, PdfBrushes.Black);                           //  2 - 2
        LentiPdfGrid.Rows[2].Cells[2].Value = value;
        value = new PdfTextElement("Asse", MisBldFont, PdfBrushes.Black);                               //  2 - 3
        LentiPdfGrid.Rows[2].Cells[3].Value = value;
        value = new PdfTextElement("Sfera", MisBldFont, PdfBrushes.Black);                              //  2 - 4
        LentiPdfGrid.Rows[2].Cells[4].Value = value;
        value = new PdfTextElement("Cilindro", MisBldFont, PdfBrushes.Black);                           //  2 - 5
        LentiPdfGrid.Rows[2].Cells[5].Value = value;
        value = new PdfTextElement("Asse", MisBldFont, PdfBrushes.Black);                               //  2 - 6
        LentiPdfGrid.Rows[2].Cells[6].Value = value;

        LentiPdfGrid.Rows[3].Cells[0].Style = CellStyleE;
        LentiPdfGrid.Rows[3].Cells[1].Style = CellStyleHbD;

        value = new PdfTextElement("", MisRegFont, PdfBrushes.Black);                                   //  3 - 0
        LentiPdfGrid.Rows[3].Cells[0].Value = value;
        value = new PdfTextElement("PER DISTANZA", MisBldFont, PdfBrushes.Black);                       //  3 - 1
        LentiPdfGrid.Rows[3].Cells[1].Value = value;

        LentiPdfGrid.Rows[4].Cells[0].Style = CellStyleE;
        LentiPdfGrid.Rows[4].Cells[1].Style = CellStyleVal;
        LentiPdfGrid.Rows[4].Cells[2].Style = CellStyleVal;
        LentiPdfGrid.Rows[4].Cells[3].Style = CellStyleVal;
        LentiPdfGrid.Rows[4].Cells[4].Style = CellStyleVal;
        LentiPdfGrid.Rows[4].Cells[5].Style = CellStyleVal;
        LentiPdfGrid.Rows[4].Cells[6].Style = CellStyleVal;

        value = new PdfTextElement("", MisRegFont, PdfBrushes.Black);                                   //  4 - 0
        LentiPdfGrid.Rows[4].Cells[0].Value = value;
        value = new PdfTextElement(SetObjNullToStr(Visus.ODD_Sf), MisRegFont, PdfBrushes.Black);        //  4 - 1
        LentiPdfGrid.Rows[4].Cells[1].Value = value;
        value = new PdfTextElement(SetObjNullToStr(Visus.ODD_Cil), MisRegFont, PdfBrushes.Black);       //  4 - 2
        LentiPdfGrid.Rows[4].Cells[2].Value = value;
        value = new PdfTextElement(SetObjNullToStr(Visus.ODD_Asse), MisRegFont, PdfBrushes.Black);      //  4 - 3
        LentiPdfGrid.Rows[4].Cells[3].Value = value;
        value = new PdfTextElement(SetObjNullToStr(Visus.OSD_Sf), MisRegFont, PdfBrushes.Black);        //  4 - 4
        LentiPdfGrid.Rows[4].Cells[4].Value = value;
        value = new PdfTextElement(SetObjNullToStr(Visus.OSD_Cil), MisRegFont, PdfBrushes.Black);       //  4 - 5
        LentiPdfGrid.Rows[4].Cells[5].Value = value;
        value = new PdfTextElement(SetObjNullToStr(Visus.OSD_Asse), MisRegFont, PdfBrushes.Black);      //  4 - 6
        LentiPdfGrid.Rows[4].Cells[6].Value = value;

        LentiPdfGrid.Rows[5].Cells[0].Style = CellStyleE;
        LentiPdfGrid.Rows[5].Cells[1].Style = CellStyleHbP;

        value = new PdfTextElement("", MisRegFont, PdfBrushes.Black);                                   //  5 - 0
        LentiPdfGrid.Rows[5].Cells[0].Value = value;
        value = new PdfTextElement("A PERMANENZA", MisBldFont, PdfBrushes.Black);                       //  5 - 1
        LentiPdfGrid.Rows[5].Cells[1].Value = value;

        LentiPdfGrid.Rows[6].Cells[0].Style = CellStyleE;
        LentiPdfGrid.Rows[6].Cells[1].Style = CellStyleVal;
        LentiPdfGrid.Rows[6].Cells[2].Style = CellStyleVal;
        LentiPdfGrid.Rows[6].Cells[3].Style = CellStyleVal;
        LentiPdfGrid.Rows[6].Cells[4].Style = CellStyleVal;
        LentiPdfGrid.Rows[6].Cells[5].Style = CellStyleVal;
        LentiPdfGrid.Rows[6].Cells[6].Style = CellStyleVal;

        value = new PdfTextElement("", MisRegFont, PdfBrushes.Black);                                   //  6 - 0
        LentiPdfGrid.Rows[6].Cells[0].Value = value;
        value = new PdfTextElement(SetObjNullToStr(Visus.ODP_Sf), MisRegFont, PdfBrushes.Black);        //  6 - 1
        LentiPdfGrid.Rows[6].Cells[1].Value = value;
        value = new PdfTextElement(SetObjNullToStr(Visus.ODP_Cil), MisRegFont, PdfBrushes.Black);       //  6 - 2
        LentiPdfGrid.Rows[6].Cells[2].Value = value;
        value = new PdfTextElement(SetObjNullToStr(Visus.ODP_Asse), MisRegFont, PdfBrushes.Black);      //  6 - 3
        LentiPdfGrid.Rows[6].Cells[3].Value = value;
        value = new PdfTextElement(SetObjNullToStr(Visus.OSP_Sf), MisRegFont, PdfBrushes.Black);        //  6 - 4
        LentiPdfGrid.Rows[6].Cells[4].Value = value;
        value = new PdfTextElement(SetObjNullToStr(Visus.OSP_Cil), MisRegFont, PdfBrushes.Black);       //  6 - 5
        LentiPdfGrid.Rows[6].Cells[5].Value = value;
        value = new PdfTextElement(SetObjNullToStr(Visus.OSP_Asse), MisRegFont, PdfBrushes.Black);      //  6 - 6
        LentiPdfGrid.Rows[6].Cells[6].Value = value;

        LentiPdfGrid.Rows[7].Cells[0].Style = CellStyleE;
        LentiPdfGrid.Rows[7].Cells[1].Style = CellStyleHbV;

        value = new PdfTextElement("", MisRegFont, PdfBrushes.Black);                                   //  7 - 0
        LentiPdfGrid.Rows[7].Cells[0].Value = value;
        value = new PdfTextElement("PER LETTURA", MisBldFont, PdfBrushes.Black);                        //  7 - 1
        LentiPdfGrid.Rows[7].Cells[1].Value = value;

        LentiPdfGrid.Rows[8].Cells[0].Style = CellStyleE;
        LentiPdfGrid.Rows[8].Cells[1].Style = CellStyleVal;
        LentiPdfGrid.Rows[8].Cells[2].Style = CellStyleVal;
        LentiPdfGrid.Rows[8].Cells[3].Style = CellStyleVal;
        LentiPdfGrid.Rows[8].Cells[4].Style = CellStyleVal;
        LentiPdfGrid.Rows[8].Cells[5].Style = CellStyleVal;
        LentiPdfGrid.Rows[8].Cells[6].Style = CellStyleVal;

        value = new PdfTextElement("", MisRegFont, PdfBrushes.Black);                                   //  8 - 0
        LentiPdfGrid.Rows[8].Cells[0].Value = value;
        value = new PdfTextElement(SetObjNullToStr(Visus.ODL_Sf), MisRegFont, PdfBrushes.Black);        //  8 - 1
        LentiPdfGrid.Rows[8].Cells[1].Value = value;
        value = new PdfTextElement(SetObjNullToStr(Visus.ODL_Cil), MisRegFont, PdfBrushes.Black);       //  8 - 2
        LentiPdfGrid.Rows[8].Cells[2].Value = value;
        value = new PdfTextElement(SetObjNullToStr(Visus.ODL_Asse), MisRegFont, PdfBrushes.Black);      //  8 - 3
        LentiPdfGrid.Rows[8].Cells[3].Value = value;
        value = new PdfTextElement(SetObjNullToStr(Visus.OSL_Sf), MisRegFont, PdfBrushes.Black);        //  8 - 4
        LentiPdfGrid.Rows[8].Cells[4].Value = value;
        value = new PdfTextElement(SetObjNullToStr(Visus.OSL_Cil), MisRegFont, PdfBrushes.Black);       //  8 - 5
        LentiPdfGrid.Rows[8].Cells[5].Value = value;
        value = new PdfTextElement(SetObjNullToStr(Visus.OSL_Asse), MisRegFont, PdfBrushes.Black);      //  8 - 6
        LentiPdfGrid.Rows[8].Cells[6].Value = value;
        #endregion

        // Draw PDF grid into the PDF page.
        PdfLayoutResult result2 = LentiPdfGrid.Draw(page, new Syncfusion.Drawing.PointF(0, result.Bounds.Bottom + paragraphAfterSpacing));
        #endregion

        #region Terza parte: Note PRESCRIZIONE LENTI
        #region Definizione stili celle Note PRESCRIZIONE LENTI
        // Specify the style for head's cell
        PdfGridCellStyle CellStyleH = new PdfGridCellStyle();
        CellStyleH.Borders.Left.Width = 0F;
        CellStyleH.Borders.Right.Width = 0F;
        CellStyleH.Borders.Top.Width = 0F;
        CellStyleH.Borders.Bottom.Width = 0F;
        CellStyleH.CellPadding = new PdfPaddings(2, 0, 0, 0);

        PdfGridCellStyle CellStyleL = new PdfGridCellStyle();
        CellStyleL.Borders.Left.Width = 0F;
        CellStyleL.Borders.Right.Width = 0F;
        CellStyleL.Borders.Top.Width = 0F;
        CellStyleL.Borders.Bottom.Width = 0F;
        CellStyleL.CellPadding = new PdfPaddings(2, 0, 0, 0);

        PdfGridCellStyle CellStyleF = new PdfGridCellStyle();
        CellStyleF.Borders.Left.Width = 0F;
        CellStyleF.Borders.Right.Width = 0F;
        CellStyleF.Borders.Top.Width = 0F;
        CellStyleF.Borders.Bottom.Width = 0F;
        CellStyleF.CellPadding = new PdfPaddings(90, 0, 28, 0);
        CellStyleF.StringFormat = new PdfStringFormat(PdfTextAlignment.Center);
        #endregion

        #region Imposta griglia Note PRESCRIZIONE LENTI
        // Create Grid
        PdfGrid NotePdfGrid = new PdfGrid();

        //Adding grid style
        NotePdfGrid.Style = gridStyle;

        // Add Rows
        PdfGridRow rowN0 = NotePdfGrid.Rows.Add();
        PdfGridRow rowN1 = NotePdfGrid.Rows.Add();
        PdfGridRow rowN2 = NotePdfGrid.Rows.Add();

        // Add Columns
        NotePdfGrid.Columns.Add(5);

        // Set Rows's height
        rowN0.Height = 16;
        rowN1.Height = 16;
        rowN2.Height = 16;

        // Set Columns's width
        NotePdfGrid.Columns[0].Width = 100;
        NotePdfGrid.Columns[1].Width = 36;
        NotePdfGrid.Columns[2].Width = 97;
        NotePdfGrid.Columns[3].Width = 68;
        NotePdfGrid.Columns[4].Width = 229;

        // Set columns merged (ColumnSpan & RowSpan)
        NotePdfGrid.Rows[0].Cells[2].ColumnSpan = 3;
        NotePdfGrid.Rows[1].Cells[1].ColumnSpan = 2;
        NotePdfGrid.Rows[1].Cells[3].ColumnSpan = 2;

        NotePdfGrid.Rows[2].Cells[2].ColumnSpan = 3;
        #endregion

        #region Inserimento Note PRESCRIZIONE LENTI
        NotePdfGrid.Rows[0].Cells[0].Style = CellStyleE;
        NotePdfGrid.Rows[0].Cells[1].Style = CellStyleH;
        NotePdfGrid.Rows[0].Cells[2].Style = CellStyleL;

        value = new PdfTextElement("", FieldRegFont, PdfBrushes.Black);                             //  0 - 0
        NotePdfGrid.Rows[0].Cells[0].Value = value;
        value = new PdfTextElement("TABO", FieldBldFont, PdfBrushes.Black);                         //  0 - 1
        NotePdfGrid.Rows[0].Cells[1].Value = value;
        if (fTabo)
        {
            value = new PdfTextElement("Si", FieldRegFont, PdfBrushes.Black);                       //  0 - 2
        }
        else
        {
            value = new PdfTextElement("No", FieldRegFont, PdfBrushes.Black);                       //  0 - 2
        }
        NotePdfGrid.Rows[0].Cells[2].Value = value;

        NotePdfGrid.Rows[1].Cells[0].Style = CellStyleE;
        NotePdfGrid.Rows[1].Cells[1].Style = CellStyleH;
        NotePdfGrid.Rows[1].Cells[3].Style = CellStyleL;

        value = new PdfTextElement("", FieldRegFont, PdfBrushes.Black);                             //  1 - 0
        NotePdfGrid.Rows[1].Cells[0].Value = value;
        value = new PdfTextElement("Distanza interpupillare mm", FieldBldFont, PdfBrushes.Black);   //  1 - 1
        NotePdfGrid.Rows[1].Cells[1].Value = value;
        value = new PdfTextElement(SetObjNullToStr(Visus.DI), FieldRegFont, PdfBrushes.Black);      //  1 - 3
        NotePdfGrid.Rows[1].Cells[3].Value = value;

        NotePdfGrid.Rows[2].Cells[0].Style = CellStyleE;
        NotePdfGrid.Rows[2].Cells[1].Style = CellStyleH;
        NotePdfGrid.Rows[2].Cells[2].Style = CellStyleL;

        value = new PdfTextElement("", FieldRegFont, PdfBrushes.Black);                             //  2 - 0
        NotePdfGrid.Rows[2].Cells[0].Value = value;
        value = new PdfTextElement("NOTE", FieldBldFont, PdfBrushes.Black);                         //  2 - 1
        NotePdfGrid.Rows[2].Cells[1].Value = value;
        value = new PdfTextElement(SetObjNullToStr(Visus.Note), FieldRegFont, PdfBrushes.Black);    //  2 - 2
        NotePdfGrid.Rows[2].Cells[2].Value = value;
        #endregion

        // Draw PDF grid into the PDF page.
        PdfLayoutResult result3 = NotePdfGrid.Draw(page, new Syncfusion.Drawing.PointF(0, result2.Bounds.Bottom + paragraphAfterSpacing));
        #endregion

        #region Timbro
        PdfStandardFont TimbroFont = new PdfStandardFont(PdfFontFamily.TimesRoman, 8, PdfFontStyle.Bold);

        PdfGrid TimbroPdfGrid = new PdfGrid();

        TimbroPdfGrid.AllowRowBreakAcrossPages = false;

        PdfGridCellStyle tCellStyle0 = new PdfGridCellStyle();
        PdfGridCellStyle tCellStyle1 = new PdfGridCellStyle();
        PdfGridCellStyle tCellStyle2 = new PdfGridCellStyle();
        PdfGridCellStyle tCellStyle3 = new PdfGridCellStyle();
        PdfGridCellStyle tCellStyle4 = new PdfGridCellStyle();
        PdfGridCellStyle tCellStyle5 = new PdfGridCellStyle();
        PdfGridCellStyle tCellStyle6 = new PdfGridCellStyle();

        tCellStyle2.Borders.Left.Width = 0F;
        tCellStyle2.Borders.Right.Width = 0F;
        tCellStyle2.Borders.Top.Width = 0F;
        tCellStyle2.Borders.Bottom.Width = 0F;
        tCellStyle2.CellPadding = new PdfPaddings(16F, 0, 1F, 0);

        tCellStyle3.Borders.Left.Width = 0F;
        tCellStyle3.Borders.Right.Width = 0F;
        tCellStyle3.Borders.Top.Width = 0F;
        tCellStyle3.Borders.Bottom.Width = 0F;
        tCellStyle3.CellPadding = new PdfPaddings(53.2F, 0, 1F, 0);

        if (who == "1")     // Marco
        {
            tCellStyle0.Borders.Left.Width = 0F;
            tCellStyle0.Borders.Right.Width = 0F;
            tCellStyle0.Borders.Top.Width = 0F;
            tCellStyle0.Borders.Bottom.Width = 0F;
            tCellStyle0.CellPadding = new PdfPaddings(25.3F, 0, 0, 0);

            tCellStyle1.Borders.Left.Width = 0F;
            tCellStyle1.Borders.Right.Width = 0F;
            tCellStyle1.Borders.Top.Width = 0F;
            tCellStyle1.Borders.Bottom.Width = 0F;
            tCellStyle1.CellPadding = new PdfPaddings(26F, 0, 1F, 0);

            tCellStyle4.Borders.Left.Width = 0F;
            tCellStyle4.Borders.Right.Width = 0F;
            tCellStyle4.Borders.Top.Width = 0F;
            tCellStyle4.Borders.Bottom.Width = 0F;
            tCellStyle4.CellPadding = new PdfPaddings(10.3F, 0, 1F, 0);

            tCellStyle5.Borders.Left.Width = 0F;
            tCellStyle5.Borders.Right.Width = 0F;
            tCellStyle5.Borders.Top.Width = 0F;
            tCellStyle5.Borders.Bottom.Width = 0F;
            tCellStyle5.CellPadding = new PdfPaddings(28.9F, 0, 1F, 0);

            tCellStyle6.Borders.Left.Width = 0F;
            tCellStyle6.Borders.Right.Width = 0F;
            tCellStyle6.Borders.Top.Width = 0F;
            tCellStyle6.Borders.Bottom.Width = 0F;
            tCellStyle6.CellPadding = new PdfPaddings(18.9F, 0, 1F, 0);
        }
        else                // Pietro
        {
            tCellStyle0.Borders.Left.Width = 0F;
            tCellStyle0.Borders.Right.Width = 0F;
            tCellStyle0.Borders.Top.Width = 0F;
            tCellStyle0.Borders.Bottom.Width = 0F;
            tCellStyle0.CellPadding = new PdfPaddings(25.3F, 0, 0, 0);

            tCellStyle1.Borders.Left.Width = 0F;
            tCellStyle1.Borders.Right.Width = 0F;
            tCellStyle1.Borders.Top.Width = 0F;
            tCellStyle1.Borders.Bottom.Width = 0F;
            tCellStyle1.CellPadding = new PdfPaddings(31.8F, 0, 1F, 0);

            tCellStyle4.Borders.Left.Width = 0F;
            tCellStyle4.Borders.Right.Width = 0F;
            tCellStyle4.Borders.Top.Width = 0F;
            tCellStyle4.Borders.Bottom.Width = 0F;
            tCellStyle4.CellPadding = new PdfPaddings(12.5F, 0, 1F, 0);

            tCellStyle5.Borders.Left.Width = 0F;
            tCellStyle5.Borders.Right.Width = 0F;
            tCellStyle5.Borders.Top.Width = 0F;
            tCellStyle5.Borders.Bottom.Width = 0F;
            tCellStyle5.CellPadding = new PdfPaddings(28.9F, 0, 1F, 0);

            tCellStyle6.Borders.Left.Width = 0F;
            tCellStyle6.Borders.Right.Width = 0F;
            tCellStyle6.Borders.Top.Width = 0F;
            tCellStyle6.Borders.Bottom.Width = 0F;
            tCellStyle6.CellPadding = new PdfPaddings(20.3F, 0, 1F, 0);
        }

        // Add rows to the DataTable.
        PdfGridRow trow0 = TimbroPdfGrid.Rows.Add();
        PdfGridRow trow1 = TimbroPdfGrid.Rows.Add();
        PdfGridRow trow2 = TimbroPdfGrid.Rows.Add();
        PdfGridRow trow3 = TimbroPdfGrid.Rows.Add();
        PdfGridRow trow4 = TimbroPdfGrid.Rows.Add();
        PdfGridRow trow5 = TimbroPdfGrid.Rows.Add();
        PdfGridRow trow6 = TimbroPdfGrid.Rows.Add();

        // Add the columns to head grid
        TimbroPdfGrid.Columns.Add(1);

        // Adding grid cell style
        PdfGridCellStyle cellStyle = new PdfGridCellStyle();
        cellStyle.Borders.Left.Width = 0.1F;
        cellStyle.Borders.Right.Width = 0.1F;
        cellStyle.Borders.Top.Width = 0.1F;
        cellStyle.Borders.Bottom.Width = 0.1F;

        //Set cell paddings.
        cellStyle.CellPadding = new PdfPaddings(10, 0, 0, 0);

        // Set columns's width
        TimbroPdfGrid.Columns[0].Width = 150;

        //Applying style to grid
        TimbroPdfGrid.Rows[0].Cells[0].Style = tCellStyle0;
        TimbroPdfGrid.Rows[1].Cells[0].Style = tCellStyle1;
        TimbroPdfGrid.Rows[2].Cells[0].Style = tCellStyle2;
        TimbroPdfGrid.Rows[3].Cells[0].Style = tCellStyle3;
        TimbroPdfGrid.Rows[4].Cells[0].Style = tCellStyle4;
        TimbroPdfGrid.Rows[5].Cells[0].Style = tCellStyle5;
        TimbroPdfGrid.Rows[6].Cells[0].Style = tCellStyle6;

        // Set rows values
        val = new PdfTextElement("Dott. " + doctor, TimbroFont, PdfBrushes.Black);       // 0 - 0
        TimbroPdfGrid.Rows[0].Cells[0].Value = val;

        val = new PdfTextElement(specialization, TimbroFont, PdfBrushes.Black);          // 1 - 0
        TimbroPdfGrid.Rows[1].Cells[0].Value = val;

        val = new PdfTextElement(address, TimbroFont, PdfBrushes.Black);                 // 2 - 0
        TimbroPdfGrid.Rows[2].Cells[0].Value = val;

        val = new PdfTextElement(city, TimbroFont, PdfBrushes.Black);                    // 3 - 0
        TimbroPdfGrid.Rows[3].Cells[0].Value = val;

        val = new PdfTextElement(codfisc, TimbroFont, PdfBrushes.Black);                 // 4 - 0
        TimbroPdfGrid.Rows[4].Cells[0].Value = val;

        val = new PdfTextElement(piva, TimbroFont, PdfBrushes.Black);                    // 5 - 0
        TimbroPdfGrid.Rows[5].Cells[0].Value = val;

        val = new PdfTextElement(ordine, TimbroFont, PdfBrushes.Black);                  // 6 - 0
        TimbroPdfGrid.Rows[6].Cells[0].Value = val;

        // Draw PDF grid into the PDF page.
        PdfLayoutResult result4 = TimbroPdfGrid.Draw(page, new Syncfusion.Drawing.PointF(350, result3.Bounds.Bottom + paragraphAfterSpacing));

        // Disclaimer
        g.DrawString("Riportare la presente prescrizione nelle visite successive", FieldItaBldFont, PdfBrushes.Black, 191.18F, result4.Bounds.Bottom + paragraphAfterSpacing + 10);
        #endregion

        //Create memory stream.
        MemoryStream memoryStream = new MemoryStream();

        //Save the PDF document.
        pdfDocument.Save(memoryStream);

        //Download the PDF document
        await JS.SaveAs("Prescrizione Lenti " + LName + " " + FName + "_" + ListaVisite[VisitaCorrente].Val.ToString("dd.MM.yyyy") + ".pdf", memoryStream.ToArray());
    }

    async void PrintPrescrizione(string who)
    {
        int paragraphAfterSpacing = 8;
        // int cellMargin = 8;

        string doctor = "";
        string specialization = "";
        string address = "V.le R. Sanzio, 60 Tel 095 371701";
        string city = "CATANIA";
        string codfisc = "";
        string piva = "";
        string ordine = "";

        string iscrOrdine = "";

        if (who == "1")
        {
            doctor = "MARCO LA BRUNA";
            specialization = "Specialista in Oftalmologia";
            codfisc = "Cod. Fisc. LBR MRC 84M31 C351P";
            piva = "Partita IVA 05289740879";
            ordine = "Ordine dei Medici CT n° 14037";

            iscrOrdine = "Iscriz. Ord. Dei Medici di CT - Marco La Bruna n° 14037";
        }
        else
        {
            doctor = "PIETRO LA BRUNA";
            specialization = "Specialista in Oculistica";
            codfisc = "Cod. Fisc. LBR PTR 49T07 H221S";
            piva = "Partita IVA 00635170871";
            // ordine = "Ordine dei Medici CT n° 5133";

            iscrOrdine = "Iscriz. Ord. Dei Medici di CT - Pietro La Bruna n° 5133";
        }

        FirstPage = true;

        //Create a new PDF document.
        PdfDocument pdfDocument = new PdfDocument();

        // Add the event.
        // ------------------------------------------------------------------------------------------------------------------------
        pdfDocument.Pages.PageAdded += Pages_PageAdded;
        // ------------------------------------------------------------------------------------------------------------------------

        #region Definizione documento pdf
        // Set document information
        // ------------------------------------------------------------------------------------------------------------------------
        pdfDocument.DocumentInformation.Author = "Powered by Phoenix";
        pdfDocument.DocumentInformation.CreationDate = DateTime.Now;
        pdfDocument.DocumentInformation.Creator = "Ophthal";
        pdfDocument.DocumentInformation.Keywords = "Dott. " + doctor + " La Bruna";
        pdfDocument.DocumentInformation.Subject = "Scheda Prescrizione"; //pDataPrescrizione
        pdfDocument.DocumentInformation.Title = "Prescrizione " + LName + " " + FName + "_" + pDataPrescrizione.Substring(0, 2) + "." + pDataPrescrizione.Substring(2, 2) + "." + pDataPrescrizione.Substring(4, 4);

        // Set page size
        // ------------------------------------------------------------------------------------------------------------------------
        pdfDocument.PageSettings.Size = Syncfusion.Pdf.PdfPageSize.A4;

        // Set margin for all the pages
        pdfDocument.PageSettings.Margins.Left = 20F;
        pdfDocument.PageSettings.Margins.Right = 30F;
        pdfDocument.PageSettings.Margins.Top = 20F;
        pdfDocument.PageSettings.Margins.Bottom = 50F;
        // pdfDocument.PageSettings.Margins.Bottom = 10F;

        // pdfDocument.PageSettings.Margins.All = 40F;

        // Set page orientation
        // ------------------------------------------------------------------------------------------------------------------------
        pdfDocument.PageSettings.Orientation = PdfPageOrientation.Portrait;

        // Set paginate layout
        // ------------------------------------------------------------------------------------------------------------------------
        PdfLayoutFormat format = new PdfLayoutFormat();
        format.Layout = PdfLayoutType.Paginate;

        // Add page to the PDF document
        PdfPage page = pdfDocument.Pages.Add();

        // Obtain PdfGraphics object.
        PdfGraphics g = page.Graphics;
        #endregion

        #region Header & Footer
        // Create Header and Footer font
        // ------------------------------------------------------------------------------------------------------------------------
        PdfFont fontHeader = new PdfStandardFont(PdfFontFamily.Helvetica, 14, PdfFontStyle.Regular);
        PdfFont fontFooter = new PdfStandardFont(PdfFontFamily.Helvetica, 7, PdfFontStyle.Regular);

        #region Header
        // Get document's bounds
        // ------------------------------------------------------------------------------------------------------------------------
        RectangleF bounds = new RectangleF(0, 0, pdfDocument.Pages[0].GetClientSize().Width, 70);

        // Create a Page template that can be used as header.
        // ------------------------------------------------------------------------------------------------------------------------
        PdfPageTemplateElement header = new PdfPageTemplateElement(bounds);

        // Load image for header
        // Scarica l'immagine dal server
        var httpClient = new HttpClient();
        // string imageUrl = $"{Env.BaseAddress}/img/template-4.png";                      // URL dell'immagine
        string imageUrl = $"{Env.BaseAddress}/img/LB_99_53.png";                      // URL dell'immagine
        var imageBytes = await httpClient.GetByteArrayAsync(imageUrl);

        PdfGridCellStyle HeadLogoStyle = new PdfGridCellStyle();
        HeadLogoStyle.Borders.Left.Width = 0F;
        HeadLogoStyle.Borders.Right.Width = 0F;
        HeadLogoStyle.Borders.Top.Width = 0F;
        HeadLogoStyle.Borders.Bottom.Width = 0F;
        HeadLogoStyle.CellPadding = new PdfPaddings(0, 0, 0, 0);

        // Setup font for Dati Testata
        PdfStandardFont SideFont = new PdfStandardFont(PdfFontFamily.TimesRoman, 10, PdfFontStyle.Bold | PdfFontStyle.Italic);
        PdfStandardFont hHeadFont = new PdfStandardFont(PdfFontFamily.TimesRoman, 16, PdfFontStyle.Bold | PdfFontStyle.Italic);

        PdfStandardFont PdPFont = new PdfStandardFont(PdfFontFamily.TimesRoman, 8, PdfFontStyle.Bold);
        PdfStandardFont FootFont = new PdfStandardFont(PdfFontFamily.TimesRoman, 9, PdfFontStyle.Bold | PdfFontStyle.Italic);

        // Specify the style for bottom
        PdfGridCellStyle HeadStyle = new PdfGridCellStyle();
        HeadStyle.Borders.Left.Width = 0F;
        HeadStyle.Borders.Right.Width = 0F;
        HeadStyle.Borders.Top.Width = 0F;
        HeadStyle.Borders.Bottom.Width = 0F;
        HeadStyle.CellPadding = new PdfPaddings(15, 10, 0, 0);
        HeadStyle.StringFormat = new PdfStringFormat(PdfTextAlignment.Center);

        // Usa un MemoryStream per creare il PdfBitmap
        using (MemoryStream imageStream = new MemoryStream(imageBytes))
        {
            PdfBitmap image = new PdfBitmap(imageStream);

            // Draw the image in the header.
            header.Graphics.DrawImage(image, 5, 15);
        }

        header.Graphics.DrawString("DOTT. " + doctor, hHeadFont, PdfBrushes.Black, 100, 14);
        header.Graphics.DrawString(specialization, hHeadFont, PdfBrushes.Black, 100, 36);

        PdfPen hPen = new PdfPen(Color.Black);
        hPen.Width = 0.1F;

        PointF hP1 = new PointF();
        PointF hP2 = new PointF();

        // linea verticale
        hP1.X = 85;
        hP1.Y = 0;

        hP2.X = 85;
        hP2.Y = 70;

        header.Graphics.DrawLine(hPen, hP1, hP2);

        // top linea orizzontale
        hP1.X = 0;
        hP1.Y = 70;

        hP2.X = 545;
        hP2.Y = 70;

        header.Graphics.DrawLine(hPen, hP1, hP2);

        // Add the header at the top.
        pdfDocument.Template.Top = header;
        #endregion

        #region Footer
        // Set document's bounds
        // ------------------------------------------------------------------------------------------------------------------------
        RectangleF fBounds = new RectangleF(0, 0, pdfDocument.Pages[0].GetClientSize().Width, 70);

        // Create a Page template that can be used as footer.
        // ------------------------------------------------------------------------------------------------------------------------
        PdfPageTemplateElement footer = new PdfPageTemplateElement(fBounds);

        PdfBrush brush = new PdfSolidBrush(Color.Black);

        // Create page number field.
        PdfPageNumberField pageNumber = new PdfPageNumberField(fontFooter, brush);

        // Create page count field.
        PdfPageCountField count = new PdfPageCountField(fontFooter, brush);

        // Add the fields in composite fields.
        PdfCompositeField compositeField = new PdfCompositeField(fontFooter, brush, "Pag. {0} di {1}", pageNumber, count);

        compositeField.Bounds = footer.Bounds;

        Console.WriteLine($"pageNumber: {pageNumber}, count: {count}");

        // Draw the composite field in footer.
        compositeField.Draw(footer.Graphics, new PointF(20, 28));

        footer.Graphics.DrawString("Viale Raffaello Sanzio, 60 – scala C, 5° piano – (Piazza Michelangelo) - 95128 Catania (CT)", FootFont, PdfBrushes.Black, 151, 8);
        footer.Graphics.DrawString("Riceve per appuntamento – Tel/Fax: 095371701", FootFont, PdfBrushes.Black, 230, 22);
        footer.Graphics.DrawString("Sito Web: http://www.studiolabruna.it – email: info@studiolabruna.it", FootFont, PdfBrushes.Black, 190, 36);
        footer.Graphics.DrawString(iscrOrdine, FootFont, PdfBrushes.Black, 212, 50);

        PdfPen fPen = new PdfPen(Color.Black);
        fPen.Width = 0.1F;

        PointF fP1 = new PointF();
        PointF fP2 = new PointF();

        // linea verticale
        fP1.X = 85;
        fP1.Y = 0;

        fP2.X = 85;
        fP2.Y = 70;

        footer.Graphics.DrawLine(fPen, fP1, fP2);

        // bottom linea orizzontale
        fP1.X = 0;
        fP1.Y = 0;

        fP2.X = 545;
        fP2.Y = 0;

        footer.Graphics.DrawLine(fPen, fP1, fP2);

        // Add the footer template at the bottom.
        pdfDocument.Template.Bottom = footer;
        #endregion
        #endregion

        #region Prima parte: Dati Testata
        PdfFont fieldPaziente = new PdfStandardFont(PdfFontFamily.Helvetica, 14, PdfFontStyle.Bold | PdfFontStyle.Italic);
        PdfFont fieldHelvBold = new PdfStandardFont(PdfFontFamily.Helvetica, 12, PdfFontStyle.Bold | PdfFontStyle.Italic);

        #region Imposta griglia Dati Testata
        // Create the head grid
        PdfGrid HeadPdfGrid = new PdfGrid();

        PdfGridCellStyle posCellStyleP0 = new PdfGridCellStyle();
        posCellStyleP0.Borders.Left.Width = 0;
        posCellStyleP0.Borders.Right.Width = 0;
        posCellStyleP0.Borders.Top.Width = 0;
        posCellStyleP0.Borders.Bottom.Width = 0;
        posCellStyleP0.CellPadding = new PdfPaddings(0, 3, 6, 0);

        PdfGridCellStyle posCellStyleP1 = new PdfGridCellStyle();
        posCellStyleP1.Borders.Left.Width = 0;
        posCellStyleP1.Borders.Right.Width = 0;
        posCellStyleP1.Borders.Top.Width = 0;
        posCellStyleP1.Borders.Bottom.Width = 0;
        posCellStyleP1.CellPadding = new PdfPaddings(0, 3, 12, 0);


        // Add the rows to head grid
        PdfGridRow row0 = HeadPdfGrid.Rows.Add();
        PdfGridRow row1 = HeadPdfGrid.Rows.Add();

        //Adding grid style
        PdfGridStyle gridStyle = new PdfGridStyle();

        //Allow grid to overflow horizontally
        gridStyle.AllowHorizontalOverflow = true;

        //Adding cell spacing between cells
        gridStyle.CellSpacing = 0F;

        HeadPdfGrid.Style = gridStyle;

        // Add the columns to head grid
        HeadPdfGrid.Columns.Add(2);

        // Set columns's width
        HeadPdfGrid.Columns[0].Width = 100;
        HeadPdfGrid.Columns[1].Width = 430;

        // Set columns merged
        //HeadPdfGrid.Rows[0].Cells[0].RowSpan = 2;
        #endregion

        #region Inserimento Dati Testata
        // Set the HeadPdfGrid's value
        PdfTextElement val;

        HeadPdfGrid.Rows[0].Cells[0].Style = posCellStyleP0;
        HeadPdfGrid.Rows[0].Cells[1].Style = posCellStyleP0;

        val = new PdfTextElement(" ", fieldPaziente, PdfBrushes.Black);                     // 0-0
        HeadPdfGrid.Rows[0].Cells[0].Value = val;

        val = new PdfTextElement(LName + " " + FName, fieldPaziente, PdfBrushes.Black);     // 0-1
        HeadPdfGrid.Rows[0].Cells[1].Value = val;

        HeadPdfGrid.Rows[1].Cells[0].Style = posCellStyleP1;
        HeadPdfGrid.Rows[1].Cells[1].Style = posCellStyleP1;

        val = new PdfTextElement(" ", fieldPaziente, PdfBrushes.Black);                     // 1-0
        HeadPdfGrid.Rows[1].Cells[0].Value = val;

        val = new PdfTextElement("Prescrizione", fieldHelvBold, PdfBrushes.Black);          // 1-1
        HeadPdfGrid.Rows[1].Cells[1].Value = val;

        PdfLayoutResult result = HeadPdfGrid.Draw(page, new Syncfusion.Drawing.PointF(0, 80));
        #endregion
        #endregion

        #region Seconda parte: Dati Prescrizione
        // Create field's name and field's font
        // ------------------------------------------------------------------------------------------------------------------------
        PdfFont fieldNameFont = new PdfStandardFont(PdfFontFamily.TimesRoman, 11, PdfFontStyle.Bold);
        PdfFont fieldFont = new PdfStandardFont(PdfFontFamily.Helvetica, 11, PdfFontStyle.Regular);

        PdfFont fieldDateFont = new PdfStandardFont(PdfFontFamily.Helvetica, 11, PdfFontStyle.Bold);
        PdfFont fieldValueFont = new PdfStandardFont(PdfFontFamily.Helvetica, 11, PdfFontStyle.Regular);

        PdfFont italicdFont = new PdfStandardFont(PdfFontFamily.Helvetica, 10, PdfFontStyle.Italic);

        #region Definizione stile celle Prescrizione
        PdfGridCellStyle posCellStyleH1 = new PdfGridCellStyle();
        posCellStyleH1.Borders.Left.Width = 0;
        posCellStyleH1.Borders.Right.Width = 0;
        posCellStyleH1.Borders.Top.Width = 0;
        posCellStyleH1.Borders.Bottom.Width = 0;
        posCellStyleH1.CellPadding = new PdfPaddings(0, 3, 0, 0);

        PdfGridCellStyle posCellStyleV1 = new PdfGridCellStyle();
        posCellStyleV1.Borders.Left.Width = 0;
        posCellStyleV1.Borders.Right.Width = 0;
        posCellStyleV1.Borders.Top.Width = 0;
        posCellStyleV1.Borders.Bottom.Width = 0;
        posCellStyleV1.CellPadding = new PdfPaddings(0, 3, 0, 0);

        PdfGridCellStyle posCellStyleH2 = new PdfGridCellStyle();
        posCellStyleH2.Borders.Left.Width = 0;
        posCellStyleH2.Borders.Right.Width = 0;
        posCellStyleH2.Borders.Top.Width = 0;
        posCellStyleH2.Borders.Bottom.Width = 0;
        posCellStyleH2.CellPadding = new PdfPaddings(0, 3, 0, 0);

        PdfGridCellStyle posCellStyleV2 = new PdfGridCellStyle();
        posCellStyleV2.Borders.Left.Width = 0;
        posCellStyleV2.Borders.Right.Width = 0;
        posCellStyleV2.Borders.Top.Width = 0;
        posCellStyleV2.Borders.Bottom.Width = 0;
        posCellStyleV2.CellPadding = new PdfPaddings(0, 3, 0, 0);

        PdfGridCellStyle posCellStyleN = new PdfGridCellStyle();
        posCellStyleN.Borders.Left.Width = 0;
        posCellStyleN.Borders.Right.Width = 0;
        posCellStyleN.Borders.Top.Width = 0;
        posCellStyleN.Borders.Bottom.Width = 0F;
        posCellStyleN.CellPadding = new PdfPaddings(3, 3, 16, 0);

        PdfGridCellStyle posCellStyleD = new PdfGridCellStyle();
        posCellStyleD.Borders.Left.Width = 0;
        posCellStyleD.Borders.Right.Width = 0;
        posCellStyleD.Borders.Top.Width = 0;
        posCellStyleD.Borders.Bottom.Width = 0F;
        posCellStyleD.CellPadding = new PdfPaddings(3, 3, 36, 0);
        #endregion

        #region Imposta griglia Prescrizioni
        // Create Grid
        PdfGrid PrescrPdfGrid = new PdfGrid();

        // Add Columns
        PrescrPdfGrid.Columns.Add(2);

        // Set Columns's width
        PrescrPdfGrid.Columns[0].Width = 35;        // Pr./ o S. /
        PrescrPdfGrid.Columns[1].Width = 375;       // somministrazione
        #endregion

        #region Inserimento Dati Prescrizioni
        // Set the HeadPdfGrid's value
        PdfTextElement value;

        Console.WriteLine($"📌 Prescrizione - Inizio Farmaci ");
        for (var np = 0; np < Prescriptions.Count - 1; np++)
        {
            // riga farmaco
            PdfGridRow fRow = PrescrPdfGrid.Rows.Add();

            fRow.Cells[0].Style = posCellStyleH1;
            fRow.Cells[1].Style = posCellStyleV1;

            val = new PdfTextElement("Pr./ ", fieldFont, PdfBrushes.Black);
            fRow.Cells[0].Value = val;

            val = new PdfTextElement(Prescriptions[np].Farmaco.Trim(), fieldFont, PdfBrushes.Black);
            fRow.Cells[1].Value = val;

            Console.WriteLine($"🔷\t np: {np}\t Pr./ [Farmaco]: {Prescriptions[np].Farmaco.Trim()}");

            // riga somministrazione
            PdfGridRow uRow = PrescrPdfGrid.Rows.Add();

            uRow.Cells[0].Style = posCellStyleH2;
            uRow.Cells[1].Style = posCellStyleV2;

            val = new PdfTextElement("S. /", fieldFont, PdfBrushes.Black);
            uRow.Cells[0].Value = val;

            val = new PdfTextElement(Prescriptions[np].Uso.Trim(), fieldFont, PdfBrushes.Black);
            uRow.Cells[1].Value = val;

            Console.WriteLine($"🔥\t :\t\t S. / [Uso]: {Prescriptions[np].Uso.Trim()}");

            // riga vuota
            PdfGridRow eRow = PrescrPdfGrid.Rows.Add();

            // eRow.Cells[0].ColumnSpan = 3;
            eRow.Cells[0].ColumnSpan = 2;

            eRow.Cells[0].Style = posCellStyleH1;

            val = new PdfTextElement(" ", fieldFont, PdfBrushes.Black);
            eRow.Cells[0].Value = val;

            if (np < Prescriptions.Count - 2)
            {
                Console.WriteLine($" ");
            }
        }
        Console.WriteLine($"📌 Prescrizione - Farmaci Completati ");
        Console.WriteLine($" ");

        // riga delle note
        if (NotaPrescrizione != "")
        {
            PdfGridRow nRow = PrescrPdfGrid.Rows.Add();
            nRow.Cells[0].ColumnSpan = 2;
            nRow.Cells[0].Style = posCellStyleN;

            val = new PdfTextElement(NotaPrescrizione, italicdFont, PdfBrushes.Black);
            nRow.Cells[0].Value = val;
        }

        // riga della data
        PdfGridRow dRow = PrescrPdfGrid.Rows.Add();
        dRow.Height = 36F;
        dRow.Cells[0].Style = posCellStyleD;
        dRow.Cells[1].Style = posCellStyleD;

        val = new PdfTextElement(" ", fieldFont, PdfBrushes.Black);
        dRow.Cells[0].Value = val;

        var TmpDate = pDataPrescrizione.Substring(0, 2) + "/" + pDataPrescrizione.Substring(2, 2) + "/" + pDataPrescrizione.Substring(4, 4);
        Console.WriteLine($"pDataRelazione: {pDataRelazione}");

        val = new PdfTextElement(TmpDate, fieldNameFont, PdfBrushes.Black);
        dRow.Cells[1].Value = val;
        #endregion

        // Draw PDF grid into the PDF page.
        PdfLayoutResult result2 = PrescrPdfGrid.Draw(page, new Syncfusion.Drawing.PointF(100, result.Bounds.Bottom + 24));
        #endregion

        #region Timbro
        PdfStandardFont TimbroFont = new PdfStandardFont(PdfFontFamily.TimesRoman, 8, PdfFontStyle.Bold);

        PdfGrid TimbroPdfGrid = new PdfGrid();

        TimbroPdfGrid.AllowRowBreakAcrossPages = false;

        PdfGridCellStyle tCellStyle0 = new PdfGridCellStyle();
        PdfGridCellStyle tCellStyle1 = new PdfGridCellStyle();
        PdfGridCellStyle tCellStyle2 = new PdfGridCellStyle();
        PdfGridCellStyle tCellStyle3 = new PdfGridCellStyle();
        PdfGridCellStyle tCellStyle4 = new PdfGridCellStyle();
        PdfGridCellStyle tCellStyle5 = new PdfGridCellStyle();
        PdfGridCellStyle tCellStyle6 = new PdfGridCellStyle();

        tCellStyle2.Borders.Left.Width = 0F;
        tCellStyle2.Borders.Right.Width = 0F;
        tCellStyle2.Borders.Top.Width = 0F;
        tCellStyle2.Borders.Bottom.Width = 0F;
        tCellStyle2.CellPadding = new PdfPaddings(16F, 0, 1F, 0);

        tCellStyle3.Borders.Left.Width = 0F;
        tCellStyle3.Borders.Right.Width = 0F;
        tCellStyle3.Borders.Top.Width = 0F;
        tCellStyle3.Borders.Bottom.Width = 0F;
        tCellStyle3.CellPadding = new PdfPaddings(53.2F, 0, 1F, 0);

        if (who == "1")     // Marco
        {
            tCellStyle0.Borders.Left.Width = 0F;
            tCellStyle0.Borders.Right.Width = 0F;
            tCellStyle0.Borders.Top.Width = 0F;
            tCellStyle0.Borders.Bottom.Width = 0F;
            tCellStyle0.CellPadding = new PdfPaddings(25.3F, 0, 0, 0);

            tCellStyle1.Borders.Left.Width = 0F;
            tCellStyle1.Borders.Right.Width = 0F;
            tCellStyle1.Borders.Top.Width = 0F;
            tCellStyle1.Borders.Bottom.Width = 0F;
            tCellStyle1.CellPadding = new PdfPaddings(26F, 0, 1F, 0);

            tCellStyle4.Borders.Left.Width = 0F;
            tCellStyle4.Borders.Right.Width = 0F;
            tCellStyle4.Borders.Top.Width = 0F;
            tCellStyle4.Borders.Bottom.Width = 0F;
            tCellStyle4.CellPadding = new PdfPaddings(10.3F, 0, 1F, 0);

            tCellStyle5.Borders.Left.Width = 0F;
            tCellStyle5.Borders.Right.Width = 0F;
            tCellStyle5.Borders.Top.Width = 0F;
            tCellStyle5.Borders.Bottom.Width = 0F;
            tCellStyle5.CellPadding = new PdfPaddings(28.9F, 0, 1F, 0);

            tCellStyle6.Borders.Left.Width = 0F;
            tCellStyle6.Borders.Right.Width = 0F;
            tCellStyle6.Borders.Top.Width = 0F;
            tCellStyle6.Borders.Bottom.Width = 0F;
            tCellStyle6.CellPadding = new PdfPaddings(18.9F, 0, 1F, 0);
        }
        else                // Pietro
        {
            tCellStyle0.Borders.Left.Width = 0F;
            tCellStyle0.Borders.Right.Width = 0F;
            tCellStyle0.Borders.Top.Width = 0F;
            tCellStyle0.Borders.Bottom.Width = 0F;
            tCellStyle0.CellPadding = new PdfPaddings(25.3F, 0, 0, 0);

            tCellStyle1.Borders.Left.Width = 0F;
            tCellStyle1.Borders.Right.Width = 0F;
            tCellStyle1.Borders.Top.Width = 0F;
            tCellStyle1.Borders.Bottom.Width = 0F;
            tCellStyle1.CellPadding = new PdfPaddings(31.8F, 0, 1F, 0);

            tCellStyle4.Borders.Left.Width = 0F;
            tCellStyle4.Borders.Right.Width = 0F;
            tCellStyle4.Borders.Top.Width = 0F;
            tCellStyle4.Borders.Bottom.Width = 0F;
            tCellStyle4.CellPadding = new PdfPaddings(12.5F, 0, 1F, 0);

            tCellStyle5.Borders.Left.Width = 0F;
            tCellStyle5.Borders.Right.Width = 0F;
            tCellStyle5.Borders.Top.Width = 0F;
            tCellStyle5.Borders.Bottom.Width = 0F;
            tCellStyle5.CellPadding = new PdfPaddings(28.9F, 0, 1F, 0);

            tCellStyle6.Borders.Left.Width = 0F;
            tCellStyle6.Borders.Right.Width = 0F;
            tCellStyle6.Borders.Top.Width = 0F;
            tCellStyle6.Borders.Bottom.Width = 0F;
            tCellStyle6.CellPadding = new PdfPaddings(20.3F, 0, 1F, 0);
        }

        // Add rows to the DataTable.
        PdfGridRow trow0 = TimbroPdfGrid.Rows.Add();
        PdfGridRow trow1 = TimbroPdfGrid.Rows.Add();
        PdfGridRow trow2 = TimbroPdfGrid.Rows.Add();
        PdfGridRow trow3 = TimbroPdfGrid.Rows.Add();
        PdfGridRow trow4 = TimbroPdfGrid.Rows.Add();
        PdfGridRow trow5 = TimbroPdfGrid.Rows.Add();
        PdfGridRow trow6 = TimbroPdfGrid.Rows.Add();

        // Add the columns to head grid
        TimbroPdfGrid.Columns.Add(1);

        // Adding grid cell style
        PdfGridCellStyle cellStyle = new PdfGridCellStyle();
        cellStyle.Borders.Left.Width = 0.1F;
        cellStyle.Borders.Right.Width = 0.1F;
        cellStyle.Borders.Top.Width = 0.1F;
        cellStyle.Borders.Bottom.Width = 0.1F;

        //Set cell paddings.
        cellStyle.CellPadding = new PdfPaddings(10, 0, 0, 0);

        // Set columns's width
        TimbroPdfGrid.Columns[0].Width = 150;

        //Applying style to grid
        TimbroPdfGrid.Rows[0].Cells[0].Style = tCellStyle0;
        TimbroPdfGrid.Rows[1].Cells[0].Style = tCellStyle1;
        TimbroPdfGrid.Rows[2].Cells[0].Style = tCellStyle2;
        TimbroPdfGrid.Rows[3].Cells[0].Style = tCellStyle3;
        TimbroPdfGrid.Rows[4].Cells[0].Style = tCellStyle4;
        TimbroPdfGrid.Rows[5].Cells[0].Style = tCellStyle5;
        TimbroPdfGrid.Rows[6].Cells[0].Style = tCellStyle6;

        // Set rows values
        val = new PdfTextElement("Dott. " + doctor, TimbroFont, PdfBrushes.Black);       // 0 - 0
        TimbroPdfGrid.Rows[0].Cells[0].Value = val;

        val = new PdfTextElement(specialization, TimbroFont, PdfBrushes.Black);          // 1 - 0
        TimbroPdfGrid.Rows[1].Cells[0].Value = val;

        val = new PdfTextElement(address, TimbroFont, PdfBrushes.Black);                 // 2 - 0
        TimbroPdfGrid.Rows[2].Cells[0].Value = val;

        val = new PdfTextElement(city, TimbroFont, PdfBrushes.Black);                    // 3 - 0
        TimbroPdfGrid.Rows[3].Cells[0].Value = val;

        val = new PdfTextElement(codfisc, TimbroFont, PdfBrushes.Black);                 // 4 - 0
        TimbroPdfGrid.Rows[4].Cells[0].Value = val;

        val = new PdfTextElement(piva, TimbroFont, PdfBrushes.Black);                    // 5 - 0
        TimbroPdfGrid.Rows[5].Cells[0].Value = val;

        val = new PdfTextElement(ordine, TimbroFont, PdfBrushes.Black);                  // 6 - 0
        TimbroPdfGrid.Rows[6].Cells[0].Value = val;

        // Draw PDF grid into the PDF page.
        TimbroPdfGrid.Draw(page, new Syncfusion.Drawing.PointF(350, result2.Bounds.Bottom + 20));
        #endregion

        //Create memory stream.
        MemoryStream memoryStream = new MemoryStream();

        //Save the PDF document.
        pdfDocument.Save(memoryStream);

        //Download the PDF document
        await JS.SaveAs("Prescrizione " + LName + " " + FName + "_" + pDataPrescrizione.Substring(0, 2) + "." + pDataPrescrizione.Substring(2, 2) + "." + pDataPrescrizione.Substring(4, 4) + ".pdf", memoryStream.ToArray());
    }

    async void PrintRelazione(string who)
    {
        int paragraphAfterSpacing = 8;
        // int cellMargin = 8;

        string doctor = "";
        string specialization = "";
        string address = "V.le R. Sanzio, 60 Tel 095 371701";
        string city = "CATANIA";
        string codfisc = "";
        string piva = "";
        string ordine = "";

        string iscrOrdine = "";

        if (who == "1")
        {
            doctor = "MARCO LA BRUNA";
            specialization = "Specialista in Oftalmologia";
            codfisc = "Cod. Fisc. LBR MRC 84M31 C351P";
            piva = "Partita IVA 05289740879";
            ordine = "Ordine dei Medici CT n° 14037";

            iscrOrdine = "Iscriz. Ord. Dei Medici di CT - Marco La Bruna n° 14037";
        }
        else
        {
            doctor = "PIETRO LA BRUNA";
            specialization = "Specialista in Oculistica";
            codfisc = "Cod. Fisc. LBR PTR 49T07 H221S";
            piva = "Partita IVA 00635170871";
            // ordine = "Ordine dei Medici CT n° 5133";

            iscrOrdine = "Iscriz. Ord. Dei Medici di CT - Pietro La Bruna n° 5133";
        }

        FirstPage = true;

        if (pDataRelazione.Length > 8)
        {
            var dds = pDataRelazione.Substring(0, 2) + "." + pDataRelazione.Substring(3, 2) + "." + pDataRelazione.Substring(6, 4);
            pDataRelazione = dds;
        }

        //Create a new PDF document.
        PdfDocument pdfDocument = new PdfDocument();

        // Add the event.
        // ------------------------------------------------------------------------------------------------------------------------
        pdfDocument.Pages.PageAdded += Pages_PageAdded;
        // ------------------------------------------------------------------------------------------------------------------------

        #region Definizione documento pdf
        // Set document information
        // ------------------------------------------------------------------------------------------------------------------------
        pdfDocument.DocumentInformation.Author = "Powered by Phoenix";
        pdfDocument.DocumentInformation.CreationDate = DateTime.Now;
        pdfDocument.DocumentInformation.Creator = "Ophthal";
        pdfDocument.DocumentInformation.Keywords = "Dott. " + doctor;
        pdfDocument.DocumentInformation.Subject = "Relazione";
        pdfDocument.DocumentInformation.Title = "Relazione " + LName + " " + FName + "_" + pDataRelazione.Substring(0, 2) + "." + pDataRelazione.Substring(2, 2) + "." + pDataRelazione.Substring(4, 4);

        // Set page size
        // ------------------------------------------------------------------------------------------------------------------------
        pdfDocument.PageSettings.Size = Syncfusion.Pdf.PdfPageSize.A4;

        // Set margin for all the pages
        pdfDocument.PageSettings.Margins.Left = 20F;
        pdfDocument.PageSettings.Margins.Right = 30F;
        pdfDocument.PageSettings.Margins.Top = 20F;
        pdfDocument.PageSettings.Margins.Bottom = 50F;
        // pdfDocument.PageSettings.Margins.Bottom = 10F;

        // pdfDocument.PageSettings.Margins.All = 40F;

        // Set page orientation
        // ------------------------------------------------------------------------------------------------------------------------
        pdfDocument.PageSettings.Orientation = PdfPageOrientation.Portrait;

        // Set paginate layout
        // ------------------------------------------------------------------------------------------------------------------------
        PdfLayoutFormat format = new PdfLayoutFormat();
        format.Layout = PdfLayoutType.Paginate;

        // Add page to the PDF document
        PdfPage page = pdfDocument.Pages.Add();

        // Obtain PdfGraphics object.
        PdfGraphics g = page.Graphics;
        #endregion

        #region Header & Footer
        // Create Header and Footer font
        // ------------------------------------------------------------------------------------------------------------------------
        PdfFont fontHeader = new PdfStandardFont(PdfFontFamily.Helvetica, 14, PdfFontStyle.Regular);
        PdfFont fontFooter = new PdfStandardFont(PdfFontFamily.Helvetica, 7, PdfFontStyle.Regular);

        #region Header
        // Get document's bounds
        // ------------------------------------------------------------------------------------------------------------------------
        RectangleF bounds = new RectangleF(0, 0, pdfDocument.Pages[0].GetClientSize().Width, 70);

        // Create a Page template that can be used as header.
        // ------------------------------------------------------------------------------------------------------------------------
        PdfPageTemplateElement header = new PdfPageTemplateElement(bounds);

        // Load image for header
        // Scarica l'immagine dal server
        var httpClient = new HttpClient();
        string imageUrl = $"{Env.BaseAddress}/img/LB_99_53.png";                      // URL dell'immagine
        var imageBytes = await httpClient.GetByteArrayAsync(imageUrl);

        PdfGridCellStyle HeadLogoStyle = new PdfGridCellStyle();
        HeadLogoStyle.Borders.Left.Width = 0F;
        HeadLogoStyle.Borders.Right.Width = 0F;
        HeadLogoStyle.Borders.Top.Width = 0F;
        HeadLogoStyle.Borders.Bottom.Width = 0F;
        HeadLogoStyle.CellPadding = new PdfPaddings(0, 0, 0, 0);

        // Setup font for Dati Testata
        PdfStandardFont SideFont = new PdfStandardFont(PdfFontFamily.TimesRoman, 10, PdfFontStyle.Bold | PdfFontStyle.Italic);
        PdfStandardFont hHeadFont = new PdfStandardFont(PdfFontFamily.TimesRoman, 16, PdfFontStyle.Bold | PdfFontStyle.Italic);

        PdfStandardFont PdPFont = new PdfStandardFont(PdfFontFamily.TimesRoman, 8, PdfFontStyle.Bold);
        PdfStandardFont FootFont = new PdfStandardFont(PdfFontFamily.TimesRoman, 9, PdfFontStyle.Bold | PdfFontStyle.Italic);

        // Specify the style for bottom
        PdfGridCellStyle HeadStyle = new PdfGridCellStyle();
        HeadStyle.Borders.Left.Width = 0F;
        HeadStyle.Borders.Right.Width = 0F;
        HeadStyle.Borders.Top.Width = 0F;
        HeadStyle.Borders.Bottom.Width = 0F;
        HeadStyle.CellPadding = new PdfPaddings(15, 10, 0, 0);
        HeadStyle.StringFormat = new PdfStringFormat(PdfTextAlignment.Center);

        // Usa un MemoryStream per creare il PdfBitmap
        using (MemoryStream imageStream = new MemoryStream(imageBytes))
        {
            PdfBitmap image = new PdfBitmap(imageStream);

            // Draw the image in the header.
            header.Graphics.DrawImage(image, 5, 15);
        }

        header.Graphics.DrawString("DOTT. " + doctor, hHeadFont, PdfBrushes.Black, 100, 14);
        header.Graphics.DrawString(specialization, hHeadFont, PdfBrushes.Black, 100, 36);

        PdfPen hPen = new PdfPen(Color.Black);
        hPen.Width = 0.1F;

        PointF hP1 = new PointF();
        PointF hP2 = new PointF();

        // linea verticale
        hP1.X = 85;
        hP1.Y = 0;

        hP2.X = 85;
        hP2.Y = 70;

        header.Graphics.DrawLine(hPen, hP1, hP2);

        // top linea orizzontale
        hP1.X = 0;
        hP1.Y = 70;

        hP2.X = 545;
        hP2.Y = 70;

        header.Graphics.DrawLine(hPen, hP1, hP2);

        // Add the header at the top.
        pdfDocument.Template.Top = header;
        #endregion

        #region Footer
        // Set document's bounds
        // ------------------------------------------------------------------------------------------------------------------------
        RectangleF fBounds = new RectangleF(0, 0, pdfDocument.Pages[0].GetClientSize().Width, 70);

        // Create a Page template that can be used as footer.
        // ------------------------------------------------------------------------------------------------------------------------
        PdfPageTemplateElement footer = new PdfPageTemplateElement(fBounds);

        PdfBrush brush = new PdfSolidBrush(Color.Black);

        // Create page number field.
        PdfPageNumberField pageNumber = new PdfPageNumberField(fontFooter, brush);

        // Create page count field.
        PdfPageCountField count = new PdfPageCountField(fontFooter, brush);

        // Add the fields in composite fields.
        PdfCompositeField compositeField = new PdfCompositeField(fontFooter, brush, "Pag. {0} di {1}", pageNumber, count);

        compositeField.Bounds = footer.Bounds;

        Console.WriteLine($"pageNumber: {pageNumber}, count: {count}");

        // Draw the composite field in footer.
        compositeField.Draw(footer.Graphics, new PointF(20, 28));

        footer.Graphics.DrawString("Viale Raffaello Sanzio, 60 – scala C, 5° piano – (Piazza Michelangelo) - 95128 Catania (CT)", FootFont, PdfBrushes.Black, 151, 8);
        footer.Graphics.DrawString("Riceve per appuntamento – Tel/Fax: 095371701", FootFont, PdfBrushes.Black, 230, 22);
        footer.Graphics.DrawString("Sito Web: http://www.studiolabruna.it – email: info@studiolabruna.it", FootFont, PdfBrushes.Black, 190, 36);
        footer.Graphics.DrawString(iscrOrdine, FootFont, PdfBrushes.Black, 212, 50);

        PdfPen fPen = new PdfPen(Color.Black);
        fPen.Width = 0.1F;

        PointF fP1 = new PointF();
        PointF fP2 = new PointF();

        // linea verticale
        fP1.X = 85;
        fP1.Y = 0;

        fP2.X = 85;
        fP2.Y = 70;

        footer.Graphics.DrawLine(fPen, fP1, fP2);

        // bottom linea orizzontale
        fP1.X = 0;
        fP1.Y = 0;

        fP2.X = 545;
        fP2.Y = 0;

        footer.Graphics.DrawLine(fPen, fP1, fP2);

        // Add the footer template at the bottom.
        pdfDocument.Template.Bottom = footer;
        #endregion
        #endregion

        #region Prima parte: Dati Testata
        PdfFont fieldPaziente = new PdfStandardFont(PdfFontFamily.Helvetica, 14, PdfFontStyle.Bold | PdfFontStyle.Italic);
        PdfFont fieldHelvBold = new PdfStandardFont(PdfFontFamily.Helvetica, 12, PdfFontStyle.Bold | PdfFontStyle.Italic);

        #region Imposta griglia Dati Testata
        // Create the head grid
        PdfGrid HeadPdfGrid = new PdfGrid();

        PdfGridCellStyle posCellStyleP0 = new PdfGridCellStyle();
        posCellStyleP0.Borders.Left.Width = 0;
        posCellStyleP0.Borders.Right.Width = 0;
        posCellStyleP0.Borders.Top.Width = 0;
        posCellStyleP0.Borders.Bottom.Width = 0;
        posCellStyleP0.CellPadding = new PdfPaddings(0, 3, 6, 0);

        PdfGridCellStyle posCellStyleP1 = new PdfGridCellStyle();
        posCellStyleP1.Borders.Left.Width = 0;
        posCellStyleP1.Borders.Right.Width = 0;
        posCellStyleP1.Borders.Top.Width = 0;
        posCellStyleP1.Borders.Bottom.Width = 0;
        posCellStyleP1.CellPadding = new PdfPaddings(0, 3, 12, 0);


        // Add the rows to head grid
        PdfGridRow row0 = HeadPdfGrid.Rows.Add();
        PdfGridRow row1 = HeadPdfGrid.Rows.Add();

        //Adding grid style
        PdfGridStyle gridStyle = new PdfGridStyle();

        //Allow grid to overflow horizontally
        gridStyle.AllowHorizontalOverflow = true;

        //Adding cell spacing between cells
        gridStyle.CellSpacing = 0F;

        HeadPdfGrid.Style = gridStyle;

        // Add the columns to head grid
        HeadPdfGrid.Columns.Add(2);

        // Set columns's width
        HeadPdfGrid.Columns[0].Width = 100;
        HeadPdfGrid.Columns[1].Width = 430;

        // Set columns merged
        // HeadPdfGrid.Rows[0].Cells[0].RowSpan = 2;
        #endregion

        #region Inserimento Dati Testata
        // Set the HeadPdfGrid's value
        PdfTextElement val;

        HeadPdfGrid.Rows[0].Cells[0].Style = posCellStyleP0;
        HeadPdfGrid.Rows[0].Cells[1].Style = posCellStyleP0;

        val = new PdfTextElement(" ", fieldPaziente, PdfBrushes.Black);                     // 0-0
        HeadPdfGrid.Rows[0].Cells[0].Value = val;

        val = new PdfTextElement(LName + " " + FName, fieldPaziente, PdfBrushes.Black);     // 0-1
        HeadPdfGrid.Rows[0].Cells[1].Value = val;

        HeadPdfGrid.Rows[1].Cells[0].Style = posCellStyleP1;
        HeadPdfGrid.Rows[1].Cells[1].Style = posCellStyleP1;

        val = new PdfTextElement(" ", fieldPaziente, PdfBrushes.Black);                     // 1-0
        HeadPdfGrid.Rows[1].Cells[0].Value = val;

        val = new PdfTextElement("presenta il seguente quadro oculare:", fieldHelvBold, PdfBrushes.Black);          // 1-1
        HeadPdfGrid.Rows[1].Cells[1].Value = val;

        PdfLayoutResult result = HeadPdfGrid.Draw(page, new Syncfusion.Drawing.PointF(0, 80));
        #endregion
        #endregion

        #region Seconda parte: Dati Relazione
        // Create field's name and field's font
        // ------------------------------------------------------------------------------------------------------------------------
        PdfFont fieldNameFont = new PdfStandardFont(PdfFontFamily.TimesRoman, 11, PdfFontStyle.Bold);
        PdfFont fieldFont = new PdfStandardFont(PdfFontFamily.Helvetica, 11, PdfFontStyle.Regular);

        PdfFont fieldDateFont = new PdfStandardFont(PdfFontFamily.Helvetica, 11, PdfFontStyle.Bold);
        PdfFont fieldValueFont = new PdfStandardFont(PdfFontFamily.Helvetica, 11, PdfFontStyle.Regular);

        PdfFont italicdFont = new PdfStandardFont(PdfFontFamily.Helvetica, 10, PdfFontStyle.Italic);

        #region Definizione stile celle Visita
        // Specify the style for head's cell
        PdfGridCellStyle posCellStyleEH = new PdfGridCellStyle();
        posCellStyleEH.Borders.Left.Width = 0;
        posCellStyleEH.Borders.Right.Width = 0;
        posCellStyleEH.Borders.Top.Width = 0;
        posCellStyleEH.Borders.Bottom.Width = 0;
        posCellStyleEH.CellPadding = new PdfPaddings(0, 0, 0, 0);

        PdfGridCellStyle posCellStyleH = new PdfGridCellStyle();
        posCellStyleH.Borders.Left.Width = 0;
        posCellStyleH.Borders.Right.Width = 0;
        posCellStyleH.Borders.Top.Width = 0;
        posCellStyleH.Borders.Bottom.Width = 0;
        posCellStyleH.CellPadding = new PdfPaddings(0, 3, 6, 2);

        PdfGridCellStyle posCellStyleV = new PdfGridCellStyle();
        posCellStyleV.Borders.Left.Width = 0;
        posCellStyleV.Borders.Right.Width = 0;
        posCellStyleV.Borders.Top.Width = 0;
        posCellStyleV.Borders.Bottom.Width = 0;
        posCellStyleV.CellPadding = new PdfPaddings(0, 3, 6, 2);

        PdfGridCellStyle posCellStyleH1 = new PdfGridCellStyle();
        posCellStyleH1.Borders.Left.Width = 0;
        posCellStyleH1.Borders.Right.Width = 0;
        posCellStyleH1.Borders.Top.Width = 0;
        posCellStyleH1.Borders.Bottom.Width = 0;
        posCellStyleH1.CellPadding = new PdfPaddings(0, 3, 0, 2);

        PdfGridCellStyle posCellStyleV1 = new PdfGridCellStyle();
        posCellStyleV1.Borders.Left.Width = 0;
        posCellStyleV1.Borders.Right.Width = 0;
        posCellStyleV1.Borders.Top.Width = 0;
        posCellStyleV1.Borders.Bottom.Width = 0;
        posCellStyleV1.CellPadding = new PdfPaddings(0, 3, 0, 2);

        PdfGridCellStyle posCellStyleH2 = new PdfGridCellStyle();
        posCellStyleH2.Borders.Left.Width = 0;
        posCellStyleH2.Borders.Right.Width = 0;
        posCellStyleH2.Borders.Top.Width = 0;
        posCellStyleH2.Borders.Bottom.Width = 0;
        posCellStyleH2.CellPadding = new PdfPaddings(0, 3, 0, 6);

        PdfGridCellStyle posCellStyleV2 = new PdfGridCellStyle();
        posCellStyleV2.Borders.Left.Width = 0;
        posCellStyleV2.Borders.Right.Width = 0;
        posCellStyleV2.Borders.Top.Width = 0;
        posCellStyleV2.Borders.Bottom.Width = 0;
        posCellStyleV2.CellPadding = new PdfPaddings(0, 3, 0, 6);

        PdfGridCellStyle posCellStyleH3 = new PdfGridCellStyle();
        posCellStyleH3.Borders.Left.Width = 0;
        posCellStyleH3.Borders.Right.Width = 0;
        posCellStyleH3.Borders.Top.Width = 0;
        posCellStyleH3.Borders.Bottom.Width = 0;
        posCellStyleH3.CellPadding = new PdfPaddings(0, 3, 12, 6);

        PdfGridCellStyle posCellStyleH4 = new PdfGridCellStyle();
        posCellStyleH4.Borders.Left.Width = 0;
        posCellStyleH4.Borders.Right.Width = 0;
        posCellStyleH4.Borders.Top.Width = 0;
        posCellStyleH4.Borders.Bottom.Width = 0;
        posCellStyleH4.CellPadding = new PdfPaddings(0, 3, 6, 6);

        PdfGridCellStyle posCellStyleN = new PdfGridCellStyle();
        posCellStyleN.Borders.Left.Width = 0;
        posCellStyleN.Borders.Right.Width = 0;
        posCellStyleN.Borders.Top.Width = 0;
        posCellStyleN.Borders.Bottom.Width = 0F;
        posCellStyleN.CellPadding = new PdfPaddings(3, 3, 14, 0);
        #endregion

        #region Imposta griglia Dati Visita
        // Create Grid
        PdfGrid RelPdfGrid = new PdfGrid();

        // Add Columns
        RelPdfGrid.Columns.Add(3);

        // Add Rows
        PdfGridRow rowV00 = RelPdfGrid.Rows.Add();    // "Diagnosi"
        PdfGridRow rowV01 = RelPdfGrid.Rows.Add();    // "OD," + DiagnosiOD
        PdfGridRow rowV02 = RelPdfGrid.Rows.Add();    // "OS," + DiagnosiOS

        PdfGridRow rowV03 = RelPdfGrid.Rows.Add();    // "Schirmer  test tipo 2 (basale)"
        PdfGridRow rowV04 = RelPdfGrid.Rows.Add();    // "OD," + SHIRMER_Od
        PdfGridRow rowV05 = RelPdfGrid.Rows.Add();    // "OS," + SHIRMER_Os

        PdfGridRow rowV06 = RelPdfGrid.Rows.Add();    // "Segmento anteriore"
        PdfGridRow rowV07 = RelPdfGrid.Rows.Add();    // "OD," + Seg_Ant_Od
        PdfGridRow rowV08 = RelPdfGrid.Rows.Add();    // "OS," + Seg_Ant_Os

        PdfGridRow rowV09 = RelPdfGrid.Rows.Add();    // "Visus"
        PdfGridRow rowV10 = RelPdfGrid.Rows.Add();    // "OD," + Visus_Od
        PdfGridRow rowV11 = RelPdfGrid.Rows.Add();    // "OS," + Visus_Os

        PdfGridRow rowV12 = RelPdfGrid.Rows.Add();    // "Tono oculare (valori normali fino a 20)"
        PdfGridRow rowV13 = RelPdfGrid.Rows.Add();    // "OD," + TONO_Od
        PdfGridRow rowV14 = RelPdfGrid.Rows.Add();    // "OS," + TONO_Os

        PdfGridRow rowV15 = RelPdfGrid.Rows.Add();    // "Fundus in midriasi con indentazione"
        PdfGridRow rowV16 = RelPdfGrid.Rows.Add();    // "OD," + Fundus_Od
        PdfGridRow rowV17 = RelPdfGrid.Rows.Add();    // "OS," + Fundus_Os

        PdfGridRow rowV18 = RelPdfGrid.Rows.Add();    // "Si rilascia su richiesta dell"interessato/a per gli usi consentiti dalla legge"
        PdfGridRow rowV19 = RelPdfGrid.Rows.Add();    // DateTime.Now.ToShortDateString()

        // Set Columns's width
        RelPdfGrid.Columns[0].Width = 100;
        RelPdfGrid.Columns[1].Width = 40;
        RelPdfGrid.Columns[2].Width = 390;

        // Set .Rows[0].Cells[0].RowSpan and Rows[0].Cells[2].ColumnSpan
        RelPdfGrid.Rows[0].Cells[1].ColumnSpan = 2;
        RelPdfGrid.Rows[3].Cells[1].ColumnSpan = 2;
        RelPdfGrid.Rows[6].Cells[1].ColumnSpan = 2;
        RelPdfGrid.Rows[9].Cells[1].ColumnSpan = 2;
        RelPdfGrid.Rows[12].Cells[1].ColumnSpan = 2;
        RelPdfGrid.Rows[15].Cells[1].ColumnSpan = 2;
        RelPdfGrid.Rows[18].Cells[1].ColumnSpan = 2;
        RelPdfGrid.Rows[19].Cells[1].ColumnSpan = 2;
        #endregion

        #region Inserimento Dati Relazione
        // Set the HeadPdfGrid's value
        PdfTextElement value;

        RelPdfGrid.Rows[0].Cells[0].Style = posCellStyleEH;           // colonna side bar
        RelPdfGrid.Rows[0].Cells[1].Style = posCellStyleH;            // "Diagnosi"

        RelPdfGrid.Rows[1].Cells[0].Style = posCellStyleEH;           // colonna side bar
        RelPdfGrid.Rows[1].Cells[1].Style = posCellStyleH1;           // "OD,"
        RelPdfGrid.Rows[1].Cells[2].Style = posCellStyleV1;           // DiagnosiOD

        RelPdfGrid.Rows[2].Cells[0].Style = posCellStyleEH;           // colonna side bar
        RelPdfGrid.Rows[2].Cells[1].Style = posCellStyleH2;           // "OS,"
        RelPdfGrid.Rows[2].Cells[2].Style = posCellStyleV2;           // DiagnosiOS

        RelPdfGrid.Rows[3].Cells[0].Style = posCellStyleEH;           // colonna side bar
        RelPdfGrid.Rows[3].Cells[1].Style = posCellStyleH;            // "Schirmer  test tipo 2 (basale)"

        RelPdfGrid.Rows[4].Cells[0].Style = posCellStyleEH;           // colonna side bar
        RelPdfGrid.Rows[4].Cells[1].Style = posCellStyleH1;           // "OD,"
        RelPdfGrid.Rows[4].Cells[2].Style = posCellStyleV1;           // SHIRMER_Od

        RelPdfGrid.Rows[5].Cells[0].Style = posCellStyleEH;           // colonna side bar
        RelPdfGrid.Rows[5].Cells[1].Style = posCellStyleH2;           // "OS,"
        RelPdfGrid.Rows[5].Cells[2].Style = posCellStyleV2;           // SHIRMER_Os

        RelPdfGrid.Rows[6].Cells[0].Style = posCellStyleEH;           // colonna side bar
        RelPdfGrid.Rows[6].Cells[1].Style = posCellStyleH;            // "Segmento anteriore"

        RelPdfGrid.Rows[7].Cells[0].Style = posCellStyleEH;           // colonna side bar
        RelPdfGrid.Rows[7].Cells[1].Style = posCellStyleH1;           // "OD,"
        RelPdfGrid.Rows[7].Cells[2].Style = posCellStyleV1;           // Seg_Ant_Od

        RelPdfGrid.Rows[8].Cells[0].Style = posCellStyleEH;           // colonna side bar
        RelPdfGrid.Rows[8].Cells[1].Style = posCellStyleH2;           // "OS,"
        RelPdfGrid.Rows[8].Cells[2].Style = posCellStyleV2;           // Seg_Ant_Os

        RelPdfGrid.Rows[9].Cells[0].Style = posCellStyleEH;           // colonna side bar
        RelPdfGrid.Rows[9].Cells[1].Style = posCellStyleH;            // "Visus"

        RelPdfGrid.Rows[10].Cells[0].Style = posCellStyleEH;          // colonna side bar
        RelPdfGrid.Rows[10].Cells[1].Style = posCellStyleH1;          // "OD,"
        RelPdfGrid.Rows[10].Cells[2].Style = posCellStyleV1;          // Visus_Od

        RelPdfGrid.Rows[11].Cells[0].Style = posCellStyleEH;          // colonna side bar
        RelPdfGrid.Rows[11].Cells[1].Style = posCellStyleH2;          // "OD,"
        RelPdfGrid.Rows[11].Cells[2].Style = posCellStyleV2;          // Visus_Os

        RelPdfGrid.Rows[12].Cells[0].Style = posCellStyleEH;          // colonna side bar
        RelPdfGrid.Rows[12].Cells[1].Style = posCellStyleH;           // "Tono oculare (valori normali fino a 20)"

        RelPdfGrid.Rows[13].Cells[0].Style = posCellStyleEH;          // colonna side bar
        RelPdfGrid.Rows[13].Cells[1].Style = posCellStyleH1;          // "OD,"
        RelPdfGrid.Rows[13].Cells[2].Style = posCellStyleV1;          // TONO_Od

        RelPdfGrid.Rows[14].Cells[0].Style = posCellStyleEH;          // colonna side bar
        RelPdfGrid.Rows[14].Cells[1].Style = posCellStyleH2;          // "OD,"
        RelPdfGrid.Rows[14].Cells[2].Style = posCellStyleV2;          // TONO_Os

        RelPdfGrid.Rows[15].Cells[0].Style = posCellStyleEH;          // colonna side bar
        RelPdfGrid.Rows[15].Cells[1].Style = posCellStyleH;           // "Fundus in midriasi con indentazione"

        RelPdfGrid.Rows[16].Cells[0].Style = posCellStyleEH;          // colonna side bar
        RelPdfGrid.Rows[16].Cells[1].Style = posCellStyleH1;          // "OD,"
        RelPdfGrid.Rows[16].Cells[2].Style = posCellStyleV1;          // Fundus_Od

        RelPdfGrid.Rows[17].Cells[0].Style = posCellStyleEH;          // colonna side bar
        RelPdfGrid.Rows[17].Cells[1].Style = posCellStyleH2;          // "OD,"
        RelPdfGrid.Rows[17].Cells[2].Style = posCellStyleV2;          // Fundus_Os

        RelPdfGrid.Rows[18].Cells[0].Style = posCellStyleEH;          // colonna side bar
        RelPdfGrid.Rows[18].Cells[1].Style = posCellStyleH3;          // "Si rilascia su richiesta dell"interessato/a per gli usi consentiti dalla legge"

        RelPdfGrid.Rows[19].Cells[0].Style = posCellStyleEH;          // colonna side bar
        RelPdfGrid.Rows[19].Cells[1].Style = posCellStyleH4;          // DateTime.Now.ToShortDateString()


        value = new PdfTextElement("", fieldFont, PdfBrushes.Black);
        RelPdfGrid.Rows[0].Cells[0].Value = value;
        value = new PdfTextElement("Diagnosi", fieldNameFont, PdfBrushes.Black);
        RelPdfGrid.Rows[0].Cells[1].Value = value;

        value = new PdfTextElement("", fieldFont, PdfBrushes.Black);
        RelPdfGrid.Rows[1].Cells[0].Value = value;
        value = new PdfTextElement("OD,", fieldNameFont, PdfBrushes.Black);
        RelPdfGrid.Rows[1].Cells[1].Value = value;
        value = new PdfTextElement(FillEmpty(Relazione.DiagnosiOD), fieldFont, PdfBrushes.Black);
        RelPdfGrid.Rows[1].Cells[2].Value = value;

        value = new PdfTextElement("", fieldFont, PdfBrushes.Black);
        RelPdfGrid.Rows[2].Cells[0].Value = value;
        value = new PdfTextElement("OS,", fieldNameFont, PdfBrushes.Black);
        RelPdfGrid.Rows[2].Cells[1].Value = value;
        value = new PdfTextElement(FillEmpty(Relazione.DiagnosiOS), fieldFont, PdfBrushes.Black);
        RelPdfGrid.Rows[2].Cells[2].Value = value;

        value = new PdfTextElement("", fieldFont, PdfBrushes.Black);
        RelPdfGrid.Rows[3].Cells[0].Value = value;
        value = new PdfTextElement("Schirmer  test tipo 2 (basale)", fieldNameFont, PdfBrushes.Black);
        RelPdfGrid.Rows[3].Cells[1].Value = value;

        value = new PdfTextElement("", fieldFont, PdfBrushes.Black);
        RelPdfGrid.Rows[4].Cells[0].Value = value;
        value = new PdfTextElement("OD,", fieldNameFont, PdfBrushes.Black);
        RelPdfGrid.Rows[4].Cells[1].Value = value;
        value = new PdfTextElement(FillEmpty(Relazione.SHIRMER_Od), fieldFont, PdfBrushes.Black);
        RelPdfGrid.Rows[4].Cells[2].Value = value;

        value = new PdfTextElement("", fieldFont, PdfBrushes.Black);
        RelPdfGrid.Rows[5].Cells[0].Value = value;
        value = new PdfTextElement("OS,", fieldNameFont, PdfBrushes.Black);
        RelPdfGrid.Rows[5].Cells[1].Value = value;
        value = new PdfTextElement(FillEmpty(Relazione.SHIRMER_Os), fieldFont, PdfBrushes.Black);
        RelPdfGrid.Rows[5].Cells[2].Value = value;

        value = new PdfTextElement("", fieldFont, PdfBrushes.Black);
        RelPdfGrid.Rows[6].Cells[0].Value = value;
        value = new PdfTextElement("Segmento anteriore", fieldNameFont, PdfBrushes.Black);
        RelPdfGrid.Rows[6].Cells[1].Value = value;

        value = new PdfTextElement("", fieldFont, PdfBrushes.Black);
        RelPdfGrid.Rows[7].Cells[0].Value = value;
        value = new PdfTextElement("OD,", fieldNameFont, PdfBrushes.Black);
        RelPdfGrid.Rows[7].Cells[1].Value = value;
        value = new PdfTextElement(FillEmpty(Relazione.Seg_Ant_Od), fieldFont, PdfBrushes.Black);
        RelPdfGrid.Rows[7].Cells[2].Value = value;

        value = new PdfTextElement("", fieldFont, PdfBrushes.Black);
        RelPdfGrid.Rows[8].Cells[0].Value = value;
        value = new PdfTextElement("OS,", fieldNameFont, PdfBrushes.Black);
        RelPdfGrid.Rows[8].Cells[1].Value = value;
        value = new PdfTextElement(FillEmpty(Relazione.Seg_Ant_Os), fieldFont, PdfBrushes.Black);
        RelPdfGrid.Rows[8].Cells[2].Value = value;

        value = new PdfTextElement("", fieldFont, PdfBrushes.Black);
        RelPdfGrid.Rows[9].Cells[0].Value = value;
        value = new PdfTextElement("Visus", fieldNameFont, PdfBrushes.Black);
        RelPdfGrid.Rows[9].Cells[1].Value = value;

        value = new PdfTextElement("", fieldFont, PdfBrushes.Black);
        RelPdfGrid.Rows[10].Cells[0].Value = value;
        value = new PdfTextElement("OD,", fieldNameFont, PdfBrushes.Black);
        RelPdfGrid.Rows[10].Cells[1].Value = value;
        value = new PdfTextElement(FillEmpty(Relazione.Visus_Od), fieldFont, PdfBrushes.Black);
        RelPdfGrid.Rows[10].Cells[2].Value = value;

        value = new PdfTextElement("", fieldFont, PdfBrushes.Black);
        RelPdfGrid.Rows[11].Cells[0].Value = value;
        value = new PdfTextElement("OS,", fieldNameFont, PdfBrushes.Black);
        RelPdfGrid.Rows[11].Cells[1].Value = value;
        value = new PdfTextElement(FillEmpty(Relazione.Visus_Os), fieldFont, PdfBrushes.Black);
        RelPdfGrid.Rows[11].Cells[2].Value = value;

        value = new PdfTextElement("", fieldFont, PdfBrushes.Black);
        RelPdfGrid.Rows[12].Cells[0].Value = value;
        value = new PdfTextElement("Tono oculare (valori normali fino a 20)", fieldNameFont, PdfBrushes.Black);
        RelPdfGrid.Rows[12].Cells[1].Value = value;

        value = new PdfTextElement("", fieldFont, PdfBrushes.Black);
        RelPdfGrid.Rows[13].Cells[0].Value = value;
        value = new PdfTextElement("OD,", fieldNameFont, PdfBrushes.Black);
        RelPdfGrid.Rows[13].Cells[1].Value = value;
        value = new PdfTextElement(FillEmpty(Relazione.TONO_Od), fieldFont, PdfBrushes.Black);
        RelPdfGrid.Rows[13].Cells[2].Value = value;

        value = new PdfTextElement("", fieldFont, PdfBrushes.Black);
        RelPdfGrid.Rows[14].Cells[0].Value = value;
        value = new PdfTextElement("OS,", fieldNameFont, PdfBrushes.Black);
        RelPdfGrid.Rows[14].Cells[1].Value = value;
        value = new PdfTextElement(FillEmpty(Relazione.TONO_Os), fieldFont, PdfBrushes.Black);
        RelPdfGrid.Rows[14].Cells[2].Value = value;

        value = new PdfTextElement("", fieldFont, PdfBrushes.Black);
        RelPdfGrid.Rows[15].Cells[0].Value = value;
        value = new PdfTextElement("Fundus in midriasi con indentazione", fieldNameFont, PdfBrushes.Black);
        RelPdfGrid.Rows[15].Cells[1].Value = value;

        value = new PdfTextElement("", fieldFont, PdfBrushes.Black);
        RelPdfGrid.Rows[16].Cells[0].Value = value;
        value = new PdfTextElement("OD,", fieldNameFont, PdfBrushes.Black);
        RelPdfGrid.Rows[16].Cells[1].Value = value;
        value = new PdfTextElement(FillEmpty(Relazione.Fundus_Od), fieldFont, PdfBrushes.Black);
        RelPdfGrid.Rows[16].Cells[2].Value = value;

        value = new PdfTextElement("", fieldFont, PdfBrushes.Black);
        RelPdfGrid.Rows[17].Cells[0].Value = value;
        value = new PdfTextElement("OS,", fieldNameFont, PdfBrushes.Black);
        RelPdfGrid.Rows[17].Cells[1].Value = value;
        value = new PdfTextElement(FillEmpty(Relazione.Fundus_Os), fieldFont, PdfBrushes.Black);
        RelPdfGrid.Rows[17].Cells[2].Value = value;

        value = new PdfTextElement("", fieldFont, PdfBrushes.Black);
        RelPdfGrid.Rows[18].Cells[0].Value = value;
        value = new PdfTextElement("Si rilascia su richiesta dell'interessato / a per gli usi consentiti dalla legge", fieldNameFont, PdfBrushes.Black);
        RelPdfGrid.Rows[18].Cells[1].Value = value;

        //value = new PdfTextElement(DateTime.Now.ToShortDateString(), fieldNameFont, PdfBrushes.Black);
        value = new PdfTextElement("", fieldFont, PdfBrushes.Black);
        RelPdfGrid.Rows[19].Cells[0].Value = value;
        var TmpDate = pDataRelazione.Substring(0, 2) + "/" + pDataRelazione.Substring(2, 2) + "/" + pDataRelazione.Substring(4, 4);
        Console.WriteLine($"pDataRelazione: {pDataRelazione}");

        value = new PdfTextElement(TmpDate, fieldNameFont, PdfBrushes.Black);
        RelPdfGrid.Rows[19].Cells[1].Value = value;
        #endregion

        // Draw PDF grid into the PDF page.
        // RelPdfGrid.Draw(page, new Syncfusion.Drawing.PointF(0, result.Bounds.Bottom + 24));

        PdfLayoutResult result2 = RelPdfGrid.Draw(page, new Syncfusion.Drawing.PointF(0, result.Bounds.Bottom + 24));
        #endregion

        #region Timbro
        PdfStandardFont TimbroFont = new PdfStandardFont(PdfFontFamily.TimesRoman, 8, PdfFontStyle.Bold);

        PdfGrid TimbroPdfGrid = new PdfGrid();

        TimbroPdfGrid.AllowRowBreakAcrossPages = false;

        PdfGridCellStyle tCellStyle0 = new PdfGridCellStyle();
        PdfGridCellStyle tCellStyle1 = new PdfGridCellStyle();
        PdfGridCellStyle tCellStyle2 = new PdfGridCellStyle();
        PdfGridCellStyle tCellStyle3 = new PdfGridCellStyle();
        PdfGridCellStyle tCellStyle4 = new PdfGridCellStyle();
        PdfGridCellStyle tCellStyle5 = new PdfGridCellStyle();
        PdfGridCellStyle tCellStyle6 = new PdfGridCellStyle();

        tCellStyle2.Borders.Left.Width = 0F;
        tCellStyle2.Borders.Right.Width = 0F;
        tCellStyle2.Borders.Top.Width = 0F;
        tCellStyle2.Borders.Bottom.Width = 0F;
        tCellStyle2.CellPadding = new PdfPaddings(16F, 0, 1F, 0);

        tCellStyle3.Borders.Left.Width = 0F;
        tCellStyle3.Borders.Right.Width = 0F;
        tCellStyle3.Borders.Top.Width = 0F;
        tCellStyle3.Borders.Bottom.Width = 0F;
        tCellStyle3.CellPadding = new PdfPaddings(53.2F, 0, 1F, 0);

        if (who == "1")     // Marco
        {
            tCellStyle0.Borders.Left.Width = 0F;
            tCellStyle0.Borders.Right.Width = 0F;
            tCellStyle0.Borders.Top.Width = 0F;
            tCellStyle0.Borders.Bottom.Width = 0F;
            tCellStyle0.CellPadding = new PdfPaddings(25.3F, 0, 0, 0);

            tCellStyle1.Borders.Left.Width = 0F;
            tCellStyle1.Borders.Right.Width = 0F;
            tCellStyle1.Borders.Top.Width = 0F;
            tCellStyle1.Borders.Bottom.Width = 0F;
            tCellStyle1.CellPadding = new PdfPaddings(26F, 0, 1F, 0);

            tCellStyle4.Borders.Left.Width = 0F;
            tCellStyle4.Borders.Right.Width = 0F;
            tCellStyle4.Borders.Top.Width = 0F;
            tCellStyle4.Borders.Bottom.Width = 0F;
            tCellStyle4.CellPadding = new PdfPaddings(10.3F, 0, 1F, 0);

            tCellStyle5.Borders.Left.Width = 0F;
            tCellStyle5.Borders.Right.Width = 0F;
            tCellStyle5.Borders.Top.Width = 0F;
            tCellStyle5.Borders.Bottom.Width = 0F;
            tCellStyle5.CellPadding = new PdfPaddings(28.9F, 0, 1F, 0);

            tCellStyle6.Borders.Left.Width = 0F;
            tCellStyle6.Borders.Right.Width = 0F;
            tCellStyle6.Borders.Top.Width = 0F;
            tCellStyle6.Borders.Bottom.Width = 0F;
            tCellStyle6.CellPadding = new PdfPaddings(18.9F, 0, 1F, 0);
        }
        else                // Pietro
        {
            tCellStyle0.Borders.Left.Width = 0F;
            tCellStyle0.Borders.Right.Width = 0F;
            tCellStyle0.Borders.Top.Width = 0F;
            tCellStyle0.Borders.Bottom.Width = 0F;
            tCellStyle0.CellPadding = new PdfPaddings(25.3F, 0, 0, 0);

            tCellStyle1.Borders.Left.Width = 0F;
            tCellStyle1.Borders.Right.Width = 0F;
            tCellStyle1.Borders.Top.Width = 0F;
            tCellStyle1.Borders.Bottom.Width = 0F;
            tCellStyle1.CellPadding = new PdfPaddings(31.8F, 0, 1F, 0);

            tCellStyle4.Borders.Left.Width = 0F;
            tCellStyle4.Borders.Right.Width = 0F;
            tCellStyle4.Borders.Top.Width = 0F;
            tCellStyle4.Borders.Bottom.Width = 0F;
            tCellStyle4.CellPadding = new PdfPaddings(12.5F, 0, 1F, 0);

            tCellStyle5.Borders.Left.Width = 0F;
            tCellStyle5.Borders.Right.Width = 0F;
            tCellStyle5.Borders.Top.Width = 0F;
            tCellStyle5.Borders.Bottom.Width = 0F;
            tCellStyle5.CellPadding = new PdfPaddings(28.9F, 0, 1F, 0);

            tCellStyle6.Borders.Left.Width = 0F;
            tCellStyle6.Borders.Right.Width = 0F;
            tCellStyle6.Borders.Top.Width = 0F;
            tCellStyle6.Borders.Bottom.Width = 0F;
            tCellStyle6.CellPadding = new PdfPaddings(20.3F, 0, 1F, 0);
        }

        // Add rows to the DataTable.
        PdfGridRow trow0 = TimbroPdfGrid.Rows.Add();
        PdfGridRow trow1 = TimbroPdfGrid.Rows.Add();
        PdfGridRow trow2 = TimbroPdfGrid.Rows.Add();
        PdfGridRow trow3 = TimbroPdfGrid.Rows.Add();
        PdfGridRow trow4 = TimbroPdfGrid.Rows.Add();
        PdfGridRow trow5 = TimbroPdfGrid.Rows.Add();
        PdfGridRow trow6 = TimbroPdfGrid.Rows.Add();

        // Add the columns to head grid
        TimbroPdfGrid.Columns.Add(1);

        // Adding grid cell style
        PdfGridCellStyle cellStyle = new PdfGridCellStyle();
        cellStyle.Borders.Left.Width = 0.1F;
        cellStyle.Borders.Right.Width = 0.1F;
        cellStyle.Borders.Top.Width = 0.1F;
        cellStyle.Borders.Bottom.Width = 0.1F;

        //Set cell paddings.
        cellStyle.CellPadding = new PdfPaddings(10, 0, 0, 0);

        // Set columns's width
        TimbroPdfGrid.Columns[0].Width = 150;

        //Applying style to grid
        TimbroPdfGrid.Rows[0].Cells[0].Style = tCellStyle0;
        TimbroPdfGrid.Rows[1].Cells[0].Style = tCellStyle1;
        TimbroPdfGrid.Rows[2].Cells[0].Style = tCellStyle2;
        TimbroPdfGrid.Rows[3].Cells[0].Style = tCellStyle3;
        TimbroPdfGrid.Rows[4].Cells[0].Style = tCellStyle4;
        TimbroPdfGrid.Rows[5].Cells[0].Style = tCellStyle5;
        TimbroPdfGrid.Rows[6].Cells[0].Style = tCellStyle6;

        // Set rows values
        val = new PdfTextElement("Dott. " + doctor, TimbroFont, PdfBrushes.Black);       // 0 - 0
        TimbroPdfGrid.Rows[0].Cells[0].Value = val;

        val = new PdfTextElement(specialization, TimbroFont, PdfBrushes.Black);          // 1 - 0
        TimbroPdfGrid.Rows[1].Cells[0].Value = val;

        val = new PdfTextElement(address, TimbroFont, PdfBrushes.Black);                 // 2 - 0
        TimbroPdfGrid.Rows[2].Cells[0].Value = val;

        val = new PdfTextElement(city, TimbroFont, PdfBrushes.Black);                    // 3 - 0
        TimbroPdfGrid.Rows[3].Cells[0].Value = val;

        val = new PdfTextElement(codfisc, TimbroFont, PdfBrushes.Black);                 // 4 - 0
        TimbroPdfGrid.Rows[4].Cells[0].Value = val;

        val = new PdfTextElement(piva, TimbroFont, PdfBrushes.Black);                    // 5 - 0
        TimbroPdfGrid.Rows[5].Cells[0].Value = val;

        val = new PdfTextElement(ordine, TimbroFont, PdfBrushes.Black);                  // 6 - 0
        TimbroPdfGrid.Rows[6].Cells[0].Value = val;

        // Draw PDF grid into the PDF page.
        TimbroPdfGrid.Draw(page, new Syncfusion.Drawing.PointF(350, result2.Bounds.Bottom + 20));
        #endregion

        //Create memory stream.
        MemoryStream memoryStream = new MemoryStream();

        //Save the PDF document.
        pdfDocument.Save(memoryStream);

        //Download the PDF document
        await JS.SaveAs("Relazione " + LName + " " + FName + "_" + pDataRelazione.Substring(0, 2) + "." + pDataRelazione.Substring(2, 2) + "." + pDataRelazione.Substring(4, 4) + ".pdf", memoryStream.ToArray());
    }

    async void PrintRel()
    {
        int paragraphAfterSpacing = 8;
        // int cellMargin = 8;

        //Create a new PDF document.
        PdfDocument pdfDocument = new PdfDocument();

        #region Definizione documento pdf
        // Set document information
        // ------------------------------------------------------------------------------------------------------------------------
        pdfDocument.DocumentInformation.Author = "Powered by Phoenix";
        pdfDocument.DocumentInformation.CreationDate = DateTime.Now;
        pdfDocument.DocumentInformation.Creator = "Ophthal";
        pdfDocument.DocumentInformation.Keywords = "Dott. La Bruna";
        pdfDocument.DocumentInformation.Subject = "Relazione";
        pdfDocument.DocumentInformation.Title = "Relazione " + ListaVisite[VisitaCorrente].Val.ToString("dd.MM.yyyy");

        // Set page size
        // ------------------------------------------------------------------------------------------------------------------------
        pdfDocument.PageSettings.Size = Syncfusion.Pdf.PdfPageSize.A4;

        // Set margin for all the pages
        pdfDocument.PageSettings.Margins.Left = 20F;
        pdfDocument.PageSettings.Margins.Right = 40F;
        pdfDocument.PageSettings.Margins.Top = 20F;
        pdfDocument.PageSettings.Margins.Bottom = 50F;

        // pdfDocument.PageSettings.Margins.All = 40F;

        // Set page orientation
        // ------------------------------------------------------------------------------------------------------------------------
        pdfDocument.PageSettings.Orientation = PdfPageOrientation.Portrait;

        // Set paginate layout
        // ------------------------------------------------------------------------------------------------------------------------
        PdfLayoutFormat format = new PdfLayoutFormat();
        format.Layout = PdfLayoutType.Paginate;

        // Add page to the PDF document
        PdfPage page = pdfDocument.Pages.Add();

        // Obtain PdfGraphics object.
        PdfGraphics g = page.Graphics;
        #endregion

        #region Header & Footer
        // Create Header and Footer font
        // ------------------------------------------------------------------------------------------------------------------------
        PdfFont fontHeader = new PdfStandardFont(PdfFontFamily.TimesRoman, 16, PdfFontStyle.Bold | PdfFontStyle.Italic);
        PdfFont fontFooter = new PdfStandardFont(PdfFontFamily.TimesRoman, 9, PdfFontStyle.Bold | PdfFontStyle.Italic);

        #region Header
        // Get document's bounds
        // ------------------------------------------------------------------------------------------------------------------------
        RectangleF hBounds = new RectangleF(0, 0, pdfDocument.Pages[0].GetClientSize().Width, 70);

        // Create a Page template that can be used as header.
        // ------------------------------------------------------------------------------------------------------------------------
        PdfPageTemplateElement header = new PdfPageTemplateElement(hBounds);

        // Load image for header
        // Scarica l'immagine dal server
        var httpClient = new HttpClient();
        string imageUrl = $"{Env.BaseAddress}/img/LB_99_53.png";                      // URL dell'immagine
        var imageBytes = await httpClient.GetByteArrayAsync(imageUrl);

        PdfGridCellStyle HeadLogoStyle = new PdfGridCellStyle();
        HeadLogoStyle.Borders.Left.Width = 0F;
        HeadLogoStyle.Borders.Right.Width = 0F;
        HeadLogoStyle.Borders.Top.Width = 0F;
        HeadLogoStyle.Borders.Bottom.Width = 0F;
        HeadLogoStyle.CellPadding = new PdfPaddings(0, 0, 0, 0);

        // Setup font for Dati Testata
        PdfStandardFont SideFont = new PdfStandardFont(PdfFontFamily.TimesRoman, 10, PdfFontStyle.Bold | PdfFontStyle.Italic);
        PdfStandardFont hHeadFont = new PdfStandardFont(PdfFontFamily.TimesRoman, 16, PdfFontStyle.Bold | PdfFontStyle.Italic);

        PdfStandardFont PdPFont = new PdfStandardFont(PdfFontFamily.TimesRoman, 8, PdfFontStyle.Bold);
        PdfStandardFont FootFont = new PdfStandardFont(PdfFontFamily.TimesRoman, 9, PdfFontStyle.Bold | PdfFontStyle.Italic);

        // Specify the style for bottom
        PdfGridCellStyle HeadStyle = new PdfGridCellStyle();
        HeadStyle.Borders.Left.Width = 0F;
        HeadStyle.Borders.Right.Width = 0F;
        HeadStyle.Borders.Top.Width = 0F;
        HeadStyle.Borders.Bottom.Width = 0F;
        HeadStyle.CellPadding = new PdfPaddings(15, 10, 0, 0);
        HeadStyle.StringFormat = new PdfStringFormat(PdfTextAlignment.Center);

        // Usa un MemoryStream per creare il PdfBitmap
        using (MemoryStream imageStream = new MemoryStream(imageBytes))
        {
            PdfBitmap image = new PdfBitmap(imageStream);

            // Draw the image in the page
            //g.DrawImage(image, 5, 0);

            // Draw the image in the header
            header.Graphics.DrawImage(image, 5, 15);
        }

        header.Graphics.DrawString("STUDIO OCULISTICO", fontHeader, PdfBrushes.Red, 120, 14);
        header.Graphics.DrawString("DOTT. PIETRO LA BRUNA", fontHeader, PdfBrushes.Red, 120, 36);

        PdfPen hPen = new PdfPen(Color.Coral);
        hPen.Width = 0.1F;

        PointF hP1 = new PointF();
        PointF hP2 = new PointF();

        // linea verticale
        hP1.X = 85;
        hP1.Y = 0;

        hP2.X = 85;
        hP2.Y = 70;

        header.Graphics.DrawLine(hPen, hP1, hP2);

        // 1a linea orizzontale
        hP1.X = 0;
        hP1.Y = 70;

        hP2.X = 530;
        hP2.Y = 70;

        header.Graphics.DrawLine(hPen, hP1, hP2);

        // Add the header at the top.
        pdfDocument.Template.Top = header;
        #endregion

        #region Footer
        // Set document's bounds
        // ------------------------------------------------------------------------------------------------------------------------
        RectangleF fBounds = new RectangleF(0, 0, pdfDocument.Pages[0].GetClientSize().Width, 70);

        // Create a Page template that can be used as footer.
        // ------------------------------------------------------------------------------------------------------------------------
        PdfPageTemplateElement footer = new PdfPageTemplateElement(fBounds);

        PdfBrush brush = new PdfSolidBrush(Color.Black);

        // // Create page date of printing field.
        // PdfTextElement pageDatePrint = new PdfTextElement("Printed on " + DateTime.Now.ToShortDateString(), fontFooter, brush);


        // Create page number field.
        PdfPageNumberField pageNumber = new PdfPageNumberField(fontFooter, brush);

        // Create page count field.
        PdfPageCountField count = new PdfPageCountField(fontFooter, brush);

        // Add the fields in composite fields.
        PdfCompositeField compositeField = new PdfCompositeField(fontFooter, brush, "Pag. {0} di {1}", pageNumber, count);

        compositeField.Bounds = footer.Bounds;

        Console.WriteLine($"pageNumber: {pageNumber}, count: {count}");

        // // Draw the text element and store its layout information
        // pageDatePrint.Draw(footer.Graphics, new PointF(0, 40));

        // Draw the composite field in footer.
        compositeField.Draw(footer.Graphics, new PointF(20, 28));

        footer.Graphics.DrawString("Viale Raffaello Sanzio, 60 – scala C, 5° piano – (Piazza Michelangelo) - 95128 Catania (CT)", FootFont, PdfBrushes.ForestGreen, 141, 8);
        footer.Graphics.DrawString("Riceve per appuntamento – Tel/Fax: 095371701", FootFont, PdfBrushes.ForestGreen, 220, 22);
        footer.Graphics.DrawString("Sito Web: http://www.studiolabruna.it – email: info@studiolabruna.it", FootFont, PdfBrushes.ForestGreen, 180, 36);
        footer.Graphics.DrawString("Iscriz. Ord. Dei Medici di CT- Pietro La Bruna n° 5133 / Marco La Bruna n° 14037", FootFont, PdfBrushes.ForestGreen, 152, 50);

        PdfPen fPen = new PdfPen(Color.Coral);
        fPen.Width = 0.1F;

        PointF fP1 = new PointF();
        PointF fP2 = new PointF();

        // linea verticale
        fP1.X = 85;
        fP1.Y = 0;

        fP2.X = 85;
        fP2.Y = 70;

        footer.Graphics.DrawLine(fPen, fP1, fP2);

        // 1a linea orizzontale
        fP1.X = 0;
        fP1.Y = 0;

        fP2.X = 530;
        fP2.Y = 0;

        footer.Graphics.DrawLine(fPen, fP1, fP2);

        // Add the footer template at the bottom.
        pdfDocument.Template.Bottom = footer;
        #endregion
        #endregion

        #region Prima parte: Dati Testata
        #region Imposta griglia Dati Testata
        // Create the head grid
        PdfGrid HeadPdfGrid = new PdfGrid();

        // Add the rows to head grid
        PdfGridRow row0 = HeadPdfGrid.Rows.Add();
        PdfGridRow row1 = HeadPdfGrid.Rows.Add();

        //Adding grid style
        PdfGridStyle gridStyle = new PdfGridStyle();

        //Allow grid to overflow horizontally
        gridStyle.AllowHorizontalOverflow = true;

        //Adding cell spacing between cells
        gridStyle.CellSpacing = 0F;

        HeadPdfGrid.Style = gridStyle;

        // Add the columns to head grid
        // HeadPdfGrid.Columns.Add(2);
        HeadPdfGrid.Columns.Add(1);

        // Set columns's width
        // HeadPdfGrid.Columns[0].Width = 100;
        // HeadPdfGrid.Columns[1].Width = 430;
        HeadPdfGrid.Columns[0].Width = 430;

        // Set columns merged
        // HeadPdfGrid.Rows[0].Cells[0].RowSpan = 2;
        #endregion

        #region Inserimento Dati Testata
        // Set the HeadPdfGrid's value
        PdfTextElement val;

        // HeadPdfGrid.Rows[0].Cells[0].Style = HeadLogoStyle;
        // HeadPdfGrid.Rows[0].Cells[0].ImagePosition = PdfGridImagePosition.Tile;             // 0-0

        // HeadPdfGrid.Rows[0].Cells[1].Style = HeadStyle;

        // val = new PdfTextElement("STUDIO OCULISTICO", hHeadFont, PdfBrushes.Black);         // 0-1
        // HeadPdfGrid.Rows[0].Cells[1].Value = val;

        // // HeadPdfGrid.Rows[1].Cells[0].Style = HeadStyle;
        // HeadPdfGrid.Rows[1].Cells[1].Style = HeadStyle;

        // val = new PdfTextElement("DOTT. PIETRO LA BRUNA", hHeadFont, PdfBrushes.Black);     // 0-1
        // HeadPdfGrid.Rows[1].Cells[1].Value = val;

        // PdfLayoutResult result = HeadPdfGrid.Draw(page, new Syncfusion.Drawing.PointF(0, 0));

        HeadPdfGrid.Rows[0].Cells[0].Style = HeadStyle;

        val = new PdfTextElement("STUDIO OCULISTICO", hHeadFont, PdfBrushes.Black);         // 0-1
        HeadPdfGrid.Rows[0].Cells[0].Value = val;

        // HeadPdfGrid.Rows[1].Cells[0].Style = HeadStyle;
        HeadPdfGrid.Rows[1].Cells[0].Style = HeadStyle;

        val = new PdfTextElement("DOTT. PIETRO LA BRUNA", hHeadFont, PdfBrushes.Black);     // 0-1
        HeadPdfGrid.Rows[1].Cells[0].Value = val;

        // PdfLayoutResult result = HeadPdfGrid.Draw(page, new Syncfusion.Drawing.PointF(100, 75));

        // Console.WriteLine($"X: {result.Bounds.X}, Y: {result.Bounds.Y}, Size: {result.Bounds.Size}, Bottom: {result.Bounds.Bottom}");
        #endregion
        #endregion


        PdfPen pen = new PdfPen(Color.Black);
        pen.Width = 0.1F;

        PointF p1 = new PointF();
        PointF p2 = new PointF();

        // linea verticale
        p1.X = 85;
        p1.Y = 70;

        p2.X = 85;
        p2.Y = 702;

        g.DrawLine(pen, p1, p2);

        // // linea verticale
        // p1.X = 530;
        // p1.Y = 0;

        // p2.X = 530;
        // p2.Y = 840;

        // g.DrawLine(pen, p1, p2);

        // // 1a linea orizzontale
        // p1.X = 0;
        // p1.Y = 70;

        // p2.X = 530;
        // p2.Y = 70;

        // g.DrawLine(pen, p1, p2);

        // // 2a linea orizzontale
        // p1.X = 0;
        // p1.Y = 695;

        // p2.X = 530;
        // p2.Y = 695;

        // g.DrawLine(pen, p1, p2);

        g.DrawString("Microchirurgia", SideFont, PdfBrushes.Black, 0, 104);
        g.DrawString("Oculare", SideFont, PdfBrushes.Black, 0, 116);

        g.DrawString("Chirurgia", SideFont, PdfBrushes.Black, 0, 166);
        g.DrawString("Palpebrale", SideFont, PdfBrushes.Black, 0, 178);

        g.DrawString("Chirurgia", SideFont, PdfBrushes.Black, 0, 228);
        g.DrawString("Refrattiva", SideFont, PdfBrushes.Black, 0, 240);

        g.DrawString("Laser Terapia", SideFont, PdfBrushes.Black, 0, 290);

        g.DrawString("Topografia", SideFont, PdfBrushes.Black, 0, 340);
        g.DrawString("Corneale", SideFont, PdfBrushes.Black, 0, 352);

        g.DrawString("Ecografia", SideFont, PdfBrushes.Black, 0, 402);

        g.DrawString("Fluorangiografia", SideFont, PdfBrushes.Black, 0, 452);

        g.DrawString("Campo Visivo", SideFont, PdfBrushes.Black, 0, 502);

        g.DrawString("E.R.G e P.E.V.", SideFont, PdfBrushes.Black, 0, 552);

        g.DrawString("Tomografia", SideFont, PdfBrushes.Black, 0, 602);
        g.DrawString("Coerenza Ottica", SideFont, PdfBrushes.Black, 0, 614);
        g.DrawString("(O.C.T.)", SideFont, PdfBrushes.Black, 0, 626);

        g.DrawString("H.R.T.", SideFont, PdfBrushes.Black, 0, 676);


        // g.DrawString("Dott. PIETRO LA BRUNA", PdPFont, PdfBrushes.Black, 364, 610);
        // g.DrawString("Specialista in OCULISTICA", PdPFont, PdfBrushes.Black, 361, 620);
        // g.DrawString("V.le R. Sanzio,60 Tel 095 371701", PdPFont, PdfBrushes.Black, 354, 630);
        // g.DrawString("CATANIA", PdPFont, PdfBrushes.Black, 391, 640);
        // g.DrawString("Cod. Fisc. LBR PTR 49T07 H221S", PdPFont, PdfBrushes.Black, 350, 650);
        // g.DrawString("Partita IVA 00635170871", PdPFont, PdfBrushes.Black, 368, 660);


        // g.DrawString("Viale Raffaello Sanzio, 60 – scala C, 5° piano – (Piazza Michelangelo) - 95128 Catania (CT)", FootFont, PdfBrushes.Black, 141, 705);
        // g.DrawString("Riceve per appuntamento – Tel/Fax: 095371701", FootFont, PdfBrushes.Black, 220, 719);
        // g.DrawString("Sito Web: http://www.studiolabruna.it – email: info@studiolabruna.it", FootFont, PdfBrushes.Black, 180, 733);
        // g.DrawString("Iscriz. Ord. Dei Medici di CT- Pietro La Bruna n° 5133 / Marco La Bruna n° 14037", FootFont, PdfBrushes.Black, 152, 747);

        #region Seconda parte: Dati Relazione
        // Create field's name and field's font
        // ------------------------------------------------------------------------------------------------------------------------
        PdfFont fieldPaziente = new PdfStandardFont(PdfFontFamily.Helvetica, 14, PdfFontStyle.Bold | PdfFontStyle.Italic);
        PdfFont fieldHelvBold = new PdfStandardFont(PdfFontFamily.Helvetica, 12, PdfFontStyle.Bold | PdfFontStyle.Italic);
        PdfFont fieldNameFont = new PdfStandardFont(PdfFontFamily.TimesRoman, 11, PdfFontStyle.Bold);
        PdfFont fieldFont = new PdfStandardFont(PdfFontFamily.Helvetica, 11, PdfFontStyle.Regular);

        #region Definizione stile celle Visita
        // Specify the style for head's cell
        PdfGridCellStyle posCellStyleP0 = new PdfGridCellStyle();
        posCellStyleP0.Borders.Left.Width = 0;
        posCellStyleP0.Borders.Right.Width = 0;
        posCellStyleP0.Borders.Top.Width = 0;
        posCellStyleP0.Borders.Bottom.Width = 0;
        posCellStyleP0.CellPadding = new PdfPaddings(0, 3, 6, 0);

        PdfGridCellStyle posCellStyleP1 = new PdfGridCellStyle();
        posCellStyleP1.Borders.Left.Width = 0;
        posCellStyleP1.Borders.Right.Width = 0;
        posCellStyleP1.Borders.Top.Width = 0;
        posCellStyleP1.Borders.Bottom.Width = 0;
        posCellStyleP1.CellPadding = new PdfPaddings(0, 3, 0, 12);

        PdfGridCellStyle posCellStyleH = new PdfGridCellStyle();
        posCellStyleH.Borders.Left.Width = 0;
        posCellStyleH.Borders.Right.Width = 0;
        posCellStyleH.Borders.Top.Width = 0;
        posCellStyleH.Borders.Bottom.Width = 0;
        posCellStyleH.CellPadding = new PdfPaddings(0, 3, 6, 2);

        PdfGridCellStyle posCellStyleV = new PdfGridCellStyle();
        posCellStyleV.Borders.Left.Width = 0;
        posCellStyleV.Borders.Right.Width = 0;
        posCellStyleV.Borders.Top.Width = 0;
        posCellStyleV.Borders.Bottom.Width = 0;
        posCellStyleV.CellPadding = new PdfPaddings(0, 3, 6, 2);

        PdfGridCellStyle posCellStyleH1 = new PdfGridCellStyle();
        posCellStyleH1.Borders.Left.Width = 0;
        posCellStyleH1.Borders.Right.Width = 0;
        posCellStyleH1.Borders.Top.Width = 0;
        posCellStyleH1.Borders.Bottom.Width = 0;
        posCellStyleH1.CellPadding = new PdfPaddings(0, 3, 0, 2);

        PdfGridCellStyle posCellStyleV1 = new PdfGridCellStyle();
        posCellStyleV1.Borders.Left.Width = 0;
        posCellStyleV1.Borders.Right.Width = 0;
        posCellStyleV1.Borders.Top.Width = 0;
        posCellStyleV1.Borders.Bottom.Width = 0;
        posCellStyleV1.CellPadding = new PdfPaddings(0, 3, 0, 2);

        PdfGridCellStyle posCellStyleH2 = new PdfGridCellStyle();
        posCellStyleH2.Borders.Left.Width = 0;
        posCellStyleH2.Borders.Right.Width = 0;
        posCellStyleH2.Borders.Top.Width = 0;
        posCellStyleH2.Borders.Bottom.Width = 0;
        posCellStyleH2.CellPadding = new PdfPaddings(0, 3, 0, 6);

        PdfGridCellStyle posCellStyleV2 = new PdfGridCellStyle();
        posCellStyleV2.Borders.Left.Width = 0;
        posCellStyleV2.Borders.Right.Width = 0;
        posCellStyleV2.Borders.Top.Width = 0;
        posCellStyleV2.Borders.Bottom.Width = 0;
        posCellStyleV2.CellPadding = new PdfPaddings(0, 3, 0, 6);

        PdfGridCellStyle posCellStyleH3 = new PdfGridCellStyle();
        posCellStyleH3.Borders.Left.Width = 0;
        posCellStyleH3.Borders.Right.Width = 0;
        posCellStyleH3.Borders.Top.Width = 0;
        posCellStyleH3.Borders.Bottom.Width = 0;
        posCellStyleH3.CellPadding = new PdfPaddings(0, 3, 12, 6);

        PdfGridCellStyle posCellStyleH4 = new PdfGridCellStyle();
        posCellStyleH4.Borders.Left.Width = 0;
        posCellStyleH4.Borders.Right.Width = 0;
        posCellStyleH4.Borders.Top.Width = 0;
        posCellStyleH4.Borders.Bottom.Width = 0;
        posCellStyleH4.CellPadding = new PdfPaddings(0, 3, 6, 6);
        #endregion

        #region Imposta griglia Dati Relazione
        // Create Grid
        PdfGrid RelPdfGrid = new PdfGrid();

        // Add Rows
        PdfGridRow rowV00 = RelPdfGrid.Rows.Add();    // cognome e nome
        PdfGridRow rowV01 = RelPdfGrid.Rows.Add();    // "presenta il seguente quadro oculare:"

        PdfGridRow rowV02 = RelPdfGrid.Rows.Add();    // "Diagnosi"
        PdfGridRow rowV03 = RelPdfGrid.Rows.Add();    // "OD," + DiagnosiOD
        PdfGridRow rowV04 = RelPdfGrid.Rows.Add();    // "OS," + DiagnosiOS

        PdfGridRow rowV05 = RelPdfGrid.Rows.Add();    // "Schirmer  test tipo 2 (basale)"
        PdfGridRow rowV06 = RelPdfGrid.Rows.Add();    // "OD," + SHIRMER_Od
        PdfGridRow rowV07 = RelPdfGrid.Rows.Add();    // "OS," + SHIRMER_Os

        PdfGridRow rowV08 = RelPdfGrid.Rows.Add();    // "Segmento anteriore"
        PdfGridRow rowV09 = RelPdfGrid.Rows.Add();    // "OD," + Seg_Ant_Od
        PdfGridRow rowV10 = RelPdfGrid.Rows.Add();    // "OS," + Seg_Ant_Os

        PdfGridRow rowV11 = RelPdfGrid.Rows.Add();    // "Visus"
        PdfGridRow rowV12 = RelPdfGrid.Rows.Add();    // "OD," + Visus_Od
        PdfGridRow rowV13 = RelPdfGrid.Rows.Add();    // "OS," + Visus_Os

        PdfGridRow rowV14 = RelPdfGrid.Rows.Add();    // "Tono oculare (valori normali fino a 20)"
        PdfGridRow rowV15 = RelPdfGrid.Rows.Add();    // "OD," + TONO_Od
        PdfGridRow rowV16 = RelPdfGrid.Rows.Add();    // "OS," + TONO_Os

        PdfGridRow rowV17 = RelPdfGrid.Rows.Add();    // "Fundus in midriasi con indentazione"
        PdfGridRow rowV18 = RelPdfGrid.Rows.Add();    // "OD," + Fundus_Od
        PdfGridRow rowV19 = RelPdfGrid.Rows.Add();    // "OS," + Fundus_Os

        PdfGridRow rowV20 = RelPdfGrid.Rows.Add();    // "Si rilascia su richiesta dell"interessato/a per gli usi consentiti dalla legge"
        PdfGridRow rowV21 = RelPdfGrid.Rows.Add();    // DateTime.Now.ToShortDateString()

        // Add Columns
        RelPdfGrid.Columns.Add(3);

        // Set Columns's width
        RelPdfGrid.Columns[0].Width = 100;
        RelPdfGrid.Columns[1].Width = 40;
        RelPdfGrid.Columns[2].Width = 370;

        // Set .Rows[0].Cells[0].RowSpan and Rows[0].Cells[2].ColumnSpan
        RelPdfGrid.Rows[0].Cells[0].RowSpan = 22;

        RelPdfGrid.Rows[0].Cells[1].ColumnSpan = 2;

        RelPdfGrid.Rows[1].Cells[1].ColumnSpan = 2;

        RelPdfGrid.Rows[2].Cells[1].ColumnSpan = 2;
        RelPdfGrid.Rows[5].Cells[1].ColumnSpan = 2;
        RelPdfGrid.Rows[8].Cells[1].ColumnSpan = 2;
        RelPdfGrid.Rows[11].Cells[1].ColumnSpan = 2;
        RelPdfGrid.Rows[14].Cells[1].ColumnSpan = 2;
        RelPdfGrid.Rows[17].Cells[1].ColumnSpan = 2;

        RelPdfGrid.Rows[20].Cells[1].ColumnSpan = 2;
        RelPdfGrid.Rows[21].Cells[1].ColumnSpan = 2;
        #endregion

        #region Inserimento Dati Relazione
        // Set the HeadPdfGrid's value
        PdfTextElement value;

        RelPdfGrid.Rows[0].Cells[0].Style = posCellStyleP0;           // cella vuota

        RelPdfGrid.Rows[0].Cells[1].Style = posCellStyleP0;           // cognome e nome

        RelPdfGrid.Rows[1].Cells[1].Style = posCellStyleP1;           // "presenta il seguente quadro oculare:"

        RelPdfGrid.Rows[2].Cells[1].Style = posCellStyleH;            // "Diagnosi"
        RelPdfGrid.Rows[3].Cells[1].Style = posCellStyleH1;           // "OD,"
        RelPdfGrid.Rows[3].Cells[2].Style = posCellStyleV1;           // DiagnosiOD
        RelPdfGrid.Rows[4].Cells[1].Style = posCellStyleH2;           // "OS,"
        RelPdfGrid.Rows[4].Cells[2].Style = posCellStyleV2;           // DiagnosiOS

        RelPdfGrid.Rows[5].Cells[1].Style = posCellStyleH;            // "Schirmer  test tipo 2 (basale)"
        RelPdfGrid.Rows[6].Cells[1].Style = posCellStyleH1;           // "OD,"
        RelPdfGrid.Rows[6].Cells[2].Style = posCellStyleV1;           // SHIRMER_Od
        RelPdfGrid.Rows[7].Cells[1].Style = posCellStyleH2;           // "OS,"
        RelPdfGrid.Rows[7].Cells[2].Style = posCellStyleV2;           // SHIRMER_Os

        RelPdfGrid.Rows[8].Cells[1].Style = posCellStyleH;            // "Segmento anteriore"
        RelPdfGrid.Rows[9].Cells[1].Style = posCellStyleH1;           // "OD,"
        RelPdfGrid.Rows[9].Cells[2].Style = posCellStyleV1;           // Seg_Ant_Od
        RelPdfGrid.Rows[10].Cells[1].Style = posCellStyleH2;          // "OS,"
        RelPdfGrid.Rows[10].Cells[2].Style = posCellStyleV2;          // Seg_Ant_Os

        RelPdfGrid.Rows[11].Cells[1].Style = posCellStyleH;           // "Visus"
        RelPdfGrid.Rows[12].Cells[1].Style = posCellStyleH1;          // "OD,"
        RelPdfGrid.Rows[12].Cells[2].Style = posCellStyleV1;          // Visus_Od
        RelPdfGrid.Rows[13].Cells[1].Style = posCellStyleH2;          // "OD,"
        RelPdfGrid.Rows[13].Cells[2].Style = posCellStyleV2;          // Visus_Os

        RelPdfGrid.Rows[14].Cells[1].Style = posCellStyleH;           // "Tono oculare (valori normali fino a 20)"
        RelPdfGrid.Rows[15].Cells[1].Style = posCellStyleH1;          // "OD,"
        RelPdfGrid.Rows[15].Cells[2].Style = posCellStyleV1;          // TONO_Od
        RelPdfGrid.Rows[16].Cells[1].Style = posCellStyleH2;          // "OD,"
        RelPdfGrid.Rows[16].Cells[2].Style = posCellStyleV2;          // TONO_Os

        RelPdfGrid.Rows[17].Cells[1].Style = posCellStyleH;           // "Fundus in midriasi con indentazione"
        RelPdfGrid.Rows[18].Cells[1].Style = posCellStyleH1;          // "OD,"
        RelPdfGrid.Rows[18].Cells[2].Style = posCellStyleV1;          // Fundus_Od
        RelPdfGrid.Rows[19].Cells[1].Style = posCellStyleH2;          // "OD,"
        RelPdfGrid.Rows[19].Cells[2].Style = posCellStyleV2;          // Fundus_Os

        RelPdfGrid.Rows[20].Cells[1].Style = posCellStyleH3;          // "Si rilascia su richiesta dell"interessato/a per gli usi consentiti dalla legge"

        RelPdfGrid.Rows[21].Cells[1].Style = posCellStyleH4;          // DateTime.Now.ToShortDateString()

        value = new PdfTextElement(LName + " " + FName, fieldPaziente, PdfBrushes.Black);
        RelPdfGrid.Rows[0].Cells[1].Value = value;

        value = new PdfTextElement("presenta il seguente quadro oculare:", fieldHelvBold, PdfBrushes.Black);
        RelPdfGrid.Rows[1].Cells[1].Value = value;

        value = new PdfTextElement("Diagnosi", fieldNameFont, PdfBrushes.Black);
        RelPdfGrid.Rows[2].Cells[1].Value = value;

        value = new PdfTextElement("OD,", fieldNameFont, PdfBrushes.Black);
        RelPdfGrid.Rows[3].Cells[1].Value = value;
        value = new PdfTextElement(FillEmpty(Relazione.DiagnosiOD), fieldFont, PdfBrushes.Black);
        RelPdfGrid.Rows[3].Cells[2].Value = value;

        value = new PdfTextElement("OS,", fieldNameFont, PdfBrushes.Black);
        RelPdfGrid.Rows[4].Cells[1].Value = value;
        value = new PdfTextElement(FillEmpty(Relazione.DiagnosiOS), fieldFont, PdfBrushes.Black);
        RelPdfGrid.Rows[4].Cells[2].Value = value;

        value = new PdfTextElement("Schirmer  test tipo 2 (basale)", fieldNameFont, PdfBrushes.Black);
        RelPdfGrid.Rows[5].Cells[1].Value = value;

        value = new PdfTextElement("OD,", fieldNameFont, PdfBrushes.Black);
        RelPdfGrid.Rows[6].Cells[1].Value = value;
        value = new PdfTextElement(FillEmpty(Relazione.SHIRMER_Od), fieldFont, PdfBrushes.Black);
        RelPdfGrid.Rows[6].Cells[2].Value = value;

        value = new PdfTextElement("OS,", fieldNameFont, PdfBrushes.Black);
        RelPdfGrid.Rows[7].Cells[1].Value = value;
        value = new PdfTextElement(FillEmpty(Relazione.SHIRMER_Os), fieldFont, PdfBrushes.Black);
        RelPdfGrid.Rows[7].Cells[2].Value = value;

        value = new PdfTextElement("Segmento anteriore", fieldNameFont, PdfBrushes.Black);
        RelPdfGrid.Rows[8].Cells[1].Value = value;

        value = new PdfTextElement("OD,", fieldNameFont, PdfBrushes.Black);
        RelPdfGrid.Rows[9].Cells[1].Value = value;
        value = new PdfTextElement(FillEmpty(Relazione.Seg_Ant_Od), fieldFont, PdfBrushes.Black);
        RelPdfGrid.Rows[9].Cells[2].Value = value;

        value = new PdfTextElement("OS,", fieldNameFont, PdfBrushes.Black);
        RelPdfGrid.Rows[10].Cells[1].Value = value;
        value = new PdfTextElement(FillEmpty(Relazione.Seg_Ant_Os), fieldFont, PdfBrushes.Black);
        RelPdfGrid.Rows[10].Cells[2].Value = value;

        value = new PdfTextElement("Visus", fieldNameFont, PdfBrushes.Black);
        RelPdfGrid.Rows[11].Cells[1].Value = value;

        value = new PdfTextElement("OD,", fieldNameFont, PdfBrushes.Black);
        RelPdfGrid.Rows[12].Cells[1].Value = value;
        value = new PdfTextElement(FillEmpty(Relazione.Visus_Od), fieldFont, PdfBrushes.Black);
        RelPdfGrid.Rows[12].Cells[2].Value = value;

        value = new PdfTextElement("OS,", fieldNameFont, PdfBrushes.Black);
        RelPdfGrid.Rows[13].Cells[1].Value = value;
        value = new PdfTextElement(FillEmpty(Relazione.Visus_Os), fieldFont, PdfBrushes.Black);
        RelPdfGrid.Rows[13].Cells[2].Value = value;

        value = new PdfTextElement("Tono oculare (valori normali fino a 20)", fieldNameFont, PdfBrushes.Black);
        RelPdfGrid.Rows[14].Cells[1].Value = value;

        value = new PdfTextElement("OD,", fieldNameFont, PdfBrushes.Black);
        RelPdfGrid.Rows[15].Cells[1].Value = value;
        value = new PdfTextElement(FillEmpty(Relazione.TONO_Od), fieldFont, PdfBrushes.Black);
        RelPdfGrid.Rows[15].Cells[2].Value = value;

        value = new PdfTextElement("OS,", fieldNameFont, PdfBrushes.Black);
        RelPdfGrid.Rows[16].Cells[1].Value = value;
        value = new PdfTextElement(FillEmpty(Relazione.TONO_Os), fieldFont, PdfBrushes.Black);
        RelPdfGrid.Rows[16].Cells[2].Value = value;

        value = new PdfTextElement("Fundus in midriasi con indentazione", fieldNameFont, PdfBrushes.Black);
        RelPdfGrid.Rows[17].Cells[1].Value = value;

        value = new PdfTextElement("OD,", fieldNameFont, PdfBrushes.Black);
        RelPdfGrid.Rows[18].Cells[1].Value = value;
        value = new PdfTextElement(FillEmpty(Relazione.Fundus_Od), fieldFont, PdfBrushes.Black);
        RelPdfGrid.Rows[18].Cells[2].Value = value;

        value = new PdfTextElement("OS,", fieldNameFont, PdfBrushes.Black);
        RelPdfGrid.Rows[19].Cells[1].Value = value;
        value = new PdfTextElement(FillEmpty(Relazione.Fundus_Os), fieldFont, PdfBrushes.Black);
        RelPdfGrid.Rows[19].Cells[2].Value = value;

        value = new PdfTextElement("Si rilascia su richiesta dell'interessato / a per gli usi consentiti dalla legge", fieldNameFont, PdfBrushes.Black);
        RelPdfGrid.Rows[20].Cells[1].Value = value;

        value = new PdfTextElement(DateTime.Now.ToShortDateString(), fieldNameFont, PdfBrushes.Black);
        RelPdfGrid.Rows[21].Cells[1].Value = value;
        #endregion

        #region PdfGrid Firma
        // Define cell's style
        PdfGridCellStyle FirmaStyle0 = new PdfGridCellStyle();
        FirmaStyle0.Borders.Left.Width = 0;
        FirmaStyle0.Borders.Right.Width = 0;
        FirmaStyle0.Borders.Top.Width = 0;
        FirmaStyle0.Borders.Bottom.Width = 0;
        FirmaStyle0.CellPadding = new PdfPaddings(14, 0, 0, 0);

        PdfGridCellStyle FirmaStyle1 = new PdfGridCellStyle();
        FirmaStyle1.Borders.Left.Width = 0;
        FirmaStyle1.Borders.Right.Width = 0;
        FirmaStyle1.Borders.Top.Width = 0;
        FirmaStyle1.Borders.Bottom.Width = 0;
        FirmaStyle1.CellPadding = new PdfPaddings(11, 0, 0, 0);

        PdfGridCellStyle FirmaStyle2 = new PdfGridCellStyle();
        FirmaStyle2.Borders.Left.Width = 0;
        FirmaStyle2.Borders.Right.Width = 0;
        FirmaStyle2.Borders.Top.Width = 0;
        FirmaStyle2.Borders.Bottom.Width = 0;
        FirmaStyle2.CellPadding = new PdfPaddings(4, 0, 0, 0);

        PdfGridCellStyle FirmaStyle3 = new PdfGridCellStyle();
        FirmaStyle3.Borders.Left.Width = 0;
        FirmaStyle3.Borders.Right.Width = 0;
        FirmaStyle3.Borders.Top.Width = 0;
        FirmaStyle3.Borders.Bottom.Width = 0;
        FirmaStyle3.CellPadding = new PdfPaddings(41, 0, 0, 0);

        PdfGridCellStyle FirmaStyle4 = new PdfGridCellStyle();
        FirmaStyle4.Borders.Left.Width = 0;
        FirmaStyle4.Borders.Right.Width = 0;
        FirmaStyle4.Borders.Top.Width = 0;
        FirmaStyle4.Borders.Bottom.Width = 0;
        FirmaStyle4.CellPadding = new PdfPaddings(0, 0, 0, 0);

        PdfGridCellStyle FirmaStyle5 = new PdfGridCellStyle();
        FirmaStyle5.Borders.Left.Width = 0;
        FirmaStyle5.Borders.Right.Width = 0;
        FirmaStyle5.Borders.Top.Width = 0;
        FirmaStyle5.Borders.Bottom.Width = 0;
        FirmaStyle5.CellPadding = new PdfPaddings(18, 0, 0, 0);

        // Create Grid
        PdfGrid FirmaPdfGrid = new PdfGrid();

        // Add Rows
        PdfGridRow rowF00 = FirmaPdfGrid.Rows.Add();    // "Dott. PIETRO LA BRUNA"
        PdfGridRow rowF01 = FirmaPdfGrid.Rows.Add();    // "Specialista in OCULISTICA"

        PdfGridRow rowF02 = FirmaPdfGrid.Rows.Add();    // "V.le R. Sanzio,60 Tel 095 371701"
        PdfGridRow rowF03 = FirmaPdfGrid.Rows.Add();    // "CATANIA"

        PdfGridRow rowF04 = FirmaPdfGrid.Rows.Add();    // "Cod. Fisc. LBR PTR 49T07 H221S"
        PdfGridRow rowF05 = FirmaPdfGrid.Rows.Add();    // "Partita IVA 00635170871"

        // Add Columns
        FirmaPdfGrid.Columns.Add(1);

        // Set Columns's width
        FirmaPdfGrid.Columns[0].Width = 120;

        // Assign style to cells
        FirmaPdfGrid.Rows[0].Cells[0].Style = FirmaStyle0;
        FirmaPdfGrid.Rows[1].Cells[0].Style = FirmaStyle1;
        FirmaPdfGrid.Rows[2].Cells[0].Style = FirmaStyle2;
        FirmaPdfGrid.Rows[3].Cells[0].Style = FirmaStyle3;
        FirmaPdfGrid.Rows[4].Cells[0].Style = FirmaStyle4;
        FirmaPdfGrid.Rows[5].Cells[0].Style = FirmaStyle5;

        // Insert values in the cells
        value = new PdfTextElement("Dott. PIETRO LA BRUNA", PdPFont, PdfBrushes.Black);
        FirmaPdfGrid.Rows[0].Cells[0].Value = value;

        value = new PdfTextElement("Specialista in OCULISTICA", PdPFont, PdfBrushes.Black);
        FirmaPdfGrid.Rows[1].Cells[0].Value = value;

        value = new PdfTextElement("V.le R. Sanzio,60 Tel 095 371701", PdPFont, PdfBrushes.Black);
        FirmaPdfGrid.Rows[2].Cells[0].Value = value;

        value = new PdfTextElement("CATANIA", PdPFont, PdfBrushes.Black);
        FirmaPdfGrid.Rows[3].Cells[0].Value = value;

        value = new PdfTextElement("Cod. Fisc. LBR PTR 49T07 H221S", PdPFont, PdfBrushes.Black);
        FirmaPdfGrid.Rows[4].Cells[0].Value = value;

        value = new PdfTextElement("Partita IVA 00635170871", PdPFont, PdfBrushes.Black);
        FirmaPdfGrid.Rows[5].Cells[0].Value = value;
        #endregion
        #endregion

        //PdfLayoutResult result = HeadPdfGrid.Draw(page, new Syncfusion.Drawing.PointF(100, 75));

        // Draw PDF grid into the PDF page.
        PdfLayoutResult result = RelPdfGrid.Draw(page, new Syncfusion.Drawing.PointF(0, 75));

        Console.WriteLine($"X: {result.Bounds.X}, Y: {result.Bounds.Y}, Size: {result.Bounds.Size}, Bottom: {result.Bounds.Bottom}");

        float bt;

        var bts = result.Bounds.Bottom.ToString().Split(",");

        if (float.Parse(bts[1]) > 684)
        {
            bt = float.Parse(bts[0]);
        }
        else
        {
            bt = float.Parse(bts[1]);
        }

        Console.WriteLine($"bt: {bt}");

        FirmaPdfGrid.Draw(page, new Syncfusion.Drawing.PointF(355, bt + 20));

        Console.WriteLine($"X: {result.Bounds.X}, Y: {result.Bounds.Y}, Size: {result.Bounds.Size}, Bottom: {result.Bounds.Bottom}");

        var pp = page.Size;

        Console.WriteLine($"page size: {page.Size}");

        //Create memory stream.
        MemoryStream memoryStream = new MemoryStream();

        //Save the PDF document.
        pdfDocument.Save(memoryStream);

        //Download the PDF document
        await JS.SaveAs("Relazione_" + ListaVisite[VisitaCorrente].Val.ToString("dd.MM.yyyy") + ".pdf", memoryStream.ToArray());
    }
    #endregion
}
